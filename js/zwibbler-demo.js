/**
   Zwibbler

   Copyright 2019 Hanov Solutions Inc. All Rights Reserved. This software is
   NOT open source. For licensing information, contact the author.

   steve.hanov@gmail.com

   @license
 */
(function(){var __extends = (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function () { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function () { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __values = (this && this.__values) || function (o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
};
var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,b){c!=Array.prototype&&c!=Object.prototype&&(c[a]=b.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(){ca=function(){};ba.Symbol||(ba.Symbol=da)}var da=function(){var c=0;return function(a){return"jscomp_symbol_"+(a||"")+c++}}();
function ea(){ca();var c=ba.Symbol.iterator;c||(c=ba.Symbol.iterator=ba.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&aa(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return fa(this)}});ea=function(){}}function fa(c){var a=0;return ha(function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}})}function ha(c){ea();c={next:c};c[ba.Symbol.iterator]=function(){return this};return c}
function ia(c,a){ea();c instanceof String&&(c+="");var b=0,d={next:function(){if(b<c.length){var e=b++;return{value:a(e,c[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d}function ja(c,a){if(a){for(var b=ba,d=c.split("."),e=0;e<d.length-1;e++){var f=d[e];f in b||(b[f]={});b=b[f]}d=d[d.length-1];e=b[d];f=a(e);f!=e&&null!=f&&aa(b,d,{configurable:!0,writable:!0,value:f})}}
ja("Array.prototype.values",function(c){return c?c:function(){return ia(this,function(a,b){return b})}});ja("Array.prototype.keys",function(c){return c?c:function(){return ia(this,function(a){return a})}});function ka(c){ea();var a=c[Symbol.iterator];return a?a.call(c):fa(c)}
ja("Promise",function(c){function a(a){this.qc=0;this.An=void 0;this.Fg=[];var b=this.Wl();try{a(b.resolve,b.reject)}catch(l){b.reject(l)}}function b(){this.Ae=null}function d(b){return b instanceof a?b:new a(function(a){a(b)})}if(c)return c;b.prototype.op=function(a){null==this.Ae&&(this.Ae=[],this.ht());this.Ae.push(a)};b.prototype.ht=function(){var a=this;this.pp(function(){a.lu()})};var e=ba.setTimeout;b.prototype.pp=function(a){e(a,0)};b.prototype.lu=function(){for(;this.Ae&&this.Ae.length;){var a=
this.Ae;this.Ae=[];for(var b=0;b<a.length;++b){var d=a[b];a[b]=null;try{d()}catch(n){this.it(n)}}}this.Ae=null};b.prototype.it=function(a){this.pp(function(){throw a;})};a.prototype.Wl=function(){function a(a){return function(e){d||(d=!0,a.call(b,e))}}var b=this,d=!1;return{resolve:a(this.ux),reject:a(this.tn)}};a.prototype.ux=function(b){if(b===this)this.tn(new TypeError("A Promise cannot resolve to itself"));else if(b instanceof a)this.by(b);else{a:switch(typeof b){case "object":var d=null!=b;break a;
case "function":d=!0;break a;default:d=!1}d?this.tx(b):this.$p(b)}};a.prototype.tx=function(a){var b=void 0;try{b=a.then}catch(l){this.tn(l);return}"function"==typeof b?this.cy(b,a):this.$p(a)};a.prototype.tn=function(a){this.Sr(2,a)};a.prototype.$p=function(a){this.Sr(1,a)};a.prototype.Sr=function(a,b){if(0!=this.qc)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.qc);this.qc=a;this.An=b;this.mu()};a.prototype.mu=function(){if(null!=this.Fg){for(var a=0;a<this.Fg.length;++a)f.op(this.Fg[a]);
this.Fg=null}};var f=new b;a.prototype.by=function(a){var b=this.Wl();a.Xi(b.resolve,b.reject)};a.prototype.cy=function(a,b){var d=this.Wl();try{a.call(b,d.resolve,d.reject)}catch(n){d.reject(n)}};a.prototype.then=function(b,d){function e(a,b){return"function"==typeof a?function(b){try{f(a(b))}catch(z){c(z)}}:b}var f,c,h=new a(function(a,b){f=a;c=b});this.Xi(e(b,f),e(d,c));return h};a.prototype["catch"]=function(a){return this.then(void 0,a)};a.prototype.Xi=function(a,b){function d(){switch(e.qc){case 1:a(e.An);
break;case 2:b(e.An);break;default:throw Error("Unexpected state: "+e.qc);}}var e=this;null==this.Fg?f.op(d):this.Fg.push(d)};a.resolve=d;a.reject=function(b){return new a(function(a,d){d(b)})};a.race=function(b){return new a(function(a,e){for(var f=ka(b),c=f.next();!c.done;c=f.next())d(c.value).Xi(a,e)})};a.all=function(b){var e=ka(b),f=e.next();return f.done?d([]):new a(function(a,b){function c(b){return function(d){h[b]=d;k--;0==k&&a(h)}}var h=[],k=0;do h.push(void 0),k++,d(f.value).Xi(c(h.length-
1),b),f=e.next();while(!f.done)})};return a});ja("String.prototype.startsWith",function(c){return c?c:function(a,b){if(null==this)throw new TypeError("The 'this' value for String.prototype.startsWith must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype.startsWith must not be a regular expression");var d=this+"";a+="";for(var e=d.length,f=a.length,c=Math.max(0,Math.min(b|0,d.length)),k=0;k<f&&c<e;)if(d[c++]!=a[k++])return!1;return k>=f}});
ja("Array.prototype.fill",function(c){return c?c:function(a,b,d){var e=this.length||0;0>b&&(b=Math.max(0,e+b));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(b=Number(b||0);b<d;b++)this[b]=a;return this}});ja("Math.sign",function(c){return c?c:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}});
var r=function(){function c(a,b){this.type=a;this.values=b}c.Dh=function(a){a.toLowerCase()in c.Eo&&(a=c.Eo[a.toLowerCase()]);var b=/#([0-9a-f])([0-9a-f])([0-9a-f])/i,d=/rgb\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *\)/,e=/rgba\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *, *([0-9\.]+) *\)/;var f=/#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i.exec(a);if(null!==f)a=parseInt(f[1],16)/255,b=parseInt(f[2],16)/255,d=parseInt(f[3],16)/255,f=1;else if(f=e.exec(a),null!==f)a=parseFloat(f[1])/255,b=parseFloat(f[2])/
255,d=parseFloat(f[3])/255,f=parseFloat(f[4]);else if(f=d.exec(a),null!==f)a=parseFloat(f[1])/255,b=parseFloat(f[2])/255,d=parseFloat(f[3])/255,f=1;else if(f=b.exec(a),null!==f)a=parseInt(f[1],16),a=(16*a+a)/255,b=parseInt(f[2],16),b=(16*b+b)/255,d=parseInt(f[2],16),d=(16*d+d)/255,f=1;else return null;return new c(c.RGBA,[a,b,d,f])};c.Zd=function(a){return c.Dh(a)||new c(c.RGBA,[1,0,1,1])};c.qz=function(a){var b=/#[0-9a-f]+|rgba?\([^\)]+\)|[a-z]+/gi,d=[],e;do(e=b.exec(a))&&d.push(e[0]);while(e);return d};
c.prototype.toString=function(){function a(a){a=Math.round(255*a);return 16>a?"0"+a.toString(16):a.toString(16)}var b=this.dj(c.RGBA);return 1===b.values[3]?"#"+a(b.values[0])+a(b.values[1])+a(b.values[2]):"rgba("+Math.round(255*b.values[0])+","+Math.round(255*b.values[1])+","+Math.round(255*b.values[2])+","+b.values[3]+")"};c.prototype.dj=function(a){return c.Pt[this.type][a](this)};c.prototype.Lb=function(a){a.type!==this.type&&(a=a.dj(this.type));if(this.type===c.df){var b=this.values[0],d=a.values[0];
b=b>d?Math.min(b-d,d-b+360):Math.min(d-b,b-d+360);b/=360;return Math.pow(b*b+(this.values[1]-a.values[1])*(this.values[1]-a.values[1])+(this.values[2]-a.values[2])*(this.values[2]-a.values[2]),.5)}return Math.pow((this.values[0]-a.values[0])*(this.values[0]-a.values[0])+(this.values[1]-a.values[1])*(this.values[1]-a.values[1])+(this.values[2]-a.values[2])*(this.values[2]-a.values[2]),.5)};c.RGBA=0;c.No=1;c.df=2;c.ws=3;c.fz=3;c.Pt=[[la,ma,na,oa],[pa,la,qa,ra],[sa,ta,la,ua],[va,wa,xa,la]];c.Eo={aliceblue:"#f0f8ff",
antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",
darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",
honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",
limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",
orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",
steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",transparent:"rgba(0,0,0,0.0)",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return c}(),ya=.9505,za=1,Aa=1.089;
function sa(c){var a=c.values[0],b=c.values[1],d=c.values[2];0>a&&(a+=360);var e=a/60-Math.floor(a/60),f=d*(1-b),h=d*(1-e*b);b=d*(1-(1-e)*b);var k=e=0,l=0;switch(Math.floor(a/60)%6){case 0:e=d;k=b;l=f;break;case 1:e=h;k=d;l=f;break;case 2:e=f;k=d;l=b;break;case 3:e=f;k=h;l=d;break;case 4:e=b;k=f;l=d;break;case 5:e=d,k=f,l=h}return new r(r.RGBA,[e,k,l,c.values[3]])}
function na(c){var a=c.values[0],b=c.values[1],d=c.values[2],e=Math.max(a,b,d),f=Math.min(a,b,d);return new r(r.df,[e===f?0:e===a?(60*(b-d)/(e-f)+360)%360:e===b?60*(d-a)/(e-f)+120:60*(a-b)/(e-f)+240,0===e?0:1-f/e,e,c.values[3]])}function ra(c){function a(a){return a>6/29*(6/29)*(6/29)?Math.pow(a,1/3):1/3*(29/6)*(29/6)*a+4/29}var b=a(c.values[1]/za);return new r(r.ws,[116*b-16,500*(a(c.values[0]/ya)-b),200*(b-a(c.values[2]/Aa)),c.values[3]])}
function wa(c){var a=(c.values[0]+16)/116,b=a+c.values[1]/500,d=a-c.values[2]/200,e=6/29;return new r(r.No,[b>e?ya*b*b*b:3*(b-16/116)*e*e*ya,a>e?za*a*a*a:3*(a-16/116)*e*e*za,d>e?Aa*d*d*d:3*(d-16/116)*e*e*Aa,c.values[3]])}function ma(c){for(var a=[],b=0;3>b;b++)a[b]=.04045>=c.values[b]?c.values[b]/12.92:Math.pow((c.values[b]+.055)/1.055,2.4);return new r(r.No,[.4124*a[0]+.3576*a[1]+.1805*a[2],.2126*a[0]+.7152*a[1]+.0722*a[2],.0193*a[0]+.1192*a[1]+.9505*a[2],c.values[3]])}
function pa(c){var a=[],b=[0,0,0,0];a[0]=3.241*c.values[0]-1.5374*c.values[1]-.4986*c.values[2];a[1]=-.9692*c.values[0]+1.876*c.values[1]+.0416*c.values[2];a[2]=.0556*c.values[0]-.204*c.values[1]+1.057*c.values[2];for(var d=0;3>d;d++)b[d]=.0031308>=a[d]?12.92*a[d]:1.055*Math.pow(a[d],1/2.4)-.055;b[3]=c.values[3];return new r(r.RGBA,b)}function la(c){return new r(c.type,c.values.concat())}function oa(c){return ra(ma(c))}function va(c){return pa(wa(c))}function qa(c){return na(pa(c))}
function ta(c){return ma(sa(c))}function ua(c){return oa(sa(c))}function xa(c){return qa(wa(c))};function Ba(c){for(var a="",b,d,e,f,h,k,l=0;l<c.length;)b=c.charCodeAt(l++),d=c.charCodeAt(l++),e=c.charCodeAt(l++),f=b>>2,b=(b&3)<<4|d>>4,h=(d&15)<<2|e>>6,k=e&63,isNaN(d)?h=k=64:isNaN(e)&&(k=64),a=a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k);
return a};var Ca=function(){function c(a,b,d){void 0===d&&(d="");this.name=a;this.attributes=b;this.text=d;this.children=[]}c.prototype.toString=function(){var a=[];this.gp(a,"");a=a.join("");for(var b="",d=0;d<a.length;d++){var e=a.charCodeAt(d);128>e?b+=String.fromCharCode(e):(127<e&&2048>e?b+=String.fromCharCode(e>>6|192):(b+=String.fromCharCode(e>>12|224),b+=String.fromCharCode(e>>6&63|128)),b+=String.fromCharCode(e&63|128))}return b};c.prototype.gp=function(a,b){var d;if(this.hasAttributes()||0!==this.children.length){a.push(b);
a.push("<");a.push(this.name);for(d in this.attributes)this.attributes.hasOwnProperty(d)&&(a.push(" "),a.push(d),void 0!==this.attributes[d]&&null!==this.attributes[d]&&(a.push('="'),a.push(this.Wo(""+this.attributes[d])),a.push('"')));if(this.children.length||""!==this.text){a.push(">\n");for(d=0;d<this.children.length;d++)this.children[d].gp(a,b+"  ");""!==this.text&&a.push(b+"  "+this.Wo(this.text));a.push(b+"</"+this.name+">")}else a.push("/>");a.push("\n")}};c.prototype.hasAttributes=function(){for(var a in this.attributes)if(this.attributes.hasOwnProperty(a))return!0;
return!1};c.prototype.pi=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.attributes[b]=a[b])};c.prototype.Vd=function(a){this.children.push(a)};c.prototype.Wo=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};return c}();var x=new (function(){function c(){this.disabled={};this.Ed=[];this.Dp=!1}c.prototype.enable=function(a,b){void 0===b&&(b=!0);this.disabled[a]=!b};c.prototype.create=function(a,b){void 0===b&&(b=!0);!1===b&&(this.disabled[a]=!0);var d=this;return function(){for(var b=0;b<arguments.length;b++);d.bw(a,arguments)}};c.prototype.addListener=function(a){this.Ed.push(a);return a};c.prototype.removeListener=function(a){for(var b=0;b<this.Ed.length;b++)if(this.Ed[b]===a){this.Ed.splice(b,1);break}};c.prototype.hu=
function(){this.Dp||(this.Dp=!0,this.addListener(function(a,b){console.log(a+": "+b)}))};c.prototype.bw=function(a,b){var d=[],e;if(0!==this.Ed.length){var f=b[0].split("%s");d.push(f[0]);for(e=1;e<f.length;e++)e-1>=b.length-1?d.push("<too few args>"):"string"===typeof b[e]||"number"===typeof b[e]?d.push(b[e]):void 0===b[e]?d.push("(undefined)"):null===b[e]?d.push("(null)"):b[e]instanceof Object&&b[e].toString instanceof Function?d.push(b[e].toString()):d.push(JSON.stringify(b[e])),d.push(f[e]);d=
d.join("");e=0;for(f=this.Ed;e<f.length;e++)(0,f[e])(a,d)}};return c}());var Da=x.create("EVALJS"),Ea=function(){function c(a,b){this.ud=a;this.key=b}c.prototype.toString=function(){return"LValue("+this.key+")"};return c}(),Fa=function(){function c(a,b,d){this.id=a;this.jk=b;d&&(this.he=d)}c.prototype.he=function(){return this};c.prototype.Jq=function(a){return a};c.prototype.toString=function(){return"Token(id='"+this.id+"', lbp="+this.jk+")"};return c}(),Ga=function(){function c(a,b){return a[b]}function a(a,b,d){a[b]=d}function b(a){if(a instanceof Ea){if(a.ud===z)return L(z,
a.key);if(a.ud)return a.ud[a.key]}else return a}function d(a,b){void 0===b&&(b=0);var d=E[a];d?d.jk=Math.max(d.jk,b):d=E[a]=new Fa(a,b);return d}function e(a,b){var e=d(a);e.he=function(){return b};return e}function f(a){return new Fa("(literal)",0,function(){return a})}function h(a){var b=new Fa("(name)",0,function(){return new Ea(z,a)});b.toString=function(){return"Token(name: "+a+")"};return b}function k(a,d,e){l(a,d,function(a){return e(b(a),b(y(d-1)))})}function l(a,b,e){d(a,b).Jq=e}function n(a,
e,f){d(a,e).he=function(){return f(b(y(e)))}}function q(a,b,e){d(a,b).he=e}function u(a){return" "===a||"\t"===a||"\n"===a||"\r"===a}function v(){return Pa<Z.length?Z[Pa++]:E["(end)"]}function w(a){if(a&&V.id!==a)throw Error("Error: expected "+a+" but got "+V.id);return V=v()}function y(a){var b=V;V=v();for(var d=b.he();a<V.jk;)b=V,V=v(),d=b.Jq(d);return d}var z={},L=c,S=a,E={},D=0,C,X;e("true",!0);e("false",!1);e("null",null);e("undefined",void 0);d("(end)");(function(a,d,e){l(a,d,function(a){return e(b(a),
b(y(d)))})})(",",C=++D,function(a,b){return b});l("=",X=++D,function(a){var d=y(X);if(!(a instanceof Ea))throw Error("Error: lhs of = must be assignable");d=b(d);if(a.ud===z)S(z,a.key,d);else if(a.ud instanceof Object)a.ud[a.key]=d;else throw Error(a.ud+"["+a.key+"] cannot be assigned to.");return d});k("&&",++D,function(a,b){return a&&b});k("||",++D,function(a,b){return a||b});k("|",++D,function(a,b){return a|b});k("^",++D,function(a,b){return a^b});k("&",++D,function(a,b){return a&b});k("===",++D,
function(a,b){return a===b});k("!==",D,function(a,b){return a!==b});k("==",D,function(a,b){return a==b});k("!=",D,function(a,b){return a!=b});k(">",++D,function(a,b){return a>b});k(">=",D,function(a,b){return a>=b});k("<",D,function(a,b){return a<b});k("<=",D,function(a,b){return a<=b});k("in",D,function(a,b){return a in b});k("<<",++D,function(a,b){return a<<b});k(">>",D,function(a,b){return a>>b});k(">>>",D,function(a,b){return a>>>b});k("+",++D,function(a,b){return a+b});k("-",D,function(a,b){return a-
b});k("*",++D,function(a,b){return a*b});k("/",D,function(a,b){return a/b});k("%",D,function(a,b){return a%b});n("!",++D,function(a){return!a});n("~",D,function(a){return~a});n("+",D,function(a){return+a});n("-",D,function(a){return-a});n("typeof",D,function(a){return typeof a});l(".",++D,function(a){var d=V;if("(name)"!==d.id)throw Error("Error: '.' expects a name, not "+V.id);if(a instanceof Ea)a.ud=b(a),a.key=d.he().key;else if(a instanceof Object)a=new Ea(b(a),d.he().key);else throw Error("Error: '.' must be preceded by object");
w();return a});q("(",++D,function(){var a=y(0);w(")");return a});d(")");l("(",++D,function(a){var d=[];if(")"!==V.id)for(;;){d.push(b(y(C+1)));if(","!==V.id)break;w(",")}w(")");var e=null;a instanceof Ea&&(e=a.ud);a=b(a);if("function"!==typeof a)throw Error("Tried to call a non-function; type was "+typeof a);return a.apply(e,d)});d(",");l("[",D,function(a){var d=y(0);if(!(a instanceof Ea))throw Error("Error: '[]' must be preceded by lvalue");w("]");a.ud=b(a);a.key=b(d);return a});d("]");q("{",++D,
function(){for(var a={};"}"!==V.id;){if("(literal)"===V.id)var d=V.he();else if("(name)"===V.id)d=V.he().key;else throw Error("Bad {}; expecting name or string constant");w();w(":");a[d]=b(y(C+1));if(","!==V.id)break;V=w(",")}w("}");return a});q("[",D,function(){for(var a=[];"]"!==V.id;){a.push(b(y(C+1)));if(","!==V.id)break;V=w(",")}w("]");return a});d(",");d(":");d("}");var ob=/(\d+(\.\d+)?)|(===|!==|==|!=|\+=|-=|&&|\|\||<=|>=|<<|>>>|>>|&&|\|\||[{}\(\)\[\]\+\-\.\*\/=!,\?&\|:%~<>])|([a-zA-Z\$_][\$_a-zA-Z0-9]*)|("([^"\\]|\\.)*"|'([^'\\]|\\.)*')/g,
Z=[],Pa=0,V;return{parse:function(a){for(var b=[],d=0;d<a.length;){for(;u(a.charAt(d));)d++;ob.lastIndex=d;var e=ob.exec(a);if(e&&e.index===d)if(d+=e[0].length,e[1])b.push(f(parseFloat(e[1])));else if(e[3]&&e[3]in E)b.push(E[e[3]]);else if(e[4])switch(e[4]){case "true":case "false":case "null":case "in":case "typeof":case "undefined":b.push(E[e[4]]);break;default:b.push(h(e[4]))}else{if(e[5]){e=e[5].substr(1,e[5].length-2);for(var c="",k=!1,l=0;l<e.length;l++){var n=e[l];if(k){switch(n){case "n":n=
"\n";break;case "r":n="\r";break;case "t":n="\t"}c+=n;k=!1}else"\\"===n?k=!0:c+=n}b.push(f(c))}}else throw Error("Parse error: Expected stuff in "+a+" near: "+a.substr(d));}b.push(E["(end)"]);return b},evaluate:function(d,e,f,h){Pa=0;Z=e;z=d;L=f||function(a,b){return a[b]};S=h||function(a,b,d){a[b]=d};V=v();d=b(y(0));z={};L=c;S=a;return d}}}(),Ha=Ga.parse,Ja=Ga.evaluate;function Ka(c,a,b){try{return Ja(c,Ha(a),b)}catch(d){console.log("When evaluating: %s on scope ",a,c),console.log(d)}}
function La(c,a){if(c===a)return!0;if(!(c instanceof Object&&a instanceof Object)||c.constructor!==a.constructor)return!1;for(var b in c)if(c.hasOwnProperty(b)&&(!a.hasOwnProperty(b)||c[b]!==a[b]&&("object"!==typeof c[b]||!La(c[b],a[b]))))return!1;for(b in a)if(a.hasOwnProperty(b)&&!c.hasOwnProperty(b))return!1;return!0}
var Na=function(){function c(){this.ve={};this.ji=!1;this.length=0;this.Hl=[];this.timeout=0}c.prototype.watch=function(a,b,d){a={scope:a,parsed:Ha(b),Wq:void 0,Tq:d};b in this.ve?this.ve[b].push(a):this.ve[b]=[a];this.length+=1;this.ji=!0;this.check()};c.prototype.unwatch=function(a,b){if(a in this.ve){for(var d=this.ve[a],e=0;e<d.length;e++)if(d[e].Tq===b){d.splice(e,1);break}0===d.length&&delete this.ve[a];--this.length}};c.prototype.check=function(a){var b=this;this.ji=!0;a&&this.Hl.push(a);0===
this.timeout&&(this.timeout=setTimeout(function(){for(var a=(new Date).getTime(),e=0,f=0;10>f&&b.ji;f++){b.ji=!1;for(var c in b.ve)for(var k=null,l=void 0,n=0;n<b.ve[c].length;n++){var q=b.ve[c][n];try{q.scope!==k&&(l=Ja(q.scope,q.parsed),k=q.scope,e+=1),La(q.Wq,l)||(q.Wq=l,q.Tq(l),b.ji=!0)}catch(u){console.log("Error when evaluating %s: ",c,u),console.log("Context was: %o",q.scope)}}l=b.Hl;b.Hl=[];for(k=0;k<l.length;k++)(0,l[k])()}Da("Evaluated %s/%s watchers in %sms",e,b.length,(new Date).getTime()-
a);b.timeout=0},0))};return c}();var Qa=function(){function c(){this.items=[];this.next=0;this.Ee=!1;this.log=x.create("UNDOSTACK")}c.prototype.va=function(a,b,d){void 0===b&&(b=!1);a=a instanceof Oa?[a]:a;if(0!==a.length){this.next<this.items.length&&(this.items.length=this.next);if(!b)for(b=0;b<a.length;b++)a[b].kd(d);for(d=this.top();d;)if(d[d.length-1].Ff(a[0])){if(a.shift(),0===a.length)break}else break;a.length&&this.items.push(a);this.Ee=!0;this.next=this.items.length}};c.prototype.Ac=function(a){this.log("Undo index %s of %s",
this.next,this.items.length);if(this.Td()){for(var b=this.items[--this.next],d=b.length-1;0<=d;d--)b[d].Ac(a);return this.Ee=!0}return!1};c.prototype.Id=function(a){this.log("Redo index %s of %s",this.next,this.items.length);if(this.Sd()){for(var b=this.items[this.next++],d=0;d<b.length;d++)b[d].kd(a);return this.Ee=!0}return!1};c.prototype.Td=function(){return 0<this.next};c.prototype.Sd=function(){return this.next<this.items.length};c.prototype.clear=function(){this.next=this.items.length=0;this.Ee=
!1};c.prototype.top=function(){return this.items.length?this.items[this.items.length-1]:null};return c}(),Oa=function(){function c(){}c.prototype.kd=function(){};c.prototype.Ac=function(){};c.prototype.Ff=function(){return!1};return c}();var Ra=function(){function c(a){this.next=a}c.prototype.ls=function(a){for(var b=0;b<a.length;b++)this.jb(a.charCodeAt(b))};c.prototype.jb=function(a){this.next.jb(a)};c.prototype.flush=function(){this.next.flush()};c.prototype.sg=function(){return this.next.sg()};return c}(),Sa=function(){function c(){this.data="";this.log=x.create("BYTESTREAM")}c.prototype.ls=function(a){for(var b=0;b<a.length;b++)this.jb(a.charCodeAt(b))};c.prototype.sg=function(){return this};c.prototype.jb=function(a){if(255<
a||0>a)throw"Bad data written to byte buffer";this.data+=String.fromCharCode(a)};c.prototype.flush=function(){};c.prototype.toString=function(){return this.data};c.prototype.Jb=function(){for(var a=[],b=0;b<this.data.length;b++)a.push(this.data.charCodeAt(b));return a};c.Lo=function(a,b){c.Ho[a]=b};c.bf=function(a){var b=new c;a=a.split(",");a.reverse();for(var d=0;d<a.length;d++){var e=a[d];e.length&&(b=c.Ho[e](b))}return b};c.Ho={};return c}();var Ta=function(c){function a(a){a=c.call(this,a)||this;a.oh=0;a.total=0;a.size=0;a.keys="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return a}__extends(a,c);a.prototype.jb=function(a){this.oh=this.oh<<8|a;this.size+=8;for(this.total+=1;6<=this.size;)this.next.jb(this.keys.charCodeAt(this.oh>>this.size-6&63)),this.size-=6};a.prototype.flush=function(){var a=(3-this.total%3)%3;this.size&&(this.next.jb(this.keys.charCodeAt(this.oh>>this.size-6&63)),this.oh=this.size=0);for(;a--;)this.next.jb(61);
this.next.flush()};return a}(Ra);Sa.Lo("Base64Encoder",function(c){return new Ta(c)});var Ua=function(c){function a(a){a=c.call(this,a)||this;a.Jf=0;a.Gd=0;a.Oq=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8193];a.log=x.create("BITWRITER");return a}__extends(a,c);a.prototype.jb=function(a){this.ks(a,8)};a.prototype.ks=function(a,d){this.Jf=this.Jf<<d|a&this.Oq[d];for(this.Gd+=d;8<=this.Gd;)this.next.jb(this.Jf>>>this.Gd-8&255),this.Gd-=8,this.Jf&=this.Oq[this.Gd]};a.prototype.flush=function(){this.Gd&&(this.next.jb(this.Jf<<8-this.Gd),this.Jf=this.Gd=0);this.next.flush()};return a}(Ra);var Va=function(c){function a(a){var b=c.call(this,a)||this;b.Cg=258;b.lz=0;b.$f=0;b.first=!0;b.sh=[];b.pn=[];b.Jl=[];b.oz=0;b.Ul=9;b.log=x.create("LZWEncoder");b.qt=new Ua(a);b.So();return b}__extends(a,c);a.prototype.jb=function(a){if(this.first)this.$f=a,this.first=!1;else{var b=this.Hs(this.$f,a);void 0!==this.sh[b]?this.$f=this.sh[b]:(this.Ki(this.$f),this.sh[b]=this.Cg,this.pn[b]=this.$f,this.$f=this.Jl[b]=a,4095>this.Cg?(this.Cg+=1,this.Ul=Math.ceil(Math.log(this.Cg)/Math.log(2))):this.So())}};
a.prototype.Hs=function(a,d){var b;var f=d<<4^a;for(b=0===f?1:18041-f;;){if(void 0===this.sh[f]||this.pn[f]===a&&this.Jl[f]===d)return f;f-=b;0>f&&(f+=18041)}};a.prototype.So=function(){this.Ki(a.ps);this.Cg=258;this.Ul=9;this.sh.length=0;this.pn.length=0;this.Jl.length=0};a.prototype.flush=function(){this.first||(this.Ki(this.$f),this.Ki(a.us))};a.prototype.Ki=function(a){this.qt.ks(a,this.Ul)};a.ps=256;a.us=257;return a}(Ra);Sa.Lo("LZWEncoder",function(c){return new Va(c)});x.create("ANIM");var Wa=function(){function c(){this.Kg=0;this.fn=null}c.prototype.request=function(a,b){var d=this;this.et=a;this.fn=b;0===this.Kg&&(this.Kg=window.requestAnimationFrame(function(a){d.Kg=0;d.fn&&d.fn(d.et,a)}))};c.prototype.cancel=function(){0!==this.Kg&&(window.cancelAnimationFrame(this.Kg),this.Kg=0)};return c}();function Xa(c,a,b){this.Na=c;this.Tk=a;this.fn=b;this.Yk=0}
var Ya=new (function(){function c(){this.zb=[];this.co=!1;this.log=x.create("ImageLoader")}c.prototype.timeout=function(){var a=[];this.log("Timeout running... %s images remaining",this.zb.length);for(var b=0;b<this.zb.length;b++)this.zb[b].Na.complete?this.zb[b].fn(this.zb[b].Na,this.zb[b].Tk):5E3>this.zb[b].Yk?(this.zb[b].Yk+=250,a.push(this.zb[b])):this.zb[b].fn(this.zb[b].Na,this.zb[b].Tk);this.zb=a;this.zb.length?setTimeout(this.timeout,250):(this.log("Timeout Stopped"),this.co=!1)};c.prototype.load=
function(a,b,d){var e=this;void 0===d&&(d=!1);var f=document.createElement("img"),c=new Xa(f,a,b);this.zb.push(c);var k=0<=a.indexOf("://"),l="://"+window.location.host,n=0!==a.indexOf("data:")&&k&&-1===a.indexOf(l);n&&!d&&(this.log("Using cross origin request for img"),f.crossOrigin="");f.addEventListener("load",function(){e.log("LoadFn called. complete=%s",f.complete);if(f.complete)for(var a=0;a<e.zb.length;a++){var d=e.zb[a];if(d.Na===f){e.zb.splice(a,1);b(f,d.Tk);break}}else e.co||(e.co=!0,setTimeout(e.timeout,
250),c.Yk=250)},!1);f.addEventListener("error",function(){e.log("Error loading %s; useCors=%s disableCors=%s",a,n,d);!n||d?b(null,c.Tk):e.load(a,b,!0)},!1);f.src=a;return f};return c}());var Za=function(){function c(){this.images={}}c.prototype.add=function(a,b){var d=this.images[a];d||(d={Na:null,Hk:0},Ya.load(b,function(a){d.Na=a}),this.images[a]=d);d.Hk+=1};c.prototype.release=function(a){var b=this.images[a];b&&(--b.Hk,0>=b.Hk&&delete this.images[a])};c.prototype.get=function(a){return(a=this.images[a])&&a.Na?a.Na:null};return c}();var $a=function(){function c(a){this.code="en";this.data={};this.log=x.create("LANGUAGE");this.data=this.jr(a,{})}c.prototype.Or=function(a){a=a.split(",");this.log("Choice of languages: %s",a);for(var b=0;b<a.length;b++){var d=a[b].split("-")[0];if(d in this.data){this.log("Using language code %s",d);this.code=d;break}else this.log("No language for code %s",d)}};c.prototype.Gl=function(a){this.jr(a,this.data)};c.prototype.jr=function(a,b){for(var d=a.split("\n"),e=/^([ \t]*)([^:]+):([^:]+):(.*)/,
f=0;f<d.length;f++){var c=e.exec(d[f]);if(c){var k=c[2],l=c[3];c=c[4];k in b||(b[k]={});l in b[k]&&this.log("Warning: Replacing %s:%s",k,l);b[k][l]=c}}return b};c.prototype.fn=function(){var a=this;return function(b){for(var d=[],e=1;e<arguments.length;e++)d[e-1]=arguments[e];return a.Yo(b,d)}};c.prototype.get=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];return this.Yo(a,b)};c.prototype.Yo=function(a,b){var d="<not translated:"+a+">";this.code in this.data&&a in this.data[this.code]&&
(d=this.data[this.code][a]);for(var e=0;e<b.length;e++)d=d.replace("^"+e,b[e]);return d};return c}();var ab=x.create("EventEmitter"),bb=function(){function c(){this.ai=!1;this.Ya={};this.yd=[];this.sj={}}c.prototype.na=function(a){for(var b=this,d=1;d<arguments.length;d++);this.yd.push(Array.prototype.slice.apply(arguments));1===this.yd.length&&setTimeout(function(){for(var a=0;a<b.yd.length;a++)b.bm.apply(b,b.yd[a]);b.yd.length=0},0)};c.prototype.jd=function(a){for(var b=1;b<arguments.length;b++);this.yd.push(Array.prototype.slice.apply(arguments));if(1===this.yd.length){for(b=0;b<this.yd.length;b++)this.bm.apply(this,
this.yd[b]);this.yd.length=0}};c.prototype.og=function(a){for(var b=this,d=1;d<arguments.length;d++);d=Array.prototype.slice.apply(arguments);var e=d[0];e in this.sj||setTimeout(function(){var a=b.sj[e];delete b.sj[e];b.bm.apply(b,a)},0);this.sj[e]=d};c.prototype.bm=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];if(a in this.Ya){d=this.Ya[a];this.ai||ab("Emit %s",a);for(var e=0;e<d.length;e++)d[e].apply(null,b)}};c.prototype.pa=function(a,b){this.Ya||(this.Ya={});for(var d=
0,e=a.split(" ");d<e.length;d++)this.bind(e[d],b)};c.prototype.once=function(a,b){function d(){e.ds(a,d);b.apply(null,arguments)}var e=this;e.bind(a,d)};c.prototype.bind=function(a,b){a in this.Ya?this.Ya[a].push(b):this.Ya[a]=[b];return b};c.prototype.removeListener=function(a,b){return this.ds(a,b)};c.prototype.ds=function(a,b){var d,e;if(a in this.Ya){var f=this.Ya[a];var c=d=0;for(e=f.length-1;d<=e;c=d+=1)if(f[c]===b){f.splice(c,1);break}0===f.length&&delete this.Ya[a]}};c.prototype.qh=function(){this.Ya=
{}};return c}();var cb=function(c){function a(){var a=c.call(this)||this;a.keys={};a.ai=!0;a.qy=new RegExp("alt backspace cmd command control ctrl del delete down end enter esc escape f4 home ins insert left meta pagedown pageup right shift up \u2318".split(" ").sort(function(a,b){return b.length-a.length}).join("|"),"g");a.log=x.create("KEYMAP");a.sq=function(b){a.Kv(b)};return a}__extends(a,c);a.prototype.map=function(a,d,e){void 0===e&&(e=!0);a=a.toLowerCase().split(",");var b;if("string"===typeof d)for(d=d.split(","),
b=0;b<a.length;b++)for(var c=0;c<d.length;c++)this.Po(a[b],d[c],!e);else for(b=0;b<a.length;b++)this.Po(a[b],d,!e)};a.prototype.Po=function(a,d,e){if(0!==a.length){var b=a.match(this.qy)||[],c=!1,k=!1,l=!1,n=!1,q=[],u;for(u=0;u<b.length;u++)switch(b[u]){case "alt":l=!0;break;case "control":case "ctrl":k=!0;break;case "shift":c=!0;break;case "home":q.push(36);break;case "end":q.push(35);break;case "pageup":q.push(33);break;case "pagedown":q.push(34);break;case "delete":case "del":q.push(46);break;
case "backspace":q.push(8);break;case "up":q.push(38);break;case "right":q.push(39);break;case "down":q.push(40);break;case "left":q.push(37);break;case "escape":case "esc":q.push(27);break;case "enter":q.push(13);break;case "ins":case "insert":q.push(45);break;case "f4":q.push(115);break;case "meta":case "command":case "cmd":case "\u2318":n=!0;break;default:alert("key entry not found: "+b[u])}var v=this;b=function(a){c&&-1===a.indexOf("-shift")&&(a+="-shift");k&&-1===a.indexOf("-control")&&(a+="-control");
l&&-1===a.indexOf("-alt")&&(a+="-alt");n&&-1===a.indexOf("-meta")&&(a+="-meta");"string"===typeof d?v.log("%sKeyboard mapping: %s->%s",e?"Remove ":"",a,d):v.log("%sKeyboard mapping: %s->%s",e?"Remove ":"",a,"function()");if(e){if(a in v.keys){for(var b=[],f=0,h=v.keys[a];f<h.length;f++){var q=h[f];q!==d&&b.push(q)}v.keys[a]=b}}else if(a in v.keys){f=v.keys[a];for(b=0;b<f.length&&f[b]!==d;b++);b===f.length&&v.keys[a].push(d)}else v.keys[a]=[d]};if(0===q.length)switch(a=a.toUpperCase().charAt(a.length-
1),a){case "=":b("107-shift");b("187");b("61");break;case "+":b("107");b("61-shift");break;case "-":b("109");b("189");b("173");break;default:q.push(a.charCodeAt(0))}for(u=0;u<q.length;u++)b(""+q[u])}};a.prototype.hv=function(a){var b="";a.keyCode&&(b+=a.keyCode);a.shiftKey&&(b+="-shift");a.ctrlKey&&(b+="-control");a.altKey&&(b+="-alt");a.metaKey&&(b+="-meta");return b};a.prototype.translate=function(a){var b=[],e=this.hv(a);e in this.keys&&(b=this.keys[e]);(32>a.keyCode||126<=a.keyCode)&&this.log("%s",
e);return b};a.prototype.Kv=function(a){for(var b=0,e=this.translate(a);b<e.length;b++){var f=e[b];"string"===typeof f?(this.log("action: %s",f),this.jd("*",f,a)):f(a)}};a.prototype.rp=function(a){a.addEventListener("keydown",this.sq)};a.prototype.detach=function(a){a.removeEventListener("keydown",this.sq)};return a}(bb);var db={1:"INITIAL CONNECTION",2:"APPEND",128:"ERROR",129:"ACK/NACK",255:"CONTINUATION"},eb={0:"No",1:"Yes"};function A(c,a,b,d){return{length:c,type:a,name:b,mz:d}}
var fb={1:[A(1,0,"messageType",db),A(1,0,"more",eb),A(2,0,"protocolVersion"),A(4,0,"maxSize"),A(1,0,"creationMode",{0:"POSSIBLY_CREATE",1:"NEVER_CREATE",2:"ALWAYS_CREATE"}),A(8,0,"offset"),A(1,0,"docIDLength"),A(-1,1,"docID"),A(-2,1,"data")],2:[A(1,0,"messageType",db),A(1,0,"more",eb),A(8,0,"offset"),A(-2,1,"data")],128:[A(1,0,"messageType",db),A(1,0,"more",eb),A(2,0,"errorCode",{0:"UNSPECIFIED",1:"DOES_NOT_EXIST",2:"ALREADY_EXISTS",3:"INVALID_OFFSET"}),A(-2,1,"description")],129:[A(1,0,"messageType",
db),A(1,0,"more",eb),A(2,0,"ack",{0:"NACK",1:"ACK"}),A(8,0,"offset")],255:[A(1,0,"messageType",db),A(1,0,"more",eb),A(-2,1,"data")]};
function hb(c){var a=fb[c.messageType];if(!a)throw Error("no encoder for message type "+c.messageType);for(var b=[],d=0;d<a.length;d++){var e=a[d];if(!(e.name in c))throw Error("missing field "+e.name);var f=c[e.name];if(0===e.type){var h=b;e=e.length;do--e,h.push(Math.floor(f/Math.pow(2,8*e)%256));while(0<e)}else if(f instanceof Uint8Array)for(h=0;h<f.length;h++)b.push(f[h]);else for(h=b,f=(new TextEncoder).encode(f),e=0;e<f.length;e++)h.push(f[e])}return new Uint8Array(b)}
function ib(c){var a=fb[c[0]];if(!a)return null;for(var b={},d=0,e=0,f=0;f<a.length;f++){var h=a[f],k;if(0===h.type){d=e;var l=h.length;for(k=0;l;)k=256*k+c[d],--l,d+=1;k=d=k;e+=h.length}else{l=d;-2===h.length&&(l=c.length-e,b[h.name+"_length"]=l);k=c;var n=e,q=l;void 0===q&&(q=k.length-n);k=(new TextDecoder).decode(k.slice(n,n+q));e+=l}b[h.name]=k}return b}
var jb=function(c){function a(a,d){var b=c.call(this)||this;b.dd=a;b.lk=d;a.binaryType="arraybuffer";a.onopen=function(){b.na({type:"open"})};a.onerror=function(){b.na({type:"error"});a.onerror=a.onclose=null};a.onclose=function(){b.na({type:"close"});a.onerror=a.onclose=null};a.onmessage=function(a){b.na({type:"message",message:new Uint8Array(a.data)})};return b}__extends(a,c);a.prototype.close=function(){this.dd.close()};a.prototype.read=function(){return __awaiter(this,void 0,void 0,function(){var a,
d,e,f,c;return __generator(this,function(b){switch(b.label){case 0:a=[],b.label=1;case 1:return[4,this.Sq()];case 2:d=b.sent();if("message"!==d.type||0===a.length&&!d.message[1])return[2,d];e=0;f=d.message;a.length&&(e=2);for(c=e;c<f.length;c++)a.push(f[c]);return d.message[1]?[3,1]:[2,{type:"message",message:new Uint8Array(a)}];case 3:return[2]}})})};a.prototype.send=function(a){var b=this.dd,e=0,f=a.length;f>this.lk&&(f=this.lk,a[1]=1);b.send(a.slice(e,e+f));for(e+=f;e<a.length;)f=a.length-e,f>
this.lk-2&&(f=this.lk-2),b.send(hb({messageType:255,more:e+f<a.length?1:0,data:a.slice(e,e+f)})),e+=f};return a}(function(){function c(){this.vo=[];this.Ya=[]}c.prototype.Sq=function(){var a=this;return(new Promise(function(b){a.Ya.length?b(a.Ya.shift()):a.vo.push(b)})).then(null,function(a){throw a;})};c.prototype.na=function(a){this.vo.length?this.vo.shift()(a):this.Ya.push(a)};return c}());
function kb(c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return[2,new Promise(function(a){setTimeout(a,c)})]})})}
var lb=function(c){function a(a,d,e){var b=c.call(this)||this;b.sa=a;b.Gx=d;b.latency=e;b.log=x.create("Sharing");b.jn=function(a){if(""!==b.Hd)throw Error("Already have queued changes");b.Hd=a;b.Ql()};b.zk=function(){};b.Wn=!1;b.connected=!1;b.dd=null;b.Hc=0;b.Hd="";b.Ud="";return b}__extends(a,c);a.prototype.Tx=function(a){this.latency=a};a.prototype.start=function(a,d){var b=this;return new Promise(function(e,c){b.log("Start shared session: createMode=%s",d);b.zk=e;if(1===d)b.sa.pa("local-changes",
b.jn),b.Cp(a,d,"").then(null,c);else{var f=function(e){b.log("Got first changes; finally connecting.");b.sa.removeListener("local-changes",f);b.sa.pa("local-changes",b.jn);b.Cp(a,d,e).then(null,c)};b.sa.pa("local-changes",f)}})};a.prototype.stop=function(){this.log("stop() -- shut down session");this.Wn=!1;this.dd&&this.dd.close();this.sa.removeListener("local-changes",this.jn)};a.prototype.Cp=function(a,d,e){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(f){switch(f.label){case 0:this.Wn=
!0,b=0,f.label=1;case 1:if(!this.Wn)return[3,10];this.connected=!1;this.Ud&&(this.Hd=this.Ud,this.Ud="");if(!b)return[3,3];this.log("Waiting %sms before reconnecting",b);return[4,kb(b)];case 2:f.sent(),f.label=3;case 3:return b=Math.max(Math.min(2*b,3E5),1E3),[4,this.connect()];case 4:return f.sent()?[4,this.Qv(a,d,e)]:[3,1];case 5:if(!f.sent())return[3,1];this.zk&&(this.zk(),this.zk=function(){});this.na("connected");d=1;e="";this.connected=!0;this.Ql();f.label=6;case 6:return f.trys.push([6,8,,
9]),[4,this.bt()];case 7:return f.sent(),[3,9];case 8:return c=f.sent(),this.log("While trying to connect: "+c.message),console.log("While trying to connect: ",c),[3,9];case 9:return this.connected=!1,b=0,this.na("connect-error"),[3,1];case 10:return[2]}})})};a.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var a,d,e;return __generator(this,function(b){switch(b.label){case 0:return a=this.Gx,this.dd&&this.dd.close(),this.dd=d=new jb(new WebSocket(a),102400),this.log("Connect to %s; wait for event",
a),[4,d.Sq()];case 1:e=b.sent();if("open"!==e.type)return this.log("Received unexpected event: %s",e.type),[2,!1];this.log("Connected to %s",a);return[2,!0]}})})};a.prototype.send=function(a){var b=this;setTimeout(function(){b.dd&&b.dd.send(a)},this.latency)};a.prototype.Qv=function(a,d,e){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(f){switch(f.label){case 0:this.log("Send INIT message docLen=%s changes=%s",this.Hc,e.length);try{this.send(hb({messageType:1,
more:0,maxSize:102400,protocolVersion:2,creationMode:d,offset:this.Hc,docIDLength:a.length,docID:a,data:e}))}catch(l){throw console.log("Got error ",l),l;}return[4,this.dd.read()];case 1:b=f.sent();if("message"!=b.type)return this.log("Expected message; got "+b.type),[2,!1];c=ib(b.message);if(128===c.messageType)throw this.log("Got error response: %s",c.description),Error(c.description);2===c.messageType&&(0<c.offset&&e.length&&this.sa.Vh(e),this.log("Got initial changes at offset %s=>%s",c.offset,
c.offset+c.data_length),(c.data.length||0===c.offset)&&this.sa.ih(c.data,0===c.offset),0===c.offset&&(this.Ud=this.Hd=""),this.Hc=c.offset+c.data_length);this.log("Connected and initialized.");return[2,!0]}})})};a.prototype.Ql=function(){this.Hd.length&&this.connected&&(this.send(hb({messageType:2,offset:this.Hc,more:0,data:this.Hd})),this.Ud=this.Hd,this.Hd="")};a.prototype.bt=function(){return __awaiter(this,void 0,void 0,function(){var a,d;return __generator(this,function(b){switch(b.label){case 0:return[4,
this.dd.read()];case 1:a=b.sent();if("message"!==a.type)return this.log("Expected message; got "+a.type),[2];d=ib(a.message);if(2===d.messageType){if(this.Hc!==d.offset)throw Error("Error: docLength ="+this.Hc+" but got offset "+d.offset);this.sa.ih(d.data,!1);this.log("From server: APPEND "+this.Hc+"->"+(this.Hc+d.data_length));this.Hc+=d.data_length;this.Ql()}else if(129===d.messageType)d.ack?(this.log("Received ACK "+this.Hc+"=>"+d.offset),this.sa.Vh(this.Ud),this.Ud="",this.Hc=d.offset):(this.log("Received NACK; my "+
this.Hc+"!="+d.offset),""===this.Hd&&(this.Hd=this.Ud,this.Ud=""));else throw Error("Unexpected message type "+d.messageType);b.label=2;case 2:return[3,0];case 3:return[2]}})})};return a}(bb);x.create("ColourPanel");
var mb={style:"\n.zwibbler-colour-panel {\n    overflow:hidden;\n    border-top: 1px solid black;\n    white-space: nowrap;\n    font-size: 0;\n}\n\n.zwibbler-colour-panel div { \n    display: inline-block;\n}",Zj:'<div class="zwibbler-colour-panel" z-style="{height:ColourPanelWidth()+\'px\'}">\n    <canvas z-clear-glyph="{width: ColourPanelWidth(), style:\'clear\'}"\n        z-on:click="setColour(\'rgba(0,0,0,0.0)\', true)"\n        z-on:contextmenu="setColour(\'rgba(0,0,0,0.0)\', false)">\n    </canvas>\n    <canvas z-clear-glyph="{width: ColourPanelWidth(), style:\'transparent\'}"\n        z-on:click="setOpacity(0.5, true)"\n        z-on:contextmenu="setOpacity(0.5, false)">\n    </canvas>\n    <div z-for="colour in ColourPanelColours"\n        z-style="{width: ColourPanelWidth()+\'px\', height: ColourPanelWidth()+\'px\', background: colour}"\n        z-on:click="setColour(colour, true)"\n        z-on:contextmenu="setColour(colour, false)">\n    </div>\n</div>\n',controller:function(c){var a=
c.Ep();a.shift();a.shift();c.ColourPanelColours=a;c.ColourPanelWidth=function(){return c.$d("useTouch")?40:20}}};var nb=function(){function c(){this.xh=[];this.log=x.create("DESTRUCTOR")}c.prototype.add=function(a){this.xh.push(a)};c.prototype.addEventListener=function(a,b,d,e){function f(b){a.addEventListener(b,d,e);c.add(function(){a.removeEventListener(b,d,e)})}var c=this;void 0===e&&(e=!1);var k=0;for(b=b.split(" ");k<b.length;k++)f(b[k])};c.prototype.pa=function(a,b,d){a.pa(b,d);this.add(function(){a.removeListener(b,d)})};c.prototype.Xa=function(){this.log("Running %s destructors",this.xh.length);for(var a=
this.xh.length-1;0<=a;a--)this.xh[a]();this.xh.length=0};return c}();x.create("OTDocument");
var pb=function(){function c(a,b,d,e,f){void 0===e&&(e=[]);void 0===f&&(f=!1);this.Pa=a;this.xc=b;this.gc=d;this.ops=e;this.local=f}c.prototype.clone=function(a,b){void 0===b&&(b=this.gc);for(var d=[],e=0,f=this.ops;e<f.length;e++)d.push(f[e].clone());return new c(a,this.xc,b,d,this.local)};c.prototype.inverse=function(a,b){void 0===a&&(a=this.Pa);void 0===b&&(b=this.gc);for(var d=[],e=this.ops.length-1;0<=e;e--)d.push(this.ops[e].inverse());return new c(a,this.xc,b,d,this.local)};return c}(),qb=
function(){function c(a,b,d){this.yt=a;this.ot=b;this.Iq=d}c.prototype.getData=function(){return this.yt};c.prototype.ug=function(){return this.Iq};c.prototype.empty=function(){return this.ot===this.Iq};return c}(),rb=function(){function c(a,b){void 0===a&&(a=!1);this.kt=a;this.Ce=b;this.log=x.create("OTDocument");this.Bc=[];this.next=0;this.local=[];this.all=[];this.vb=0;this.ue={};this.yb=!1;this.Sh=null;this.$o=-1;this.sl=""}c.prototype.Td=function(){return 0<this.next&&!this.locked()};c.prototype.Sd=
function(){return this.next<this.Bc.length&&!this.locked()};c.prototype.Ac=function(){this.Td()&&(this.yb=!0,this.ur(this.Bc[--this.next],!0),this.va(!1,!0),this.yb=!1)};c.prototype.Id=function(){this.Sd()&&(this.yb=!0,this.ur(this.Bc[this.next++],!1),this.va(!1,!0),this.yb=!1)};c.prototype.Sl=function(){this.next=this.Bc.length=0};c.prototype.ck=function(a){if(null===a)return this.all.length-1;for(var b=0;b<this.all.length;b++)if(this.all[b].Pa===a)return b;return-1};c.prototype.locked=function(){return null!==
this.Sh};c.prototype.Km=function(a){var b=this.ck(a);if(0>b)return this.log("CID "+a+" does not exist"),!1;var d=this.ck(this.Sh);b===this.all.length-1&&(a=null);this.yb=!0;this.Sh=a;if(b!==d){if(d<b)for(a=d+1;a<=b;a++)this.vf(this.all[a]);else for(a=d;a>b;a--)this.vf(this.all[a].inverse());this.va(!1)}this.yb=!1};c.prototype.Im=function(){for(var a=[],b=0,d=this.all;b<d.length;b++){var e=d[b];a.push({Pa:e.Pa,gc:e.gc,local:e.local})}return a};c.prototype.vm=function(){return this.local.length?0===
this.Ce?new qb(this.encode(this.local),this.vb.toString(),(this.vb+this.local.length).toString()):new qb(this.encode(this.local),this.local[0].xc,this.local[this.local.length-1].Pa):new qb("","0","0")};c.prototype.Vh=function(a){if(0===this.Ce){a=parseInt(a,10)-this.vb;for(var b=0;b<a;b++)this.all[this.vb+b].Pa=(this.vb+b+1).toString(),this.vb+b+1<this.all.length&&(this.all[this.vb+b+1].xc=this.all[this.vb+b].Pa);this.vb+=a;this.local.splice(0,a)}else for(b=this.local.length-1;0<=b;b--)if(a===this.local[b].Pa){this.local.splice(0,
b+1);break}};c.prototype.ug=function(){return this.all.length?this.all[this.all.length-1].Pa:this.vj()};c.prototype.Fl=function(a,b){void 0===b&&(b=!1);this.yb||(a.local=!0,b||(this.Bc.length=this.next,this.Bc.push(a),this.next+=1),this.local.push(a),this.all.push(a),this.kt?(this.log("Executing LOCAL %s",a.Pa),this.vf(a)):this.log("adding LOCAL %s",a.Pa),1===this.Ce&&(this.ue[a.Pa]=a))};c.prototype.vf=function(a){var b=0;for(a=a.ops;b<a.length;b++)this.kd(a[b])};c.prototype.vu=function(a){for(var b=
this.all.length-1;0<=b&&this.all[b].Pa!==a;b--);return b};c.prototype.ur=function(a,b){var d=this.vu(a.Pa);if(-1===d)this.log("ERROR");else{var e=this.Zh();b?(e=a.inverse(e,this.now()),e.xc=this.all[d].Pa):e=a.clone(e,this.now());for(d=b?d+1:d;d<this.all.length;d++)this.all[d].local?e.xc=this.all[d].Pa:this.$k(this.all[d],[e]);this.local.push(e);this.all.push(e);this.vf(e);1===this.Ce&&(this.ue[e.Pa]=e)}};c.prototype.$k=function(a,b){if(0!==b.length){if(a.xc!==b[0].xc)throw Error("Error: Expected same parentage.");
for(var d=0,e=a.ops;d<e.length;d++)for(var f=e[d],c=0,k=b;c<k.length;c++){var l=k[c];f=this.Cy(f,l.ops,a.Pa,l.Pa)}b[0].xc=a.Pa}};c.prototype.Cy=function(a,b,d,e){this.log("Transform "+d+" agaisnt list "+e);for(var f=0;f<b.length;f++){var c=b[f];b[f]=this.lo(a,c,d,e);a=this.lo(c,a,e,d)}return a};c.prototype.ih=function(a,b){var d=this.decode(a);if(null===d||0===d.length)return null!==d;this.log("Entering addRemoteChanges");var e=null;b&&(e=new pb(this.Zh(!0),this.ug(),(new Date).getTime()/1E3,b,!0));
var f=this.ck(this.Sh),c=this.all.length;if(0===this.Ce){if(this.locked())throw Error("Not implemented");if(this.vb===this.all.length)for(var k=0;k<d.length;k++){var l=d[k];this.all.push(l);e&&this.$k(l,[e])}else{for(this.yb=!0;c!==this.vb;)--c,this.vf(this.all[c].inverse());this.yb=!1;l=this.all.slice(this.vb);e&&l.push(e);for(this.all.length=this.vb;0<d.length&&0<l.length;)if(this.dt(d[0],l[0]))this.log("Removing DUPE oplist"),l.shift(),this.local.shift(),this.all.push(d.shift()),this.vb+=1;else break;
for(var n=0;n<d.length;n++)k=d[n],this.$k(k,l);e&&l.pop();this.all=this.all.concat(d,l)}this.vb+=d.length}else{for(c=0;c<d.length;c++)k=d[c],k.Pa in this.ue||(this.ue[k.Pa]=k);c={};c[this.vj()]=[];for(l in this.ue)c[l]=[];for(l in this.ue)k=this.ue[l],k.xc in c&&c[k.xc].push(k.Pa);for(l in c)c[l].sort();k=c[this.vj()];d=this.vj();for(e=0;e<this.all.length&&1===k.length&&k[0]===this.all[e].Pa;e++)d=k[0],k=c[k[0]];for(this.yb=!0;f>=e;f--){this.log("[%s] Executing INVERSE %s",f,this.all[f].Pa);try{this.vf(this.all[f].inverse())}catch(q){throw this.log("Error occurred HEREEEEEE %s",
this.all[f].Pa),q;}}this.yb=!1;this.all.length=e;e=[];this.Fm(c,d,e);c=this.all.length;for(f=1;f<e.length;f++)this.all.push(e[f]);f=this.ck(this.Sh);this.log("revertedTo=%s lockedTo=%s ordered=%s all=%s",c,f,e.length,this.all.length)}this.yb=!0;for(e=c;e<=f;e++)this.log("[%s] Executing REMOTE %s",e,this.all[e].Pa),this.vf(this.all[e]);0<this.all.length-c?this.va(!0):this.log("no remote changes to commit");this.yb=!1;this.log("Done addremotechanges");return!0};c.prototype.Fm=function(a,b,d){d.push(this.ue[b]);
for(b=a[b];1===b.length;)d.push(this.ue[b[0]]),b=a[b[0]];if(0!==b.length){var e=d.length;this.Fm(a,b[0],d);for(var f=1;f<b.length;f++){var c=[];this.Fm(a,b[f],c);for(var k=e;k<d.length;k++)this.$k(d[k],c);d.push.apply(d,c)}}};c.prototype.vj=function(){return(0).toString()};c.prototype.Zh=function(a){void 0===a&&(a=!1);if(0===this.Ce){var b=this.$o.toString();a||--this.$o;return b}return this.sl+Math.floor(1E6*Math.random()).toString(36)};c.prototype.show=function(){this.log("%s",JSON.stringify(this.all,
null,2))};c.prototype.now=function(){return Math.floor((new Date).getTime()/1E3)};c.prototype.Ix=function(a){this.sl=a};c.prototype.xp=function(a,b){if(0===this.Ce){var d=parseInt(a,10),e=parseInt(b,10);return 0>d&&0>e?d>e:0<d&&0<e?d<e:0<e?!1:!0}return a<b};c.prototype.dt=function(a,b){var d=this.encode([a]),e=this.encode([b]);return d==e};c.prototype.va=function(){};return c}(),sb=function(){function c(a,b,d){this.type=a;this.bc=b;this.newValue=d}c.prototype.clone=function(){return new c(this.type,
this.bc,this.newValue)};c.prototype.inverse=function(){return"a"===this.type?new c("a",-this.bc,this.newValue-this.bc):new c("m",1/this.bc,this.newValue/this.bc)};return c}();
(function(c){function a(a,d){var b=c.call(this,!0,a)||this;b.prefix=d;b.value=0;b.Ix(d);return b}__extends(a,c);a.prototype.kd=function(a){"a"===a.type?(this.log("Add to  %s  %s",this.value,a.bc),this.value+=a.bc):"m"===a.type&&(this.log("Multiply %s by %s",this.value,a.bc),this.value*=a.bc);if(this.value!==a.newValue)throw Error("Document value should be "+a.newValue+", but got "+this.value);};a.prototype.decode=function(a){a=JSON.parse(a,function(a,b){if(b instanceof Object){if(b.bc)return new sb(b.type,
b.bc,b.newValue);if(b.ops)return new pb(b.Pa,b.xc,b.gc,b.ops)}return b});if(0===this.Ce)for(var b=this.vb,e=b+1,f=0;f<a.length;f++){var c=a[f];c.xc=b.toString();c.Pa=e.toString();b=e;e+=1}return a};a.prototype.encode=function(a){return JSON.stringify(a)};a.prototype.lo=function(a,d,e,f){this.log("transform %s/,%s",e,f);if(this.xp(e,f))return e=a.newValue,e="a"===d.type?e+d.bc:e*d.bc,new sb(d.type,d.bc,e);e=d.newValue;e="a"===a.type?e+a.bc:e*a.bc;this.log("   Modified op2 with value "+e);return new sb("a",
e-a.newValue,e)};a.prototype.add=function(a){var b=this.Zh();this.Fl(new pb(b,this.ug(),Math.round((new Date).getTime()/1E3),[new sb("a",a,this.value+a)]))};a.prototype.multiply=function(a){var b=this.Zh();this.Fl(new pb(b,this.ug(),Math.round((new Date).getTime()/1E3),[new sb("m",a,this.value*a)]))};return a})(rb);var tb=function(){function c(a,b){this.dc=a;this.index=b}c.prototype.encode=function(){return this.dc+";"+this.index};return c}(),yb=function(){function c(a,b,d,e){this.fb=a;this.ba=e;this.type="c";this.Ia=new tb(b,d)}c.prototype.encode=function(){var a=JSON.stringify(this.ba);return"C"+this.fb+";"+this.Ia.encode()+";"+a.length+";"+a+";"};c.prototype.clone=function(){return new c(this.fb,this.Ia.dc,this.Ia.index,this.ba)};c.prototype.inverse=function(){return new ub(this.fb,this.Ia.dc,this.Ia.index)};
c.cf=function(a,b){var d=/C([^;]+);([^;]+);(-?\d+);(\d+);/g;d.lastIndex=b;var e=d.exec(a);if(e&&e.index===b){var f=parseInt(e[4],10),h=JSON.parse(a.substr(d.lastIndex,f));return{kf:new c(e[1],e[2],parseInt(e[3],10),h),position:d.lastIndex+f+1}}return null};return c}(),ub=function(){function c(a,b,d){this.fb=a;this.dc=b;this.index=d;this.ba=null;this.type="d";this.Ia=new tb(b,d)}c.prototype.clone=function(){return new c(this.fb,this.Ia.dc,this.Ia.index)};c.prototype.inverse=function(){if(null===this.ba)throw Error("DeleteOp should have been executed before inverse");
return new yb(this.fb,this.Ia.dc,this.Ia.index,this.ba)};c.prototype.encode=function(){return"D"+this.fb+";"+this.Ia.encode()+";"};c.cf=function(a,b){var d=/D([^;]+);([^;]+);(-?\d+);/g;d.lastIndex=b;var e=d.exec(a);return e&&e.index===b?{kf:new c(e[1],e[2],parseInt(e[3],10)),position:d.lastIndex}:null};return c}(),zb=function(){function c(a,b,d){this.fb=a;this.ba=b;this.Gf=d;this.type="s"}c.prototype.clone=function(){return new c(this.fb,this.ba,this.Gf)};c.prototype.inverse=function(){if(null===
this.Gf)throw Error("SetPropertiesOp was not executed before inversion");return new c(this.fb,this.Gf,this.ba)};c.prototype.encode=function(){var a=JSON.stringify(this.ba);return"S"+this.fb+";"+a.length+";"+a+";"};c.cf=function(a,b){var d=/S([^;]+);(\d+);/g;d.lastIndex=b;var e=d.exec(a);if(e&&e.index===b){var f=parseInt(e[2],10),h=JSON.parse(a.substr(d.lastIndex,f));return{kf:new c(e[1],h,null),position:d.lastIndex+f+1}}return null};return c}(),Ab=function(){function c(a,b,d,e,f){this.fb=a;this.type=
"m";this.src=new tb(b,d);this.Ia=new tb(e,f)}c.prototype.clone=function(){return new c(this.fb,this.src.dc,this.src.index,this.Ia.dc,this.Ia.index)};c.prototype.inverse=function(){return new c(this.fb,this.Ia.dc,this.Ia.index,this.src.dc,this.src.index)};c.prototype.encode=function(){return"M"+this.fb+";"+this.src.encode()+";"+this.Ia.encode()+";"};c.cf=function(a,b){var d=/M([^;]+);([^;]+);(-?\d+);([^;]+);(\d+);/g;d.lastIndex=b;var e=d.exec(a);return e&&e.index===b?{kf:new c(e[1],e[2],parseInt(e[3],
10),e[4],parseInt(e[5],10)),position:d.lastIndex}:null};return c}(),Bb=function(c){function a(a,d,e){void 0===e&&(e=!1);var b=c.call(this,!1,1)||this;b.ub=a;b.bk=e;b.bg=[];b.sn=!1;b.Jx(d);return b}__extends(a,c);a.prototype.Jx=function(a){this.sl=a};a.prototype.createNode=function(a,d,e,f){this.yb||(d=new yb(a,d,e,f),this.bg.push(d),this.bk&&!this.locked()&&this.kd(d));return a};a.prototype.Xd=function(a,d,e){this.yb||(d=new ub(a,d,e),d.ba=this.ub.Mc(a),this.bg.push(d),this.bk&&!this.locked()&&this.kd(d))};
a.prototype.Pc=function(a,d,e,f,c){this.yb||(a=new Ab(a,f,c,d,e),this.bg.push(a),this.bk&&!this.locked()&&this.kd(a))};a.prototype.We=function(a,d,e){this.yb||(a=new zb(a,d,e),this.bg.push(a),this.bk&&!this.locked()&&this.kd(a))};a.prototype.Mc=function(a){return this.ub.Mc(a)};a.prototype.va=function(a,d){if(!this.sn){if(!this.yb&&this.bg.length){for(var b=new pb(this.Zh(),this.ug(),this.now()),f=0,c=this.bg;f<c.length;f++)b.ops.push(c[f]);this.Fl(b,d)}else this.yb&&(this.sn=!0,this.ub.va(a,d),this.sn=
!1);this.bg.length=0}};a.prototype.kd=function(a){this.log("Execute "+a.type);switch(a.type){case "c":this.ub.createNode(a.fb,a.Ia.dc,a.Ia.index,a.ba);break;case "d":-1===a.Ia.index?this.log("op was nullified."):(a.ba=this.ub.Mc(a.fb),this.ub.Xd(a.fb,a.Ia.dc,a.Ia.index));break;case "s":if(null===a.Gf){a.Gf={};var b=this.ub.Mc(a.fb),e;for(e in a.ba)a.Gf[e]=b[e]}this.ub.We(a.fb,a.ba,a.Gf);break;case "m":-1!==a.src.index&&this.ub.Pc(a.fb,a.Ia.dc,a.Ia.index,a.src.dc,a.src.index)}};a.prototype.decode=
function(a){for(var b=[],e=0,f=/B([^;]+);([^;]+);([^;]+);\d+;/g;e<a.length;){var c;switch(a[e]){case "B":f.lastIndex=e;if((c=f.exec(a))&&c.index===e){e=parseInt(c[1],36);var k=c[2];c=c[3];if(isNaN(e))return this.log("Error: TS is not a number."),null;c=new pb(c,k,e);b.push(c);e=f.lastIndex}else return null;continue;case "C":c=yb.cf(a,e);break;case "D":c=ub.cf(a,e);break;case "S":c=zb.cf(a,e);break;case "M":c=Ab.cf(a,e);break;default:return null}if(0===b.length)return this.log("Got change outside of batch"),
null;if(null===c)throw Error("change is null while decoding: "+a.substr(e,500));e=c.position;b[b.length-1].ops.push(c.kf)}return b};a.prototype.encode=function(a){for(var b="",e=0;e<a.length;e++){var f=a[e];b+="B"+f.gc.toString(36)+";"+f.xc+";"+f.Pa+";"+f.ops.length+";";var c=0;for(f=f.ops;c<f.length;c++)b+=f[c].encode()}return b};a.prototype.lo=function(a,d,e,f){function b(b,d,e){b="c"===a.type?1:-1;switch(e.type){case "c":if(0>e.Ia.index)break;e=e.clone();c(d,e.Ia,b,"c");l.log("Result is "+f+":"+
e.type+"."+e.Ia.index);break;case "d":if(0>e.Ia.index)break;e=e.clone();c(d,e.Ia,b,"d");l.log("Result is "+f+":"+e.type+"."+e.Ia.index);break;case "m":0>e.Ia.index||0>e.src.index||(e=e.clone(),c(d,e.src,b,"d"),c(d,e.Ia,b,"c"))}return e}function c(b,c,h,k){b.dc===c.dc&&0<=c.index&&(b.index<c.index||b.index==c.index&&0<h?(c.index+=h,l.log("Shift "+f+":"+d.type+" by "+h)):b.index===c.index&&0>h&&"d"===k?(c.index=-1,l.log("NULLIFY")):l.log("No conflict; "+e+":"+a.type+" "+b.index+" "+f+":"+d.type+" "+
c.index))}var l=this;this.log("xform "+e+":"+a.type+"/"+f+":"+d.type);if(this.xp(f,e))return this.log("Not doing anything; "+f+"<"+e),d;"c"===a.type&&0<=a.Ia.index?d=b(a.type,a.Ia,d):"d"===a.type&&0<=a.Ia.index?d=b(a.type,a.Ia,d):"m"===a.type&&0<=a.Ia.index&&0<=a.src.index&&(d=b("d",a.src,d),d=b("c",a.Ia,d));return d};return a}(rb);
(function(){function c(){this.Fa={};this.log=x.create("DebugTree");this.root={fb:"0",parent:null,children:[],ba:{name:"root"}};this.Fa["0"]=this.root}c.prototype.createNode=function(a,b,d,e){this.log("create node "+a+" child of "+b);b=this.Fa[b];e={fb:a,parent:b,children:[],ba:e};b.children.splice(d,0,e);this.Fa[a]=e};c.prototype.Xd=function(a){this.log("delete node "+a);if(a in this.Fa){var b=this.Fa[a].parent;if(b)for(var d=0;d<b.children.length;d++)if(b.children[d].fb===a){b.children.splice(d,
1);break}delete this.Fa[a]}};c.prototype.Pc=function(a,b,d){this.log("move "+a+" to "+b+":"+d);if(a in this.Fa){var e=this.Fa[a];this.Xd(a);this.createNode(a,b,d,e.ba)}};c.prototype.We=function(a,b){if(a in this.Fa)for(var d in b)b.hasOwnProperty(d)&&(this.Fa[a].ba[d]=b[d])};c.prototype.Mc=function(a){return a in this.Fa?this.Fa[a].ba:{}};c.prototype.va=function(){};c.prototype.toString=function(){return this.encode(this.root)};c.prototype.encode=function(a){for(var b="("+a.ba.name,d=0;d<a.children.length;d++)b+=
" "+this.encode(a.children[d]);return b+")"};return c})();var Cb=x.create("DOCTREE"),Db=function(){function c(a,b){this.fe=a;this.Fa={};this.Fa["0"]=b}c.prototype.Ys=function(a,b){if(a in this.Fa)throw Error("Node "+a+" already exists");this.Fa[a]=b};c.prototype.createNode=function(a,b,d,e){Cb("createNode("+a+", "+b+", "+d+")");if(a in this.Fa)throw Error("createNode "+a+" already exists");b=this.Ka(b);if(b.Ma()+1<d)throw Error("Asked to insert at index "+d+" but parent only has "+b.Ma()+" children");e=this.fe.gw(a,e);b.ek(e,d);e.parent=b;this.Fa[a]=e;this.fe.Zq&&
this.fe.Zq(e)};c.prototype.Ka=function(a){if(a in this.Fa)return this.Fa[a];throw Error("nid "+a+" does not exist");};c.prototype.Je=function(a){return a in this.Fa};c.prototype.Xd=function(a,b,d){Cb("deleteNode("+a+", "+b+", "+d+")");var e=this.Ka(a),f=this.Ka(b);if(e.parent!==f)throw Error("Asked to remove "+a+" from parent "+b+" but it has a different parent");if(f.sb(d)!==e)throw Error("Asked to remove "+a+":"+d+" but it is in a different index");if(0!==e.Ma())throw Error("Asked to delete "+a+
" but it still has children.");for(a=e.Ma()-1;0<=a;a--)b=e.sb(a),this.Xd(b.id,e.id,a);this.fe.$q&&this.fe.$q(e);f.removeChild(d);delete this.Fa[e.id]};c.prototype.Pc=function(a,b,d,e,f){Cb("moveNode("+a+", dest="+b+":"+d+", src="+e+":"+f+")");var c=this.Ka(a),k=this.Ka(b),l=this.Ka(e);if(c.parent!==l)throw Error("node "+a+" does not have parent "+e);if(l.Ma()<f)throw Error("parent of "+a+" does not have a node at index "+f);if(l.sb(f)!==c)throw Error("node "+a+" not the "+f+"th child");if(c.parent===
k){if(k.Ma()<=d)throw Error("asked to shift node at "+b+":"+d+" but it only has "+k.Ma()+" children");c.parent.Yn(d,f)}else{if(k.Ma()<d)throw Error("asked to put a node at "+b+":"+d+" but it only has "+k.Ma()+" children");l.removeChild(f);k.ek(c,d);c.parent=k}};c.prototype.We=function(a,b){var d=this.Ka(a),e;for(e in b)d.setProperty(e,b[e]);this.fe.fr&&this.fe.fr(d,b)};c.prototype.Mc=function(a){return this.Ka(a).Mc()};c.prototype.va=function(a){this.fe.wk&&this.fe.wk(a)};c.prototype.Ic=function(a){for(var b in this.Fa)a(this.Fa[b])};
return c}();function Eb(){}var Fb=setTimeout,Gb=[],Hb=!1;function Ib(){for(var c=0;c<Gb.length;c++)Gb[c][0](Gb[c][1]);Gb=[];Hb=!1}function Jb(c,a){Gb.push([c,a]);Hb||(Hb=!0,Fb(Ib,0))}function Kb(c,a){function b(b){Lb(a,b)}function d(b){Mb(a,b)}try{c(b,d)}catch(e){d(e)}}function Nb(c){var a=c.Ow,b=a.qc;a=a.am;var d=c.Xn[b];c=c.then;if("function"===typeof d){b="fulfilled";try{a=d(a)}catch(e){Mb(c,e)}}Ob(c,a)||("fulfilled"===b&&Lb(c,a),"rejected"===b&&Mb(c,a))}
function Ob(c,a){var b=!1;try{if(c===a)throw new TypeError("A promises callback cannot return that same promise.");if(a&&("function"===typeof a||"object"===typeof a)){var d=a.then;if("function"===typeof d)return d.call(a,function(d){b||(b=!0,a!==d?Lb(c,d):Pb(c,d))},function(a){b||(b=!0,Mb(c,a))}),!0}}catch(e){return b||Mb(c,e),!0}return!1}function Lb(c,a){c!==a&&Ob(c,a)||Pb(c,a)}function Pb(c,a){"pending"===c.qc&&(c.qc="sealed",c.am=a,Jb(Qb,c))}
function Mb(c,a){"pending"===c.qc&&(c.qc="sealed",c.am=a,Jb(Rb,c))}function Sb(c){var a=c.bo;c.bo=[];for(c=0;c<a.length;c++)Nb(a[c])}function Qb(c){c.qc="fulfilled";Sb(c)}function Rb(c){c.qc="rejected";Sb(c)}
var Tb=function(){function c(a){this.qc="pending";this.am=void 0;this.bo=[];Kb(a,this)}c.prototype.then=function(a,b){var d={Ow:this,then:new c(Eb),Xn:{}};d.Xn.fulfilled=a;d.Xn.rejected=b;"fulfilled"===this.qc||"rejected"===this.qc?Jb(Nb,d):this.bo.push(d);return d.then};c.prototype["catch"]=function(a){return this.then(null,a)};c.resolve=function(a){return a&&"object"===typeof a&&a.constructor===this?a:new this(function(b){b(a)})};c.reject=function(a){return new this(function(b,d){d(a)})};return c}();
Tb.prototype.then=Tb.prototype.then;x.create("HTML");function Ub(c){return parseFloat(c||"")||0}
var Wb=function(){function c(a){this.fa=a}c.prototype.Wa=function(a){for(var b in a){if(0<=b.indexOf("-"))throw Error("setStyle: styles must be camelcase; not "+b);this.fa.style[b]=""+a[b]}return this};c.prototype.pi=function(a){for(var b in a)this.fa.setAttribute(b,a[b]);return this};c.prototype.Xc=function(a){a.appendChild(this.fa);return this};c.prototype.Om=function(a){a.parentNode&&a.parentNode.insertBefore(this.fa,a.nextSibling)};c.prototype.insertBefore=function(a){a.parentNode&&a.parentNode.insertBefore(this.fa,
a);return this};c.prototype.remove=function(){this.fa.parentNode&&this.fa.parentNode.removeChild(this.fa);return this};c.prototype.ce=function(a){return window.getComputedStyle(this.fa)[a]||""};c.prototype.Yb=function(){var a=this.fa.getBoundingClientRect();return{top:a.top+window.pageYOffset,left:a.left+window.pageXOffset,width:a.width,height:a.height}};c.prototype.Rk=function(a){var b=(b=this.vv())?b.Yb():{left:0,top:0};this.fa.style.left=a.left-b.left+"px";this.fa.style.top=a.top-b.top+"px"};c.prototype.vv=
function(){if(!(this.fa instanceof HTMLElement)||"fixed"===this.ce("position"))return Vb(document.body);for(var a=this.fa.parentElement;a&&"static"===Vb(a).ce("position");)a=a.parentElement;return a?Vb(a):null};c.prototype.Cm=function(){var a=window.getComputedStyle(this.fa),b={left:Ub(a.marginLeft),top:Ub(a.marginTop),right:Ub(a.marginRight),bottom:Ub(a.marginBottom),Vm:0,Cn:0,jo:0,Ml:0};"content-box"===a.boxSizing&&(b.Vm+=Ub(a.borderLeftWidth)+Ub(a.paddingLeft),b.jo+=Ub(a.borderTopWidth)+Ub(a.paddingTop),
b.Cn+=Ub(a.borderRightWidth)+Ub(a.paddingRight),b.Ml+=Ub(a.borderBottomWidth)+Ub(a.paddingBottom));return b};c.prototype.sd=function(a){this.fa.classList.add(a);return this};c.prototype.ho=function(a,b){b?this.fa.classList.add(a):this.fa.classList.remove(a)};c.prototype.addEventListener=function(a,b,d){void 0===d&&(d=!1);var e=0;for(a=a.split(" ");e<a.length;e++)this.fa.addEventListener(a[e],b,d);return this};c.prototype.removeEventListener=function(a,b,d){void 0===d&&(d=!1);var e=0;for(a=a.split(" ");e<
a.length;e++)this.fa.removeEventListener(a[e],b,d);return this};c.prototype.matches=function(a){if(this.fa.matches)return this.fa.matches(a);var b=0;for(a=a.split(",");b<a.length;b++){var d=a[b];d=d.trim();if(0!=d.length)return"["==d[0]?this.fa.hasAttribute(d.substr(1,d.length-2)):this.fa.tagName===d.toUpperCase()}return!1};c.prototype.query=function(a,b){this.matches(a)&&b(this.fa);Array.prototype.forEach.call(this.fa.querySelectorAll(a),b)};c.prototype.clear=function(){for(;null!==this.fa.firstChild;)this.fa.removeChild(this.fa.firstChild);
return this};c.prototype.Sg=function(a){this.fa.innerText=a;return this};return c}();function Vb(c,a){if("string"===typeof c){if("<"==c[0]){var b=Vb.Op(c);return new Wb(b[0])}b=new Wb(document.createElement(c));a&&b.pi(a);return b}return new Wb(c)}var Xb=null;
(function(c){c.Wb=function(a){return"jQuery"in window&&a instanceof window.jQuery?a[0]:a instanceof HTMLElement?a:"string"===typeof a?document.querySelector(a):null};c.Sj=function(){var a=document.documentElement,b=a.scrollWidth>a.clientWidth;a=a.scrollHeight>a.clientHeight?c.vg():0;b=b?c.vg():0;return{width:window.innerWidth-a,height:window.innerHeight-b,x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}};c.vg=function(){if(null===
Xb){var a=document.createElement("div");a.style.visibility="hidden";a.style.width="100px";document.body.appendChild(a);var b=a.offsetWidth;a.style.overflow="scroll";var d=document.createElement("div");d.style.width="100%";a.appendChild(d);d=d.offsetWidth;a.parentNode.removeChild(a);Xb=b-d}return Xb};c.kq=function(){for(var a=document.getElementsByTagName("*"),b=0,d=0;d<a.length;d++){var e=parseInt(c(a[d]).ce("z-index"),10)||0;e>b&&(b=e)}return b};c.Op=function(a){var b=document.createElement("div");
b.innerHTML=a;a=[];for(b=b.firstChild;b;)b instanceof HTMLElement&&a.push(b),b=b.nextSibling;return a}})(Vb||(Vb={}));
function Yb(c){return new Tb(function(a,b){var d=new XMLHttpRequest;c.mimeType&&d.overrideMimeType(c.mimeType);c.withCredentials&&(d.withCredentials=!0);c.responseType&&(d.responseType=c.responseType);var e=c.method||"GET",f=c.ir||{},h=c.url,k="",l=!0,n;for(n in f)l||(k+="&"),l=!1,k+=n+"="+encodeURIComponent(f[n]);"GET"===e&&0<k.length&&(h+="?"+k,k="");d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status)a(d);else{var e=d.statusText;0===d.status?e="Could not contact server.":d.getResponseHeader("status")&&
(e=d.getResponseHeader("status"));b(Error(d.status+" "+e))}};d.open(e,h,!0);"string"===typeof c.data&&(k=c.data);c.contentType?d.setRequestHeader("Content-type","application/json"):"POST"===e&&d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.cancel&&c.cancel.then(function(){d.abort()});c.Hp?setTimeout(function(){d.send(k)},c.Hp):d.send(k)})}(function(){function c(){this.Wr=null}c.prototype.Xa=function(){this.Wr&&Vb(this.Wr).remove()};return c})();var Zb=[],$b=null;
function ac(c){for(var a=0;a<Zb.length;a++)if(Zb[a]===c)return;Zb.push(c);$b||($b=document.createElement("style"),document.head&&document.head.insertBefore($b,document.head.firstChild));$b.appendChild(document.createTextNode(c))}
var bc=function(){function c(){this.input=null}c.prototype.Xa=function(){this.input&&this.input.parentNode&&this.input.parentNode.removeChild(this.input)};c.prototype.open=function(a){var b=this;return new Promise(function(d){b.input&&b.input.parentNode&&b.input.parentNode.removeChild(b.input);b.input=document.createElement("input");b.input.style.display="none";b.input.setAttribute("id","ZwibblerFileInput");b.input.setAttribute("type","file");document.body.appendChild(b.input);a.accept&&b.input.setAttribute("accept",
a.accept);var e=new FileReader,f="";b.input.addEventListener("change",function(){var b=this.files;b&&0<b.length&&(f=b[0].type,"data-uri"===a.format?e.readAsDataURL(b[0]):"text"===a.format?e.readAsText(b[0]):"ArrayBuffer"===a.format&&e.readAsArrayBuffer(b[0]))});e.addEventListener("load",function(){d({contentType:f,data:e.result})});b.input.value="";b.input.click()})};return c}(),cc=function(){function c(){this.rk="";this.anchor=null}c.prototype.Xa=function(){this.anchor&&this.anchor.parentNode&&this.anchor.parentNode.removeChild(this.anchor);
""!==this.rk&&window.URL.revokeObjectURL(this.rk)};c.prototype.Ax=function(a,b){for(var d=atob(a.split(",")[1]),e=a.split(",")[0].split(":")[1].split(";")[0],f=new ArrayBuffer(d.length),c=new Uint8Array(f),k=0;k<d.length;k++)c[k]=d.charCodeAt(k);this.zx(new Blob([f],{type:e}),b)};c.prototype.zx=function(a,b){var d=this;this.Xa();window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(a,b):(this.rk=window.URL.createObjectURL(a),this.anchor=document.createElement("a"),this.anchor.innerHTML=
"download",this.anchor.setAttribute("href",this.rk),this.anchor.setAttribute("download",b),this.anchor.style.display="none",document.body.appendChild(this.anchor),this.anchor.click(),setTimeout(function(){d.anchor&&document.body.removeChild(d.anchor)},1E3))};return c}(),B=Vb;var dc=function(){function c(a,b,d,e,c){void 0===a&&(a="transparent");void 0===b&&(b=0);void 0===d&&(d=0);void 0===e&&(e=0);void 0===c&&(c=0);this.mf=a;this.left=b;this.top=d;this.right=e;this.bottom=c;this.zIndex=1;this.insertBefore=null;this.ma=document.createElement("div")}c.prototype.Oe=function(){this.ma&&B(this.ma).remove()};c.prototype.show=function(a){B(this.ma).Wa({position:"fixed",background:this.mf,opacity:.25,left:this.left+"px",top:this.top+"px",right:this.right+"px",bottom:this.bottom+
"px",display:"block"});this.ma.addEventListener("click",a);this.ma.style.zIndex=this.zIndex.toString();this.insertBefore?this.insertBefore.parentNode&&this.insertBefore.parentNode.insertBefore(this.ma,this.insertBefore):document.body.appendChild(this.ma)};return c}();function ec(c,a){function b(){var a=f.offsetWidth,b=f.offsetHeight,d=B.Sj();B(f).Rk({left:d.x+d.width/2-a/2,top:d.y+d.height/2-b/2})}function d(a){var b=(new Date).getTime();q&&v&&200>b-v&&(a.preventDefault(),setTimeout(function(){u.hide()},0))}function e(){v=(new Date).getTime()}void 0===a&&(a={});var f=B.Wb(c);if(!f)throw Error("Zwibbler.Dialog: Bad element passed in: "+c);var h=null===f.parentNode;h&&document.body.appendChild(f);"static"===B(f).ce("position")&&(f.style.position="absolute");f.style.display=
"none";var k=new dc("transparent");k.insertBefore=f;var l=a.showNear,n=a.showHow,q=!1,u={hide:function(){k.Oe();f.style.display="none";if(u.onhide)u.onhide();window.removeEventListener("resize",b)},isShown:function(){return"none"!==B(f).ce("display")},show:function(a,d,e,c){void 0===e&&(e=!1);void 0===c&&(c=!0);var h=0,w=0,y="",C="";v=0;if("number"===typeof a&&"number"===typeof d){h=a;w=d;var z=!0}else y=a||l,C=d||n,z=!1;a=B.kq()+1;f.style.zIndex=a.toString();k.zIndex=a;f.style.display="block";a=
f.offsetWidth;d=f.offsetHeight;if(z)C=B.Sj(),h={left:h,top:w},h.left=Math.min(h.left,C.x+C.width-a-2),h.top=Math.min(h.top,C.y+C.height-d-3),B(f).Rk(h);else if(y&&C){if(w=B.Wb(y))h=f,y=C,C=B(w).Yb(),y=y.toLowerCase().split(" "),2!==y.length&&(y=["tl","tl"]),0<=y[0].indexOf("b")&&(C.top+=w.offsetHeight),0<=y[0].indexOf("r")&&(C.left+=w.offsetWidth),0<=y[1].indexOf("b")&&(C.top-=h.offsetHeight),0<=y[1].indexOf("r")&&(C.left-=h.offsetWidth),h.style.position="absolute",w=B.Sj(),y=h.clientHeight,C.left=
Math.min(C.left,w.x+w.width-h.clientWidth),C.top=Math.min(C.top,w.y+w.height-y),B(h).Rk(C)}else window.addEventListener("resize",b),b();c&&k.show(u.hide);if(u.onshow)u.onshow();q=e},destroy:function(){window.removeEventListener("resize",b);f.removeEventListener("click",d);f.removeEventListener("pointerup",d);f.removeEventListener("touchend",d);f.removeEventListener("touchstart",e);f.removeEventListener("pointerdown",e);h&&B(f).remove()},onshow:a.onshow,onhide:a.onhide},v=0;f.addEventListener("click",
d);"ontouchstart"in window?(f.addEventListener("touchend",d),f.addEventListener("touchstart",e)):(f.addEventListener("pointerup",d),f.addEventListener("pointerdown",e));return u};var fc=x.create("Zeact"),hc=function(){function c(a,b,d,e,c){this.hl=a;this.scope=b;this.element=d;this.name=e;this.value=c}c.prototype.emit=function(a,b){this.hl.na(this.element,a,b)};c.prototype.listen=function(a,b){this.hl.Za(this.element,a,b)};c.prototype.watch=function(a,b){this.hl.watch(this.scope,this.element,a,b)};c.prototype.eval=function(a){return gc.mm(this.scope,a,this.element)};c.prototype.destructor=function(a){this.hl.xa(this.element,a)};return c}(),ic=function(){function c(){this.wo=
new Na;this.nj={};this.De={};this.ys=1}c.prototype.wb=function(a,b,d){void 0===d&&(d=2);this.nj[a]={name:a,link:b,Vr:d}};c.prototype.bj=function(a,b){this.De[a.toUpperCase()]=b;"string"===typeof b.template&&(b.template=b.template.trim())};c.prototype.Od=function(a,b){var d=this;this.wb(a,function(a,c,h,k){d.ey(a,function(){d.watch(a,c,k,function(d){b(c,d,a)})})})};c.prototype.watch=function(a,b,d,e){var c=this;this.wo.watch(a,d,e);this.xa(b,function(){c.wo.unwatch(d,e)})};c.prototype.ey=function(a,
b){a.Co?(b(),this.digest()):a.ah?a.ah.push(b):a.ah=[b]};c.prototype.iw=function(a){if(!a.Co&&(a.Co=!0,a.ah)){for(var b=0,d=a.ah;b<d.length;b++)(0,d[b])();delete a.ah;this.digest()}};c.prototype.Za=function(a,b,d){a.addEventListener(b,d);this.xa(a,function(){a.removeEventListener(b,d)});a.zwibblerListeners||(a.zwibblerListeners={});a.zwibblerListeners[b]||(a.zwibblerListeners[b]=[]);a.zwibblerListeners[b].push(d)};c.prototype.na=function(a,b,d){var e=this;setTimeout(function(){e.jd(a,b,d)},0)};c.prototype.jd=
function(a,b,d){if(a.zwibblerListeners&&b in a.zwibblerListeners)for(var e=0,c=a.zwibblerListeners[b];e<c.length;e++){var h=c[e];try{h.call(a,d)}catch(k){console.log("Error while handling event "+b+": ",k)}}};c.prototype.xa=function(a,b){a.kl?a.kl.push(b):a.kl=[b]};c.prototype.detach=function(a){for(var b=a.firstChild;b;)this.detach(b),b=b.nextSibling;if(a.kl){b=0;for(var d=a.kl;b<d.length;b++)(0,d[b])();delete a.zwibblerWatchers}a.zwibblerListeners&&delete a.zwibblerListeners;a.Es&&delete a.Es;a.gh&&
delete a.gh};c.prototype.digest=function(a){this.wo.check(a)};c.prototype.su=function(a,b){var d=/^z-([a-z0-9@\-]+)/.exec(a.toLowerCase());if(d&&(d=d[1],d in this.nj&&this.nj[d].Vr===b))return this.nj[d]};c.prototype.Ll=function(a,b,d,e){void 0===e&&(e=b);for(var c=b.parentNode,h=[],k=0;k<e.attributes.length;k++)h.push({name:e.attributes[k].name,value:e.attributes[k].value});for(k=0;k<h.length&&b.parentNode;k++){e=h[k].name;var l=h[k].value,n=this.su(e,d);if(n&&n.Vr===d&&(fc("Link directive to %s for %s=%s",
b.gh,e,l),(e=n.link(a,b,e,l))&&e!==b))return{fa:e,Jk:!0}}return{fa:b,Jk:b.parentNode!==c}};c.prototype.ej=function(a,b,d,e){b=document.createElement(b);for(var c in d)b.setAttribute(c,d[c]);e&&(b.ll=e);a=this.sc(a,b);delete b.ll;return a};c.prototype.ct=function(a,b){var d=this,e=this.De[b.tagName];if(!e)return null;fc("Attaching component %s",b.tagName);var c=e.template;if(c instanceof HTMLElement)var h=c.cloneNode(!0);else if("string"===typeof c)if("<"===c[0]){fc("Using elementsFromString to instantiate component");
var k=B.Op(c);if(0===k.length)throw Error("Component "+b.tagName+": Could not interpret as HTML: "+c);if(1<k.length)throw Error("Component "+b.tagName+": Should render as a single element, but got "+k.length);h=k[0]}else{fc("Using querySelector to instantiate component");h=document.querySelector(c);if(null===h)throw Error("Component "+b.tagName+': querySelector("'+c+'") returned null');h=h.cloneNode(!0)}else throw Error("Component "+b.tagName+": Could not interpret template "+c);c=null!==b.parentNode;
null!==b.parentNode&&b.parentNode.replaceChild(h,b);var l=this,n={$emit:function(a,b){l.na(h,a,b)},$emitNow:function(a,b){l.jd(h,a,b)},$element:h,$parent:a};if(b.ll){k=b.ll;for(var q in n)k[q]=n[q];n=k}q=e.properties;var u={};q&&q.forEach(function(e){u[e]=1;var c=b.getAttribute(e);c&&(fc("Bind prop %s to %s",e,c),d.watch(a,h,c,function(a){n[e]=a}))});h.xs=1;for(q=b.firstChild;q;)k=q.nextSibling,h.appendChild(q),q=k;e.style&&ac(e.style);for(q=0;q<b.attributes.length;q++){k=b.attributes[q].name;var v=
b.attributes[q].value;u[k]||0===k.indexOf("z-")||h.setAttribute(k,v)}for(q=1;2>=q;q++)if(k=this.Ll(a,h,q,b),c&&k.Jk)return{scope:n,node:k.fa};for(q=1;2>=q;q++)if(k=this.Ll(n,h,q,h),c&&k.Jk)return{scope:n,node:k.fa};if(e.controller)try{e.controller(n,new hc(this,n,h,"","")),this.digest()}catch(w){console.log(w),console.log("When running controller for %s",b.tagName)}this.sc(n,h);return{scope:n,node:h}};c.prototype.sc=function(a,b){var d=this,e=this.Qo(a,b);this.digest(function(){d.iw(a)});return e};
c.prototype.Qo=function(a,b){if(1===b.nodeType){if(b.gh)return{node:b,scope:a};b.gh=this.ys++;for(var d=0;2>=d;d++){var e=this.Ll(a,b,d);if(e.Jk)return{node:e.fa,scope:a};if(0===d&&(e=this.ct(a,b)))return e}for(d=b.firstChild;d;)e=d.nextSibling,d.xs||this.Qo(a,d),d=e}return{node:b,scope:a}};return c}(),gc;
(function(c){function a(a,b,d){var e=b.type?b.type.toLowerCase():"",c=d;if("zwibblerValue"in b)var f="zwibblerValue";else f="value",c=""+c;if("radio"===e||"checkbox"===e)b.checked=b[f]===c;else{if("SELECT"===b.tagName){e=0;for(var h=b.querySelectorAll("option");e<h.length;e++){var u=h[e],v=u.getAttribute("z-value");if(v&&Ka(a,v)===d){u.selected=!0;return}}}else"DIV"===b.tagName&&"value"in a&&(a.value=c);b[f]=c}}function b(a,b){var d=b.type?b.type.toLowerCase():"";if("checkbox"===d)return"zwibblerValue"in
b?b.zwibblerValue:b.checked;if("radio"===d)(d=b.getAttribute("name"))&&(d=document.querySelector('input[name="'+d+"]:checked"))&&(b=d);else if("SELECT"===b.tagName){d=0;for(var e=b.querySelectorAll("option");d<e.length;d++){var c=e[d];if(c.selected&&(c=c.getAttribute("z-value")))return Ka(a,c)}}else if("value"in a)return a.value;return"zwibblerValue"in b?b.zwibblerValue:b.value}function d(a,b,d,c,l){d&&(a["this"]=d);c&&(a.$event=c);return Ka(a,b,l)}c.sz=a;c.Xu=b;c.mm=d;c.bf=function(){function e(a,
b){var d=a.indexOf(b);return-1===d?"":a.substr(d+b.length+1)}var c=new ic;c.wb("init",function(a,b,e,c){d(a,c,b)});c.Od("text",function(a,b){a.textContent=b});c.Od("json",function(a,b){a.textContent=JSON.stringify(b)});c.Od("html",function(a,b){a.innerHTML=b});c.wb("model",function(d,e,f,n){c.Za(e,"input",function(){var a=b(d,e);fc("input -> model: New value for %s: %s",n,a);Ka(d,n+"="+JSON.stringify(a));c.digest()});setTimeout(function(){var b=e.getAttribute("z-value");b&&(c.watch(d,e,b,function(c){fc("z-value for %s[%s] is %s",
e.tagName,b,c);e.zwibblerValue=c;a(d,e,c)}),c.xa(e,function(){delete e.zwibblerValue}));c.watch(d,e,n,function(b){fc("model(%s) -> %s[%s] : new value is %s",n,e.tagName,e.type,b);a(d,e,b)})},0)});c.wb("on",function(a,b,f,n){var h=e(f,"on");""!==h&&(fc("Attaching native event %s => %s",h,n),c.Za(b,h,function(e){fc("Got %s, execute %s",h,n);var f=d(a,n,b,e);c.digest();e&&e.preventDefault&&!1===f&&e.preventDefault()}))});c.wb("bind",function(a,b,d,f){var h=e(d,"bind");""!==h&&c.watch(a,b,f,function(a){b.setAttribute(h,
a);"value"===h&&"SELECT"===b.tagName&&(console.log("SSet bound value %s=%s",h,a),console.log("Num children=",b.children.length),b.value=a)})},1);c.wb("for",function(a,b,d,e){d=e.indexOf(" in ");if(-1!==d){var f=e.substr(0,d),h=e.substr(d+4),k=[];fc("z-for '%s' in '%s'",f,h);var l=b.parentNode,n=b.nextSibling;b.parentNode.removeChild(b);c.watch(a,l,h,function(d){if("number"===typeof d){for(var e=[],q=0;q<d;q++)e.push(q);d=e}for(q=0;q<k.length;q++)e=k[q],e.parentNode&&e.parentNode.removeChild(e),c.detach(e);
k.length=0;if("object"===typeof d&&"length"in d)for(q=0;q<d.length;q++){e=document.createComment("z-for "+h+"["+q+"] = "+d[q]);l.insertBefore(e,n);k.push(e);e=Object.create(a);e.$parent=a;e[f]=d[q];var v=b.cloneNode(!0);v.removeAttribute("z-for");l.insertBefore(v,n);e=c.sc(e,v).node;k.push(e)}})}},0);c.wb("if",function(a,b,d,e){var f=document.createComment(d+" "+e),h=b.parentElement,k=null;h.replaceChild(f,b);c.watch(a,h,e,function(e){e&&!k?(k=b.cloneNode(!0),k.removeAttribute(d),h.replaceChild(k,
f),c.sc(a,k)):!e&&k&&(c.detach(k),h.replaceChild(f,k),k=null)})},0);c.Od("class",function(a,b){for(var d in b)B(a).ho(d,b[d])});c.Od("style",function(a,b){for(var d in b)a.style[d]=b[d]});c.Od("selected",function(a,b){B(a).ho("selected",b)});c.Od("disabled",function(a,b){b?a.setAttribute("disabled","true"):a.removeAttribute("disabled")});c.Od("enabled",function(a,b){b?a.removeAttribute("disabled"):a.setAttribute("disabled","true")});c.Od("checked",function(a,b){a.checked=b?!0:!1});return c}})(gc||
(gc={}));var jc=gc;var kc=x.create("DRAGSORT");
function lc(c){function a(a){"dragover"!==a.type&&kc(a.type);for(var b=a.target;b.parentNode!==c.parent&&b.parentNode;)b=b.parentNode;if(1===b.nodeType&&b.getAttribute("draggable")&&"false"!==b.getAttribute("draggable").toLowerCase()&&b.parentNode===c.parent)if("dragstart"===a.type){for(var d=c.parent.children,e=0;e<d.length;e++)console.log(c.Si,d[e].getAttribute(c.Si),d[e]),null!==d[e].getAttribute(c.Si)&&d[e].setAttribute("sort-index",e.toString());a.dataTransfer.setData("text",b.id);a.dataTransfer.dropEffect=
"move";h=f=b;a.stopPropagation()}else"dragover"===a.type&&h&&f.parentNode===b.parentNode?(h.classList.remove(c.kn),h=b,h.classList.add(c.kn),a.preventDefault()):"dragend"===a.type&&h&&f.parentNode===b.parentNode?(h.classList.remove(c.kn),b=parseInt(h.getAttribute("sort-index")||"0"),d=parseInt(f.getAttribute("sort-index")||"0"),c.Hw(d,b),a.preventDefault(),a.stopPropagation()):"drop"===a.type&&(a.preventDefault(),a.stopPropagation())}var b=c.parent.Fs;c.parent.Fs=!0;for(var d=c.parent.children,e=
0;e<d.length;e++)null!==d[e].getAttribute(c.Si)&&d[e].setAttribute("draggable","true");if(b)return function(){};B(c.parent).addEventListener("dragstart dragover dragend drop",a);var f,h;return function(){B(c.parent).removeEventListener("dragstart dragover dragend drop",a)}};var mc=function(){function c(a,b){this.name=b;this.ma=B("div").Wa({borderTop:"1px solid #888",padding:"5px",cursor:"default"}).Xc(a);this.update(0)}c.prototype.update=function(a){this.ma.fa.innerText=this.name+"... "+Math.round(100*a)+"%"};c.prototype.error=function(a){var b=this,d=document.createElement("input");d.setAttribute("type","button");d.value="OK";d.addEventListener("click",function(){b.done()});this.ma.fa.innerText=this.name+"... "+a+" ";this.ma.fa.appendChild(d)};c.prototype.done=function(){this.ma.remove()};
c.all=[];return c}();var nc=function(){function c(a,b,d){void 0===d&&(d=!1);var e=this;this.ma=a;this.Bz=d;this.$m=0;this.Um={};this.qb=!1;this.timeout=null;this.lines=[];this.filter=null;this.Ft="#5da700 #ed81ff #02ab34 #f92798 #59ff91 #ff6b80 #3cffe4 #ffd32b #5e8caa #ffdb7f #e5cdff #00c17e #f6f6f5 #9a861e #daff9d #808d40".split(" ");this.Gt="#2f361e #6b35c2 #416323 #431b77 #af2f21 #5451ad #805221 #962e7f #456354 #a52e4f #273c4c #692d25 #455b8a #3f1a2a #382454 #774f63".split(" ");this.Vl=[];ac('\n\n.z-inner-debug.black {\n    background: #000;\n}\n\n.z-inner-debug.white {\n    background: #fff;\n}\n\n.z-debug-panel {\n    font-family: "monospace";\n    font-size: 12px;\n    display: flex;\n    flex-flow: column nowrap;\n    text-align: left;\n}\n\n.z-inner-debug {\n    flex: 1 1 auto;\n    overflow: scroll;\n}\n\n.z-inner-debug.black div {\n    border-bottom: 1px solid #222;\n    margin-bottom: 3px;\n}\n\n.z-inner-debug.white div {\n    border-bottom: 1px solid #eee;\n    margin-bottom: 3px;\n}\n');
a.classList.add("z-debug-panel");var c=0;B("input").pi({type:"text",placeholder:"regexp...",onclick:"this.select()"}).Xc(a).addEventListener("input",function(a){c&&window.clearTimeout(c);c=setTimeout(function(){e.Qx(a.target.value);c=0},200)});this.ad=B("div").sd("z-inner-debug").Xc(a).fa;B("button").Xc(this.ma).Wa({flex:"0 0 auto"}).Sg("Scroll to bottom/top").addEventListener("click",function(){e.ad.scrollTop=e.qp()?0:e.ad.scrollHeight});this.Zv=x.addListener(function(a,b){return e.ip(a,b)});b.add(function(){x.removeListener(e.Zv)});
this.ip("DEBUG","Debug window starting");B(this.ad).sd(d?"white":"black");this.Vl=d?this.Gt:this.Ft}c.prototype.show=function(){this.ma.style.display="flex";this.qb=!0;this.Oo();this.ad.scrollTop=this.ad.scrollHeight};c.prototype.Oe=function(){this.ma.style.display="none";this.qb=!1};c.prototype.Mu=function(a){a in this.Um||(this.Um[a]=this.Vl[this.$m],this.$m=(this.$m+1)%this.Vl.length);return this.Um[a]};c.prototype.ip=function(a,b){for(var d=this,e=0,c=b.split("\n");e<c.length;e++)this.lines.push({key:a,
line:c[e]});this.qb&&null===this.timeout&&(this.timeout=setTimeout(function(){d.timeout=null;d.Oo()},100))};c.prototype.Qx=function(a){this.filter=2>a.length?null:new RegExp(a,"i");for(a=this.ad.firstChild;a;){var b=a;1===b.nodeType&&"DIV"===b.tagName&&(!this.filter||this.filter.exec(b.textContent)?b.style.display="block":b.style.display="none");a=a.nextSibling}};c.prototype.qp=function(){return this.ad.scrollTop>=this.ad.scrollHeight-this.ad.clientHeight};c.prototype.Oo=function(){for(var a=this.qp(),
b=0,d=this.lines;b<d.length;b++){var e=d[b],c=this.Mu(e.key),h=document.createElement("div");h.style.color=c;e=e.key+": "+e.line;this.filter&&!this.filter.exec(e)&&(h.style.display="none");h.appendChild(document.createTextNode(e));this.ad.appendChild(h)}a&&(this.ad.scrollTop=this.ad.scrollHeight);this.lines.length=0};return c}();var oc=function(){function c(a,b,d){this.parentElement=a;this.stack=[];this.yn=!1;this.pe=[];this.ky=!1;this.first=B("CANVAS",{width:b,height:d}).Xc(a).fa;this.stack.push({canvas:this.first,sa:this.first.getContext("2d"),nh:{}});this.hd=this.Gh();this.width=this.first.width;this.height=this.first.height;this.Li(this.first)}c.prototype.Rs=function(){if(void 0===a)var a=this.stack.length;var b=B("CANVAS").Wa({position:"absolute",left:this.first.offsetLeft+"px",top:this.first.offsetTop+"px",pointerEvents:"none",
outline:"4px solid red"}).sd("zwibbler-overlay").fa;this.Li(b);this.stack.splice(a,0,{canvas:b,sa:b.getContext("2d"),nh:{}});a===this.stack.length-1?this.parentElement.insertBefore(b,null):this.parentElement.insertBefore(b,this.stack[a+1].canvas);b.getContext("2d")};c.prototype.Sc=function(a,b,d){var e=this;this.stack[a].nh[b]=d;if(!this.yn){var c=(new Date).getTime();this.yn=!0;requestAnimationFrame(function(){var a=(new Date).getTime(),b=e.hq();e.yn=!1;for(var d=0,f=e.stack;d<f.length;d++){var q=
f[d],u=!0,v;for(v in q.nh){var w=q.sa;u&&(w.setTransform(b,0,0,b,0,0),w.clearRect(0,0,e.width,e.height),u=!1);q.nh[v](w,b)}q.nh={}}if(e.ky){e.pe.push({gc:a,latency:a-c,fu:(new Date).getTime()-a});25<e.pe.length&&e.pe.shift();w=f=d=0;for(q=e.pe;w<q.length;w++)u=q[w],d+=u.latency,f+=u.fu;d=Math.round(d/e.pe.length*10)/10;f=Math.round(f/e.pe.length*10)/10;a=1<e.pe.length?Math.round(e.pe.length/((a-e.pe[0].gc)/1E3)*100)/100:0;w=e.get(0);w.setTransform(b,0,0,b,0,0);w.fillStyle="white";b="latency="+d+"ms drawTime="+
f+"ms fps="+a;w.fillRect(0,0,w.measureText("latency=MM.MMms drawTime=MM.MMms fps=MM").width,13);w.textBaseline="top";w.font="10px arial";w.fillStyle="red";w.fillText(b,2,2)}})}};c.prototype.get=function(a){return this.stack[a].sa};c.prototype.hq=function(){var a=this.Gh();if(a!==this.hd){this.hd=a;a=0;for(var b=this.stack;a<b.length;a++)this.Li(b[a].canvas)}return this.hd};c.prototype.Xe=function(a,b){this.width=a;this.height=b;for(var d=0,e=this.stack;d<e.length;d++)this.Li(e[d].canvas)};c.prototype.Gh=
function(){var a=this.stack[0].sa;return(window.devicePixelRatio||1)/(a.Vy||a.nw||a.qw||a.ww||a.mt||1)};c.prototype.Li=function(a){a.width=this.width*this.hd;a.height=this.height*this.hd;a.style.width=this.width+"px";a.style.height=this.height+"px";a.getContext("2d").setTransform(this.hd,0,0,this.hd,0,0)};return c}();function pc(c){return"string"===typeof c}function F(c){return"number"===typeof c}function qc(c){return"object"===typeof c};var rc=function(){function c(){this.keys={}}c.prototype.contains=function(a){return a in this.keys};c.prototype.add=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++)this.keys[a[b]]=!0;else this.keys[a]=!0};c.prototype.remove=function(a){delete this.keys[a]};c.prototype.mj=function(a){var b,d;void 0===d&&(d="");if(!(a instanceof c))throw d||"Assertion failed";d=new c;for(b in this.keys)a.contains(b)||d.add(b);return d};c.prototype.Jb=function(){var a;var b=[];for(a in this.keys)this.keys.hasOwnProperty(a)&&
b.push(a);return b};c.prototype.vy=function(){var a;var b=[];for(a in this.keys)this.keys.hasOwnProperty(a)&&b.push(parseFloat(a));return b};c.prototype.clear=function(){this.keys={}};c.prototype.Ic=function(a){for(var b in this.keys)if(this.keys.hasOwnProperty(b)&&a(b))break};c.prototype.empty=function(){for(var a in this.keys)if(this.keys.hasOwnProperty(a))return!1;return!0};return c}();function sc(c){for(var a=[],b=0;b<c;b++)a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567890"[Math.floor(63*Math.random())]);return a.join("")};var tc=x.create("MISC");function uc(c){var a=document.createElement("canvas");c&&c.appendChild(a);a.style.background="transparent";return a}function vc(c,a){var b=r.Zd(c);b.values[3]=a;return b.toString()}function wc(c){var a=B.Sj(),b=B(c).Yb();b.left=Math.min(b.left,a.x+a.width-c.offsetWidth);b.top=Math.min(b.top,a.y+a.height-c.offsetHeight);B(c).Rk(b)}
function xc(c){var a=c.getContext("2d");if(null===a)return"error";var b=a.getImageData(0,0,c.width,c.height);c=b.width;var d=b.height;a=c*d*3;var e=a+54,f=[66,77,e&255,e>>8&255,e>>16&255,e>>24&255,0,0,0,0,54,0,0,0],h=[40,0,0,0,c&255,c>>8&255,c>>16&255,c>>24&255,d&255,d>>8&255,d>>16&255,d>>24&255,1,0,24,0,0,0,0,0,a&255,a>>8&255,a>>16&255,a>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];a=(4-3*c%4)%4;b=b.data;e=c<<2;for(var k=Sa.bf("Base64Encoder"),l=0;l<f.length;l++)k.jb(f[l]);for(l=0;l<h.length;l++)k.jb(h[l]);
do{f=e*(d-1);for(h=0;h<c;h++)l=h<<2,k.jb(b[f+l+2]),k.jb(b[f+l+1]),k.jb(b[f+l]);for(f=0;f<a;f++)k.jb(0)}while(--d);k.flush();return"data:image/bmp;base64,"+k.sg().toString()}
function yc(c,a){"erase"===a?c.ed?(c.strokeStyle="#000000",c.globalCompositeOperation="destination-out",--c.lineWidth,c.stroke(),c.globalCompositeOperation="source-over",c.strokeStyle=c.ed,c.lineWidth+=2,c.stroke(),--c.lineWidth):(c.strokeStyle="#000000",c.globalCompositeOperation="destination-out",c.stroke(),c.globalCompositeOperation="source-over"):(c.strokeStyle=a,c.stroke())}
function zc(){for(var c=0;c<arguments.length;c++);c=arguments[0];for(var a=1;a<arguments.length;a++){var b=arguments[a],d;for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d])}return c}function Ac(c){return c instanceof HTMLElement?"INPUT"===c.tagName||"TEXTAREA"===c.tagName||c.isContentEditable?!0:!1:!1};var Bc=x.create("Graphics",!0),G=function(){function c(a,b){this.x=a;this.y=b}c.prototype.Lb=function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))};c.prototype.toString=function(){return"("+this.x+", "+this.y+")"};c.prototype.Lc=function(a){return this.x===a.x&&this.y===a.y};c.prototype.clone=function(){return new c(this.x,this.y)};c.prototype.ty=function(a){return new c(this.x-a.x,this.y-a.y)};c.prototype.Jp=function(a,b){var d=a.x,e=a.y,c=this.x,h=this.y,k=b.x-d,l=b.y-
e,n=k*k+l*l;if(0===n)return this.Lb(a);n=((c-d)*k+(h-e)*l)/n;1<n?n=1:0>n&&(n=0);d=d+n*k-c;e=e+n*l-h;return Math.sqrt(d*d+e*e)};return c}(),Cc=function(){function c(a,b){this.width=a;this.height=b}c.prototype.bs=function(){return new H(0,0,this.width,this.height)};return c}();function Dc(c,a,b,d){return Math.sqrt((c-b)*(c-b)+(a-d)*(a-d))}function I(c,a,b,d){var e=Dc(c,a,b,d);return 0===e?{x:1,y:0}:{x:(b-c)/e,y:(d-a)/e}}function Ec(c){c.x*=-1;c.y*=-1;return c}
var H=function(){function c(a,b,d,e){this.x=a;this.y=b;this.width=d;this.height=e;this.xr()}c.load=function(a){return new c(a.x,a.y,a.width,a.height)};c.dh=function(a){if(0===a.length)return new c(0,0,0,0);for(var b=a[0].x,d=a[0].x,e=a[0].y,f=a[0].y,h=1;h<a.length;h++)a[h].x<b&&(b=a[h].x),a[h].x>d&&(d=a[h].x),a[h].y<e&&(e=a[h].y),a[h].y>f&&(f=a[h].y);return new c(b,e,d-b,f-e)};c.prototype.save=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}};c.prototype.clone=function(){return new c(this.x,
this.y,this.width,this.height)};c.prototype.Lc=function(a){return this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height};c.prototype.zi=function(a){a.x<this.x&&(this.width+=this.x-a.x,this.x=a.x);a.y<this.y&&(this.height+=this.y-a.y,this.y=a.y);a.x+a.width>this.x+this.width&&(this.width+=a.x+a.width-this.x-this.width);a.y+a.height>this.y+this.height&&(this.height+=a.y+a.height-this.y-this.height)};c.prototype.no=function(a,b){a<this.x?(this.width+=this.x-a,this.x=a):a>this.x+this.width&&
(this.width=a-this.x);b<this.y?(this.height+=this.y-b,this.y=b):b>this.y+this.height&&(this.height=b-this.y)};c.prototype.contains=function(a){return this.x<=a.x&&this.x+this.width>a.x+a.width&&this.y<=a.y&&this.y+this.height>a.y+a.height};c.prototype.Nw=function(a){return this.x>a.x+a.width||a.x>this.x+this.width||this.y>a.y+a.height||a.y>this.y+this.height?!1:!0};c.prototype.lh=function(){return this.width*this.height};c.prototype.hr=function(a){return this.Nw(a)?(Math.min(this.right(),a.right())-
Math.max(this.x,a.x))*(Math.min(this.bottom(),a.bottom())-Math.max(this.y,a.y)):0};c.prototype.gd=function(a,b,d){void 0===d&&(d=0);return this.x-d<=a&&this.x+this.width+d>a&&this.y-d<=b&&this.y+this.height+d>b};c.prototype.xr=function(){0>this.width&&(this.x+=this.width,this.width=-this.width);0>this.height&&(this.y+=this.height,this.height=-this.height)};c.prototype.Dd=function(a,b){void 0===b&&(b=a);this.x-=a/2;this.y-=b/2;this.width+=a;this.height+=b};c.prototype.transform=function(a){var b=a.apply(this.x,
this.y);var d=a.apply(this.x+this.width,this.y);var e=a.apply(this.x+this.width,this.y+this.height);a=a.apply(this.x,this.y+this.height);this.x=Math.min(b.x,d.x,e.x,a.x);this.y=Math.min(b.y,d.y,e.y,a.y);this.width=Math.max(b.x,d.x,e.x,a.x)-this.x;this.height=Math.max(b.y,d.y,e.y,a.y)-this.y};c.prototype.right=function(){return this.x+this.width};c.prototype.bottom=function(){return this.y+this.height};c.prototype.vd=function(){return new G(this.x+this.width/2,this.y+this.height/2)};c.prototype.toString=
function(){return"Rectangle("+this.x+", "+this.y+", "+this.width+", "+this.height+")"};return c}(),J=function(){function c(){this.log=x.create("MATRIX");if(0===arguments.length)this.m11=1,this.m21=this.m12=0,this.m22=1,this.Ca=this.Ba=0;else if(1===arguments.length)if("string"===typeof arguments[0]){var a=arguments[0].match(/-?\d+\.?[\de\-]*/g);if(!a||6!=a.length)throw Error("Bad initializer for matrix: "+arguments[0]);this.m11=parseFloat(a[0]);this.m21=parseFloat(a[1]);this.m12=parseFloat(a[2]);
this.m22=parseFloat(a[3]);this.Ba=parseFloat(a[4]);this.Ca=parseFloat(a[5])}else{if(6!==arguments[0].length)throw"Bad array initializer for Matrix.";this.m11=arguments[0][0];this.m12=arguments[0][1];this.m21=arguments[0][2];this.m22=arguments[0][3];this.Ba=arguments[0][4];this.Ca=arguments[0][5]}else this.m11=arguments[0],this.m12=arguments[1],this.m21=arguments[2],this.m22=arguments[3],this.Ba=arguments[4],this.Ca=arguments[5]}c.prototype.toString=function(){return"[ "+this.m11+" "+this.m12+" "+
this.Ba+"    "+this.m21+" "+this.m22+" "+this.Ca+"    0 0 1 ]"};c.prototype.Jb=function(){return[this.m11,this.m12,this.m21,this.m22,this.Ba,this.Ca]};c.prototype.Fq=function(){return 1===this.m11&&0===this.m12&&0===this.m21&&1===this.m22&&0===this.Ba&&0===this.Ca};c.prototype.Lc=function(a){return this.m11===a.m11&&this.m12===a.m12&&this.m21===a.m21&&this.m22===a.m22&&this.Ba===a.Ba&&this.Ca===a.Ca};c.prototype.multiply=function(a){var b=new c;b.m11=this.m11*a.m11+this.m12*a.m21;b.m21=this.m21*a.m11+
this.m22*a.m21;b.m12=this.m11*a.m12+this.m12*a.m22;b.m22=this.m21*a.m12+this.m22*a.m22;b.Ba=this.m11*a.Ba+this.m12*a.Ca+this.Ba;b.Ca=this.m21*a.Ba+this.m22*a.Ca+this.Ca;return b};c.prototype.apply=function(a,b){return new G(this.m11*a+this.m12*b+this.Ba,this.m21*a+this.m22*b+this.Ca)};c.prototype.ag=function(a){var b;void 0===b&&(b=!1);b?a.setTransform(this.m11,this.m21,this.m12,this.m22,this.Ba,this.Ca):a.transform(this.m11,this.m21,this.m12,this.m22,this.Ba,this.Ca)};c.prototype.clone=function(){return new c(this.m11,
this.m12,this.m21,this.m22,this.Ba,this.Ca)};c.prototype.inverse=function(){var a=this.m11*this.m22-this.m12*this.m21;return new c(this.m22/a,-this.m12/a,-this.m21/a,this.m11/a,(this.m12*this.Ca-this.Ba*this.m22)/a,(this.Ba*this.m21-this.m11*this.Ca)/a)};c.prototype.fs=function(){var a=this.m11,b=this.m21,d=this.m12,e=this.m22,f=Math.sqrt(a*a+b*b),h=Math.sqrt(d*d+e*e);return new c(a/f,d/h,b/f,e/h,this.Ba,this.Ca)};c.prototype.$b=function(){return new G(Math.sqrt(this.m11*this.m11+this.m21*this.m21),
Math.sqrt(this.m12*this.m12+this.m22*this.m22))};c.prototype.Wv=function(){return 1===this.m11&&1===this.m22&&0===this.m12&&0===this.m21};c.prototype.translate=function(a,b){return this.multiply(new Fc(a,b))};c.prototype.rotate=function(a,b,d){return this.multiply(new Gc(a,b,d))};c.prototype.Wg=function(){return"matrix("+this.m11+", "+this.m21+", "+this.m12+", "+this.m22+", "+this.Ba+", "+this.Ca+")"};c.prototype.toJSON=function(){return this.Wg()};return c}(),Gc=function(c){function a(a,d,e){var b=
Math.cos(a);a=Math.sin(a);return c.call(this,b,a,-a,b,-d*b-e*a+d,d*a-e*b+e)||this}__extends(a,c);return a}(J),Fc=function(c){function a(a,d){return c.call(this,1,0,0,1,a,d)||this}__extends(a,c);return a}(J),Hc=function(c){function a(a,d,e,f){return void 0===e||void 0===f?c.call(this,a,0,0,d,0,0)||this:c.call(this,a,0,0,d,e-a*e,f-d*f)||this}__extends(a,c);return a}(J),Ic=function(c){function a(a,d,e){var b=Math.cos(2*a);a=Math.sin(2*a);return c.call(this,b,a,a,-b,-d*b-e*a+d,-d*a+e*b+e)||this}__extends(a,
c);return a}(J);function Jc(c,a,b,d,e,f,h,k,l,n){if(!(8<++Jc.depth)){var q=(a+d)/2,u=(b+e)/2,v=(d+f)/2,w=(e+h)/2,y=(f+k)/2,z=(h+l)/2,L=(q+v)/2,S=(u+w)/2;v=(v+y)/2;w=(w+z)/2;var E=(L+v)/2,D=(S+w)/2,C=k-a,X=l-b;d=Math.abs((d-k)*X-(e-l)*C);f=Math.abs((f-k)*X-(h-l)*C);(d+f)*(d+f)<n*(C*C+X*X)?c.push(new G(E,D)):(Jc(c,a,b,q,u,L,S,E,D,n),Jc(c,E,D,v,w,y,z,k,l,n))}--Jc.depth}(Jc||(Jc={})).depth=0;
function Kc(c,a,b,d,e,f,h,k){if(!(8<++Jc.depth)){var l=(a+d)/2,n=(b+e)/2,q=(d+f)/2,u=(e+h)/2,v=(l+q)/2,w=(n+u)/2,y=f-a,z=h-b;d=Math.abs((d-f)*z-(e-h)*y);d*d<=k*(y*y+z*z)?c.push(new G(v,w)):(Kc(c,a,b,l,n,v,w,k),Kc(c,v,w,q,u,f,h,k))}--Jc.depth}
function Lc(c,a,b){var d,e=!1,f=c.length;1<f&&c[f-1].x===c[0].x&&c[f-1].y===c[0].y&&--f;if(3>f)return!1;var h=c[f-1].x;var k=c[f-1].y;for(d=0;d<f;d++){var l=c[d].x;var n=c[d].y;if(l>h){var q=h;var u=l;var v=k;k=n}else q=l,u=h,v=n;l<a===a<=h&&(b-v)*(u-q)<(k-v)*(a-q)&&(e=!e);h=l;k=n}return e}function Mc(c,a,b,d){d*=d;for(var e=1;e<c.length;e++){var f=c[e-1].x,h=c[e-1].y,k=c[e].x-f,l=c[e].y-h,n=((a-f)*k+(b-h)*l)/(k*k+l*l);1<n?n=1:0>n&&(n=0);f=f+n*k-a;h=h+n*l-b;if(f*f+h*h<=d)return!0}return!1}
(function(){function c(a){this.ac=a}c.prototype.clear=function(){for(var a=0;a<this.ac.width*this.ac.height*4;a++)this.ac.data[a]=0};c.prototype.getImageData=function(){return this.ac};c.prototype.width=function(){return this.ac.width};c.prototype.height=function(){return this.ac.height};c.prototype.get=function(a,b){var d=this.ac.width*b*4+4*a;return this.ac.data[d]|this.ac.data[d+1]<<8|this.ac.data[d+2]<<16|this.ac.data[d+3]<<24};c.prototype.set=function(a,b,d){a=this.ac.width*b*4+4*a;this.ac.data[a]=
d&255;this.ac.data[a+1]=d>>8&255;this.ac.data[a+2]=d>>16&255;this.ac.data[a+3]=d>>24&255};return c})();
(function(){function c(a,b){this.data=[];this.ig=a;this.Gi=b;this.data=[]}c.prototype.width=function(){return this.ig};c.prototype.height=function(){return this.Gi};c.prototype.getImageData=function(){var a=document.createElement("canvas");a.width=this.ig;a.height=this.Gi;a=a.getContext("2d").getImageData(0,0,this.ig,this.Gi);for(var b=this.ig*this.Gi,d=0;d<b;d++){var e=!0===this.data[d]?255:0;a.data[4*d]=e;a.data[4*d+1]=e;a.data[4*d+2]=e;a.data[4*d+3]=255}return a};c.prototype.get=function(a,b){return!0===
this.data[this.ig*b+a]};c.prototype.set=function(a,b,d){this.data[this.ig*b+a]=d};return c})();
var K=function(){function c(a){this.closed=!1;this.da=[];a instanceof H&&(this.moveTo(a.x,a.y),this.lineTo(a.x+a.width,a.y),this.lineTo(a.x+a.width,a.y+a.height),this.lineTo(a.x,a.y+a.height),this.lineTo(a.x,a.y),this.closePath())}c.prototype.clear=function(){this.closed=!1;this.da=[]};c.prototype.beginPath=function(){};c.prototype.rect=function(){};c.prototype.moveTo=function(a,b){this.da.push(c.Ec,a,b)};c.prototype.lineTo=function(a,b){this.da.push(c.Dc,a,b)};c.prototype.bezierCurveTo=function(a,
b,d,e,f,h){this.da.push(c.we,a,b,d,e,f,h)};c.prototype.quadraticCurveTo=function(a,b,d,e){this.da.push(c.ye,a,b,d,e)};c.prototype.arc=function(){};c.prototype.arcTo=function(){};c.prototype.closePath=function(){this.da.push(c.Cc)};c.prototype.ia=function(a){for(var b=0;b<this.da.length;){switch(this.da[b]){case c.Ec:a.moveTo&&a.moveTo(this.da[b+1],this.da[b+2]);break;case c.Dc:a.lineTo&&a.lineTo(this.da[b+1],this.da[b+2]);break;case c.we:a.bezierCurveTo&&a.bezierCurveTo(this.da[b+1],this.da[b+2],
this.da[b+3],this.da[b+4],this.da[b+5],this.da[b+6]);break;case c.ye:a.quadraticCurveTo&&a.quadraticCurveTo(this.da[b+1],this.da[b+2],this.da[b+3],this.da[b+4]);break;case c.Cc:a.closePath&&a.closePath();break;default:alert("Error!")}b+=c.Fc[this.da[b]]}};c.prototype.wx=function(){for(var a=0,b=0,d=0,e=[];a<this.da.length;){switch(this.da[a]){case c.Cc:e.push([c.Cc]);break;case c.Ec:b=this.da[a+1];d=this.da[a+2];break;case c.Dc:e.push([c.Dc,b,d]);b=this.da[a+1];d=this.da[a+2];break;case c.we:e.push([c.we,
this.da[a+3],this.da[a+4],this.da[a+1],this.da[a+2],b,d]);b=this.da[a+5];d=this.da[a+6];break;case c.ye:e.push([c.ye,this.da[a+1],this.da[a+2],b,d]),b=this.da[a+3],d=this.da[a+4]}a+=c.Fc[this.da[a]]}this.da.length&&e.push([c.Ec,b,d]);a=new c;for(b=e.length-1;0<=b;b--)Array.prototype.push.apply(a.da,e[b]);a.closed=this.closed;return a};c.prototype.$e=function(){for(var a=0,b,d=[];a<this.da.length;){var e=c.Ko[this.da[a]];for(b=0;b<e;b++)d.push(new G(this.da[a+1+2*b],this.da[a+1+2*b+1]));a+=c.Fc[this.da[a]]}return d};
c.prototype.transform=function(a){for(var b=0,d,e;b<this.da.length;){e=c.Ko[this.da[b]];for(d=0;d<e;d++){var f=a.apply(this.da[b+1+2*d],this.da[b+1+2*d+1]);this.da[b+1+2*d]=f.x;this.da[b+1+2*d+1]=f.y}b+=c.Fc[this.da[b]]}};c.prototype.clone=function(){var a=new c;a.da=this.da.concat();return a};c.prototype.vp=function(a){for(var b=0,d,e=d=0,f=new H(this.da[1],this.da[2],0,0),h;b<this.da.length;){switch(this.da[b]){case c.Ec:case c.Dc:d=this.da[b+1];e=this.da[b+2];f.no(d,e);break;case c.we:var k=h=
[],l=this.da[b+5],n=this.da[b+6];Jc(k,d,e,this.da[b+1],this.da[b+2],this.da[b+3],this.da[b+4],l,n,a*a);k.push(new G(l,n));for(d=0;d<h.length;d++)f.no(h[d].x,h[d].y);d=this.da[b+5];e=this.da[b+6];break;case c.ye:k=h=[];l=this.da[b+3];n=this.da[b+4];Kc(k,d,e,this.da[b+1],this.da[b+2],l,n,a*a);k.push(new G(l,n));for(d=0;d<h.length;d++)f.no(h[d].x,h[d].y);d=this.da[b+3];e=this.da[b+4]}b+=c.Fc[this.da[b]]}return f};c.prototype.append=function(a){this.da=this.da.concat(a.da)};c.prototype.fo=function(a){for(var b=
0,d=0,e=0,f=new c,h;b<this.da.length;){switch(this.da[b]){case c.Ec:d=this.da[b+1];e=this.da[b+2];f.moveTo(d,e);break;case c.Dc:d=this.da[b+1];e=this.da[b+2];f.lineTo(d,e);break;case c.we:var k=h=[],l=this.da[b+5],n=this.da[b+6];Jc(k,d,e,this.da[b+1],this.da[b+2],this.da[b+3],this.da[b+4],l,n,a*a);k.push(new G(l,n));2===h.length&&1E-4>d*(h[0].y-h[1].y)+h[0].x*(h[1].y-e)+h[1].x*(e-h[0].y)&&(h[0]=h[1],h.length=1);for(d=0;d<h.length;d++)f.lineTo(h[d].x,h[d].y);d=this.da[b+5];e=this.da[b+6];break;case c.ye:k=
h=[];l=this.da[b+3];n=this.da[b+4];Kc(k,d,e,this.da[b+1],this.da[b+2],l,n,a*a);k.push(new G(l,n));for(d=0;d<h.length;d++)f.lineTo(h[d].x,h[d].y);d=this.da[b+3];e=this.da[b+4];break;case c.Cc:f.closePath()}b+=c.Fc[this.da[b]]}return f};c.prototype.Uw=function(a,b){var d;void 0===d&&(d=0);return Lc(this.$e(),a,b)||0<d&&this.nr(a,b,d)};c.prototype.nr=function(a,b,d){var e=0,f=0,h=0;for(d*=d;h<this.da.length;){switch(this.da[h]){case c.Ec:e=this.da[h+1];f=this.da[h+2];break;case c.Dc:var k=this.da[h+
1];var l=this.da[h+2];var n=k-e;var q=l-f;var u=n*n+q*q;u=((a-e)*n+(b-f)*q)/u;1<u?u=1:0>u&&(u=0);e+=u*n;q=f+u*q;f=e-a;q-=b;f=f*f+q*q;if(f<=d)return!0;e=k;f=l}h+=c.Fc[this.da[h]]}return!1};c.prototype.pj=function(a,b){for(var d=0,e=0,f=b[0],h,k=new G(0,0),l;d<this.da.length;){switch(this.da[d]){case c.Ec:l=this.da[d+1];h=this.da[d+2];a.moveTo(l,h);k=new G(l,h);break;case c.Dc:l=this.da[d+1];var n=h=this.da[d+2],q=new G(l,n);h=k.Lb(q);if(!(0>=h)){for(;h>f;)k.x+=(q.x-k.x)*f/h,k.y+=(q.y-k.y)*f/h,e&1?
a.moveTo(k.x,k.y):a.lineTo(k.x,k.y),h-=f,e=(e+1)%b.length,f=b[e];h<=f&&(k=new G(l,n),e&1?a.moveTo(k.x,k.y):a.lineTo(k.x,k.y),f-=h)}}d+=c.Fc[this.da[d]]}};c.prototype.lh=function(){function a(a,b){f-=(a-d)*(b+e);d=a;e=b}for(var b=0,d,e,f=0;b<this.da.length;){switch(this.da[b]){case c.Ec:d=this.da[b+1];e=this.da[b+2];break;case c.Dc:a(this.da[b+1],this.da[b+2]);break;case c.we:a(this.da[b+5],this.da[b+6]);break;case c.ye:a(this.da[b+3],this.da[b+4])}b+=c.Fc[this.da[b]]}return f/2};c.prototype.Np=function(a){for(var b=
0,d=0,e=0,f=!1;b<this.da.length;){switch(this.da[b]){case c.Ec:d=this.da[b+1];e=this.da[b+2];f=!0;break;case c.Dc:a(d,e,this.da[b+1],this.da[b+2],f),d=this.da[b+1],e=this.da[b+2],f=!1}b+=c.Fc[this.da[b]]}};c.prototype.ut=function(){var a=0;this.Np(function(b,d,e,c){a+=Dc(b,d,e,c)});return a};c.prototype.wt=function(a){var b=new c,d=0;this.Np(function(e,c,h,k,l){if(d<=a){l&&b.moveTo(e,c);l=Dc(e,c,h,k);if(d+l>=a){var f=a-d;h=e+(h-e)*f/l;k=c+(k-c)*f/l}d+=l;b.lineTo(h,k)}});return b};c.Ec=0;c.Dc=1;c.we=
2;c.ye=3;c.Cc=4;c.Fc=[3,3,7,5,1];c.Ko=[1,1,3,2,0];return c}();function Nc(c,a,b,d,e){var f;if(2>=d-b)e.push(c[b]);else{var h=c[b],k=c[d-1],l=0,n=0;for(f=b+1;f<d;f++){var q=c[f].Jp(h,k);q>l&&(l=q,n=f)}0<n&&l>a?(Nc(c,a,b,n,e),Nc(c,a,n,d,e)):e.push(h)}}function Oc(c,a){var b=[];Nc(c,a,0,c.length,b);0<c.length&&0<b.length&&!c[c.length-1].Lc(b[b.length-1])&&b.push(c[c.length-1]);return b}
var Pc=function(){function c(){this.la=[];if(1===arguments.length){var a=arguments[0];if(a instanceof H)this.la.push(new G(a.x,a.y)),this.la.push(new G(a.right(),a.y)),this.la.push(new G(a.right(),a.bottom())),this.la.push(new G(a.x,a.bottom()));else if(a instanceof Array)this.la=a;else throw alert("Bad parameter passed to Polygon() constructor."),"Error";}}c.prototype.Sv=function(a){var b=this.$e();a=a.$e();for(var d=0;d<b.length;d++){var e=b[d];if(!Lc(a,e.x,e.y))return!1}return!0};c.prototype.transform=
function(a){for(var b=0;b<this.la.length;b++)this.la[b]=a.apply(this.la[b].x,this.la[b].y)};c.prototype.add=function(a,b){this.la.push(new G(a,b))};c.prototype.gd=function(a,b,d){void 0===d&&(d=0);return Lc(this.la,a,b)||d&&Mc(this.la,a,b,d)};c.prototype.rt=function(){return H.dh(this.la)};c.prototype.clone=function(){return new c(this.la.slice(0))};c.prototype.Lc=function(a){if(this.la.length!==a.la.length)return!1;for(var b=0;b<this.la.length;b++){var d=this.la[b],e=a.la[b];if(d.x!==e.x||d.y!==
e.y)return!1}return!0};c.prototype.Dd=function(a){for(var b=[],d=0;d<this.la.length;d++){var e=this.la[0===d?this.la.length-1:d-1],c=this.la[d],h=this.la[d===this.la.length-1?0:d+1],k=Dc(e.x,e.y,c.x,c.y),l=Dc(h.x,h.y,c.x,c.y);b.push({x:c.x+((c.x-e.x)/k+(c.x-h.x)/l)/Math.sqrt(2)*a,y:c.y+((c.y-e.y)/k+(c.y-h.y)/l)/Math.sqrt(2)*a})}this.la=b};c.prototype.ia=function(a){if(!(1>this.la.length)){a.moveTo(this.la[0].x,this.la[0].y);for(var b=1;b<this.la.length;b++)a.lineTo(this.la[b].x,this.la[b].y);a.closePath()}};
c.prototype.$e=function(){return this.la};c.dz=function(a,b){for(var d=0,e=0,c=!1,h=[],k=[],l=0;l<b.length;l++)k.push(0);for(;;){var n=0,q=-1;for(l=0;l<b.length;l++)if(k[l]<b[l].length){var u=b[l][k[l]];if(0===l||u<n){n=u;q=l;var v=1-k[l]%2}}if(-1===q)return h;k[q]+=1;"intersection"===a?v?(e+=1,e===b.length&&(d=n)):(e===b.length&&(h.push(d),h.push(n)),--e):v?(e+=1,0===q?(c=!0,1===e)&&(d=n):c&&2===e&&(h.push(d),h.push(n))):(c&&1===e&&(h.push(d),h.push(n)),--e,0===q&&(c=!1),c&&1===e&&(d=n))}};return c}();
function Qc(c,a,b,d,e,f,h,k){b-=c;d-=a;h-=e;k-=f;var l=-h*d+b*k;if(0===l)return null;e=(h*(a-f)-k*(c-e))/l;return new G(c+e*b,a+e*d)}
function Rc(c,a){function b(a){var b,e;var c=[];var l=b=0;for(e=a.length;l<e;l++){var n=a[l];a[b+1]&&(c[b]=d(n,a[b+1]));b+=1}return c}function d(a,b){return new G(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2)}return a?Rc(b(b(function(a){var b,e;a=[a[0]].concat(a).concat(a[a.length-1]);var c=[];var l=b=0;for(e=a.length;l<e;l++){var n=a[l];c[2*b]=n;a[b+1]&&(c[2*b+1]=d(n,a[b+1]));b+=1}return c}(c))),a-1):c}
(function(){function c(){this.items=[];this.ra=new J}c.prototype.toString=function(){return this.items.join(" ")};c.prototype.arc=function(){throw Error("SvgPathContext.arc is not implemented.");};c.prototype.arcTo=function(){throw Error("SvgPathContext.arcTo is not implemented.");};c.prototype.moveTo=function(a,b){var d=this.ra.apply(a,b);this.items.push("M",d.x,d.y)};c.prototype.lineTo=function(a,b){var d=this.ra.apply(a,b);this.items.push("L",d.x,d.y)};c.prototype.transform=function(a,b,d,e,c,
h){a=new J(a,d,b,e,c,h);this.ra=this.ra.multiply(a)};c.prototype.rect=function(){};c.prototype.bezierCurveTo=function(a,b,d,e,c,h){a=this.ra.apply(a,b);d=this.ra.apply(d,e);c=this.ra.apply(c,h);this.items.push("C",a.x,a.y,d.x,d.y,c.x,c.y)};c.prototype.quadraticCurveTo=function(){throw Error("SvgPathContext.quadraticCurveTo is not implemented.");};c.prototype.beginPath=function(){};c.prototype.closePath=function(){this.items.push("Z")};return c})();
function Sc(c,a,b,d,e){if(!(2>a.length)){void 0===d&&(d=!0);void 0===e&&(e=!0);var f=a[0].x===a[a.length-1].x&&a[0].y===a[a.length-1].y,h=[],k=[],l=new G(0,0),n=l,q=l,u=l,v=l,w=[];b/=2;var y;for(y=1;y<a.length;y++){q=a[y-1];v=a[y];u=I(q.x,q.y,v.x,v.y);l=new G(u.y,-u.x);n=new G(q.x-u.x*b-l.x*b,q.y-u.y*b-l.y*b);q=new G(q.x-u.x*b+l.x*b,q.y-u.y*b+l.y*b);if(k.length){var z=k[k.length-1];var L=w[w.length-1];n=Qc(z.x,z.y,z.x+L.x,z.y+L.y,n.x,n.y,n.x+u.x,n.y+u.y)||n;z=h[h.length-1];q=Qc(z.x,z.y,z.x+L.x,z.y+
L.y,q.x,q.y,q.x+u.x,q.y+u.y)||q}k.push(n);h.push(q);w.push(u)}f?(z=k[0],L=w[0],n=Qc(z.x,z.y,z.x+L.x,z.y+L.y,n.x,n.y,n.x+u.x,n.y+u.y)||n,z=h[0],q=Qc(z.x,z.y,z.x+L.x,z.y+L.y,q.x,q.y,q.x+u.x,q.y+u.y)||q,k[0].x=n.x,k[0].y=n.y,h[0].x=q.x,h[0].y=q.y,k.push(n),h.push(q)):(k.push(new G(v.x+u.x*b-l.x*b,v.y+u.y*b-l.y*b)),h.push(new G(v.x+u.x*b+l.x*b,v.y+u.y*b+l.y*b)));if(e){c.moveTo(k[0].x,k[0].y);for(y=1;y<k.length;y++)c.lineTo(k[y].x,k[y].y);f&&(c.closePath(),c.moveTo(h[h.length-1].x,h[h.length-1].y))}else d&&
c.moveTo(h[h.length-1].x,h[h.length-1].y);if(d){for(y=h.length-1;0<=y;y--)c.lineTo(h[y].x,h[y].y);!f&&e&&c.lineTo(k[0].x,k[0].y)}}}
(function(){function c(a){this.la=a;this.n=0;this.ob=new G(0,0)}c.prototype.next=function(a){if(0===this.la.length)return null;if(0===this.n)return this.ob=this.la[0].clone(),this.n+=1,this.ob.clone();for(;this.n<this.la.length;){var b=this.ob.Lb(this.la[this.n]);if(0===b)this.n+=1;else if(b<=a)a-=b,this.n+=1;else return this.ob.x+=(this.la[this.n].x-this.ob.x)*a/b,this.ob.y+=(this.la[this.n].y-this.ob.y)*a/b,this.ob.clone()}return null};return c})();
var Tc=function(){function c(){this.path=[]}c.prototype.hf=function(a,b){0<this.path.length&&a===this.path[this.path.length-1].x&&b===this.path[this.path.length-1].y||this.path.push(new G(a,b))};c.prototype.Hm=function(){return this.path};return c}();function Uc(c,a){c.length>a&&(c=c.slice(c.length-a));return c}
var Vc=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.ti=[];a.order=3;a.Zn=3;a.Hr=Math.pow(2,a.order);a.sampleSize=a.Zn+1;return a}__extends(a,c);a.prototype.Hm=function(){return this.ti};a.prototype.hf=function(a,d){c.prototype.hf.call(this,a,d);if(this.path.length<this.sampleSize)this.ti=Rc(this.path,this.order);else{var b=Uc(Rc(Uc(this.path,this.sampleSize),this.order),this.Hr*this.Zn);this.ti=this.ti.slice(0,this.ti.length-this.Hr*(this.Zn-1)).concat(b)}};return a}(Tc);var Wc=function(){function c(a){this.Qc=a;this.Zi=[];this.xn=!0;this.log=x.create("cloudAddon");this.ne=a.ka("cloudRadius")}c.prototype.format=function(){var a=this.Qc.qd.$e();this.log("Format cloud; %s points",a.length);this.Zi=this.Et(a,this.ne)};c.prototype.Et=function(a,b){var d=[],e=5/6*b*2,c,h=a[a.length-1];for(c=0;c<a.length;c++){var k=a[c];var l=k.x-h.x,n=k.y-h.y,q=Math.sqrt(l*l+n*n);l/=q;n/=q;var u=q/e+.5|0;1>u&&(u=1);u=q/u;for(var v=0;v+.1*u<q;v+=u)d.push({x:h.x+v*l,y:h.y+v*n,Va:0,end:0});
h=k}k=d[d.length-1];for(c=0;c<d.length;c++)e=d[c],l=e.x-k.x,n=e.y-k.y,h=.5*Math.sqrt(l*l+n*n)/b,-1>h&&(h=-1),1<h&&(h=1),l=Math.atan2(n,l),h=Math.acos(h),h=[l-h,Math.PI+l+h],k.end=h[0],e.Va=h[1],k=e;return d};c.prototype.ia=function(a){this.log("Drawing cloud with %s circles",this.Zi.length);var b=15*Math.PI/180,d=this.ne;a.beginPath();for(var e=0;e<this.Zi.length;e++){var c=this.Zi[e];a.arc(c.x,c.y,d,c.Va,c.end+b)}a.stroke()};return c}();function Xc(c){return 0!=(c.Rb&1)}function Yc(c){return 0!=(c.Rb&4)}function Zc(c){return 5===(c.Rb&5)&&c.fa};var $c=x.create("WrappedNode");
function ad(c,a){var b={};b.ctx=c.ctx;b.id=a.id;b.type=a.type();b.children=new Proxy({},{get:function(b,e){var d=a.sb(e);return d instanceof bd?d.Lj(c):d}});b.props=cd(a.ba,"",function(b,e){a.Gw(b,e)});Object.defineProperty(b,"parent",{configurable:!0,get:function(){return a.parent?a.parent.Lj(c):null},set:function(b){$c("Warning; replacing parent property");a.parent=b}});Yc(a)&&Object.defineProperty(b,"element",{configurable:!0,get:function(){return a.fa}});return b}
function cd(c,a,b){function d(d){if("string"===typeof d)for(var e in c)if(e.startsWith(""+a+d+"."))return cd(c,""+a+d+".",b);return null}void 0===a&&(a="");return new Proxy(c,{get:function(b,f){if("hasOwnProperty"===f)return function(b){return a+b in c};if("string"===typeof f){var e=d(f);return e?e:c[a+f]}return c[f]},has:function(b,f){if("string"===typeof f){var e=d(f);return e?e:a+f in c}return b.hasOwnProperty(f)},set:function(d,f,h){"string"===typeof f?(c[a+f]=h,b(a+f,h)):c[f]=h;return!0}})};var dd=x.create("BaseNode"),bd=function(){function c(a,b){this.id=a;this.aa=b;this.Rb=0;this.parent=null;this.ba={};this.scope=null}c.prototype.type=function(){return"BaseNode"};c.prototype.toString=function(){return this.type()+":"+this.id};c.prototype.Gw=function(a,b){this.aa.Qb([this.id],a,b)};c.prototype.Lj=function(a){this.scope||(this.scope=ad(a,this));return this.scope};c.fd=function(a,b){c.types[a]=b};c.create=function(a,b,d){return a in c.types?new c.types[a](b,d):null};c.prototype.Xa=function(){};
c.prototype.wj=function(a,b){var d=typeof this.ba[a],e=typeof b;d!==e&&"string"===e&&"number"===d&&(dd("Convert property %s to a number.",a),b=parseFloat(b));b instanceof Array&&(b=b.slice(0));return b};c.prototype.Mc=function(){var a={},b;for(b in this.ba)this.ba.hasOwnProperty(b)&&(a[b]=this.ka(b));return a};c.prototype.We=function(a){for(var b in a)a.hasOwnProperty(b)&&this.setProperty(b,a[b])};c.prototype.Nh=function(a){return a in this.ba};c.prototype.Qi=function(a){return this.Nh(a)};c.prototype.setProperty=
function(a,b){b=this.wj(a,b);this.Qi(a)&&(dd("%s:%s set %s=%s",this.id,this.type(),a,b),this.ba[a]=b);return b};c.prototype.ka=function(a){a=this.ba[a];a instanceof Array&&(a=a.slice(0));return a};c.prototype.Ma=function(){return 0};c.prototype.removeChild=function(){throw Error("BaseNode removechild called.");};c.prototype.ek=function(){throw Error("BaseNode insertChild called.");};c.prototype.sb=function(){throw Error("BaseNode getChild called.");};c.prototype.Yn=function(){throw Error("BaseNode swapChildren called.");
};c.prototype.Le=function(a){for(var b=0;b<this.Ma();b++)if(a===this.sb(b))return b;return-1};c.types={};return c}();var ed=function(c){function a(b,d){var e=c.call(this,b,d)||this;e.rect=new H(0,0,1,1);e.Hi=!1;e.Ga=new H(0,0,1,1);e.ec=0;e.log=x.create("GraphicsNode");e.Rb|=1;e.ba.matrix=new J;e.ba.layer="default";e.Kl(a.ta);return e}__extends(a,c);a.prototype.Kl=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.ba[b]=a[b])};a.prototype.clip=function(){};a.prototype.Xa=function(){};a.prototype.Ne=function(){return!1};a.prototype.Yj=function(){return null};a.prototype.qj=function(){};a.prototype.Dq=function(){return!1};
a.prototype.Oh=function(){return"text"in this.ba};a.prototype.Xb=function(){var a=this.ka("layer");return a?""+a:"default"};a.prototype.Rm=function(){return null!==this.parent&&null!==this.parent.parent&&"PageNode"!==this.parent.type()};a.prototype.type=function(){return"BaseNode"};a.prototype.Ja=function(){return this.ka("matrix")};a.prototype.ae=function(){return this.Ja().inverse()};a.prototype.Qg=function(a){this.setProperty("matrix",a)};a.prototype.wj=function(a,d){d=c.prototype.wj.call(this,
a,d);"matrix"===a&&"string"===typeof d?d=new J(d):"opacity"===a&&(d=parseFloat(d));return d};a.prototype.Qi=function(a){switch(a){case "customData":case "tag":case "locked":case "lockSize":case "lockRotation":case "lockPosition":case "lockEditMode":case "rotationHandles":case "lockAspectRatio":case "zIndex":case "snap":case "opacity":case "type":return!0}return"_"===a[0]||this.Nh(a)};a.prototype.zj=function(){var a=new Pc(this.Ga);a.transform(this.Ja());return a};a.prototype.Cd=function(){return this.ka("zIndex")||
0};a.prototype.transform=function(a){this.Qg(a.multiply(this.Ja()))};a.prototype.format=function(){};a.prototype.xb=function(a,d){var b=this.ae().apply(a,d);return this.hidden()||this.ka("locked")||!this.Ga.gd(b.x,b.y)?null:this};a.prototype.Zf=function(a){this.Hi=a};a.prototype.hidden=function(){return this.Hi};a.prototype.Rg=function(){};a.prototype.vk=function(){};a.prototype.yk=function(){};a.prototype.ii=function(a){if(a.ii){var b={"zwibbler:id":""+this.id};if("tag"in this.ba){var e=this.ba.tag;
"string"!==typeof e&&(e=JSON.stringify(e));b["zwibbler:tag"]=e}a.ii(b)}};a.prototype.hi=function(a){a.hi&&a.hi()};a.prototype.ia=function(b){b.save();this.ii(b);var d=this.ba.matrix;b.transform(d.m11,d.m21,d.m12,d.m22,d.Ba,d.Ca);"erase"===this.ba.strokeStyle?b.ed?b.strokeStyle=b.ed:(b.strokeStyle="#000000",b.globalCompositeOperation="destination-out"):b.strokeStyle=this.ba.strokeStyle;b.fillStyle=this.ba.fillStyle;b.lineWidth=this.ba.lineWidth;this.ba.shadow&&(b.shadowOffsetX=3,b.shadowOffsetY=3,
b.shadowBlur=5,b.shadowColor="rgba(0,0,0,0.5)");"opacity"in this.ba&&(b.globalAlpha=this.ba.opacity);this.ef(b);this.hi(b);b.restore();a.Go&&(b.save(),b.beginPath(),b.lineWidth=1,b.strokeStyle="#ff8000",b.rect(this.rect.x,this.rect.y,this.rect.width,this.rect.height),b.stroke(),b.restore())};a.prototype.Qp=function(a,d){var b=d?function(b){a.fillStyle=b;a.fill()}:function(b){a.strokeStyle=b;a.stroke()};a.ed?(a.globalCompositeOperation="destination-out",--a.lineWidth,b("#000000"),a.globalCompositeOperation=
"source-over",a.fillStyle=a.ed,a.lineWidth+=2,b(a.ed),--a.lineWidth):(a.globalCompositeOperation="destination-out",b("#000000"),a.globalCompositeOperation="source-over")};a.prototype.ef=function(){};a.prototype.resolve=function(){return!1};a.prototype.Du=function(a,d,e,c){this.Bh||(this.Bh={});var b=this.Bh[a];if(!b||b.js!==c){b&&c===b.js||(b={js:c,value:c},this.Bh[a]=b);a=/url\(([^\)]+)\)/.exec(c);var f;a&&(f=a[1]);var l=this;f&&(b.value="rgba(0, 0, 0, 0.2)",e.add(this.id,"image",f,null,function(a){l.log("Got image response.");
b.value=d.createPattern(a,"repeat")||"magenta";e.Lg(l.id)}))}};a.prototype.Zu=function(a){return this.Bh&&(a=this.Bh[a])?a.value:"magenta"};a.prototype.jq=function(){return""};a.prototype.ge=function(){};a.prototype.Bj=function(){};a.prototype.Cj=function(){return null};a.prototype.Mr=function(){};a.ta={fillStyle:"#cccccc",strokeStyle:"#000000",lineWidth:2,shadow:!1};a.Go=!1;return a}(bd);var fd=function(){function c(){this.text="";this.font="10px Arial";this.Yp="Arial";this.fontSize=10;this.lines=[];this.to="top";this.Mh="left";this.Gq=this.bold=!1;this.textDecoration="";this.log=x.create("TextBox");this.rect=new H(0,0,0,this.fontSize)}c.prototype.Nr=function(a,b,d,e,c){this.Yp=a;this.fontSize=b;this.bold=d;this.Gq=e;this.textDecoration=c};c.prototype.Sg=function(a){this.text=a};c.prototype.En=function(a,b){switch(a){case "left":case "center":case "right":this.Mh=a;break;case null:break;
default:this.log("Unknown alignment: %s",a)}switch(b){case "top":case "middle":case "bottom":this.to=b;break;case null:break;default:this.log("Unknnown alignment: %s",b)}};c.prototype.format=function(a,b,d){this.font=""+this.fontSize+'px "'+this.Yp+'"';this.bold&&(this.font="bold "+this.font);this.Gq&&(this.font="italic "+this.font);this.lines.length=0;var e;a.font=this.font;var c=0;this.rect.width=0;if(0===b){var h=this.text.split("\n");for(e=0;e<h.length;e++){var k=h[e];var l=a.measureText(k).width;
c+=this.fontSize;this.lines.push({x:0,y:c,width:l,text:k});this.rect.width=Math.max(this.rect.width,l)}}else{k=h=0;var n=!1;for(e=0;e<this.text.length;e++){var q=this.text.charAt(e);l=a.measureText(this.text.substr(h,e-h+1)).width;"\n"===q?n=!0:l>b?k?(e=k,n=!0):e>h&&(--e,n=!0):" "===q&&(k=e);n&&(l=" "===this.text.charAt(e)?a.measureText(this.text.substr(h,e-h)).width:a.measureText(this.text.substr(h,e-h+1)).width,c+=this.fontSize,this.lines.push({x:0,y:c,width:l,text:this.text.substr(h,e-h+1)}),h=
e+1,k=0,n=!1,this.rect.width=Math.max(this.rect.width,l))}l&&(c+=this.fontSize,this.lines.push({x:0,y:c,width:l,text:this.text.substr(h,e-h)}),this.rect.width=Math.max(this.rect.width,l))}this.rect.x=0;this.rect.y=0;this.rect.height=c;if("center"===this.Mh)for(e=0;e<this.lines.length;e++)a=this.lines[e],a.x=this.rect.width/2-a.width/2;else if("right"===this.Mh)for(e=0;e<this.lines.length;e++)a=this.lines[e],a.x=this.rect.width-a.width;b&&"center"===this.Mh?this.rect.x=b/2-this.rect.width/2:b&&"right"===
this.Mh&&(this.rect.x=b-this.rect.width);d&&"middle"===this.to?this.rect.y=d/2-this.rect.height/2:d&&"bottom"===this.to&&(this.rect.y=d-this.rect.height)};c.prototype.ia=function(a,b,d){this.fillText(a,b,d);this.Mp(a,b,d)};c.prototype.Mp=function(a,b,d){var e;if(0<=this.textDecoration.indexOf("underline")){a.save();a.beginPath();var c=1;for(e=0;e<this.lines.length;e++){var h=this.lines[e];a.moveTo(h.x+b,h.y+d+c);a.lineTo(h.x+b+h.width,h.y+d+c)}a.strokeStyle=a.fillStyle;a.lineWidth=1;a.stroke();a.beginPath();
a.restore()}if(0<=this.textDecoration.indexOf("line-through")){a.save();a.beginPath();c=.25*-this.fontSize;for(e=0;e<this.lines.length;e++)h=this.lines[e],a.moveTo(h.x+b,h.y+d+c),a.lineTo(h.x+b+h.width,h.y+d+c);a.strokeStyle=a.fillStyle;a.lineWidth=1;a.stroke();a.restore()}};c.prototype.fillText=function(a,b,d){a.textBaseline="alphabetic";a.font=this.font;for(var e=0;e<this.lines.length;e++){var c=this.lines[e];a.fillText(c.text,this.rect.x+c.x+b,this.rect.y+c.y+d)}};c.prototype.strokeText=function(a,
b,d){a.textBaseline="alphabetic";a.font=this.font;for(var e=0;e<this.lines.length;e++){var c=this.lines[e];a.strokeText(c.text,this.rect.x+c.x+b,this.rect.y+c.y+d)}};return c}();var gd=function(c){function a(b,d){var e=c.call(this,b,d)||this;e.gb=new fd;e.Lm=0;e.border={lineWidth:0,mf:"#000000"};e.log=x.create("TEXT",!0);e.Kl(a.Ds);e.ba.text="lorum ipsum dolor";return e}__extends(a,c);a.prototype.type=function(){return"TextNode"};a.prototype.setProperty=function(a,d){this.ba[a]=this.wj(a,d);"textFillStyle"===a?this.ba.fillStyle=d:"fillStyle"===a&&(this.ba.textFillStyle=d)};a.prototype.format=function(a){this.gb.Nr(this.ba.fontName,this.ba.fontSize,this.ba.bold,this.ba.italic,
this.ba.textDecoration);var b=this.ba.text;b.length&&10===b.charCodeAt(b.length-1)&&(b=b.substr(0,b.length-1));this.gb.Sg(b);var e=this.ba.matrix;b=e.apply(0,0);e=e.apply(1,0);b=b.Lb(e);e=this.ka("wrap");var c=!1!==this.ka("scaleFont");this.gb.En(this.ba.textAlign,"top");e?(e=this.ba.baseWidth,void 0===e&&(this.gb.format(a,0,0),e=Math.max(this.gb.rect.width,10),500<e&&(e=500),this.ba.baseWidth=e,this.log("Formatting text for first time; baseWidth=%s",e)),b=Math.ceil(b*e),this.gb.format(a,b,0),a=this.gb.rect.height,
this.Ga=new H(0,0,e,a)):c?(this.gb.format(a,0,0),b=this.gb.rect.width,a=this.gb.rect.height,this.Ga=new H(0,-(0+this.ka("fontSize")),b,a)):(this.gb.format(a,0,0),b=this.gb.rect.width,a=this.gb.rect.height,this.Ga=new H(0,0,b,a));a=new Pc(this.Ga);a.transform(this.Ja());this.rect=a.rt();this.Lm=this.rect.height;this.rect.height+=.3*this.ba.fontSize;a=this.ka("lineWidth")+0;this.rect.Dd(a,a);this.border=this.ba.border?this.Qw(this.ba.border):{lineWidth:0,mf:"#000000"}};a.prototype.Qw=function(a){var b=
{lineWidth:0,mf:"#000000"};a=a.split(" ");for(var e=0;e<a.length;e++){var c=parseFloat(a[e]);if(isNaN(c)){if(c=r.Dh(a[e]))b.mf=c.toString()}else b.lineWidth=c}return b};a.prototype.Ja=function(){return!1===this.ka("scaleFont")?c.prototype.Ja.call(this).fs():c.prototype.Ja.call(this)};a.prototype.ia=function(a){if(0!==this.ba.text.length){var b=.3*this.ba.fontSize;a.save();this.ii(a);"opacity"in this.ba&&(a.globalAlpha=this.ba.opacity);var e=this.ba.background;if(e||this.border.lineWidth)a.save(),
this.Ja().ag(a),e&&(a.fillStyle=e,a.fillRect(this.Ga.x,this.Ga.y,this.Ga.width,this.Ga.height+b)),this.border.lineWidth&&(a.beginPath(),a.strokeStyle=this.border.mf,a.lineWidth=this.border.lineWidth,a.rect(this.Ga.x,this.Ga.y,this.Ga.width,this.Ga.height+b),a.stroke()),a.restore();this.ka("wrap")?this.Ja().fs().ag(a):this.Ja().ag(a);a.strokeStyle=this.ba.strokeStyle;a.fillStyle=this.ba.fillStyle;a.lineWidth=this.ba.lineWidth;b=0;e=this.Ja().$b();e=this.Ga.height*e.y;if(this.ba.wrap||!1===this.ka("scaleFont"))switch(this.log("Available: %s rect: %s",
e,this.gb.rect),this.ba.verticalAlign){case "bottom":b+=e-this.gb.rect.height;break;case "middle":b+=(e-this.gb.rect.height)/2}else b=-(0+this.ka("fontSize"));this.ba.shadow&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,0.5)");0<this.ba.lineWidth&&this.gb.strokeText(a,0,b);this.gb.fillText(a,0,b);this.gb.Mp(a,0,b);this.hi(a);a.restore();ed.Go&&(a.save(),a.beginPath(),a.lineWidth=1,a.strokeStyle="#ff8000",a.rect(this.rect.x,this.rect.y,this.rect.width,this.rect.height),
a.stroke(),a.restore())}};a.Ds={textFillStyle:"#000000",fontName:"Arial",fontSize:20,lineWidth:0,fillStyle:"#000000",wrap:!1,textAlign:"left",bold:!1,italic:!1,background:"rgba(0,0,0,0.0)",textDecoration:""};return a}(ed);ed.fd("TextNode",gd);var hd=function(){function c(a,b){this.oa=a;this.ha=b;this.ny=!0;this.log=x.create("MoveSegment")}c.prototype.ia=function(a){a.moveTo(this.ha.x,this.ha.y)};c.prototype.se=function(){return this.Jc()};c.prototype.Jc=function(){return{x:1,y:0}};return c}(),id=function(){function c(a,b,d,e,c){this.oa=a;this.ha=b;this.On=e;this.oe=c;this.log=x.create("LineSegment");this.Uf=0;this.Da=new G(0,0);this.La=new G(0,0);this.length=0;this.from=new G(0,0);this.ha=b;this.oa=a;this.oe=c;this.On=e;d.next();this.Fk=
d.next();this.Gk=d.next();this.moveTo=this.Vf=null;this.format()}c.prototype.format=function(){var a=Dc(this.oa.ha.x,this.oa.ha.y,this.ha.x,this.ha.y);this.Uf=this.length=a;var b=this.oa.ha.clone();this.oa instanceof c&&this.oe&&(this.oe=Math.min(this.oe,a/2,this.oa.length/2),a=I(this.oa.ha.x,this.oa.ha.y,this.ha.x,this.ha.y),b.x+=a.x*this.oe,b.y+=a.y*this.oe,this.oa.hy(this.oe),this.Uf-=this.oe);this.from=b;null===this.Vf&&(this.Vf=this.ha);a=this.Uf/10*this.On;10<a&&(a=10);var d=b.x,e=b.y,f=this.ha.x,
h=this.ha.y;d+=a;e+=a;this.Da=new G(d+this.Fk*(f+a-d),e+this.Fk*(h+a-e));d=b.x-a;f=this.ha.x-a;e=b.y-a;h=this.ha.y-a;this.La=new G(d+this.Gk*(f-d),e+this.Gk*(h-e))};c.prototype.hy=function(a){var b=I(this.from.x,this.from.y,this.ha.x,this.ha.y),d=this.ha.clone();d.x-=b.x*a;d.y-=b.y*a;this.Vf=d;this.Uf-=a;a=this.Uf/10*this.On;10<a&&(a=10);b=this.from.x;var e=this.from.y,c=d.x,h=d.y;b+=a;e+=a;this.Da=new G(b+this.Fk*(c+a-b),e+this.Fk*(h+a-e));this.log("RECALC ctrl1=%s",this.Da);b=this.from.x-a;c=d.x-
a;e=this.from.y-a;h=d.y-a;this.La=new G(b+this.Gk*(c-b),e+this.Gk*(h-e))};c.prototype.ri=function(a){this.oa=a;this.format();this.oa instanceof c&&(this.moveTo=this.oa.Vf)};c.prototype.ia=function(a){null!==this.Vf&&(this.oe&&(this.moveTo&&a.moveTo(this.moveTo.x,this.moveTo.y),a.quadraticCurveTo(this.oa.ha.x,this.oa.ha.y,this.from.x,this.from.y)),a.bezierCurveTo(this.Da.x,this.Da.y,this.La.x,this.La.y,this.Vf.x,this.Vf.y))};c.prototype.se=function(){return this.oa?I(this.oa.ha.x,this.oa.ha.y,this.Da.x,
this.Da.y):this.Jc()};c.prototype.Jc=function(){return I(this.La.x,this.La.y,this.ha.x,this.ha.y)};return c}(),jd=function(){function c(a,b,d){this.Pn=d;this.ha=b;this.oa=a;this.Pn=d;var e=Dc(a.ha.x,a.ha.y,b.x,b.y);e||(e=1);var c=(b.x-a.ha.x)/e,h=(b.y-a.ha.y)/e;this.La=new G(b.x-e*d*c,b.y-e*d*h);if((b=a.La)&&a.oa){var k=I(a.oa.ha.x,a.oa.ha.y,a.ha.x,a.ha.y),l=Dc(a.oa.ha.x,a.oa.ha.y,a.ha.x,a.ha.y);c=.5*(c+k.x);h=.5*(h+k.y);b.x=a.ha.x-l*d*c;b.y=a.ha.y-l*d*h}this.Da=new G(a.ha.x+e*d*c,a.ha.y+e*d*h);this.length=
e}c.prototype.ri=function(a){this.oa=a;var b=a.La,d=(this.ha.x-a.ha.x)/this.length,e=(this.ha.y-a.ha.y)/this.length,c=this.Pn;if(b&&a.oa){var h=I(a.oa.ha.x,a.oa.ha.y,a.ha.x,a.ha.y),k=Dc(a.oa.ha.x,a.oa.ha.y,a.ha.x,a.ha.y);d=.5*(d+h.x);e=.5*(e+h.y);b.x=a.ha.x-k*c*d;b.y=a.ha.y-k*c*e}this.Da=new G(a.ha.x+this.length*c*d,a.ha.y+this.length*c*e)};c.prototype.ia=function(a){a.bezierCurveTo(this.Da.x,this.Da.y,this.La.x,this.La.y,this.ha.x,this.ha.y)};c.prototype.se=function(){return this.oa?I(this.oa.ha.x,
this.oa.ha.y,this.Da.x,this.Da.y):{x:1,y:0}};c.prototype.Jc=function(){return 0<this.Pn?I(this.La.x,this.La.y,this.ha.x,this.ha.y):I(this.oa.ha.x,this.oa.ha.y,this.ha.x,this.ha.y)};return c}(),kd=function(){function c(a,b,d){this.oa=a;this.control=b;this.ha=d}c.prototype.ia=function(a){a.quadraticCurveTo(this.control.x,this.control.y,this.ha.x,this.ha.y)};c.prototype.se=function(){return this.oa?I(this.oa.ha.x,this.oa.ha.y,this.control.x,this.control.y):{x:1,y:0}};c.prototype.Jc=function(){return I(this.control.x,
this.control.y,this.ha.x,this.ha.y)};return c}(),ld=function(){function c(a,b,d,e){this.oa=a;this.control=b;this.ha=d;this.ne=e}c.prototype.ia=function(a){a.arcTo(this.control.x,this.control.y,this.ha.x,this.ha.y,this.ne)};c.prototype.se=function(){return{x:1,y:0}};c.prototype.Jc=function(){return I(0,0,1,0)};return c}(),md=function(){function c(a,b,d,e,c,h,k){this.oa=a;this.vd=b;this.ha=d;this.ne=e;this.Sn=c;this.ju=h;this.Qt=k}c.prototype.ia=function(a){a.arc(this.vd.x,this.vd.y,this.ne,this.Sn,
this.ju,0!==this.Qt)};c.prototype.se=function(){return{x:1,y:0}};c.prototype.Jc=function(){return I(0,0,1,0)};return c}(),nd=function(){function c(a,b,d,e){this.Da=b;this.La=d;this.Da=b;this.La=d;this.ha=e;this.oa=a}c.prototype.ia=function(a){a.bezierCurveTo(this.Da.x,this.Da.y,this.La.x,this.La.y,this.ha.x,this.ha.y)};c.prototype.se=function(){return this.oa?I(this.oa.ha.x,this.oa.ha.y,this.Da.x,this.Da.y):{x:1,y:0}};c.prototype.Jc=function(){return I(this.La.x,this.La.y,this.ha.x,this.ha.y)};return c}(),
od=function(){function c(a,b,d,e){this.oa=a;this.Da=b;this.La=d;this.ha=e}c.prototype.ia=function(a){if(this.oa){var b=[];this.oa.La&&b.push(this.oa.La);this.Da&&b.push(this.Da);2===b.length?a.bezierCurveTo(b[0].x,b[0].y,b[1].x,b[1].y,this.ha.x,this.ha.y):1===b.length&&a.quadraticCurveTo(b[0].x,b[0].y,this.ha.x,this.ha.y)}};c.prototype.ri=function(a){this.oa=a};c.prototype.se=function(){return this.oa&&this.oa.La?I(this.oa.ha.x,this.oa.ha.y,this.Da.x,this.Da.y):{x:1,y:0}};c.prototype.Jc=function(){return this.Da?
I(this.Da.x,this.Da.y,this.ha.x,this.ha.y):{x:1,y:0}};return c}(),pd=function(){function c(a,b,d,e,c){this.oa=a;this.th=b;this.ha=d;this.log=x.create("SEGMENT");this.oa=a;this.th=b;c*=2;var f=2*e.next()-1;e.next();e=this.oa.Jc();if(!this.oa.ny&&e){var k=Dc(a.ha.x,a.ha.y,b.x,b.y);this.Da=new G(a.ha.x+.5522847498*e.x*k,a.ha.y+.5522847498*e.y*k)}else this.Da=new G(a.ha.x+.5522847498*(b.x-a.ha.x),a.ha.y+.5522847498*(b.y-a.ha.y));this.La=new G(d.x-.5522847498*(d.x-b.x)*(1-f*c),d.y-.5522847498*(d.y-b.y)*
(1-f*c));this.ha=d}c.prototype.ri=function(a){this.oa=a;var b=this.oa.Jc();if(b){var d=Dc(a.ha.x,a.ha.y,this.th.x,this.th.y);this.Da=new G(a.ha.x+.5522847498*b.x*d,a.ha.y+.5522847498*b.y*d)}else this.Da=new G(a.ha.x+.5522847498*(this.th.x-this.oa.ha.x),a.ha.y+.5522847498*(this.th.y-this.oa.ha.y))};c.prototype.ia=function(a){a.bezierCurveTo(this.Da.x,this.Da.y,this.La.x,this.La.y,this.ha.x,this.ha.y)};c.prototype.se=function(){return this.oa?I(this.oa.ha.x,this.oa.ha.y,this.Da.x,this.Da.y):{x:1,y:0}};
c.prototype.Jc=function(){return I(this.La.x,this.La.y,this.ha.x,this.ha.y)};return c}();var qd=function(){function c(a){this.Uh=this.Th=0;if("string"===typeof a){for(;8>a.length;)a+=a;for(var b=16777619,d=0;d<a.length;d++)b=(16777619*b^a.charCodeAt(d))&4294967295;a=b}this.Gr=a;this.reset()}c.prototype.reset=function(){this.Uh=this.Th=this.Gr};c.prototype.next=function(){this.Uh=36969*(this.Uh&65535)+(this.Uh>>16);this.Th=18E3*(this.Th&65535)+(this.Th>>16);return((this.Uh<<16)+this.Th)/4294967295/2+.5};return c}();var rd=function(){function c(a){this.la=a;this.n=0;this.ob=new G(0,0)}c.prototype.next=function(a){if(0===this.la.length)return null;if(0===this.n)return this.ob=this.la[0].clone(),this.n+=1,this.ob.clone();for(;this.n<this.la.length;){var b=this.ob.Lb(this.la[this.n]);if(0===b)this.n+=1;else if(b<=a)a-=b,this.n+=1;else return this.ob.x+=(this.la[this.n].x-this.ob.x)*a/b,this.ob.y+=(this.la[this.n].y-this.ob.y)*a/b,this.ob.clone()}return null};return c}(),sd=function(){function c(a){this.Qc=a;this.xn=
!0;this.la=[];this.log=x.create("WaveAddon");this.ne=a.ka("waveRadius")}c.prototype.format=function(){var a=this.Qc.Nl(!1).fo(M.ol).$e();this.log("Format cloud; %s points",a.length);this.la=this.Uy(a,this.ne)};c.prototype.Uy=function(a,b){var d=new rd(a),e=1,c=[];if(2>a.length)return c;var h=0;for(var k=1;k<a.length;k++)h+=Dc(a[k-1].x,a[k-1].y,a[k].x,a[k].y);b=h/Math.round(h/(2*b)+.5)/2;for(h=[];;){k=d.next(2*b);if(!k)break;h.push(k)}h.push(a[a.length-1]);var l=h[0];c.push(l);for(d=1;d<h.length;d++){k=
h[d];var n=I(l.x,l.y,k.x,k.y);var q=b,u=new G(n.y*e,-1*n.x*e);l=new G(l.x+(n.x+u.x)*q,l.y+(n.y+u.y)*q);c.push(l);c.push(k);e*=-1;l=k}for(d=2;d<c.length-1;d+=2)e=c[d-1],h=c[d+1],c[d].x=e.x+(h.x-e.x)/2,c[d].y=e.y+(h.y-e.y)/2;return c};c.prototype.ia=function(a){a.beginPath();a.moveTo(this.la[0].x,this.la[0].y);for(var b=1;b<this.la.length-1;b+=2)a.quadraticCurveTo(this.la[b].x,this.la[b].y,this.la[b+1].x,this.la[b+1].y)};return c}();var M=function(c){function a(b,d){var e=c.call(this,b,d)||this;e.ua=[];e.jg=0;e.td=[];e.Qn=[];e.cs=!1;e.inverse=new J;e.origin=new G(0,0);e.uc=[];e.qd=new K;e.tq=!1;e.backgroundImage=null;e.log=x.create("PATHNODE");e.log("New PathNode Created");e.Hb=new gd("",d);e.Hb.setProperty("text",e.ba.text);e.Kl(a.ta);e.ba.closed=!1;e.ba.commands=[];e.ba.seed=0;return e}__extends(a,c);a.prototype.moveTo=function(b,d){var e=this.ba.commands;e.push(a.cg);e.push(b);e.push(d)};a.prototype.pt=function(b,d,e,c,h,
k){var f=this.ba.commands;f.push(a.bh);f.push(h);f.push(k);f.push(b);f.push(d);f.push(e);f.push(c)};a.prototype.type=function(){return"PathNode"};a.prototype.Oh=function(){return!0};a.prototype.setProperty=function(a,d){c.prototype.setProperty.call(this,a,d);switch(a){case "bold":case "fontName":case "fontSize":case "italic":case "text":case "textAlign":case "textDecoration":case "wrap":this.ba[a]=d;this.Hb.setProperty(a,d);break;case "textFillStyle":this.Hb.setProperty("fillStyle",d);this.ba[a]=
d;break;case "textBackground":this.Hb.setProperty("background",d);this.ba[a]=d;break;case "cloudRadius":case "waveRadius":case "doubleLine":case "doubleLineDashSide":case "spotHighlight":case "verticalAlign":this.ba[a]=d;break;case "backgroundImage":this.ba[a]=d,this.backgroundImage=null}};a.prototype.Bj=function(b){for(var d=0,e=this.ba.commands,c=b/3|0,h=0;h<c;h++)d+=a.$a[e[d]]+1;h=b%3*2+1;c=e[d+h];d=e[d+h+1];this.log("getEditHandle(%s) = (%s, %s)",b,c,d);this.Ja().apply(c,d)};a.prototype.ge=function(b,
d,e){for(var c=0,h=this.ba.commands,k=b/3|0,l=0;l<k;l++)c+=a.$a[h[c]]+1;k=this.inverse.apply(d,e);l=b%3*2+1;h[c+l]=k.x;h[c+l+1]=k.y;if(0===b&&this.ba.closed){for(b=null;c<h.length;)k=a.$a[h[c]],2<=k&&(b=c),c+=k+1;b&&(c=b,k=this.inverse.apply(d,e),h[c+1]=k.x,h[c+2]=k.y)}};a.prototype.jq=function(){return"commands"};a.prototype.qx=function(b){for(var d=this.ba.commands,e=0,c=0;c<b/3;c++)e+=a.$a[d[e]]+1;d.splice(e,a.$a[d[e]]+1)};a.prototype.Hu=function(){return this.ka("arrowXOffset")||this.ka("arrowSize")};
a.prototype.format=function(b,d){var e=this,c=null;this.ua.length=0;this.inverse=this.ba.matrix.inverse();var h=new G(0,0),k=this.ba.commands,l=null,n=this.ba.matrix,q=new qd(this.ba.seed);this.Qn.length=0;for(var u=null,v=null,w=0;w<k.length;){switch(k[w++]){case a.cg:h=n.apply(k[w++],k[w++]);v=new hd(l,h);this.ua.push(v);null===c&&(c=h);this.Qn.push(h);u=null;break;case a.xe:l&&(h=n.apply(k[w++],k[w++]),this.ua.push(new id(l,h,q,this.ba.sloppiness,this.ba.roundRadius)),this.Qn.push(h));break;case a.dg:if(l){h=
n.apply(k[w++],k[w++]);var y=n.apply(k[w++],k[w++]);this.ua.push(new kd(l,y,h))}break;case a.nl:if(l){h=n.apply(k[w++],k[w++]);y=n.apply(k[w++],k[w++]);var z=k[w++];this.ua.push(new ld(l,y,h,z))}break;case a.ml:if(l){h=n.apply(k[w++],k[w++]);y=n.apply(k[w++],k[w++]);z=k[w++];var L=k[w++],S=k[w++],E=k[w++];this.ua.push(new md(l,y,h,z,L,S,E))}break;case a.bh:l&&(h=n.apply(k[w++],k[w++]),z=n.apply(k[w++],k[w++]),y=n.apply(k[w++],k[w++]),this.ua.push(new nd(l,z,y,h)));break;case a.Mo:l&&(h=n.apply(k[w++],
k[w++]),z=n.apply(k[w++],k[w++]),y=n.apply(k[w++],k[w++]),this.ua.push(new od(l,z,y,h)));break;case a.Ci:l&&(h=n.apply(k[w++],k[w++]),this.ua.push(new jd(l,h,this.ba.smoothness)));break;case a.pl:l&&(h=n.apply(k[w++],k[w++]),z=n.apply(k[w++],k[w++]),this.ua.push(new pd(l,z,h,q,this.ba.sloppiness)));break;case a.Cc:this.ba.closed=!0;u&&l&&u!==l&&u.ri&&v&&(u.ri(l),l.ha=v.ha);break;default:w++}l=this.ua[this.ua.length-1];null!==u||l instanceof hd||(u=l)}this.origin=c||new G(0,0);this.jg=this.ua.length;
this.Au(q);this.rect.x=this.origin.x;this.rect.y=this.origin.y;this.rect.width=0;this.rect.height=0;c=this.ba.dashes.split(",");this.uc=[];for(w=0;w<c.length;w++)h=parseFloat(c[w]),isNaN(h)||this.uc.push(h);c=this.uc.length?a.ol:a.os;this.qd=this.Nl(!0).fo(c);w=0+this.ka("shapeWidth");0<w&&(this.qd=this.Ot(this.qd,w));this.rect=this.qd.vp(c);w=this.rect.width-2*(this.ba.lineWidth/2+1);h=this.ba.lineWidth;k=this.qd.clone();k.transform(this.ae());this.Ga=k.vp(c);c=this.Ja().$b();this.Ga.Dd(Math.ceil(h/
c.x),Math.ceil(h/c.y));this.rect.Dd(h+1,h+1);8>this.rect.width&&(this.rect.x+=this.rect.width/2-4,this.rect.width=8);8>this.rect.height&&(this.rect.y+=this.rect.height/2-4,this.rect.height=8);if(""!==this.ba.text){c=this.rect.vd();this.Hb.setProperty("textAlign",this.ba.textAlign||"center");this.Hb.setProperty("baseWidth",w);this.Hb.format(b,d);w=c.x-this.Hb.rect.x-this.Hb.rect.width/2;h=0;switch(this.ba.verticalAlign){default:case "middle":h=c.y-this.Hb.rect.y-this.Hb.Lm/2;break;case "top":h=this.rect.y-
this.Hb.rect.y;break;case "bottom":h=this.rect.bottom()-this.Hb.Lm-this.Hb.rect.y}this.Hb.transform(new Fc(w,h));this.Hb.format(b,d)}this.cs=0===r.Zd(this.ba.fillStyle).values[3]&&!this.backgroundImage;this.td.length=0;0<this.ba.cloudRadius?this.td.push(new Wc(this)):0<this.ba.waveRadius?this.td.push(new sd(this)):this.ba.doubleLine&&this.td.push(new td(this));for(w=0;w<this.td.length;w++)this.td[w].format(b);(w=this.ka("backgroundImage"))&&null===this.backgroundImage&&d.add(this.id,"image",w,null,
function(a){e.backgroundImage=a;d.Lg(e.id)})};a.prototype.Jj=function(){return this.qd};a.prototype.Au=function(a){function b(b,d){b=b.clone();l&&(b.x+=d.x*h*.5,b.y+=d.y*h*.5);var f=b.x-d.x*h;var n=b.y-d.y*h;var q=f+d.y*c/2;var u=n-d.x*c/2;f+=-d.y*c/2;n+=d.x*c/2;e.ua.push(new hd(e.ua[e.ua.length-1],new G(f,n)));e.ua.push(new jd(e.ua[e.ua.length-1],b,k));e.ua.push(new jd(e.ua[e.ua.length-1],new G(q,u),k));"solid"===e.ba.arrowStyle&&e.ua.push(new id(e.ua[e.ua.length-1],new G(f,n),a,e.ba.smoothness,
0))}if(this.tq=0<this.ba.arrowSize&&!this.ba.closed&&0<this.ua.length){var e=this,c=this.ba.arrowSize,h=this.ba.arrowXOffset,k=this.ba.smoothness,l=this.ba.doubleLine;null===h&&(h=c);var n=this.ua[this.ua.length-1];b(n.ha,n.Jc());this.ba.doubleArrow&&b(this.ua[0].ha,Ec(this.ua[1].se()))}};a.prototype.close=function(){this.ba.commands.push(a.Cc)};a.prototype.jt=function(){var a=this.ua[this.ua.length-1];8>=Dc(a.ha.x,a.ha.y,this.origin.x,this.origin.y)&&this.close()};a.prototype.Ot=function(a,d){this.log("ConvertToRects: width=%s",
d);for(var b=0,c=a.da,h=0,k=0,l,n,q=new K;b<c.length;){this.log("cmd %s %s %s",c[b],c[b+1],c[b+2]);switch(c[b]){case K.Ec:h=c[b+1];k=c[b+2];break;case K.Dc:l=c[b+1];n=c[b+2];this.log("(%s,%s-%s,%s)",h,k,l,n);if(0<Dc(h,k,l,n)){var u=I(h,k,l,n),v=u.y*d/2;u=-u.x*d/2;q.moveTo(h+v,k+u);q.lineTo(l+v,n+u);q.lineTo(l-v,n-u);q.lineTo(h-v,k-u);q.closePath()}h=l;k=n}b+=K.Fc[c[b]]}return q};a.prototype.clip=function(a){if(this.ba.closed){var b=new K;this.log("Clipping to a path");for(var e=0;e<this.ua.length;e++)this.ua[e].ia(b);
b.closePath();0>b.lh()&&(b=b.wx());b.ia(a)}};a.prototype.ia=function(a){this.ba.spotHighlight?this.log("Not drawing node %s due to spothighlight",this.id):c.prototype.ia.call(this,a)};a.prototype.ef=function(a){var b=this.inverse;a.save();a.lineJoin="round";a.transform(b.m11,b.m21,b.m12,b.m22,b.Ba,b.Ca);a.beginPath();a.lineCap="round";b=!0;var e;for(e=0;e<this.td.length;e++)this.td[e].xn&&(b=!1);if(b)for(e=0;e<this.ua.length;e++)this.ua[e].ia(a);for(e=0;e<this.td.length;e++)this.td[e].ia(a);if(!b&&
0<this.ba.arrowSize)for(e=this.jg;e<this.ua.length;e++)this.ua[e].ia(a);if(this.ba.closed){a.closePath();if(this.backgroundImage){a.fillStyle=a.createPattern(this.backgroundImage,"no-repeat")||"magenta";e=Math.max(this.rect.width/this.backgroundImage.naturalWidth,this.rect.height/this.backgroundImage.naturalHeight);var c=this.rect.width-this.backgroundImage.naturalWidth*e,h=this.rect.height-this.backgroundImage.naturalHeight*e;a.translate(this.rect.x+c/2,this.rect.y+h/2);a.scale(e,e);a.fill();a.scale(1/
e,1/e);a.translate(-this.rect.x-c/2,-this.rect.y-h/2)}else a.fill();a.shadowColor="rgba(0,0,0,0.0)"}b&&(this.uc.length&&0<this.ba.lineWidth?(a.beginPath(),this.qd.pj(a,this.uc),a.lineCap="butt"):0<0+this.ka("shapeWidth")&&(a.beginPath(),this.qd.ia(a)));0<this.ba.lineWidth&&a.stroke();if(this.ba.arrowSize&&"solid"===this.ba.arrowStyle){a.beginPath();for(e=this.jg;e<this.ua.length;e++)this.ua[e].ia(a);a.fillStyle=this.ba.strokeStyle;a.fill()}""!==this.ba.text&&this.Hb.ia(a);a.restore()};a.prototype.xb=
function(a,d){if(this.hidden()||this.ka("locked"))return null;var b=12+this.ba.shapeWidth/2+this.ba.lineWidth/2;if(a>=this.rect.x-b&&a<this.rect.x+b+this.rect.width&&d>=this.rect.y-b&&d<this.rect.y+b+this.rect.height)if(this.ba.closed&&!this.cs){if(this.qd.Uw(a,d))return this}else if(this.qd.nr(a,d,b)||""!==this.ba.text&&this.Hb.xb(a,d))return this;return null};a.prototype.Nl=function(a){var b=new K;if(0<this.ba.arrowSize&&!a)for(a=0;a<this.jg;a++)this.ua[a].ia(b);else for(a=0;a<this.ua.length;a++)this.ua[a].ia(b);
this.ba.closed&&b.closePath();return b};a.prototype.lineTo=function(b,d){var e=this.ba.commands;e.push(a.xe);e.push(b);e.push(d)};a.prototype.vh=function(b,d){var e=this.ba.commands;e.push(a.Ci);e.push(b);e.push(d)};a.prototype.Ne=function(){return!1!==this.ba.editable&&!0!==this.ba.lockEditMode};a.prototype.Yj=function(a,d,e){e*=8;if(a>=this.origin.x-e&&a<this.origin.x+e&&d>=this.origin.y-e&&d<this.origin.y+e)return 0;for(var b=0;b<this.jg;b++){var c=this.ua[b];if(a>=this.ua[b].ha.x-e&&a<this.ua[b].ha.x+
e&&d>=this.ua[b].ha.y-e&&d<this.ua[b].ha.y+e)return 3*b;if(c.control){if(a>=c.control.x-e&&a<c.control.x+e&&d>=c.control.y-e&&d<c.control.y+e)return 3*b+1}else if(c.Da){if(a>=c.Da.x-e&&a<c.Da.x+e&&d>=c.Da.y-e&&d<c.Da.y+e)return 3*b+1;if(c.La&&a>=c.La.x-e&&a<c.La.x+e&&d>=c.La.y-e&&d<c.La.y+e)return 3*b+2}}return null};a.prototype.Cj=function(b){var d=this.ba.commands;b/=3;var e=0,c=!1,h=0,k;for(k=0;k<d.length;){var l=d[k];if(l===a.Cc){c=!0;break}h+=1;k+=a.$a[d[k]]+1}0===b&&c&&(b=h-1);for(k=0;k<d.length;e++){c=
null;switch(d[k]){case a.cg:c="move_to";break;case a.xe:c="line_to";break;case a.dg:c="quadratic_to"}if(b===e)return c;k+=a.$a[d[k]]+1}return null};a.Cs=function(b,d,e){d/=3;var c=0,h=[],k=new G(0,0),l=!1,n=0,q;for(q=0;q<b.length;){var u=b[q];if(u===a.Cc){l=!0;break}n+=1;q+=a.$a[b[q]]+1}0===d&&l&&(d=n-1);for(q=0;q<b.length;c++){u=b[q];l=!1;d===c&&(u===a.dg&&"line_to"===e?(h.push(a.xe,b[q+1],b[q+2]),l=!0):u===a.xe&&"quadratic_to"===e&&(h.push(a.dg,b[q+1],b[q+2],(k.x+b[q+1])/2,(k.y+b[q+2])/2),l=!0));
k=new G(b[q+1],b[q+2]);if(!l)for(u=0;u<1+a.$a[b[q]];u++)h.push(b[q+u]);q+=a.$a[b[q]]+1}return h};a.prototype.Dq=function(){return!0};a.prototype.qj=function(a,d,e){a.save();a.lineWidth=1*d;a.strokeStyle="#0050B7";a.fillStyle="#0050B7";d*=8;0===e?a.fillRect(this.origin.x-d,this.origin.y-d,2*d,2*d):a.strokeRect(this.origin.x-d,this.origin.y-d,2*d,2*d);for(var b=1;b<this.jg;b++){var c=this.ua[b];a.beginPath();if(c.control)a.arc(c.control.x,c.control.y,d,0,2*Math.PI),a.arc(c.control.x,c.control.y,2*d,
0,2*Math.PI),e===3*b+1?a.fill():a.stroke();else if(c instanceof nd||c instanceof od){var k=c.Da;var l=c.La;var n=c.oa.ha;k&&(a.moveTo(n.x,n.y),a.lineTo(k.x,k.y),a.moveTo(k.x+d,k.y),a.arc(k.x,k.y,d,0,2*Math.PI),e===3*b+1?a.fill():a.stroke());a.beginPath();a.moveTo(c.ha.x,c.ha.y);a.lineTo(l.x,l.y);a.moveTo(l.x+d,l.y);a.arc(l.x,l.y,d,0,2*Math.PI);e===3*b+2?a.fill():a.stroke()}e===3*b?a.fillRect(this.ua[b].ha.x-d,this.ua[b].ha.y-d,2*d,2*d):a.strokeRect(this.ua[b].ha.x-d,this.ua[b].ha.y-d,2*d,2*d)}a.restore()};
a.qs=function(a){var b=new N,e=0;for(a=a.da;e<a.length;){switch(a[e]){case K.Ec:b.moveTo(a[e+1],a[e+2]);break;case K.Dc:b.lineTo(a[e+1],a[e+2]);break;case K.we:b.bezierCurveTo(a[e+1],a[e+2],a[e+3],a[e+4],a[e+5],a[e+6]);break;case K.ye:b.quadraticCurveTo(a[e+1],a[e+2],a[e+3],a[e+4]);break;case K.Cc:b.close()}e+=K.Fc[a[e]]}return b.Jb()};a.ta={strokeStyle:"#000000",fillStyle:"#ffffff",fontName:"Arial",fontSize:20,lineWidth:2,dashes:"",shapeWidth:0,smoothness:.3,sloppiness:0,shadow:!1,closed:!1,arrowSize:0,
arrowXOffset:null,arrowStyle:"simple",doubleArrow:!1,text:"",roundRadius:0,wrap:!1};a.os=8;a.ol=2;a.cg=0;a.xe=1;a.dg=2;a.nl=3;a.bh=4;a.Ci=5;a.pl=6;a.Cc=7;a.Mo=8;a.ml=9;a.ez=.5522847498;a.$a=[];return a}(ed);M.$a[M.cg]=2;M.$a[M.xe]=2;M.$a[M.dg]=4;M.$a[M.nl]=5;M.$a[M.bh]=6;M.$a[M.Ci]=2;M.$a[M.pl]=4;M.$a[M.Cc]=0;M.$a[M.Mo]=6;M.$a[M.ml]=8;
var N=function(){function c(a){void 0===a&&(a=[]);this.da=a}c.prototype.beginPath=function(){};c.prototype.kf=function(a,b,d){for(var e=0,c=0;c<a;c++)e+=M.$a[this.da[e]]+1;this.da[e+1]=b;this.da[e+2]=d};c.prototype.moveTo=function(a,b){this.da.push(M.cg);this.da.push(a);this.da.push(b)};c.prototype.lineTo=function(a,b){this.da.push(M.xe);this.da.push(a);this.da.push(b)};c.prototype.vh=function(a,b){this.da.push(M.Ci);this.da.push(a);this.da.push(b)};c.prototype.quadraticCurveTo=function(a,b,d,e){this.da.push(M.dg);
this.da.push(d);this.da.push(e);this.da.push(a);this.da.push(b)};c.prototype.pf=function(a,b,d,e){this.da.push(M.pl);this.da.push(d);this.da.push(e);this.da.push(a);this.da.push(b)};c.prototype.bezierCurveTo=function(a,b,d,e,c,h){this.da.push(M.bh);this.da.push(c);this.da.push(h);this.da.push(a);this.da.push(b);this.da.push(d);this.da.push(e)};c.prototype.arc=function(a,b,d,e,c,h){void 0===h&&(h=!0);var f=(new Gc(-c,a,b)).apply(a+d,b);this.da.push(M.ml);this.da.push(f.x);this.da.push(f.y);this.da.push(a);
this.da.push(b);this.da.push(d);this.da.push(e);this.da.push(c);this.da.push(h?1:0)};c.prototype.arcTo=function(a,b,d,e,c){this.da.push(M.nl);this.da.push(d);this.da.push(e);this.da.push(a);this.da.push(b);this.da.push(c)};c.prototype.bq=function(){for(var a=[],b=0;b<this.da.length;){for(var d=this.da[b],e=0;e<M.$a[d];e+=2)a.push(new G(this.da[b+1+e],this.da[b+1+e+1]));b+=M.$a[d]+1}a=H.dh(a);return{x:a.x,y:a.y,width:a.width,height:a.height}};c.prototype.translate=function(a,b){for(var d=0;d<this.da.length;){for(var e=
this.da[d],c=0;c<M.$a[e];c+=2)this.da[d+1+c]+=a,this.da[d+2+c]+=b;d+=M.$a[e]+1}};c.prototype.closePath=function(){this.da.push(M.Cc)};c.prototype.close=function(){this.closePath()};c.prototype.Jb=function(){return this.da};return c}();N.prototype.change=N.prototype.kf;N.prototype.moveTo=N.prototype.moveTo;N.prototype.lineTo=N.prototype.lineTo;N.prototype.curveTo=N.prototype.vh;N.prototype.quadraticCurveTo=N.prototype.quadraticCurveTo;N.prototype.cornerTo=N.prototype.pf;N.prototype.bezierCurveTo=N.prototype.bezierCurveTo;
N.prototype.arc=N.prototype.arc;N.prototype.arcTo=N.prototype.arcTo;N.prototype.getBoundingBox=N.prototype.bq;N.prototype.translate=N.prototype.translate;N.prototype.closePath=N.prototype.closePath;N.prototype.close=N.prototype.close;N.prototype.toArray=N.prototype.Jb;ed.fd("PathNode",M);N.prototype.beginPath=N.prototype.beginPath;N.prototype.change=N.prototype.kf;N.prototype.moveTo=N.prototype.moveTo;N.prototype.lineTo=N.prototype.lineTo;N.prototype.curveTo=N.prototype.vh;
N.prototype.quadraticTo=N.prototype.rz;N.prototype.cornerTo=N.prototype.pf;N.prototype.bezierTo=N.prototype.pt;N.prototype.arc=N.prototype.arc;N.prototype.arcTo=N.prototype.arcTo;N.prototype.getBoundingBox=N.prototype.bq;N.prototype.translate=N.prototype.translate;N.prototype.closePath=N.prototype.closePath;N.prototype.close=N.prototype.close;N.prototype.toArray=N.prototype.Jb;var td=function(){function c(a){this.Qc=a;this.ne=0;this.xn=!0;this.Wj=!1;this.path=new K;this.Dk=new K;this.log=x.create("DoubleLineAddon")}c.prototype.format=function(){this.log("Formatting doubleline; thickness=%s",this.Qc.ka("doubleLine"));var a=this.Qc.Nl(!1).fo(M.ol),b=this.Qc.Hu();if(0<b){var d=a.ut();d>b&&(a=a.wt(d-b))}a=a.$e();b=this.Qc.ka("doubleLine");this.path=new K;this.Dk=new K;d=this.Qc.ka("doubleLineDashSide");this.Wj=!1;"outer"===d?(Sc(this.path,a,b,!0,!1),Sc(this.Dk,a,b,!1,!0),this.Wj=
!0):"inner"===d?(Sc(this.path,a,b,!1,!0),Sc(this.Dk,a,b,!0,!1),this.Wj=!0):Sc(this.path,a,b,!0,!0)};c.prototype.ia=function(a){a.beginPath();this.Qc.uc.length&&this.Wj?(this.Dk.pj(a,this.Qc.uc),this.path.ia(a)):this.Qc.uc.length?this.path.pj(a,this.Qc.uc):this.path.ia(a)};return c}();var ud=x.create("FitCurve");
function vd(c){function a(a,b){E.bezierCurveTo(b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y);ud("Bezier: (%s,%s), (%s,%s), (%s,%s), (%s,%s)",b[0].x,b[0].y,b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y)}function b(a,b){return a.x*b.x+a.y*b.y}function d(a){var b=1-a;return 3*a*b*b}function e(a){return 3*a*a*(1-a)}function f(a,b){var d=a.x-b.x,e=a.y-b.y;return Math.sqrt(d*d+e*e)}function h(a){return a.x*a.x+a.y*a.y}function k(a,b){var d=Math.sqrt(h(a));0!==d&&(a.x*=b/d,a.y*=b/d);return a}function l(a,b,d){void 0===
d&&ud("Undef!");d.x=a.x+b.x;d.y=a.y+b.y;return d}function n(a,b){return{x:a.x+b.x,y:a.y+b.y}}function q(a,b){return{x:a.x*b,y:a.y*b}}function u(a,b){return{x:a.x-b.x,y:a.y-b.y}}function v(a,c,h,v,w,y){var z,D=[],C=[[],[]],L=[];var E=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];var S=h-c+1;for(z=0;z<S;z++){var X={x:w.x,y:w.y};var Z={x:y.x,y:y.y};k(X,d(v[z]));k(Z,e(v[z]));D[z]=[X,Z]}C[0][0]=0;C[0][1]=0;C[1][0]=0;C[1][1]=0;L[0]=0;for(z=L[1]=0;z<S;z++)C[0][0]+=b(D[z][0],D[z][0]),C[0][1]+=b(D[z][0],D[z][1]),
C[1][0]=C[0][1],C[1][1]+=b(D[z][1],D[z][1]),X=1-v[z],Z=v[z],X=u(a[c+z],n(q(a[c],X*X*X),n(q(a[c],d(v[z])),n(q(a[h],e(v[z])),q(a[h],Z*Z*Z))))),L[0]+=b(D[z][0],X),L[1]+=b(D[z][1],X);v=C[0][0]*C[1][1]-C[1][0]*C[0][1];z=C[0][0]*L[1]-C[0][1]*L[0];L=L[0]*C[1][1]-L[1]*C[0][1];0===v&&(v=C[0][0]*C[1][1]*1E-11);C=L/v;L=z/v;if(0>C||0>L)return C=f(a[h],a[c])/3,E[0]=a[c],E[3]=a[h],l(E[0],k(w,C),E[1]),l(E[3],k(y,C),E[2]),E;E[0]=a[c];E[3]=a[h];l(E[0],k(w,C),E[1]);l(E[3],k(y,L),E[2]);return E}function w(a,b,d){var e;
var c=[];for(e=0;e<=a;e++)c[e]={x:b[e].x,y:b[e].y};for(e=1;e<=a;e++)for(b=0;b<=a-e;b++)c[b].x=(1-d)*c[b].x+d*c[b+1].x,c[b].y=(1-d)*c[b].y+d*c[b+1].y;return c[0]}function y(a){var b=Math.sqrt(Math.sqrt(h(a)));0!==b&&(a.x/=b,a.y/=b);return a}function z(a,b,d,e,c){var f,k=(d-b+1)/2;var l=0;for(f=b+1;f<d;f++){var n=w(3,e,c[f-b]);n=u(n,a[f]);n=h(n);n>=l&&(l=n,k=f)}return{Pq:l,Ur:k}}function L(b,d,e,c,h,n){var q;var D=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];var C=n*n;if(2===e-d+1)n=f(b[e],b[d])/3,D[0]=
b[d],D[3]=b[e],l(D[0],k(c,n),D[1]),l(D[3],k(h,n),D[2]),a(3,D);else{var E=[0];for(q=d+1;q<=e;q++)E[q-d]=E[q-d-1]+f(b[q],b[q-1]);for(q=d+1;q<=e;q++)E[q-d]/=E[e-d];var X=E;D=v(b,d,e,X,c,h);q=z(b,d,e,D,X);E=q.Pq;q=q.Ur;if(E<n)a(3,D);else{if(E<C||S)for(C=0;4>C;C++){q=b;E=d;var Z=e;var ob=D;var Pa=[];for(D=E;D<=Z;D++){var re=Pa,nf=D-E,R,gb=ob,vb=q[D],wb=X[D-E],Ia=[];var Ma=[];var xb=w(3,gb,wb);for(R=0;2>=R;R++)Ia[R]={x:0,y:0},Ia[R].x=3*(gb[R+1].x-gb[R].x),Ia[R].y=3*(gb[R+1].y-gb[R].y);for(R=0;1>=R;R++)Ma[R]=
{x:0,y:0},Ma[R].x=2*(Ia[R+1].x-Ia[R].x),Ma[R].y=2*(Ia[R+1].y-Ia[R].y);R=w(2,Ia,wb);Ma=w(1,Ma,wb);re[nf]=wb-((xb.x-vb.x)*R.x+(xb.y-vb.y)*R.y)/(R.x*R.x+R.y*R.y+(xb.x-vb.x)*Ma.x+(xb.y-vb.y)*Ma.y)}Z=Pa;D=v(b,d,e,Z,c,h);q=z(b,d,e,D,Z);E=q.Pq;q=q.Ur;if(E<n||S){a(3,D);return}X=Z}Z={x:0,y:0};C=u(b[q-1],b[q]);E=u(b[q],b[q+1]);Z.x=(C.x+E.x)/2;Z.y=(C.y+E.y)/2;C=Z=y(Z);L(b,d,q,c,C,n);C.x=-C.x;C.y=-C.y;L(b,q,e,C,h,n)}}}var S=!0;void 0===S&&(S=!1);var E=new K;E.moveTo(c[0].x,c[0].y);(function(a,b,d){var e=u(a[1],
a[0]);e=y(e);var c=b-1;c=u(a[c-1],a[c]);c=y(c);L(a,0,b-1,e,c,d)})(c,c.length,25);return E};function wd(c,a,b,d,e,f){var h=!1;c.save();switch(b){case 0:case 3:var k=a.height;var l=a.width;break;default:k=a.width,l=a.height}switch(b){case 2:h=!0}c.translate(a.x,a.y);c.fillStyle="rgba(0, 0, 0, 0.2)";c.fillStyle="#ccc";c.fillRect(0,0,a.width,a.height);c.lineWidth=1;c.fillStyle="black";c.strokeStyle="black";c.font="10px sans-serif";a=Math.ceil(50/e);b=f/e;var n=Math.ceil(b/a)*a;f=n;c.beginPath();if(h)for(b=(n-b)*e;b<l;)c.moveTo(0,b),c.lineTo(k,b),h=f.toString()+d,c.fillText(h,0,b+1+10),f+=a,
b+=e*a;else for(b=(n-b)*e;b<l;)c.moveTo(b,k),c.lineTo(b,0),h=f.toString()+d,c.fillText(h,b+1,10),f+=a,b+=e*a;c.stroke();c.restore()};var xd=function(c){function a(a,d,e){var b=c.call(this)||this;b.id=a;b.ee=d;b.ai=!0;b.width=32;b.height=500;b.zz=0;b.Ib=new H(0,0,0,0);b.Cb=!1;b.lt="#c0c0c0";b.up="#808080";b.borderWidth=1;b.Ge=0;b.Fe=100;b.uo=10;b.position=5;b.offset=0;b.log=x.create("SCROLLBAR",!0);b.ai=!0;b.canvas=uc(document.body);b.canvas.style.position="absolute";b.canvas.style.border="none";b.canvas.classList.add("zwibbler-scrollbar");b.canvas.classList.add("zwibbler-passthrough");b.sa=b.canvas.getContext("2d");e.addEventListener(b.canvas,
"mousedown",function(a){b.Ab(a)});e.addEventListener(document.body,"mousemove",function(a){b.pb(a)});e.addEventListener(document.body,"mouseup",function(a){b.Db(a)});e.addEventListener(b.canvas,"touchstart",function(a){b.hn(a)});e.addEventListener(document.body,"touchmove",function(a){b.hn(a)});e.addEventListener(document.body,"touchend",function(a){b.hn(a)});b.format();return b}__extends(a,c);a.prototype.Xc=function(a){a.appendChild(this.canvas)};a.prototype.moveTo=function(a,d){this.canvas.style.left=
""+a+"px";this.canvas.style.top=""+d+"px"};a.prototype.Xe=function(a,d){this.width=a;this.height=d;this.canvas.width=this.width;this.canvas.height=d;this.format();this.ia()};a.prototype.Oe=function(){this.canvas.style.display="none"};a.prototype.show=function(){this.canvas.style.display="block"};a.prototype.Vv=function(){return"block"===this.canvas.style.display};a.prototype.Rr=function(a,d,e,c){this.Ge=a;this.Fe=d-a;this.uo=e;this.position=c;this.format();this.ia()};a.prototype.format=function(){var a=
this.ee?this.width:this.height;var d=this.uo/this.Fe*a;a*=(this.position-this.Ge)/this.Fe;this.Ib=this.ee?new H(a,0,d-1,this.height-1):new H(0,a,this.width-1,d-1);this.Ib.x=Math.round(this.Ib.x)+.5;this.Ib.y=Math.round(this.Ib.y)+.5;this.Ib.width=Math.round(this.Ib.width);this.Ib.height=Math.round(this.Ib.height)};a.prototype.ia=function(){this.sa.beginPath();this.sa.fillStyle=this.lt;this.sa.strokeStyle=this.up;this.sa.lineWidth=this.borderWidth;this.sa.rect(this.borderWidth/2,this.borderWidth/2,
this.width-this.borderWidth,this.height-this.borderWidth);this.sa.fill();this.sa.stroke();this.sa.beginPath();this.sa.fillStyle=this.up;this.sa.strokeStyle="#000000";this.sa.rect(this.Ib.x,this.Ib.y,this.Ib.width,this.Ib.height);this.sa.fill();this.sa.stroke()};a.prototype.Tp=function(a){var b=B(this.canvas).Yb(),e=0,c=0;if("touchstart"===a.type||"touchend"===a.type||"touchmove"===a.type)e=a.changedTouches[0].pageX,c=a.changedTouches[0].pageY;else if("mousedown"===a.type||"mouseup"===a.type||"mousemove"===
a.type)e=a.pageX,c=a.pageY;return new G(e-b.left,c-b.top)};a.prototype.hn=function(a){switch(a.type){case "touchstart":this.Ab(a);break;case "touchend":this.Db(a);break;case "touchmove":this.pb(a)}};a.prototype.pr=function(a){a=this.ee?a.x/this.width*this.Fe+this.Ge:a.y/this.height*this.Fe+this.Ge;a=Math.min(a,this.Fe-this.uo+this.Ge);return a=Math.max(a,this.Ge)};a.prototype.Ab=function(a){a.preventDefault();a=this.Tp(a);this.Ib.gd(a.x,a.y)?this.ee?(this.offset=a.x-this.Ib.x,a.x-=this.offset):(this.offset=
a.y-this.Ib.y,a.y-=this.offset):(this.position=this.pr(a),this.offset=0,this.ee?this.Ib.x=(this.position-this.Ge)/this.Fe*this.width:this.Ib.y=(this.position-this.Ge)/this.Fe*this.height,this.na("scroll",this.position),this.ia());this.Cb=!0};a.prototype.pb=function(a){this.Cb&&(this.Cb&&"mousemove"===a.type&&0===a.buttons?this.Cb=!1:(a.preventDefault(),a=this.Tp(a),this.ee?a.x-=this.offset:a.y-=this.offset,this.position=this.pr(a),this.na("scroll",this.position),this.format(),this.ia()))};a.prototype.Db=
function(){this.Cb&&(this.Cb=!1)};a.prototype.vg=function(){return this.ee?this.height:this.width};a.iz=0;a.gz=1;a.cz=2;a.hz=3;return a}(bb);var yd={type:"translate",position:new G(0,0),offset:new G(0,0),Cf:""},zd={type:"translate",position:new G(0,0),offset:new G(0,0),Cf:""},Ad={type:"translate",position:new G(0,0),offset:new G(0,0),Cf:""},Bd=function(){function c(a,b,d){this.Ze=a;this.ra=b;this.Ga=d}c.prototype.Qj=function(a,b){void 0===a&&(a=this.ra);void 0===b&&(b=1);var d=a.$b();return new G(this.Ga.x+this.Ga.width*this.Ze.position.x+this.Ze.offset.x/d.x/b,this.Ga.y+this.Ga.height*this.Ze.position.y+this.Ze.offset.y/d.y/b)};c.prototype.Kj=
function(){var a=this.Qj();return this.ra.apply(a.x,a.y)};c.prototype.ia=function(a,b,d,e){a.save();e=e.multiply(this.ra);var c=e.$b();c.x=1/c.x/d;c.y=1/c.y/d;d=this.Qj(e,d);e=e.multiply(new Hc(c.x,c.y,d.x,d.y));e.ag(a);(b=b.get(this.Ze.Cf))?(e=b.width,c=b.height,a.drawImage(b,d.x-e/2,d.y-c/2,e,c)):this.hm(a,d);a.restore()};c.prototype.hm=function(a,b){a.strokeStyle="red";a.lineWidth=1;a.strokeRect(b.x-10,b.y-10,20,20)};c.prototype.xb=function(a,b,d,e,c){var f=a.get(this.Ze.Cf);a=this.Qj(this.ra,
c);b=this.ra.inverse().apply(b,d);d=this.ra.$b();d.x*=c;d.y*=c;f?(e=f.height,c=f.width/2/d.x,e=e/2/d.y):(c=e/d.x,e/=d.y);return(new H(a.x-c,a.y-e,2*c,2*e)).gd(b.x,b.y,0)};c.prototype.click=function(){return!1};return c}(),Cd=function(c){function a(a,d,e,f){a=c.call(this,a,d,e)||this;a.origin=f;return a}__extends(a,c);a.prototype.xg=function(a){var b=1,e=1,c=this.ra.inverse(),h=this.Kj(),k=this.Qj();a=c.apply(h.x+a.x,h.y+a.y);k=new G(k.x-this.origin.x,k.y-this.origin.y);a=new G(a.x-this.origin.x,a.y-
this.origin.y);a=(a.x*k.x+a.y*k.y)/(k.x*k.x+k.y*k.y);0!==k.x&&0!==k.y?e=b=a:0!==k.x?b=a:e=a;return this.ra.multiply(new Hc(b,e,this.origin.x,this.origin.y)).multiply(c)};a.prototype.hm=function(a,d){a.beginPath();a.strokeStyle="#000";a.lineWidth=1;a.rect(d.x-4,d.y-4,8,8);a.stroke()};return a}(Bd),Dd=function(c){function a(a,d,e,f,h){a=c.call(this,a,d,e)||this;a.cj=h;a.log=x.create("RotationSelHandle");d=a.Kj();a.origin=a.ra.apply(f.x,f.y);a.Sn=Math.atan2(d.y-a.origin.y,d.x-a.origin.x);a.cj=h;return a}
__extends(a,c);a.prototype.xg=function(a){var b=this.Kj();a=Math.atan2(b.y+a.y-this.origin.y,b.x+a.x-this.origin.x)-this.Sn;this.cj&&(b=Math.PI/16,a=Math.floor(a/b)*b);return new Gc(-a,this.origin.x,this.origin.y)};a.prototype.hm=function(a,d){a.beginPath();a.strokeStyle="#008000";a.lineWidth=3;a.moveTo(d.x,d.y);a.arc(d.x,d.y,6,0,1.5*Math.PI,!1);a.stroke()};return a}(Bd),Ed=function(c){function a(a,d){return c.call(this,a,d,new H(0,0,0,0))||this}__extends(a,c);a.prototype.xg=function(a){return new Fc(a.x,
a.y)};return a}(Bd),Fd=function(c){function a(){return c.call(this,Ad,new J,new H(0,0,0,0))||this}__extends(a,c);a.prototype.xg=function(){return new J};return a}(Bd),Gd=function(c){function a(a,d,e){return c.call(this,a,d,e)||this}__extends(a,c);a.prototype.click=function(){this.Ze.yp&&this.Ze.yp();return!0};a.prototype.xg=function(){return new J};return a}(Bd);
function Hd(c,a,b,d){var e=void 0,f=new G(0,0),h=b.$b();f.x=a.x+a.width*c.position.x+c.offset.x/h.x;f.y=a.y+a.height*c.position.y+c.offset.y/h.y;switch(c.type){case "translate":return new Ed(c,b);case "scale":return e||(e=new G(a.right()-c.position.x*a.width,a.bottom()-c.position.y*a.height)),new Cd(c,b,a,e);case "rotate":return e||(e=a.vd()),new Dd(c,b,a,e,d||!1);case "click":return new Gd(c,b,a)}};var Id=x.create("SNAPPER");function Jd(c){switch(c){case 33:return"n-resize";case 34:return"e-resize";case 36:return"s-resize";case 40:return"w-resize";case 25:return"nw-resize";case 19:return"ne-resize";case 28:return"sw-resize";case 22:return"se-resize";case 1:case 4:case 8:case 2:return"move"}return"default"}function Kd(c,a){return{id:c,jc:2,x:a.x+a.width,hc:a.y,ic:a.y+a.height}}function Ld(c,a){return{id:c,jc:4,x:a.y+a.height,hc:a.x,ic:a.x+a.width}}
var Md=function(){function c(){this.Bf=[];this.Zg=[]}c.prototype.clear=function(){this.Bf.length=0;this.Zg.length=0};c.prototype.jp=function(a,b){this.Bf.push({id:b,jc:1,x:a.y,hc:a.x,ic:a.x+a.width});this.Bf.push(Ld(b,a));this.Zg.push({id:b,jc:8,x:a.x,hc:a.y,ic:a.y+a.height});this.Zg.push(Kd(b,a))};c.prototype.oy=function(a,b){var d=8;void 0===d&&(d=10);var e=this.Wi(this.Zg,{id:b,jc:8,x:a.x,hc:a.y,ic:a.y+a.height},Number.MAX_VALUE);e=this.Wi(this.Zg,Kd(b,a),e);var c=this.Wi(this.Bf,{id:b,jc:1,x:a.y,
hc:a.x,ic:a.x+a.width},Number.MAX_VALUE);c=this.Wi(this.Bf,Ld(b,a),c);return{x:Math.abs(e)<d?e:0,y:Math.abs(c)<d?c:0}};c.prototype.Dm=function(a,b){var d=10;void 0===d&&(d=10);var e=[];this.$r(e,this.Zg,a,b,d);this.$r(e,this.Bf,b,a,d);e.reverse();return e};c.prototype.$r=function(a,b,d,e,c){for(var f=c*c,k=0;k<b.length;k++){var l=b[k],n=Math.abs(d-l.x),q=Number.MAX_VALUE,u=0;if(!(n>c||e<l.hc-c||e>l.ic+c)){if(e>l.hc+c&&e<l.ic-c){var v=n*n;v<q&&(q=v,u=l.jc)}v=.5*(l.hc+l.ic);v=n*n+(e-v)*(e-v);v<f&&(q=
v,u=l.jc|32);b===this.Bf&&(v=n*n+(e-l.hc)*(e-l.hc),v<q&&(q=v,u=l.jc|24),v=n*n+(e-l.ic)*(e-l.ic),v<q&&(q=v,u=l.jc|18));q<f&&a.push({id:l.id,jc:u})}}};c.prototype.Wi=function(a,b,d){for(var e=0;e<a.length;e++){var c=a[e],h=c.x-b.x;Math.abs(h)>Math.abs(d)||b.id===c.id||50>(b.ic<c.hc?c.hc-b.ic:b.hc>c.ic?b.hc-c.ic:0)&&(d=h)}return d};return c}();var Nd="ontouchstart"in window,Od="onpointerdown"in window,Pd={touchstart:"down",touchmove:"move",touchend:"up",touchcancel:"up",pointerdown:"down",pointermove:"move",pointerup:"up",mousedown:"down",mousemove:"move",mouseup:"up",pointercancel:"up",wheel:"wheel"},Qd=[],Rd=function(c){function a(a,d,e,f,h,k,l,n,q,u,v,w,y,z,L,S,E,D){void 0===E&&(E=Qd);void 0===D&&(D=0);k=c.call(this,a,d,e,k,n,q)||this;k.type=a;k.pageX=d;k.pageY=e;k.Fb=f;k.Gb=h;k.startTime=l;k.pointerId=u;k.data=v;k.index=w;k.Ps=y;k.buttons=
z;k.ctrlKey=L;k.shiftKey=S;k.la=E;k.angle=D;k.scale=0;k.rotation=0;return k}__extends(a,c);a.prototype.clone=function(){return new a(this.type,this.pageX,this.pageY,this.Fb,this.Gb,this.timestamp,this.startTime,this.target,this.oc,this.pointerId,this.data,this.index,this.Ps,this.buttons,this.ctrlKey,this.shiftKey,this.la,this.angle)};a.prototype.Kj=function(){return this.offset({x:this.pageX,y:this.pageY},void 0)};a.prototype.Aj=function(){return this.timestamp-this.startTime};a.prototype.Hh=function(){return Dc(this.pageX,
this.pageY,this.Fb,this.Gb)};a.prototype.toString=function(){var a=c.prototype.toString.call(this)+(" "+this.Aj()+"ms "+Math.round(this.Hh())+"px");0!=this.scale&&(a+=" scale="+Math.round(100*(this.scale||0))/100,a+=" "+Math.round(this.rotation||0)+"deg");return a};a.prototype.setData=function(a,d){this.data[a]=d};a.prototype.getData=function(a){return this.data[a]};a.prototype.Tu=function(){var a={x:0,y:0,z:0};if("wheel"===this.oc.type){var d=this.oc;a.x=d.deltaX;a.y=d.deltaY;a.x=d.deltaZ}return a};
return a}(function(){function c(a,b,d,e,c,h){this.type=a;this.pageX=b;this.pageY=d;this.timestamp=e;this.target=c;this.oc=h}c.prototype.toString=function(){return"["+this.type+" ("+this.oc.type+")] ("+this.pageX+","+this.pageY+")"};c.prototype.offset=function(a,b){var d=B(b).Yb();return{x:a.x-d.left,y:a.y-d.top}};c.prototype.stopPropagation=function(){this.oc.stopPropagation()};c.prototype.preventDefault=function(){this.oc.preventDefault()};return c}()),Sd=x.create("TouchListener"),Yd=function(c){function a(a,
d){function b(a){f.handleEvent(a)}void 0===d&&(d={});var f=c.call(this)||this;f.fa=a;f.options=d;f.Ed=[];f.qf=[];f.active=[];f.wq={};f.ai=!0;Nd?(f.Za(a,"touchstart",b),f.Za(document,"touchmove",b),f.Za(document,"touchend",b),f.Za(document,"touchcancel",b)):Od&&!1!==d.mp&&(f.Za(a,"pointerdown",b),f.Za(document,"pointermove",b),f.Za(document,"pointerup",b),f.Za(document,"pointercancel",b));Od&&!1!==d.mp||(f.Za(a,"mousedown",b),f.Za(document,"mousemove",b),f.Za(document,"mouseup",b));f.Za(a,"wheel",
b);return f}__extends(a,c);a.prototype.Za=function(a,d,e){this.Ed.push({element:a,event:d,fn:e});"touchmove"===d?a.addEventListener(d,e,{passive:!1,capture:!0===this.options.oo}):a.addEventListener(d,e,!0===this.options.oo)};a.prototype.pa=function(a,d){for(var b=0,f=a.split(" ");b<f.length;b++){var h=f[b],k="";switch(h){case "gesturestart":case "gesturechange":case "gestureend":k="gesture";break;case "tap":case "doubletap":k="tap";break;case "swipe":k="swipe";break;case "hold":k="hold";break;case "drag":k=
"drag"}if(""!==k&&!this.wq[k]){switch(k){case "gesture":this.qf.push(new Td(this));break;case "tap":this.qf.push(new Ud(this));break;case "swipe":this.qf.push(new Vd(this));break;case "hold":this.qf.push(new Wd(this));break;case "drag":this.qf.push(new Xd(this))}this.wq[k]=!0;Sd("Created new detector "+k+" to handle "+h)}}c.prototype.pa.call(this,a,d)};a.prototype.na=function(a,d){c.prototype.jd.call(this,a,d)};a.prototype.Xa=function(){for(var a=0,d=this.Ed;a<d.length;a++){var e=d[a];e.element.removeEventListener(e.event,
e.fn,!0===this.options.oo)}a=0;for(d=this.qf;a<d.length;a++)e=d[a],e.Xa&&e.Xa();this.Ed.length=0;this.qf.length=0;this.active.length=0;this.Ya={}};a.prototype.handleEvent=function(a){var b=Pd[a.type],e=(new Date).getTime();switch(a.type){case "touchstart":case "touchend":a.target===this.fa&&a.preventDefault();case "touchmove":case "touchcancel":for(var c=0;c<a.changedTouches.length;c++){var h=a.changedTouches[c];this.Vj(a,b,h.identifier,h.pageX,h.pageY,e)}break;case "pointerdown":case "pointerup":case "pointermove":case "pointercancel":this.Vj(a,
b,a.pointerId,a.pageX,a.pageY,e);if("pointercancel"===a.type)for(c=this.active.length-1;0<=c;c--)this.Vj(a,b,this.active[c].id,a.pageX,a.pageY,e);break;case "mousedown":case "mousemove":case "mouseup":case "wheel":this.Vj(a,b,0,a.pageX,a.pageY,e)}};a.prototype.Vj=function(a,d,e,c,h,k){var b=null;switch(d){case "down":b=this.$s(e,c,h,k);d=new Rd("down",c,h,c,h,k,k,a.target,a,e,b.data,b.index,this.active.length,a.buttons,a.ctrlKey,a.shiftKey);break;case "move":b=this.wu(e);d=new Rd("move",c,h,b?b.Fb:
c,b?b.Gb:h,k,b?b.gc:k,a.target,a,e,b?b.data:{},b?b.index:-1,this.active.length,a.buttons,a.ctrlKey,a.shiftKey);break;case "up":b=this.rx(e);d=new Rd("up",c,h,b?b.Fb:c,b?b.Gb:h,k,b?b.gc:k,a.target,a,e,b?b.data:{},b?b.index:-1,this.active.length,a.buttons,a.ctrlKey,a.shiftKey);break;case "wheel":d=new Rd(d,c,h,c,h,k,k,a.target,a,e,{},-1,this.active.length,a.buttons,a.ctrlKey,a.shiftKey);break;default:return}null!==b&&(b.tf=c,b.uf=h);(b||this.fa.contains(a.target))&&this.na(d.type,d)};a.prototype.wu=
function(a){for(var b=0,e=this.active;b<e.length;b++){var c=e[b];if(c.id===a)return c}return null};a.prototype.$s=function(a,d,e,c){for(var b=0;b<this.active.length;b++){var f=this.active[b];if(f.id===a)return f.Fb=f.tf=d,f.Gb=f.uf=e,f.gc=c,f.la=[new G(d,e)],f}this.active.push({index:this.active.length,id:a,gc:c,Fb:d,Gb:e,tf:d,uf:e,la:[new G(d,e)],data:{}});return this.active[this.active.length-1]};a.prototype.rx=function(a){for(var b=0;b<this.active.length;b++)if(this.active[b].id===a)return a=this.active[b],
this.active.splice(b,1),a;return null};return a}(bb);
function Ud(c){var a=[];c.pa("up",function(b){Sd("Duration: %s distance: %s",b.Aj(),b.Hh());if(200>b.Aj()&&20>b.Hh()){var d=b.clone();d.type="tap";c.na("tap",d);a:{for(d=0;d<a.length;d++){var e=a[d];if(300>b.timestamp-e.gc&&20>Dc(b.pageX,b.pageY,e.x,e.y)){e.x=b.pageX;e.y=b.pageY;e.gc=b.timestamp;d=!0;break a}}4===a.length&&a.splice(0,1);a.push({x:b.pageX,y:b.pageY,id:b.pointerId,gc:b.timestamp});d=!1}d&&(d=b.clone(),d.type="doubletap",c.na("doubletap",d))}})}
function Xd(c){var a=-1,b=-1;c.pa("move",function(d){a!==d.Fb&&b!==d.Gb&&8<d.Hh()&&(a=d.Fb,b=d.Gb,d=d.clone(),d.type="drag",c.na("drag",d))})}
function Td(c){function a(){for(var a=0,b=0,d=0;d<e.length;d++)Sd("Active touch: id:%s %s,%s",e[d].id,e[d].tf,e[d].uf),a+=e[d].tf,b+=e[d].uf;return{x:a/e.length,y:b/e.length}}function b(a,b){for(var d=0,c=0;c<e.length;c++){var f=e[c];d+=Math.sqrt((f.tf-a)*(f.tf-a)+(f.uf-b)*(f.uf-b))}return d/e.length}function d(a,b,d,e,f){a=a.clone();a.type=b;a.pageX=d.x;a.pageY=d.y;a.scale=e;a.rotation=f;c.na(a.type,a)}var e=[],f=!1,h=0,k=1,l=1,n={x:0,y:0};c.pa("down move up",function(q){e=c.active;switch(q.type){case "down":2<=
e.length&&!f&&(f=!0,n=a(),l=b(n.x,n.y),k=1,h=0,d(q,"gesturestart",n,k,h));break;case "move":if(2<=e.length&&f){n=a();k=b(n.x,n.y)/l;for(var u=n.x,v=n.y,w=0,y=0;y<e.length;y++){var z=Math.atan2(e[y].uf-v,e[y].tf-u)-Math.atan2(e[y].Gb-v,e[y].Fb-u);z>Math.PI?z-=2*Math.PI:z<=-Math.PI&&(z+=2*Math.PI);w+=z}h=w/e.length/Math.PI*180;d(q,"gesturechange",n,k,h)}break;case "up":f&&2>e.length&&(f=!1,d(q,"gestureend",n,k,h))}})}
function Vd(c){c.pa("up",function(a){var b=a.la;if(!(200>a.Hh()||1E3<a.Aj()||2>b.length)){for(var d=b[0],e=b[b.length-1],f=1;f<b.length-1;f++)if(40<b[f].Jp(d,e))return!1;b=Math.atan2(e.y-d.y,e.x-d.x);Sd("Swipe angle %s",Math.round(b/Math.PI*180));a=a.clone();a.type="swipe";a.angle=b;c.na("swipe",a)}})}function Zd(c){this.Tw=c;this.time=(new Date).getTime();this.timeout=0}
var Wd=function(){function c(a){function b(a){var b=d.Ue[a];b&&(Sd("Remove pointer %s",a),clearTimeout(b.timeout),delete d.Ue[a])}var d=this;this.Ue={};a.pa("down",function(e){b(e.pointerId);d.Ue[e.pointerId]=new Zd(new G(e.pageX,e.pageY));d.Ue[e.pointerId].timeout=setTimeout(function(){var b=e.clone();b.type="hold";b.timestamp=(new Date).getTime();a.na("hold",b)},1E3)});a.pa("move",function(a){var e=a.pointerId;if(e in d.Ue){var c=d.Ue[e];20<(new G(a.pageX,a.pageY)).Lb(c.Tw)&&b(e)}});a.pa("up",function(a){b(a.pointerId)})}
c.prototype.Xa=function(){for(var a in this.Ue)clearTimeout(this.Ue[a].timeout)};return c}();var $d=function(){function c(a,b,d,e){this.view=a;this.Ig=b;this.Ca=this.Ba=0;this.Cb=!1;this.log=x.create("SELECT");this.ar(d,e)}c.prototype.kb=function(a){this.log("Gesture detected; aborting select box.");this.view.Qa(this.Ig);return this.Ig.kb?this.Ig.kb(a):!1};c.prototype.mc=function(){this.view.Rl("select")};c.prototype.Ab=function(a,b){return this.ar(a,b)};c.prototype.ar=function(a,b){this.Ba=a;this.Ca=b;return this.Cb=!0};c.prototype.pb=function(a,b){if(this.Cb){var d=this;this.view.vr("select",
function(e){e.save();e.strokeStyle="#0050B7";e.lineWidth=2/d.view.scale;e.fillStyle="rgba(0, 80, 183, 0.2)";var c=new H(d.Ba+.5,d.Ca+.5,a-d.Ba,b-d.Ca);e.fillRect(c.x,c.y,c.width,c.height);e.strokeRect(c.x,c.y,c.width,c.height);e.restore()});return!0}return!1};c.prototype.Db=function(a,b){this.Cb=!1;this.view.eb();this.view.Dx(new H(this.Ba,this.Ca,a-this.Ba,b-this.Ca));this.view.Vb();this.view.Qa(this.Ig);return!0};return c}();var ae=function(){function c(a,b,d){this.view=a;this.ba=b;this.rw=d;this.state="none";this.scale=1;this.log=x.create("ImageStamp");this.Na=document.createElement("img");this.url=this.Na.src=b.url;"scale"in this.ba&&(this.scale=this.ba.scale,delete this.ba.scale)}c.prototype.ld=function(){return"imagestamp"};c.prototype.Kc=function(){this.log("Entering ImageStampBehaviour");this.view.fc("move")};c.prototype.mc=function(){this.log("Leaving ImageStampBehaviour");this.view.ia()};c.prototype.Ra=function(a,
b){this.Na.complete&&(a-=this.Na.width/2,b-=this.Na.height/2);return this.view.Ra(new G(a,b))};c.prototype.Ab=function(a,b,d){var e=this;this.log("onMouseDown type %s",d.type);var c=this.Ra(a,b);this.view.aa.transaction(function(){e.view.aa.createNode("ImageNode",zc({},e.ba,{url:e.url,layer:e.view.Ua,matrix:(new Fc(c.x,c.y)).multiply(new Hc(e.scale,e.scale))}))});this.rw||(this.log("MultiStamp not set; return to pick mode."),this.view.ib());return!0};c.prototype.pb=function(a,b){this.Na.complete||
this.log("Don't draw; image not loaded.");var d=this.Ra(a,b),e=this;this.view.ia(function(a){var b=a.globalAlpha;a.globalAlpha=.5;a.drawImage(e.Na,d.x,d.y,e.Na.naturalWidth*e.scale,e.Na.naturalHeight*e.scale);a.globalAlpha=b});return!0};c.prototype.Db=function(){return!0};c.prototype.od=function(a){"cancel"===a&&(this.view.ib(),this.view.kc.na("goto-toolbar"))};return c}();var be=function(){function c(a){this.view=a;this.start=new G(0,0);this.Tn=new G(0,0);this.active=!1;this.rect=null;this.log=x.create("PanZoomMixin")}c.prototype.kb=function(a){this.log("onGesture(%s)",a.type);if(!this.view.ga.get("allowZoom"))return!1;if("gesturestart"===a.type)this.start=new G(a.pageX,a.pageY),this.Tn=this.view.Jd(a.pageX,a.pageY),this.rect=this.view.Af(),this.active=!0;else if("gesturechange"===a.type&&this.rect){var b=a.pageX-this.start.x,d=a.pageY-this.start.y;a=this.view.li(1/
a.scale);a=new Hc(a,a,this.Tn.x,this.Tn.y);a=(new Fc(-b/this.view.scale,-d/this.view.scale)).multiply(a);b=this.rect.clone();b.transform(a);this.view.Tg(b)}else"gestureend"===a.type&&(this.active=!1);return!0};return c}();var ce=function(){function c(a){this.view=a;this.state="none";this.start=new G(0,0);this.Zr=this.Yr=0;this.log=x.create("PanTool");this.pc=new be(a)}c.prototype.Kc=function(){this.log("Entering PanToolBehaviour");this.view.fc("all-scroll")};c.prototype.mc=function(){this.log("Leaving PanToolBehaviour")};c.prototype.kb=function(a){return this.pc.kb(a)};c.prototype.qq=function(a){return new G(a.pageX,a.pageY)};c.prototype.Ab=function(a,b,d){this.log("onMouseDown type %s",d.type);this.state="dragging";
this.start=this.qq(d);this.Yr=this.view.mb;this.Zr=this.view.cb;return!0};c.prototype.pb=function(a,b,d){if("dragging"!==this.state)return!1;a=this.qq(d);b=this.Zr+a.y-this.start.y;this.view.mb=this.Yr+a.x-this.start.x;this.view.cb=b;this.view.Gc();this.view.ia();return!0};c.prototype.Db=function(){this.state="none";return!0};c.prototype.gn=function(a,b,d,e){if(!this.view.ga.get("allowZoom"))return this.log("Zooming is disabled."),!1;this.log("onMouseWheel(%s, %s, %s)",a,b,d);d=0<d?1/1.1:1.1;a=new Hc(d,
d,a,b);b=this.view.Af();b.transform(a);this.view.Tg(b);e.stopPropagation();e.preventDefault();return!0};c.prototype.od=function(a){"cancel"===a&&this.view.ib()};c.prototype.ld=function(){return"pan"};return c}();var de=function(){function c(a,b){void 0===b&&(b="repeat");this.Na=a;this.repeat=b}c.prototype.loaded=function(){return this.Na instanceof HTMLImageElement?this.Na.complete:!0};c.prototype.setTransform=function(){};return c}(),ee=function(){function c(a,b,d,e){this.ry=[];this.from=new G(a,b);this.ha=new G(d,e)}c.prototype.addColorStop=function(a,b){this.ry.push({offset:a,mf:b})};return c}(),ge=function(){function c(){this.stack=[];this.ra=new J;this.lineCap="butt";this.lineJoin="miter";this.lineWidth=
1;this.strokeStyle=this.fillStyle="#000000";this.textBaseline="top";this.font="10px arial";this.globalCompositeOperation="source-over";this.globalAlpha=1;this.shadowBlur=this.shadowOffsetY=this.shadowOffsetX=0;this.shadowColor="rgba(0,0,0,0)"}c.prototype.save=function(){this.stack.push({ra:this.ra.clone(),fillStyle:this.fillStyle,font:this.font,lineJoin:this.lineJoin,lineCap:this.lineCap,lineWidth:this.lineWidth,strokeStyle:this.strokeStyle,textBaseline:this.textBaseline,globalCompositeOperation:this.globalCompositeOperation,
globalAlpha:this.globalAlpha,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,lf:this.xl()})};c.prototype.restore=function(){var a=this.stack.pop();a&&(this.ra=a.ra,this.fillStyle=a.fillStyle,this.font=a.font,this.lineJoin=a.lineJoin,this.lineCap=a.lineCap,this.lineWidth=a.lineWidth,this.ra=a.ra,this.strokeStyle=a.strokeStyle,this.textBaseline=a.textBaseline,this.globalCompositeOperation=a.globalCompositeOperation,this.globalAlpha=
a.globalAlpha,this.shadowOffsetX=a.shadowOffsetX,this.shadowOffsetY=a.shadowOffsetY,this.shadowBlur=a.shadowBlur,this.shadowColor=a.shadowColor,this.Al(a.lf))};c.prototype.drawImage=function(a,b,d,e,c,h,k,l,n){var f=a.width,u=a.height,v=0,w=f,y=u;void 0!==e&&void 0!==c&&void 0!==h&&void 0!==k&&void 0!==l&&void 0!==n?(v=b,0-d,w=e,y=c,b=h,d=k,f=l,u=n):void 0!==e&&void 0!==c&&(f=e,u=c);this.ul(a,v,0,w,y,b,d,f,u)};c.prototype.beginPath=function(){};c.prototype.closePath=function(){};c.prototype.arc=function(a,
b,d,e,c,h){h&&(h=e,e=c,c=h);for(;0>e;)e+=2*Math.PI;for(;0>c;)c+=2*Math.PI;e>c&&(e-=2*Math.PI);var f=2*Math.PI;var l=e%f;var n=c%f;n===l&&(n+=2*Math.PI);c=[];e=Math.PI/2;h=l<n?1:-1;var q=l;for(f=Math.min(f,Math.abs(n-l));1E-5<f;){l=q+h*Math.min(f,e);var u=(l-q)/2,v=d*Math.cos(u),w=d*Math.sin(u),y=.5522847498*Math.tan(u);n=v+y*w;v=-w+y*v;w=-v;y=u+q;u=Math.cos(y);y=Math.sin(y);c.push({Wy:d*Math.cos(q),hc:d*Math.sin(q),Xy:n*u-v*y,ic:n*y+v*u,Yy:n*u-w*y,$y:n*y+w*u,Zy:d*Math.cos(l),az:d*Math.sin(l)});f-=
Math.abs(l-q);q=l}for(d=0;d<c.length;d++)e=c[d],0===d&&this.moveTo(e.Wy+a,e.hc+b),this.bezierCurveTo(e.Xy+a,e.ic+b,e.Yy+a,e.$y+b,e.Zy+a,e.az+b)};c.prototype.arcTo=function(){};c.prototype.strokeRect=function(a,b,d,e){this.beginPath();this.rect(a,b,d,e);this.stroke()};c.prototype.setTransform=function(a,b,d,e,c,h){this.ra=new J(a,d,b,e,c,h)};c.prototype.transform=function(a,b,d,e,c,h){a=new J(a,d,b,e,c,h);this.ra=this.ra.multiply(a)};c.prototype.translate=function(a,b){this.transform(1,0,0,1,a,b)};
c.prototype.scale=function(a,b){this.transform(a,0,0,b,0,0)};c.prototype.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);this.transform(b,a,-a,b,0,0)};c.prototype.rect=function(a,b,d,e){this.beginPath();this.moveTo(a,b);this.lineTo(a+d,b);this.lineTo(a+d,b+e);this.lineTo(a,b+e);this.lineTo(a,b);this.closePath()};c.prototype.fillRect=function(a,b,d,e){this.rect(a,b,d,e);this.fill()};c.prototype.gf=function(a){return fe(a)};c.prototype.createPattern=function(a,b){return new de(a,b)};c.prototype.createLinearGradient=
function(a,b,d,e){return new ee(a,b,d,e)};return c}(),he=function(){function c(a){this.fontFamily="";this.fontSize=10;this.lineHeight=this.fontVariant=this.fontWeight=this.fontStyle="normal";a=fe(a);this.fontFamily=a.fontFamily||"Arial";this.fontSize=parseFloat(a.fontSize);this.fontStyle=a.fontStyle;this.fontWeight=a.fontWeight;this.fontVariant=a.fontVariant;this.lineHeight=a.lineHeight}c.prototype.toString=function(){var a=this.fontSize+'px "'+this.fontFamily+'"';"bold"===this.fontWeight&&(a="bold "+
a);"italic"===this.fontStyle&&(a="italic"+a);return a};return c}();
function fe(c){var a=null,b="10",d="normal",e="normal",f="normal",h="normal",k=!1;c=c.split(/\s+/);a:for(;;){var l=c.shift();if(!l)break;switch(l){case "normal":break;case "italic":case "oblique":d=l;break;case "small-caps":f=l;break;case "bold":case "bolder":case "lighter":case "100":case "200":case "300":case "400":case "500":case "600":case "700":case "800":case "900":e=l;break;default:if(k){a=l;c.length&&(a+=" "+c.join(" "));2<a.length&&('"'===a.charAt(0)||"'"===a.charAt(0))&&(a=a.substr(1,a.length-
2));break a}else l=l.split("/"),b=l[0],k=!0,1<l.length&&(h=l[1])}}return{fontStyle:d,fontVariant:f,fontWeight:e,fontSize:b,lineHeight:h,fontFamily:a}};var ie=function(){function c(){this.da=[]}c.prototype.lineTo=function(a,b,d){a.apply(b,d);this.da.push({rh:"L",Gg:a.apply(b,d)})};c.prototype.moveTo=function(a,b,d){a.apply(b,d);this.da.push({rh:"M",Gg:a.apply(b,d)})};c.prototype.quadraticCurveTo=function(a,b,d,e,c){this.da.push({rh:"Q",Gg:a.apply(b,d),Bk:a.apply(e,c)})};c.prototype.bezierCurveTo=function(a,b,d,e,c,h,k){this.da.push({rh:"C",Gg:a.apply(b,d),Bk:a.apply(e,c),ln:a.apply(h,k)})};c.prototype.closePath=function(){this.da.push({rh:"Z"})};
c.prototype.eo=function(a){a=a.inverse();for(var b="",d=0;d<this.da.length;d++){var e=this.da[d];0<d&&(b+=" ");b+=e.rh;if(e.Gg){var c=a.apply(e.Gg.x,e.Gg.y);b+=c.x+","+c.y;e.Bk&&(c=a.apply(e.Bk.x,e.Bk.y),b+=","+c.x+","+c.y,e.ln&&(e=a.apply(e.ln.x,e.ln.y),b+=","+e.x+","+e.y))}}return b};return c}(),je=function(c){function a(a){var b=c.call(this)||this;b.ra=new J;b.da=[];b.path=new ie;b.lf="";b.nc=[];b.Pb=0;b.log=x.create("SvgContext");b.eh=1;b.eg=2;b.rl=4;b.log("SVG context rect: %s",a);b.root=new Ca("svg",
{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:zwibbler":"http://zwibbler.com/xml",version:1.2,baseProfile:"tiny",width:a.width,height:a.height,viewBox:a.x+" "+a.y+" "+a.width+" "+a.height});b.jj=new Ca("defs",{});b.root.Vd(b.jj);b.Tj=[b.root];return b}__extends(a,c);a.prototype.fw=function(){return"clip"+this.Pb++};a.prototype.ii=function(a){a=new Ca("g",a||{});this.Yl().Vd(a);this.Tj.push(a)};a.prototype.hi=function(){var a=this.Tj.pop();if(a&&1===a.children.length){var d=
a.children[0];d.pi(a.attributes);a.name=d.name;a.attributes=d.attributes;a.children=d.children;a.text=d.text}};a.prototype.Yl=function(){return this.Tj[this.Tj.length-1]};a.prototype.node=function(a,d,e,c){function b(a,b){if(b instanceof de)e[a]="url(#"+f.gl(b)+")";else if("string"===typeof b){var d=r.Zd(b),c=d.values[3];1>c&&(d.values[3]=1,e[a+"-opacity"]=""+c);e[a]=d.toString()}}void 0===e&&(e={});var f=this;this.ra.Fq()||(e.transform="matrix("+this.ra.m11+" "+this.ra.m21+" "+this.ra.m12+" "+this.ra.m22+
" "+this.ra.Ba+" "+this.ra.Ca+")");d&this.eh?b("fill",this.fillStyle):e.fill="none";d&this.eg&&(b("stroke",this.strokeStyle),e["stroke-width"]=this.lineWidth,"miter"!==this.lineJoin&&(e["stroke-linejoin"]=this.lineJoin),"butt"!==this.lineCap&&(e["stroke-linecap"]=this.lineCap));d&this.rl&&(d=this.gf(this.font),e["font-weight"]=d.fontWeight,e["font-size"]=parseFloat(d.fontSize),e["font-style"]=d.fontStyle,e["font-family"]=d.fontFamily);""!==this.lf&&(e["clip-path"]="url(#"+this.lf+")");this.Vs(new Ca(a,
e,c))};a.prototype.Vs=function(a){var b=!0,e=null,c={},h,k=this.Yl();0===k.children.length?b=!1:e=k.children[k.children.length-1];!e||a.name===e.name&&a.text===e.text||(b=!1);if(b&&e)for(h in e.attributes)if(e.attributes.hasOwnProperty(h))if(h in a.attributes){var l=e.attributes[h],n=a.attributes[h];if(l!==n)if(0===h.indexOf("fill")||0===h.indexOf("stroke"))if("none"===l)c[h]=n;else if("none"===n)c[h]=l;else{b=!1;break}else{b=!1;break}}else c[h]=e.attributes[h];if(b&&e)for(h in a.attributes)a.attributes.hasOwnProperty(h)&&
(h in e.attributes||(c[h]=a.attributes[h]));b&&e?e.pi(c):k.Vd(a)};a.prototype.gk=function(a){if(a===this.eg){if(0===this.lineWidth)return!1;a=this.strokeStyle}else a=this.fillStyle;return a instanceof de?!0:"string"===typeof a?0<r.Zd(a).values[3]:!1};a.prototype.Xo=function(a){for(var b=0;b<this.nc.length;b++)if(this.nc[b].Qh===a)return this.nc[b].ei;return null};a.prototype.fl=function(a){var b=this.Xo(a);if(b)return b;b="image"+this.nc.length;this.nc.push({Qh:a,ei:b});var e=document.createElement("canvas"),
c=e.getContext("2d");e.width=a.width;e.height=a.height;c.drawImage(a,0,0);e=e.toDataURL();a=new Ca("image",{id:b,x:0,y:0,width:a.width,height:a.height,"xlink:href":e});this.jj.Vd(a);return b};a.prototype.gl=function(a){var b=this.Xo(a);if(b)return b;var e=this.fl(a.Na);b="pattern"+this.nc.length;this.nc.push({Qh:a,ei:b});var c=new Ca("pattern",{id:b});"no-repeat"===a.repeat?(c.attributes.width="1",c.attributes.height="1"):"repeat-x"===a.repeat?(c.attributes.patternUnits="userSpaceOnUse",c.attributes.width=
a.Na.width,c.attributes.height=1E4):("repeat-y"===a.repeat?(c.attributes.patternUnits="userSpaceOnUse",c.attributes.width=1E4):(c.attributes.patternUnits="userSpaceOnUse",c.attributes.width=a.Na.width),c.attributes.height=a.Na.height);c.Vd(new Ca("use",{"xlink:href":"#"+e}));this.jj.Vd(c);return b};a.prototype.toString=function(){return'<?xml version="1.0" encoding="UTF-8"?>\n'+this.root.toString()};a.prototype.toBlob=function(){for(var a=this.toString(),d=new Uint8Array(a.length),e=0;e<a.length;e++)d[e]=
a.charCodeAt(e);return new Blob([d],{type:"image/svg+xml"})};a.prototype.beginPath=function(){this.path=new ie};a.prototype.transform=function(a,d,e,c,h,k){a=new J(a,e,d,c,h,k);this.ra=this.ra.multiply(a)};a.prototype.closePath=function(){this.path.closePath()};a.prototype.fill=function(){this.gk(this.eh)&&this.node("path",this.eh,{d:this.path.eo(this.ra)})};a.prototype.stroke=function(){this.gk(this.eg)&&this.node("path",this.eg,{d:this.path.eo(this.ra)})};a.prototype.moveTo=function(a,d){this.path.moveTo(this.ra,
a,d)};a.prototype.lineTo=function(a,d){this.path.lineTo(this.ra,a,d)};a.prototype.quadraticCurveTo=function(a,d,e,c){this.path.quadraticCurveTo(this.ra,a,d,e,c)};a.prototype.bezierCurveTo=function(a,d,e,c,h,k){this.path.bezierCurveTo(this.ra,a,d,e,c,h,k)};a.prototype.fillText=function(a,d,e){this.gk(this.eh)&&(this.gf(this.font),this.node("text",this.eh|this.rl,{x:d,y:e},a))};a.prototype.strokeText=function(a,d,e){this.gk(this.eg)&&(this.gf(this.font),this.node("text",this.eg|this.rl,{x:d,y:e},a))};
a.prototype.ul=function(a,d,e,c,h,k,l,n,q){var b=document.createElement("canvas"),f=b.getContext("2d");b.width=c;b.height=h;f.drawImage(a,-d,-e);a=b.toDataURL();this.Yl().Vd(new Ca("image",{transform:"matrix("+this.ra.m11+" "+this.ra.m21+" "+this.ra.m12+" "+this.ra.m22+" "+this.ra.Ba+" "+this.ra.Ca+")",x:k,y:l,width:n,height:q,"xlink:href":a}))};a.prototype.measureText=function(a){var b=document.createElement("canvas").getContext("2d");b.font=this.font;return b.measureText(a)};a.prototype.Ug=function(){};
a.prototype.xl=function(){return{name:this.lf}};a.prototype.Al=function(a){this.lf=a?a.name:""};a.prototype.clip=function(){var a=this.fw(),d=new Ca("clipPath",{id:a});d.Vd(new Ca("path",{d:this.path.eo(this.ra)}));this.jj.Vd(d);this.lf=a;this.path=new ie};return a}(ge);var O=x.create("TRUETYPE");function ke(c){var a;void 0===a&&(a="Assertion failed.");if(!c)throw console.log(Error(a)),Error(a);}
var le=function(){function c(a,b){this.code=a;this.pd=b}c.prototype.toString=function(){return(255<this.code?"code=12 "+(this.code&255):""+this.code)+" "+JSON.stringify(this.pd)};return c}(),me=function(){function c(a,b,d){void 0===b&&(b=0);this.data=a;this.start=b;this.tb=0;this.length=void 0===d?this.data.length-b:d}c.prototype.getUint8=function(){ke(this.tb<this.length);return this.data[this.tb++ +this.start]};c.prototype.slice=function(a,b){void 0===a&&(a=0);void 0===b&&(b=this.length-a);return new c(this.data,
a+this.start,b)};c.prototype.seek=function(a){ke(0<=a&&a<=this.length);var b=this.tb;this.tb=a;return b};c.prototype.tj=function(){return this.tb>=this.length};c.prototype.getUint16=function(){return(this.getUint8()<<8|this.getUint8())>>>0};c.prototype.getUint32=function(){return this.getInt32()>>>0};c.prototype.getInt16=function(){var a=this.getUint16();a&32768&&(a-=65536);return a};c.prototype.getInt32=function(){return this.getUint8()<<24|this.getUint8()<<16|this.getUint8()<<8|this.getUint8()};
c.prototype.Ob=function(){return this.getInt16()};c.prototype.Dv=function(){this.getUint16()};c.prototype.wf=function(){return this.getInt16()/16384};c.prototype.Ej=function(){return this.getInt32()/65536};c.prototype.Mj=function(a){for(var b="",d=0;d<a;d++)b+=String.fromCharCode(this.getUint8());return b};c.prototype.Ev=function(a){for(var b="",d=0;d<a;d+=2)b+=String.fromCharCode(this.getUint16());return b};c.prototype.getDate=function(){var a=1E3*(4294967296*this.getUint32()+this.getUint32())+Date.UTC(1904,
1,1);return new Date(a)};c.prototype.Gm=function(a){if(4<a)throw Error("Bad input to getNumber(): "+a);for(var b=0;a--;)b=256*b+this.getUint8();return b};c.prototype.mq=function(a,b){void 0===a&&(a=!1);void 0===b&&(b=[]);for(var d=new le(0,b);;){if(this.tj())throw Error("Unexpected end of charstring");var e=this.getUint8();if(12===e)return d.code=3072|this.getUint8(),d;if(28>e||a&&29<=e&&31>=e)return d.code=e,d;if(30===e){var c="";for(e=!1;!e;){if(this.tj())throw Error("Unexpected EOF reading real");
for(var h=this.getUint8(),k=4;0<=k;k-=4){var l=h>>k&15;switch(l){case 10:c+=".";break;case 11:c+="E";break;case 12:c+="E-";break;case 14:c+="-";break;case 15:e=!0;break;case 14:break;default:c+=l.toString()}}}d.pd.push(parseFloat(c))}else 29===e?(c=this.getUint8(),e=this.getUint8(),h=this.getUint8(),k=this.getUint8(),d.pd.push(c<<24|e<<16|h<<8|k)):28===e?(c=this.getUint8(),e=this.getUint8(),d.pd.push(c<<8|e)):a&&255===e?d.pd.push(this.Ej()):251<=e?(c=this.getUint8(),d.pd.push(256*-(e-251)-c-108)):
247<=e?(c=this.getUint8(),d.pd.push(256*(e-247)+c+108)):d.pd.push(e-139)}};c.prototype.yf=function(a){this.seek(a);a=this.getUint16();var b=this.getUint8();if(4<b)throw Error("Error: This is not an index; offsetSize="+b);return a};c.prototype.Df=function(a,b){this.seek(a);var d=this.getUint16();if(b>=d)throw Error("Tried to read past end of index");var e=this.getUint8();this.seek(a+3+e*b);var c=this.Gm(e),h=this.Gm(e);this.seek(a+3+(d+1)*e-1+c);return h-c};c.prototype.Mm=function(a){this.seek(a);
var b=this.getUint16();if(0!==b){var d=this.getUint8();this.seek(a+3+d*b);var e=this.Gm(d);this.seek(a+3+(b+1)*d-1+e)}};return c}(),ne=function(){function c(a){this.format=0;this.np=[];for(var b=0;256>b;b++){var d=a.getUint8();O("   Glyph[%s] = %s",b,d);this.np.push(d)}}c.prototype.map=function(a){return 0<=a&&255>=a?this.np[a]:0};return c}(),oe=".notdef space exclam quotedbl numbersign dollar percent ampersand quoteright \nparenleft parenright asterisk plus comma hyphen period slash zero one two three four five six seven \neight nine colon semicolon less equal greater question at A B C D E F G H I J K L M N O P Q R S T U\nV W X Y Z bracketleft backslash bracketright asciicircum underscore quoteleft a b c d e f g h i j k \nl m n o p q r s t u v w x y z braceleft bar braceright asciitilde exclamdown cent sterling fraction\nyen florin section currency quotesingle quotedblleft guillemotleft guilsinglleft guilsinglright fi\nfl endash dagger daggerdbl periodcentered paragraph bullet quotesinglbase quotedblbase quotedblright\nguillemotright ellipsis perthousand questiondown grave acute circumflex tilde macron breve dotaccent \ndieresis ring cedilla hungarumlaut ogonek caron emdash AE ordfeminine Lslash Oslash OE ordmasculine \nae dotlessi lslash oslash oe germandbls onesuperior logicalnot mu trademark Eth onehalf plusminus \nThorn onequarter divide brokenbar degree thorn threequarters twosuperior registered minus eth \nmultiply threesuperior copyright Aacute Acircumflex Adieresis Agrave Aring Atilde Ccedilla Eacute \nEcircumflex Edieresis Egrave Iacute Icircumflex Idieresis Igrave Ntilde Oacute Ocircumflex \nOdieresis Ograve Otilde Scaron Uacute Ucircumflex Udieresis Ugrave Yacute Ydieresis Zcaron aacute \nacircumflex adieresis agrave aring atilde ccedilla eacute ecircumflex edieresis egrave iacute \nicircumflex idieresis igrave ntilde oacute ocircumflex odieresis ograve otilde scaron uacute \nucircumflex udieresis ugrave yacute ydieresis zcaron exclamsmall Hungarumlautsmall dollaroldstyle \ndollarsuperior ampersandsmall Acutesmall parenleftsuperior parenrightsuperior twodotenleader \nonedotenleader zerooldstyle oneoldstyle twooldstyle threeoldstyle fouroldstyle fiveoldstyle \nsixoldstyle sevenoldstyle eightoldstyle nineoldstyle commasuperior threequartersemdash \nperiodsuperior questionsmall asuperior bsuperior centsuperior dsuperior esuperior isuperior \nlsuperior msuperior nsuperior osuperior rsuperior ssuperior tsuperior ff ffi ffl parenleftinferior \nparenrightinferior Circumflexsmall hyphensuperior Gravesmall Asmall Bsmall Csmall Dsmall Esmall \nFsmall Gsmall Hsmall Ismall Jsmall Ksmall Lsmall Msmall Nsmall Osmall Psmall Qsmall Rsmall Ssmall \nTsmall Usmall Vsmall Wsmall Xsmall Ysmall Zsmall colonmonetary onefitted rupiah Tildesmall \nexclamdownsmall centoldstyle Lslashsmall Scaronsmall Zcaronsmall Dieresissmall Brevesmall Caronsmall \nDotaccentsmall Macronsmall figuredash hypheninferior Ogoneksmall Ringsmall Cedillasmall \nquestiondownsmall oneeighth threeeighths fiveeighths seveneighths onethird twothirds zerosuperior \nfoursuperior fivesuperior sixsuperior sevensuperior eightsuperior ninesuperior zeroinferior \noneinferior twoinferior threeinferior fourinferior fiveinferior sixinferior seveninferior \neightinferior nineinferior centinferior dollarinferior periodinferior commainferior Agravesmall \nAacutesmall Acircumflexsmall Atildesmall Adieresissmall Aringsmall AEsmall Ccedillasmall Egravesmall \nEacutesmall Ecircumflexsmall Edieresissmall Igravesmall Iacutesmall Icircumflexsmall Idieresissmall \nEthsmall Ntildesmall Ogravesmall Oacutesmall Ocircumflexsmall Otildesmall Odieresissmall OEsmall \nOslashsmall Ugravesmall Uacutesmall Ucircumflexsmall Udieresissmall Yacutesmall Thornsmall \nYdieresissmall 001.000 001.001 001.002 001.003 Black Bold Book Light Medium Regular Roman Semibold".split(/\s+/);
ke(391===oe.length);
var pe=function(c){function a(a){a=c.call(this,a)||this;a.assign("version",0,0);a.assign("Notice",1,0);a.assign("Copyright",12,0);a.assign("FullName",2,0);a.assign("FamilyName",3,0);a.assign("Weight",4,0);a.assign("isFixedPitch",3073,1,!1);a.assign("ItalicAngle",3074,2,0);a.assign("UnderlinePosition",3075,2,-100);a.assign("UnderlineThickness",3076,2,50);a.assign("PaintType",3077,2,0);a.assign("CharstringType",3078,2,2);a.assign("FontMatrix",3079,3,[.001,0,0,.001,0,0]);a.assign("UniqueID",13,2);a.assign("FontBBox",
5,3,[0,0,0,0]);a.assign("StrokeWidth",3080,2,0);a.assign("XUID",14,3);a.assign("charset",15,2,0);a.assign("Encoding",16,2,0);a.assign("CharStrings",17,2,0);a.assign("Private",18,[2,2]);a.assign("SyntheticBase",3092,2);a.assign("PostSCript",3093,0);a.assign("BaseFontName",3094,0);a.assign("BaseFontBlend",3095,0);a.assign("ROS",3102,[0,0]);a.assign("CIDFontVersion",3103,2,0);a.assign("CIDFontRevision",3104,2,0);a.assign("CIDFontType",3105,2,0);a.assign("CIDCount",3106,2);a.assign("FDArray",3108,2);
a.assign("FDSelect",3109,2);a.assign("FontName",3110,0);a.assign("BlueValues",6,2);a.assign("OtherBlues",7,2);a.assign("FamilyBlues",8,2);a.assign("FamilyOtherBlues",9,2);a.assign("BlueScale",3081,2,.039625);a.assign("BlueShift",3082,8);a.assign("BlueFuzz",3073,1);a.assign("StdHW",10,2);a.assign("StdVW",10,2);a.assign("StemSnapH",3084,2);a.assign("StemSnapV",3085,2);a.assign("ForceBold",3086,1,!1);a.assign("LanguageGroup",3089,2,0);a.assign("ExpansionFactor",3090,2,.6);a.assign("initialRandomSeed",
3091,2,0);a.assign("Subrs",19,2);a.assign("defaultWidthX",20,2);a.assign("NominalWidthX",21,2);return a}__extends(a,c);return a}(function(){function c(a){this.Vg=a;this.lj={};this.Qe={}}c.prototype.read=function(a){for(;!a.tj();){var b=a.mq();if(b.code in this.Qe){O("Execute %s",b);var d=this.Qe[b.code],e=[],c=0;a:for(;c<d.type.length;c++){var h=d.type[c];if(c>=b.pd.length)throw Error("Not enough operands for instruction:"+b);var k=b.pd[c];switch(h){case 0:e.push(this.Vg[k]);break;case 1:e.push(!!k);
break;case 3:e=b.pd;break a;case 2:e.push(k)}}d.fn(e)}else O("Skip instruction %s",b)}return this.lj};c.prototype.assign=function(a,b,d,e){var c=this,h=d instanceof Array;void 0!==e&&(this.lj[a]=e);this.Qe[b]={type:h?d:[d],fn:function(b){O("Assign %s=%s",a,JSON.stringify(b));c.lj[a]=h||3===d?b:b[0]}}};return c}()),qe=function(){function c(a){function b(a,b){for(void 0===b&&(b=0);b+5<a.stack.length;b+=6){var d=a.x+=a.stack[b+0],e=a.y+=a.stack[b+1],c=a.x+=a.stack[b+2],f=a.y+=a.stack[b+3],h=a.x+=a.stack[b+
4],v=a.y+=a.stack[b+5];a.sa.bezierCurveTo(d,e,c,f,h,v)}}function d(){throw Error("Not implemented.");}function e(a){a.first?(O("Got width: "+a.stack[0]),a.width=a.stack.shift()):(O("Warning; already have width"),a.stack.shift())}this.ui=a;this.Qe={};this.define("hstem",1,function(a){a.stack.length&1&&e(a)},3);this.define("vstem",3,function(a){a.stack.length&1&&e(a)},3);this.define("vmoveto",4,function(a){1<a.stack.length&&e(a);a.y+=a.stack[0];a.sa.moveTo(a.x,a.y)},3);this.define("rlineto",5,function(a){for(var b=
0;b+1<a.stack.length;b+=2)a.x+=a.stack[b],a.y+=a.stack[b+1],a.sa.lineTo(a.x,a.y)});this.define("hlineto",6,function(a){for(var b=0;b<a.stack.length;b+=2)a.x+=a.stack[b],a.sa.lineTo(a.x,a.y),b+1<a.stack.length&&(a.y+=a.stack[b+1],a.sa.lineTo(a.x,a.y))});this.define("vlineto",7,function(a){for(var b=0;b<a.stack.length;b+=2)a.y+=a.stack[b],a.sa.lineTo(a.x,a.y),b+1<a.stack.length&&(a.x+=a.stack[b+1],a.sa.lineTo(a.x,a.y))});this.define("rrcurveto",8,function(a){b(a)});this.define("callsubr",10,function(a){a.wp(a.stack.pop(),
!1)},0);this.define("return",11,function(a){a.vx()},0);this.define("endchar",14,function(a){a.stack.length&&e(a)},3);this.define("hstemhm",18,function(a){a.stack.length&1&&e(a);a.Fd+=a.stack.length/2|0},3);this.define("hintmask",19,function(a){a.stack.length&1&&e(a);a.Fd+=a.stack.length>>1;for(var b=a.Fd+7>>3,d=0;d<b;d++)a.Sf.getUint8()},3);this.define("cntrmask",20,function(a){a.stack.length&1&&e(a);a.Fd+=a.stack.length>>1;for(var b=a.Fd+7>>3,d=0;d<b;d++)a.Sf.getUint8()},3);this.define("rmoveto",
21,function(a){a.stack.length&1&&e(a);a.x+=a.stack[0];a.y+=a.stack[1];a.sa.moveTo(a.x,a.y)},3);this.define("hmoveto",22,function(a){2===a.stack.length&&e(a);a.x+=a.stack[0];a.sa.moveTo(a.x,a.y)},3);this.define("vstemhm",23,function(a){a.stack.length&1&&e(a);a.Fd+=a.stack.length/2|0},3);this.define("rcurveline",24,function(a){b(a);a.y+=a.stack.pop();a.x+=a.stack.pop();a.sa.lineTo(a.x,a.y)});this.define("rlinecurve",25,function(a){for(var d=0;d<a.stack.length-6;d+=2)a.x+=a.stack[d],a.y+=a.stack[d+1],
a.sa.lineTo(a.x,a.y);b(a,d)});this.define("vvcurveto",26,function(a){var b=a.stack.length&1;b&&(a.x+=a.stack[0]);for(;b<a.stack.length;b+=4){var d=a.x,e=a.y+=a.stack[b],c=a.x+=a.stack[b+1],f=a.y+=a.stack[b+2],u=a.x,v=a.y+=a.stack[b+3];a.sa.bezierCurveTo(d,e,c,f,u,v)}});this.define("hhcurveto",27,function(a){var b=a.stack.length&1;b&&(a.y+=a.stack[0]);for(;b<a.stack.length;b+=4){var d=a.x+=a.stack[b+0],e=a.y,c=a.x+=a.stack[b+1],f=a.y+=a.stack[b+2],u=a.x+=a.stack[b+3];a.sa.bezierCurveTo(d,e,c,f,u,a.y)}});
this.define("callgsubr",29,function(a){a.wp(a.stack.pop(),!0)},0);this.define("vhcurveto",30,function(a){for(var b=!1,d=0;d+1<a.stack.length;d+=4){var e=d==a.stack.length-5;if(b){var c=a.x+=a.stack[d+0],f=a.y,u=a.x+=a.stack[d+1],v=a.y+=a.stack[d+2],w=e?a.x+=a.stack[d+4]:a.x;e=a.y+=a.stack[d+3]}else c=a.x,f=a.y+=a.stack[d+0],u=a.x+=a.stack[d+1],v=a.y+=a.stack[d+2],w=a.x+=a.stack[d+3],e=e?a.y+=a.stack[d+4]:a.y;a.sa.bezierCurveTo(c,f,u,v,w,e);b=!b}});this.define("hvcurveto",31,function(a){for(var b=
!0,d=0;d+1<a.stack.length;d+=4){var e=d==a.stack.length-5;if(b){var c=a.x+=a.stack[d+0],f=a.y,u=a.x+=a.stack[d+1],v=a.y+=a.stack[d+2],w=e?a.x+=a.stack[d+4]:a.x;e=a.y+=a.stack[d+3]}else c=a.x,f=a.y+=a.stack[d+0],u=a.x+=a.stack[d+1],v=a.y+=a.stack[d+2],w=a.x+=a.stack[d+3],e=e?a.y+=a.stack[d+4]:a.y;a.sa.bezierCurveTo(c,f,u,v,w,e);b=!b}});this.define("and",3075,d);this.define("or",3076,d);this.define("not",3077,d);this.define("abs",3081,d);this.define("add",3082,d);this.define("sub",3083,d);this.define("div",
3084,d);this.define("neg",3086,d);this.define("eq",3087,d);this.define("drop",3090,d);this.define("put",3092,d);this.define("get",3093,d);this.define("ifelse",3094,d);this.define("random",3095,d);this.define("mul",3096,d);this.define("sqrt",3098,d);this.define("dup",3099,d);this.define("exch",3100,d);this.define("index",3101,d);this.define("roll",3102,d);this.define("hflex",3106,d);this.define("flex",3107,d);this.define("hflex1",3108,d);this.define("flex1",3109,d)}c.prototype.read=function(a,b,d){for(var e=
this,c={first:!0,width:0,Fd:0,stack:[],x:0,y:0,sa:d,Sf:a,Xr:[],wp:function(a,d){c.Xr.push(c.Sf);c.Sf=e.ui.Cv(a,d?-1:b)},vx:function(){c.Sf=c.Xr.pop()}};!c.Sf.tj();)a=c.Sf.mq(!0,c.stack),a.code in this.Qe?(a=this.Qe[a.code],a.fn(c),a.flags&2&&(c.first=!1),a.flags&1&&(c.stack.length=0)):O("Ignore unknown instruction: %s",a)};c.prototype.define=function(a,b,d,e){void 0===e&&(e=1);if(b in this.Qe)throw Error("Already have that instruction: "+a);this.Qe[b]={flags:e,name:a,fn:d}};return c}(),te=function(){function c(a){this.file=
a;this.yh=0;this.Vg={};this.ui=0;this.qm=null;this.pm=[];this.file=a=a.slice(a.tb);this.dw=a.getUint8();this.jw=a.getUint8();this.xq=a.getUint8();this.xw=a.getUint8();O("CFF version %s.%s",this.dw,this.jw);O("hdrSize=%s offSize=%s",this.xq,this.xw);a.seek(this.xq);this.gx(a);this.ly(a);this.kx(a);this.lx(a);var b=this.Ay=this.mx(a);this.zt=b.CharstringType;a.Mm(b.CharStrings);this.Uq=a.yf(b.CharStrings);O("CFF Font contains %s glyphs",this.Uq);b.FDSelect?(this.Yw(a,b),this.bx(a,b)):this.pm.push(b);
a.seek(b.CharStrings)}c.prototype.gx=function(a){var b=a.tb,d=a.yf(b);O("There are %s names",d);for(var e=0;e<d;e++){var c=a.Df(b,e);a.Mj(c)}};c.prototype.ly=function(a){this.yh=a.tb;var b=a.yf(this.yh);O("There are %s font dicts",b);b=a.Df(this.yh,0);O("Length is %s",b);a.Mm(this.yh)};c.prototype.kx=function(a){for(var b=0;b<oe.length;b++)this.Vg[b]=oe[b];var d=a.tb,e=a.yf(d);O("There are %s strings",e);for(b=0;b<e;b++){var c=a.Df(d,b);c=a.Mj(c);this.Vg[391+b]=c}a.Mm(d)};c.prototype.mx=function(a){var b=
a.Df(this.yh,0),d=new pe(this.Vg);b=d.read(a.slice(a.tb,b));if(b.Private){var e=b.Private[1];d.read(a.slice(e,b.Private[0]));b.Subrs&&(b.Subrs+=e)}return b};c.prototype.im=function(a,b,d,e){a.translate(d,e);var c=this.Ay.CharStrings,h=this.$u(b);b=this.file.Df(c,b);(new qe(this)).read(this.file.slice(this.file.tb,b),h,a);a.translate(-d,-e)};c.prototype.lx=function(a){this.ui=a.tb;a=a.yf(this.ui);O("There are %s subroutines.",a)};c.prototype.Lu=function(a){return 0===this.zt?0:1240>a?107:33900>a?1131:
32768};c.prototype.Cv=function(a,b){void 0===b&&(b=-1);var d=-1===b?this.ui:this.pm[b].Subrs;var e=this.file.yf(d);a+=this.Lu(e);d=this.file.Df(d,a);return this.file.slice(this.file.tb,d)};c.prototype.Yw=function(a,b){this.qm=new se(a.slice(b.FDSelect),this.Uq)};c.prototype.$u=function(a){return this.qm?this.qm.cw(a):0};c.prototype.bx=function(a,b){var d=b.FDArray,e=a.yf(d);O("There are %s items in FDArray",e);for(var c=0;c<e;c++){var h=a.Df(d,c),k=new pe(this.Vg);h=k.read(a.slice(a.tb,h));if(h.Private){var l=
h.Private[1];k.read(a.slice(l,h.Private[0]));h.Subrs&&(h.Subrs+=l)}this.pm.push(k.lj)}};return c}();function ue(c,a){for(var b=c,d=-1,e;1<b-d;){e=b+d>>1;var f=a(e);if(0==f)break;0<f?d=e:b=e}}
var se=function(){function c(a){this.pg=a;this.nk=0;this.format=a.getUint8();O("Reading FDSelect format %s",this.format);if(3!==this.format&&0!==this.format)throw Error("Can't read format "+this.format+" FDSelect");if(3===this.format){this.nk=a.getUint16();O("There are %s ranges",this.nk);for(var b=0;b<this.nk;b++){var d=a.getUint16(),e=a.getUint8();O("first=%s fd=%s",d,e)}}}c.prototype.cw=function(a){var b=this;if(0===this.format)return this.pg.seek(1+a),this.pg.getUint8();var d=-1;ue(this.nk,function(e){b.pg.seek(3+
3*e);e=b.pg.getUint16();d=b.pg.getUint8();var c=b.pg.getUint16();return a<e?-1:a>=c?1:0});return d};return c}(),ve=function(){function c(a){this.file=a;this.format=4;this.cache={};var b,d=[],e=a.getUint16()/2;a.getUint16();a.getUint16();a.getUint16();for(b=0;b<e;b++)d.push({$j:0,Vk:0,Pp:a.getUint16(),zq:0});a.getUint16();for(b=0;b<e;b++)d[b].Vk=a.getUint16();for(b=0;b<e;b++)d[b].zq=a.getUint16();for(b=0;b<e;b++){var c=a.getUint16();d[b].$j=c?a.tb-2+c:0}this.ua=d}c.prototype.map=function(a){if(!(a in
this.cache)){for(var b=0;b<this.ua.length;b++){var d=this.ua[b];if(d.Vk<=a&&d.Pp>=a){if(d.$j){var e=d.$j+2*(a-d.Vk);this.file.seek(e);var c=this.file.getUint16()}else c=d.zq+a&65535;O("Charcode %s is between %s and %s; maps to %s (%s) roffset=%s",a,d.Vk,d.Pp,e,c,d.$j);this.cache[a]=c;break}}b===this.ua.length&&(this.cache[a]=0)}return this.cache[a]};return c}(),we=function(){function c(a,b,d){this.file=a;this.map={};this.sk=-1;this.uy=b&&!d||!b&&d;this.file=a;this.offset=a.tb;this.sw=a.getUint16();
a.getUint16();a.getUint16();a.getUint16();for(b=0;b<this.sw;b++){d=a.getUint16();var e=a.getUint16(),c=a.Ob();this.map[d<<16|e]=c}this.reset()}c.prototype.reset=function(){this.sk=-1};c.prototype.get=function(a){var b=0;if(0<=this.sk){var d=this.sk<<16|a;d in this.map&&(b=this.map[d])}this.sk=a;return this.uy?{x:0,y:b}:{x:b,y:0}};return c}(),xe=function(){function c(a){this.Tl=[];this.Ef=[];this.Bq=this.zo=this.xo=this.Ao=this.yo=this.cl=this.flags=this.Mq=this.version=0;this.fontFamily=this.yj="";
this.bi=0;this.Pl=null;this.file=new me(a);this.bb=this.ix(this.file);this.cx(this.file);this.hx(this.file);this.$w(this.file);this.ex(this.file);this.fx(this.file);this.Xw(this.file);this.length=this.Gv()}c.prototype.ix=function(a){var b={};a.getUint32();var d=a.getUint16();a.getUint16();a.getUint16();a.getUint16();for(var e=0;e<d;e++){var c=a.Mj(4);b[c]={Bt:a.getUint32(),offset:a.getUint32(),length:a.getUint32()};"head"!==c&&O("Table %s has checksum 0x%s",c,b[c].Bt.toString(16))}return b};c.prototype.cx=
function(a){ke("head"in this.bb);a.seek(this.bb.head.offset);this.version=a.Ej();a.Ej();a.getUint32();this.Mq=a.getUint32();ke(1594834165===this.Mq);this.flags=a.getUint16();this.cl=a.getUint16();a.getDate();a.getDate();this.yo=a.Ob();this.Ao=a.Ob();this.xo=a.Ob();this.zo=a.Ob();a.getUint16();a.getUint16();a.getInt16();this.Bq=a.getInt16();a.getInt16()};c.prototype.$w=function(a){ke("cmap"in this.bb);var b=this.bb.cmap.offset;a.seek(b);a.getUint16();for(var d=a.getUint16(),e=0;e<d;e++){var c=a.getUint16(),
h=a.getUint16(),k=a.getUint32();O("CMap platformid=%s specificid=%s offset=%s",c,h,k);3===c&&1>=h&&this.Zw(a,b+k)}};c.prototype.Zw=function(a,b){var d=a.seek(b),e=a.getUint16(),c=a.getUint16();a.getUint16();var h;O("    Cmap format %s length %s",e,c);0===e?h=new ne(a,c):4===e&&(h=new ve(a,c));h&&this.Tl.push(h);a.seek(d)};c.prototype.fx=function(a){if("kern"in this.bb){a.seek(this.bb.kern.offset);var b=a.getUint16(),d=a.getUint16();O("Kern Table version: %s",b);O("Kern nTables: %s",d);for(var e=0;e<
d;e++){b=a.getUint16();var c=a.getUint16(),h=a.getUint16(),k=h>>8,l=h&4,n=0===(h&1);O("Kerning subtable version %s format %s length %s coverage: %s",b,k,c,h);b=null;0===k?b=new we(a,n,0!=l):(O("Unknown format -- skip"),a.seek(a.tb+c));b&&this.Ef.push(b)}}};c.prototype.hx=function(a){ke("name"in this.bb);var b=this.bb.name.offset;a.seek(b);a.getUint16();for(var d=a.getUint16(),e=a.getUint16(),c=0;c<d;c++){var h=a.getUint16(),k=a.getUint16(),l=a.getUint16(),n=a.getUint16(),q=a.getUint16(),u=a.getUint16();
u=a.seek(b+e+u);q=0===h||3===h?a.Ev(q):a.Mj(q);O("Name %s/%s id %s language %s: %s",h,k,n,l,q);a.seek(u);switch(n){case 1:this.fontFamily=q;break;case 4:this.yj=q}}};c.prototype.ex=function(a){ke("hhea"in this.bb);a.seek(this.bb.hhea.offset);a.Ej();a.Ob();a.Ob();a.Ob();a.Dv();a.Ob();a.Ob();a.Ob();a.getInt16();a.getInt16();a.Ob();a.getInt16();a.getInt16();a.getInt16();a.getInt16();a.getInt16();this.bi=a.getUint16()};c.prototype.Xw=function(a){"CFF "in this.bb&&(a.seek(this.bb["CFF "].offset),this.Pl=
new te(a))};c.prototype.fv=function(a){ke("hmtx"in this.bb);var b=this.file;b.seek(this.bb.hmtx.offset+4);var d=this.bb.hmtx.offset;if(a<this.bi){var e=this.file.seek(d+4*a);var c=b.getUint16();a=b.getInt16()}else e=b.seek(d+4*(this.bi-1)),c=b.getUint16(),b.seek(d+4*this.bi+2*(a-this.bi)),a=b.Ob();this.file.seek(e);return{lp:c,Yv:a}};c.prototype.$b=function(a){return a/this.cl};c.prototype.Gv=function(){ke("maxp"in this.bb);var a=this.file.seek(this.bb.maxp.offset+4),b=this.file.getUint16();this.file.seek(a);
return b};c.prototype.av=function(a){ke("loca"in this.bb);var b=this.bb.loca,d=this.file;if(1===this.Bq){b=d.seek(b.offset+4*a);a=d.getUint32();var e=d.getUint32()}else b=d.seek(b.offset+2*a),a=2*d.getUint16(),e=2*d.getUint16();d.seek(b);return a===e?0:a+this.bb.glyf.offset};c.prototype.tr=function(a){var b=this.av(a);a=this.file;if(0===b||b>=this.bb.glyf.offset+this.bb.glyf.length)return null;ke(b>=this.bb.glyf.offset);ke(b<this.bb.glyf.offset+this.bb.glyf.length);a.seek(b);b={Wd:[],di:a.getInt16(),
la:[],yo:a.Ob(),Ao:a.Ob(),xo:a.Ob(),zo:a.Ob()};ke(-1<=b.di);-1===b.di?this.ax(a,b):this.jx(a,b);return b};c.prototype.jx=function(a,b){function d(b,d,c){for(var f=0,l=0;l<h;l++){var n=k[l];n&d?f=n&c?f+a.getUint8():f-a.getUint8():~n&c&&(f+=a.getInt16());e[l][b]=f}}b.Wd=[];for(var e=b.la=[],c=0;c<b.di;c++)b.Wd.push(a.getUint16());a.seek(a.getUint16()+a.tb);if(0!==b.di){var h=Math.max.apply(null,b.Wd)+1,k=[];for(c=0;c<h;c++){var l=a.getUint8();k.push(l);e.push({x:0,y:0,Eg:0<(l&1)});if(l&8){var n=a.getUint8();
ke(0<n);for(c+=n;n--;)k.push(l),e.push({x:0,y:0,Eg:0<(l&1)})}}d("x",2,16,b.yo,b.xo);d("y",4,32,b.Ao,b.zo)}};c.prototype.ax=function(a,b){var d,e,c=32;b.Wd=[];for(b.la=[];c&32;){c=a.getUint16();var h=a.getUint16();var k=1;var l=d=0;var n=1;var q=e=0;if(c&1){var u=a.getInt16();var v=a.getInt16()}else u=a.getUint8(),v=a.getUint8();c&2&&(e=u,q=v);c&8?n=k=a.wf():c&64?(k=a.wf(),n=a.wf()):c&128&&(k=a.wf(),d=a.wf(),l=a.wf(),n=a.wf());O("Read component glyph index %s",h);O("Transform: [%s %s %s %s %s %s]",
k,d,l,n,e,q);u=a.tb;if(h=this.tr(h)){var w=b.la.length;for(v=0;v<h.Wd.length;v++)b.Wd.push(h.Wd[v]+w);for(v=0;v<h.la.length;v++){w=h.la[v].x;var y=h.la[v].y;w=k*w+d*y+e;y=l*w+n*y+q;b.la.push({x:w,y:y,Eg:h.la[v].Eg})}}a.seek(u)}b.di=b.Wd.length;c&256&&a.seek(a.getUint16()+a.tb)};c.prototype.im=function(a,b,d,e){if(this.Pl)this.Pl.im(a,b,d,e);else if(b=this.tr(b),null!==b)for(var c=0,h=0,k=0,l=0,n;h<b.la.length;h++){var q=b.la[h];0===c?(a.moveTo(q.x+d,q.y+e),c=1):1===c?q.Eg?a.lineTo(q.x+d,q.y+e):c=
2:(n=b.la[h-1],q.Eg?(a.quadraticCurveTo(n.x+d,n.y+e,q.x+d,q.y+e),c=1):a.quadraticCurveTo(n.x+d,n.y+e,(n.x+q.x)/2+d,(n.y+q.y)/2+e));h===b.Wd[k]&&(2===c&&(n=q,q=b.la[l],q.Eg?a.quadraticCurveTo(n.x+d,n.y+e,q.x+d,q.y+e):a.quadraticCurveTo(n.x+d,n.y+e,(n.x+q.x)/2+d,(n.y+q.y)/2+e)),l=h+1,k+=1,c=0)}};c.prototype.transform=function(a,b){a.scale(b/this.cl,-b/this.cl)};c.prototype.eu=function(a,b,d,e,c){a.save();a.translate(d,e);this.transform(a,c);e=d=0;this.sx();for(c=0;c<b.length;c++){var f=this.hw(b.charCodeAt(c)),
k=this.fv(f),l=this.uw(f);O("Metrics for %s code %s index %s: %s %s kern: %s,%s",b.charAt(c),b.charCodeAt(c),f,k.lp,k.Yv,l.x,l.y);this.im(a,f,d+l.x,e+l.y);d+=k.lp}a.restore()};c.prototype.hw=function(a){for(var b=0,d=0;d<this.Tl.length&&!(b=this.Tl[d].map(a));d++);return b};c.prototype.sx=function(){for(var a=0;a<this.Ef.length;a++)this.Ef[a].reset()};c.prototype.uw=function(a){for(var b,d=0,e=0,c=0;c<this.Ef.length;c++)b=this.Ef[c].get(a),d+=b.x,e+=b.y;return{x:d,y:e}};return c}(),ye=function(c){function a(){var a=
c.call(this)||this;a.fonts={};a.ci=0;a.fm=[];return a}__extends(a,c);a.prototype.add=function(a,d){this.ci+=1;var b=this;return Yb({url:a,responseType:"arraybuffer"}).then(function(e){try{return b.Is(a,d,new Uint8Array(e.response))}catch(h){throw console.log(h),h;}},function(d){b.za(a,d.message);throw d;})};a.prototype.za=function(a,d){O("Error when fetching "+a+": "+d);--this.ci;this.Ro()};a.prototype.Is=function(a,d,e){O("Got font %s;",a);e=new xe(e);O("Loaded '%s'",e.yj);d=d||e.fontFamily;this.fonts[d]=
{name:e.yj,url:a,font:e};--this.ci;this.Ro();return e};a.prototype.Ro=function(){if(0===this.ci){this.na("done");for(var a=0;a<this.fm.length;a++)this.fm[a]();this.fm.length=0}};a.prototype.get=function(a){O("Lookup font %s",a);if(a in this.fonts)return this.fonts[a].font;O("Lookup font %s; not found",a);for(var b in this.fonts)O("Searched: '%s'",b)};return a}(bb);var ze=function(){function c(a,b,d,e){this.x=a;this.y=b;this.width=d;this.height=e;this.nc=[];this.fonts={};this.images=[];this.bl={};this.Pb=1;this.It=!0;this.page={};this.log=x.create("PdfWriter");this.fi=this.object("Pages",{Kids:[],Count:0});this.xt=this.object("Catalog",{Pages:this.fi._id+" 0 R"});this.Ug()}c.prototype.Tv=function(){if(null!==c.zl)return c.zl;var a=document.createElement("canvas"),b=!1;a.width=10;a.height=10;"toDataURL"in a&&(b=0<a.toDataURL("image/jpeg").indexOf("jpeg"));c.zl=
b;this.log("JPEG supported: %s",b);return b};c.prototype.Ug=function(a,b,d,e){void 0===a&&(a=this.x);void 0===b&&(b=this.x);void 0===d&&(d=this.width);void 0===e&&(e=this.height);this.log("StartPage MediaBox=[%s %s %s %s]",a,b,d,e);this.page=this.object("Page",{MediaBox:[a,b,a+d,b+e],Parent:this.fi._id+" 0 R"});this.fi.Kids.push(this.page._id+" 0 R");this.fi.Count+=1;this.bl={}};c.prototype.object=function(a,b){var d=this.nc.length+1;a&&(b.Type=a);b._id=d;this.nc.push(b);return b};c.prototype.Zs=
function(a){this.page.Contents=a._id+" 0 R"};c.prototype.stream=function(a){if(this.It){var b=Sa.bf("LZWEncoder");b.ls(a);b.flush();a=b.sg().toString();a=this.object(null,{_stream:a,Filter:"[/LZWDecode]",DecodeParms:"[ << /EarlyChange 0 >> ]"})}else a=this.object(null,{_stream:a});return a};c.prototype.Jy=function(a){if(!(a in this.fonts)){var b="F"+this.Pb;this.Pb+=1;var d="/"+a.replace(/ /g,"");b=this.object("Font",{_name:b,BaseFont:d,Encoding:"/StandardEncoding",Subtype:"/Type1"});this.fonts[a]=
b}this.Ei("Font",this.fonts[a]);return"/"+this.fonts[a]._name};c.prototype.hs=function(a,b){var d=""+a+"-"+b;if(!(d in this.bl)){var e="gs"+this.Pb;this.Pb+=1;var c=this.object("ExtGState",{_name:e});b?c.ca=this.bd(a):c.CA=this.bd(a);this.bl[d]=e;this.Ei("ExtGState",c)}return this.bl[d]};c.prototype.Ei=function(a,b){"Resources"in this.page||(this.page.Resources={});a in this.page.Resources||(this.page.Resources[a]={});this.page.Resources[a][b._name]=b._id+" 0 R"};c.prototype.wl=function(a,b){void 0===
b&&(b="");for(var d=0;d<this.images.length;d++)if(this.images[d].Qh===a&&b===this.images[d].yq)return this.images[d].ei;return null};c.prototype.fl=function(a,b){var d,e=this.wl(a);if(!e){var c="I"+this.Pb;this.Pb+=1;b instanceof HTMLCanvasElement?e=b:(e=document.createElement("canvas"),e.width=b.width,e.height=b.height,e.getContext("2d").drawImage(b,0,0));var h=e.getContext("2d").getImageData(0,0,e.width,e.height),k=!1;if(this.Tv()){this.log("Using JPEG encoding");var l="[/DCTDecode]";var n=Sa.bf("");
for(d=0;d<h.data.length;d+=4)k=k||255>h.data[d+3];d=e.toDataURL("image/jpeg");var q=atob(d.split(",")[1]);for(d=0;d<q.length;d++)n.jb(q.charCodeAt(d))}else{this.log("Using LZW encoding");l="[/LZWDecode]";n=Sa.bf("LZWEncoder");for(d=0;d<h.data.length;d+=4)n.jb(h.data[d]),n.jb(h.data[d+1]),n.jb(h.data[d+2]),k=k||255>h.data[d+3];var u="[ <</EarlyChange 0 >> ]"}n.flush();n=n.sg().toString();c=this.object("XObject",{Subtype:"/Image",Width:e.width,Height:e.height,ColorSpace:"/DeviceRGB",BitsPerComponent:8,
Length:n.length,Interpolate:"true",Filter:l,_name:c,_stream:n});u&&(c.DecodeParms=u);if(k){n=Sa.bf("LZWEncoder");for(d=0;d<h.data.length;d+=4)n.jb(h.data[d+3]);n.flush();n=n.sg().toString();u=this.object("XObject",{Subtype:"/Image",Width:e.width,Height:e.height,ColorSpace:"/DeviceGray",BitsPerComponent:8,Length:n.length,Filter:"[/LZWDecode]",DecodeParms:"[ << /EarlyChange 0 >> ]",_stream:n});c.SMask=u._id+" 0 R"}this.images.push({Qh:a,yq:"",ei:c});e=c}this.Ei("XObject",e);return"/"+e._name};c.prototype.gl=
function(a,b){var d=this.wl(a.Na,b.toString());if(!d){d="P"+this.Pb;this.Pb+=1;this.fl(a.Na,a.Na);var e=this.wl(a.Na),c=new J(a.Na.width,0,0,-a.Na.height,0,a.Na.height);c=b.multiply(c);var h="1",k="1",l=b.$b();l=Math.max(l.x,l.y);if("no-repeat"===a.repeat||"repeat-y"===a.repeat)h=""+Math.ceil(this.width/a.Na.width/l);if("no-repeat"===a.repeat||"repeat-x"===a.repeat)k=""+Math.ceil(this.height/a.Na.height/l);d=this.object("Pattern",{_name:d,PatternType:"1",PaintType:"1",TilingType:"2",BBox:"[0 0 1 1]",
XStep:h,YStep:k,Matrix:"[ "+this.bd(c.m11,c.m21,c.m12,c.m22,c.Ba,c.Ca)+"]",Resources:"<< /XObject << /"+e._name+" "+e._id+" 0 R >> >>"});d._stream="/"+e._name+" Do";this.images.push({Qh:a.Na,yq:b.toString(),ei:d})}this.Ei("Pattern",d);return"/"+d._name};c.prototype.Tf=function(){var a=[],b=[],d;a.push("%PDF-1.4\n%\u0080\u0081\u0082\u0083\n");for(d=0;d<this.nc.length;d++)this.hp(a,b,this.nc[d],!1);var e=a.join("").length;a.push("xref\n0 "+(this.nc.length+1)+"\n");a.push("0000000000 65535 f\n");for(d=
0;d<this.nc.length;d++){for(var c=""+b[d];10>c.length;)c="0"+c;a.push(c+" 00000 n \n")}a.push("trailer\n");a.push("<< /Size "+(this.nc.length+1)+"\n");a.push("   /Root "+this.xt._id+" 0 R\n");a.push(">>\n");a.push("startxref\n");a.push(e+"\n");a.push("%%EOF\n");return a.join("")};c.prototype.toBlob=function(){for(var a=this.Tf(),b=new Uint8Array(a.length),d=0;d<a.length;d++)b[d]=a.charCodeAt(d);return new Blob([b],{type:"application/pdf"})};c.prototype.hp=function(a,b,d,e){e?a.push("<<\n"):(b.push(a.join("").length),
a.push(d._id+" 0 obj\n"),"Type"in d?a.push("<< /Type /"+d.Type+"\n"):a.push("<<\n"));"_stream"in d&&(d.Length=d._stream.toString().length);for(var c in d)if(d.hasOwnProperty(c)&&"Type"!==c&&"_"!==c.charAt(0)){e&&a.push("    ");a.push("   /"+c+" ");var h=d[c];"object"===typeof h&&"[object Array]"===Object.prototype.toString.apply(h)?a.push("[ "+h.join(" ")+" ]"):"object"===typeof h?this.hp(a,b,h,!0):a.push(h);a.push("\n")}e&&a.push("    ");a.push(">>\n");"_stream"in d&&(a.push("stream\n"),a.push(d._stream+
"\n"),a.push("endstream\n"));e||a.push("endobj\n")};c.prototype.ku=function(a){return"("+a.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")+")"};c.prototype.bd=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];b=[];for(var d=0;d<a.length;d++){var e=""+a[d];0<e.indexOf("e")&&(e=a[d].toFixed(20));b.push(e)}return b.join(" ")};c.zl=null;return c}(),Ae=function(c){function a(a,d){var b=c.call(this)||this;b.yu=d;b.path=[];b.x=0;b.y=0;b.kr=[];b.Lf="";b.Rf="";b.Qf=-1;b.Pf=
"";b.Of="";b.Nf="";b.Mf="";b.Kf=-1;b.log=x.create("PDFContext");b.le=a.clone();b.le.transform(new Hc(.75,.75,0,0));b.nb=new ze(72*a.x/96,72*a.y/96,72*a.width/96,72*a.height/96);b.stream=[];b.x=0;b.y=0;b.fillStyle="#000000";b.strokeStyle="#000000";b.ep=b.Ms;b.bp();return b}__extends(a,c);a.prototype.save=function(){c.prototype.save.call(this);this.stream.push("q");this.kr.push({Lf:this.Lf,Rf:this.Rf,Qf:this.Qf,Pf:this.Pf,Of:this.Of,Nf:this.Nf,Mf:this.Mf,Kf:this.Kf})};a.prototype.restore=function(){c.prototype.restore.call(this);
var a=this.kr.pop();a&&(this.stream.push("Q"),this.Lf=a.Lf,this.Rf=a.Rf,this.Qf=a.Qf,this.Pf=a.Pf,this.Of=a.Of,this.Nf=a.Nf,this.Mf=a.Mf,this.Kf=a.Kf)};a.prototype.Ug=function(a){var b=new Hc(.75,.75,0,0);a&&(this.le=a.clone(),this.le.transform(b));this.lm();this.nb.Ug(this.le.x,this.le.y,this.le.width,this.le.height);this.bp();this.beginPath()};a.prototype.beginPath=function(){this.path.length=0};a.prototype.bp=function(){this.log("Start page: %s",this.le);this.setTransform(1,0,0,1,0,0);this.Rf=
this.Lf="";this.Qf=-1;this.Mf=this.Nf=this.Of=this.Pf="";this.Kf=-1};a.prototype.lm=function(){this.stream.length&&this.nb.Zs(this.nb.stream(this.stream.join("\n")));this.stream.length=0};a.prototype.toString=function(){this.lm();return this.nb.Tf()};a.prototype.toBlob=function(){this.lm();return this.nb.toBlob()};a.prototype.setTransform=function(a,d,c,f,h,k){var b=this.le.vd();this.ra=(new J(a,c,d,f,h,k)).multiply(new Ic(0,b.x,b.y)).multiply(new Hc(.75,.75,0,0))};a.prototype.closePath=function(){this.path.push("h")};
a.prototype.fill=function(){this.Bl();for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("f")};a.prototype.stroke=function(){this.Cl();for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("S")};a.prototype.moveTo=function(a,d){var b=this.ra.apply(a,d);this.path.push(this.nb.bd(b.x,b.y)+" m");this.x=a;this.y=d};a.prototype.lineTo=function(a,d){var b=this.ra.apply(a,d);this.path.push(this.nb.bd(b.x,b.y)+" l");this.x=a;this.y=d};a.prototype.bezierCurveTo=
function(a,d,c,f,h,k){a=this.ra.apply(a,d);c=this.ra.apply(c,f);f=this.ra.apply(h,k);this.path.push(this.nb.bd(a.x,a.y,c.x,c.y,f.x,f.y)+" c");this.x=h;this.y=k};a.prototype.quadraticCurveTo=function(a,d,c,f){this.bezierCurveTo(2/3*a+1/3*this.x,2/3*d+1/3*this.y,2/3*a+1/3*c,2/3*d+1/3*f,c,f)};a.prototype.fillText=function(a,d,c){this.ep(a,d,c,0)};a.prototype.strokeText=function(a,d,c){this.ep(a,d,c,1)};a.prototype.measureText=function(a){var b=document.createElement("canvas").getContext("2d");b.font=
this.font;return b.measureText(a)};a.prototype.Bl=function(){if(this.Lf!==this.fillStyle){if(this.fillStyle instanceof de){var a=this.nb.gl(this.fillStyle,this.ra);this.stream.push("/Pattern cs");this.stream.push(a+" scn")}else"string"===typeof this.fillStyle&&(a=r.Zd(this.fillStyle).dj(r.RGBA),this.stream.push(this.nb.bd(a.values[0],a.values[1],a.values[2])+" rg"),a=this.nb.hs(a.values[3],!0),this.stream.push("/"+a+" gs"));this.Lf=this.fillStyle}};a.prototype.Cl=function(){function a(a){return"bevel"===
a?2:"round"===a?1:0}function d(a){return"butt"===a?0:"round"===a?1:2}if(this.Rf!==this.strokeStyle){if(this.strokeStyle instanceof de){var c=this.nb.gl(this.strokeStyle,this.ra);this.stream.push("/Pattern CS");this.stream.push(c+" SCN")}else"string"===typeof this.strokeStyle&&(c=r.Zd(this.strokeStyle).dj(r.RGBA),this.stream.push(this.nb.bd(c.values[0],c.values[1],c.values[2])+" RG"),c=this.nb.hs(c.values[3],!1),this.stream.push("/"+c+" gs"));this.Rf=this.strokeStyle}this.Qf!==this.lineWidth&&(this.Qf=
this.lineWidth,this.stream.push(this.nb.bd(72*this.lineWidth/96)+" w"));this.Pf!==this.lineJoin&&(this.Pf=this.lineJoin,this.stream.push(a(this.lineJoin)+" j"));this.Of!==this.lineCap&&(this.Of=this.lineCap,this.stream.push(d(this.lineCap)+" J"))};a.prototype.Ns=function(a,d,c,f){var b=this.gf(this.font);if(this.Nf!==b.fontSize||this.Mf!==b.fontFamily){var e=this.nb.Jy(b.fontFamily);this.stream.push(e+" "+this.nb.bd(parseFloat(b.fontSize))+" Tf");this.Nf=b.fontSize;this.Mf=b.fontFamily}this.Kf!==
f&&(this.stream.push(f+" Tr"),this.Kf=f);0===f?this.Bl():this.Cl();this.stream.push("BT");d=this.ra.multiply(new J(1,0,0,-1,d,c));this.stream.push(this.nb.bd(d.m11,d.m21,d.m12,d.m22,d.Ba,d.Ca)+" Tm");this.stream.push(this.nb.ku(a)+" Tj");this.stream.push("ET")};a.prototype.Ms=function(a,d,c,f){var b=this.gf(this.font),e=this.yu.get(b.fontFamily);e?(0===f?this.Bl():this.Cl(),this.beginPath(),e.eu(this,a,d,c,parseFloat(b.fontSize)),0===f?this.fill():this.stroke()):this.Ns(a,d,c,f)};a.prototype.gf=function(a){var b=
"",c="",f="normal",h="normal",k="normal",l="normal";a=a.split(/\s+/);a:for(;;){var n=a.shift();if(!n)break;switch(n){case "normal":break;case "italic":case "oblique":f=n;break;case "small-caps":k=n;break;case "bold":case "bolder":case "lighter":case "100":case "200":case "300":case "400":case "500":case "600":case "700":case "800":case "900":h=n;break;default:if(""===c)n=n.split("/"),c=n[0],1<n.length&&(l=n[1]);else{b=n;a.length&&(b+=" "+a.join(" "));break a}}}b&&(b=b.replace(/"/g,""));return{fontStyle:f,
fontVariant:k,fontWeight:h,fontSize:c,lineHeight:l,fontFamily:b}};a.prototype.ul=function(a,d,c,f,h,k,l,n,q){this.log("DrawImage(%s, %s, %s, %s, %s, %s, %s %s)",d,c,f,h,k,l,n,q);l+=q;var b=document.createElement("canvas"),e=b.getContext("2d");b.width=f;b.height=h;e.drawImage(a,-d,-c);a=this.nb.fl(a instanceof HTMLImageElement?[a.src,d,c,f,h].join():a,b);this.stream.push("q");k=this.ra.multiply(new J(n,0,0,-q,k,l));this.stream.push(this.nb.bd(k.m11,k.m21,k.m12,k.m22,k.Ba,k.Ca)+" cm");this.stream.push(a+
" Do");this.stream.push("Q")};a.prototype.Tf=function(){return this.nb.Tf()};a.prototype.xl=function(){return{}};a.prototype.Al=function(){};a.prototype.clip=function(){for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("W");this.stream.push("n");this.path.length=0};return a}(ge);var Be=function(c){function a(){var a=c.call(this)||this;a.Jg=[];a.kg=!1;a.canvas=null;a.ga=null;a.log=x.create("FORMAT",!0);return a}__extends(a,c);a.prototype.add=function(a,d,c,f,h){var b;var e=this.Jg;var n=0;for(b=e.length;n<b;n++){var q=e[n];q.type===d&&q.an===a&&q.url===c&&(q.Nn=!0)}this.log("Request URL %s",c.substr(0,64));this.Jg.push({an:a,type:d,url:c,ir:f||{},vt:h,Nn:!1});this.check()};a.prototype.check=function(){for(var a=0;!this.kg&&a<this.Jg.length;)this.Jg[a].Nn?this.Jg.shift():(this.Ks(this.Jg[0]),
a+=1);this.kg||this.na("done")};a.prototype.Ks=function(a){var b=this;b.kg=!0;b.log("Processing request for item %s url=%s",a.an,a.url.substr(0,64));0===a.type.indexOf("image")&&Ya.load(a.url,function(d,c){null!==d?(b.log("Image request completed for item %s url %s",a.an,c.substr(0,64)),a.vt(d,c)):b.log("Image request failed for url %s",c);b.kg=!1;a.Nn=!0;b.check()})};a.prototype.Mt=function(a,d){this.na("convert-dom-request",a,d)};a.prototype.Lg=function(a){this.na("reformat",a)};a.prototype.Ke=
function(){if(null===this.canvas)return new H(0,0,0,0);var a=B(this.canvas).Yb();return new H(a.left,a.top,this.canvas.width,this.canvas.height)};a.prototype.$d=function(a){return this.ga?this.ga.get(a):null};return a}(bb);x.create("GroupNode");
var Ce=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.children=[];b.Rb|=2;return b}__extends(a,c);a.prototype.type=function(){return"GroupNode"};a.prototype.Le=function(a){for(var b=0;b<this.children.length;b++)if(a===this.children[b])return b;return-1};a.prototype.format=function(a,d){for(var b=0,c=this.children;b<c.length;b++){var h=c[b];Xc(h)&&h.format(a,d)}};a.prototype.Ma=function(){return this.children.length};a.prototype.removeChild=function(a){var b=this.children[a];this.children.splice(a,
1);return b};a.prototype.ek=function(a,d){this.children.splice(d,0,a)};a.prototype.sb=function(a){return this.children[a]};a.prototype.Yn=function(a,d){var b=this.children[a];this.children[a]=this.children[d];this.children[d]=b};return a}(ed);ed.fd("GroupNode",Ce);function De(c){c=c.replace(/\+/g," ");return decodeURIComponent(c)}function Ee(){if(void 0===c)var c=window.location.hash;var a=c,b;c={};var d=a.indexOf("#");0<=d&&(a=a.substr(d+1));d=a.indexOf("#");0<=d&&(a=a.substr(0,d));a=a.split("&");d=0;for(b=a.length;d<b;d++){var e=a[d];var f=e.split("=");e=De(f[0]);"/"==e[0]&&-1===e.indexOf(".")&&(e=e.substr(1));f=1<f.length?De(f[1]):"";e.length&&(c[e]=f)}return c};var Fe=x.create("CONFIG"),Ge=function(c){function a(a,d,e){var b=c.call(this)||this;b.qg={};for(var h in d)b.qg[h.toLowerCase()]=h;b.options=JSON.parse(JSON.stringify(d));for(var k in e)k.toLowerCase()in b.qg||alert("Zwibbler: Unknown option '"+k+"'"),b.set(k,e[k],!0);a.addEventListener(window,"hashchange",function(){Fe("Reload parameters from url hash");b.Wm()});a.add(function(){b.Ya={}});b.Wm();for(var l in b.options)Fe("%s=%s",l,b.options[l]);return b}__extends(a,c);a.prototype.Wm=function(){var a=
Ee(),d;for(d in a)this.set(d,a[d])};a.prototype.has=function(a){return a.toLowerCase()in this.qg};a.prototype.set=function(a,d,c){void 0===c&&(c=!1);a.toLowerCase()in this.qg&&(a=this.qg[a.toLowerCase()]);if("string"===typeof d&&"number"===typeof this.options[a]&&(d=parseFloat(d),isNaN(d)))return Fe("Error: Config option %s expects a number",a),!1;Fe("Set config %s=%s",a,d);this.options[a]=d;c||(this.jd("update",a,d),this.jd(a,d,!1))};a.prototype.pa=function(a,d){if("update"!==a&&!(a in this.options))throw Error(a+
" is not a valid config setting.");d(this.options[a],!0);return c.prototype.pa.call(this,a,d)};a.prototype.get=function(a){if(!(a in this.options))throw Error(a+" is not a valid config setting.");return this.options[a]};return a}(bb);var He=x.create("CONFIG"),Ie=function(){var c;if(document.currentScript&&(c=document.currentScript.getAttribute("src")))return c;if(!document.getElementsByTagName)return"";c=document.getElementsByTagName("script");if(0===c.length)return"";c=c[c.length-1];return void 0!==c.getAttribute.length?c.src:c.getAttribute("src")||""}(),Je={autoGroup:!1,adaptiveBrushWidth:!1,adaptiveLineWidth:!1,angleArcs:0,allowSelectBox:"auto",allowResize:!0,allowTextInShape:!0,allowPointerEvents:!0,allowSystemClipboard:!0,
allowZoom:!0,autoPickTool:!0,autoPickToolText:!0,autoSnap:0,background:"clear",backgroundImage:null,collaborationServer:"wss://zwibbler.com/socket2",clickToDrawShapes:!1,colourPicker:"wheel",debug:!1,defaultArrowStyle:"simple",defaultArrowSize:15,defaultArrowXOffset:null,defaultItalic:!1,defaultBold:!1,defaultBrushColour:"#000000",defaultBrushWidth:10,defaultFillStyle:"#e0e0e0",defaultFont:"Arial",defaultFontSize:20,defaultLineWidth:2,defaultPaperSize:"none",defaultRoundRectRadius:10,defaultSmoothness:"smooth",
defaultStrokeStyle:"#000000",defaultText:"Lorum ipsum dolor",defaultTextBackground:"rgba(0,0,0,0.0)",defaultTextAlign:"left",defaultTextDecoration:"none",defaultTextFillStyle:"#000000",defaultTextStrokeStyle:"#000000",defaultTextLineWidth:0,defaultZoom:1,drawShapeStyle:"box",fonts:["Arial","Times New Roman"],gridBlocks:10,gridColour:"#cccccc",gridSpacing:20,imageFolder:"$SCRIPT",iPadNoScrollText:!1,keyBringToFront:"Home",keyCancel:"ESC",keyCopy:"Ctrl+C,\u2318+C",keyCurveTool:"C",keyCut:"Ctrl+X,\u2318+X,Shift+Delete",
keyDelete:"Delete,Backspace",keyDown:"Down,Ctrl+Down",keyDuplicate:"Ctrl+D",keyEnter:"Enter",keyGroup:"Ctrl+G",keyLeft:"Left,Ctrl+Left",keyLineTool:"L",keyMoveDown:"PageDown",keyMoveUp:"PageUp",keyNext:"Down,Right",keyNextPage:"Shift+PageDown",keyPaste:"Ctrl+V,\u2318+V,Shift+Insert",keyPrevious:"Left,Up",keyPreviousPage:"Shift+Pageup",keyRedo:"Ctrl+Shift+Z",keyRight:"Right,Ctrl+Right",keySelectNone:"ESC",keySelectAll:"Ctrl+A",keySendToBack:"End",keyUndo:"Ctrl+Z",keyUngroup:"Ctrl+Shift+G",keyUp:"Up,Ctrl+Up",
keyZoomIn:"+,Shift+=",keyZoomNormal:"=",keyZoomOut:"-",keyZoomToPage:"F4",keyZoomToWidth:"Shift+F4",language:"en",latency:0,leaveTextToolOnBlur:!1,maximumZoom:0,magnet:!0,minimumZoom:0,multilineText:!1,nudge:10,outsidePageColour:"#808080",pageBorderColour:"rbga(0,0,0,0.0)",pageInflation:20,pagePlacement:"centre",pageSelectorDiv:"",pageShadow:!0,pageView:!1,pasteOffset:10,pasteOffsetX:0,pasteOffsetY:0,persistent:!1,pixelsPerUnit:1,preciseNudge:1,readOnly:!1,scrollbars:!0,setFocus:!0,showArrowTool:!0,
showBackgroundSelector:!1,showBrushTool:!0,showCircleTool:!0,showColourPanel:!0,showCopyPaste:!0,showCurveTool:!0,showDebug:!1,showFontNameProperty:!0,showFontSizeProperty:!0,showHints:!0,showImageSelector:!1,showImageTool:!1,showKeyboardHelp:!0,showLineTool:!0,showMathTool:!1,showMoveToFrontBack:!1,showPageSelector:!1,showPageSelectorControls:!0,showPickTool:!0,showPropertyPanel:!1,showRoundRectTool:!1,showRuler:!1,showShapeBrushTool:!1,showSloppinessProperty:!0,showSmoothnessProperty:!0,showSquareTool:!0,
showTextTool:!0,showToolbar:!0,showUndoRedo:!0,simulateGestures:!1,singleStrokeBrush:!1,sloppy:!1,snap:0,spotHighlightColour:"rgba(0,0,0,0.2)",spotHighlightZIndex:1,symmetry:0,textMode:"interactive",toolbarButtonSize:50,useTouch:"auto",units:"",colourPalette:"auto",drawCircleStyle:"box",enableArrowKeysNudge:!1,showMenu:!1},Ke={},Le;for(Le in Je)Ke[Le.toLowerCase()]=Le;
var Me=function(c){function a(a,d){var b=c.call(this,a,Je,d)||this;b.$c="";""===b.$c&&b.set("imageFolder",b.options.imageFolder);"auto"===b.options.useTouch&&He("Detected touch support: %s","ontouchstart"in window||"onmsgesturechange"in window);He("Detect clipboard support: %s",b.Qm());return b}__extends(a,c);a.prototype.Wm=function(){var a=Ee(),d;for(d in a)this.set(d,a[d])};a.vs=function(a){return a.toLowerCase()in Ke};a.prototype.set=function(a,d,e){void 0===e&&(e=!1);var b=this.qg[a.toLowerCase()]||
"";"debug"===b&&(b="showDebug");if(!(b in this.options))return He("Error: %s is not a configuration option.",a),!1;if("defaultZoom"===b){if("page"!==d&&"width"!==d&&!F(d)&&(d=parseFloat(d),isNaN(d)))return He("Error: Config option %s must be a number or 'page' or 'width'",b),!1}else if("allowSelectBox"!==b)if("imageFolder"===b)a=this.zv(),""===a?(this.$c=d.replace("$SCRIPT/",""),this.$c=this.$c.replace("$SCRIPT","")):this.$c=d.replace("$SCRIPT/","$SCRIPT").replace("$SCRIPT",a),""!==this.$c&&"/"!==
this.$c[this.$c.length-1]&&(this.$c+="/"),He("scriptPath=%s imageFolder=%s, result:%s",a,this.options.imageFolder,this.$c);else if("string"===typeof d)if("number"===typeof this.options[b]){if(d=parseFloat(d),isNaN(d))return He("Error: Config option %s expects a number",b),!1}else if("boolean"===typeof this.options[b]||"useTouch"===b&&"auto"!==d)d="1"===d||"true"===d||""===d;return c.prototype.set.call(this,b,d,e)};a.prototype.zv=function(){var a=Ie;var d=a.lastIndexOf("/");return a=0<=d?a.substr(0,
d+1):""};a.prototype.uz=function(){return this.options.showBrushTool};a.prototype.xz=function(){return this.options.showPropertyPanel};a.prototype.vz=function(){return this.options.showColourPanel};a.prototype.wz=function(){return this.options.showDebug};a.prototype.yz=function(){return this.options.showToolbar};a.prototype.Sa=function(a){return this.get(a)};a.prototype.get=function(a){switch(a){case "useTouch":return this.Yg();default:return c.prototype.get.call(this,a)}};a.prototype.Yg=function(){return"auto"===
this.options.useTouch?"ontouchstart"in window||"onmsgesturechange"in window:this.options.useTouch};a.prototype.Gu=function(){if("auto"===this.options.allowSelectBox){var a=this.Yg(),d=document.documentElement.offsetHeight,c=window.innerHeight,f=!a||a&&0<c-d+50;He("Allowing select box: %s (useTouch=%s, documentHeight=%s, windowHeight=%s)",f,a,d,c);return f}return this.options.allowSelectBox};a.prototype.Su=function(){var a=(""+this.options.defaultSmoothness).toLowerCase();return"sharpest"===a?0:"sharper"===
a?.1:"sharp"===a?.2:"smoothest"===a?.5:.3};a.prototype.Am=function(a){return 0===a.indexOf("http:")||0===a.indexOf("https:")||0===a.indexOf("/")?a:this.$c+a};a.prototype.Wb=function(a){return B.Wb(this.get(a))};a.prototype.gt=function(a){function b(a){for(var b="",d=0;d<a.length;d++){var c=a.charAt(d);b=c===c.toUpperCase()?b+("-"+c.toLowerCase()):b+c}return b}var c=this,f={keyCut:1,keyCopy:1,keyPaste:1},h;for(h in this.options)this.options.hasOwnProperty(h)&&(0!==h.indexOf("key")||f[h]||a.map(this.options[h],
b(h).substr(4)));this.pa("allowSystemClipboard",function(){var b=!c.Qm();b?He("Not using system clipboard. Mapping cut/copy/paste keys"):He("Using system clipboard. Ignore keyCut/keyCopy/keyPaste.");a.map(c.options.keyCut,"cut",b);a.map(c.options.keyCopy,"copy",b);a.map(c.options.keyPaste,"paste",b)})};a.prototype.iq=function(){return"radial"===this.get("drawCircleStyle")||"radial"===this.get("drawShapeStyle")?"circle":"rectangle"};a.prototype.li=function(a){var b=a;0<this.options.maximumZoom&&(a=
Math.min(a,this.options.maximumZoom));0<this.options.minimumZoom&&(a=Math.max(a,this.options.minimumZoom));a!==b&&He("Zoom restricted to %s",a);return a};a.prototype.Qm=function(){var a=document;return this.get("allowSystemClipboard")&&void 0!==a.oncopy&&void 0!==a.oncut&&void 0!==a.onpaste};return a}(Ge);var Ne=new (function(){function c(){this.om={}}c.prototype.Ti=function(){if("localStorage"in window)try{var a=window.localStorage}catch(b){}return void 0!==a};c.prototype.setItem=function(a,b){this.Ti()?window.localStorage.setItem(a,b):this.om[a]=""+b};c.prototype.getItem=function(a){return this.Ti()?window.localStorage.getItem(a):this.om[a]};c.prototype.removeItem=function(a){this.Ti()?window.localStorage.removeItem(a):delete this.om[a]};return c}());function Oe(c){function a(a){b&&clearTimeout(b);b=setTimeout(function(){b=null;c()},arguments.length?a:1E3)}var b=null;a.cancel=function(){b&&(clearTimeout(b),b=null)};return a};var Qe=function(){function c(a,b,d,c,f,h,k){this.view=a;this.node=b;this.handle=d;this.Ig=h;this.Gb=this.Fb=0;this.log=x.create("MoveEditNode");b.Bj(d);this.Ra=b.ka("snap")||0;this.Ab(c,f,k)}c.prototype.Kc=function(){this.log("Entering MoveEditNode")};c.prototype.mc=function(){this.log("Leaving MoveEditNode")};c.prototype.Ab=function(a,b){var d=this.view.Ra(new G(a,b),this.Ra);a=d.x;b=d.y;this.log("onMouseDown(%s,%s)",a,b);this.Fb=a;this.Gb=b;return!0};c.prototype.pb=function(a,b){var d=this.view.Ra(new G(a,
b),this.Ra);a=d.x;b=d.y;this.node.ge(this.handle,a,b);this.node.format(this.view.sa,this.view.request);this.view.ia();return!1};c.prototype.Db=function(a,b){var d=this,c=this.view.Ra(new G(a,b),this.Ra);a=c.x;b=c.y;this.log("onMouseUp(%s,%s)",a,b,this.Fb,this.Gb);a!==this.Fb||b!==this.Gb?(this.node.ge(this.handle,this.Fb,this.Gb),this.view.aa.transaction(function(){d.view.aa.ge(d.node.id,d.handle,a,b)})):this.view.Ex(this.node.id,this.handle);this.view.ia();this.view.Qa(this.Ig||new Pe(this.view));
return!0};return c}();function Re(c){for(var a=[],b=0;b<c.length;b++)a.push(c[b].id);return a}
var Se=function(){function c(a,b,d,c,f){this.view=a;this.handle=b;this.xy=d;new H(0,0,0,0);this.Fa=[];this.zg=[];this.Eb=new G(0,0);this.log=x.create("TransformSelectionBehaviour");this.Xj=!1;this.Ra=0;this.Ab(c,f)}c.prototype.kb=function(a){var b=this;if("gesturestart"!==a.type&&"gesturechange"!==a.type&&"gestureend"!==a.type)return!1;this.log("%s scale=%s rotation=%s",a.type,a.scale,a.rotation);this.Xj=!0;var d=this.view.Jd(a.pageX,a.pageY,!0),c=d.x;d=d.y;"gesturestart"===a.type&&(this.Eb.x=c,this.Eb.y=
d);c-=this.Eb.x;d-=this.Eb.y;var f=a.scale,h=a.rotation;this.view.Nk||(f=1);this.view.oi||(h=0);h=-h/180*Math.PI;if(0<this.view.ga.get("snap")){var k=Math.PI/16;h=Math.floor(h/k)*k}f=new Hc(f,f,this.Eb.x,this.Eb.y);h=new Gc(h,this.Eb.x,this.Eb.y);var l=(new Fc(c,d)).multiply(f).multiply(h);for(c=0;c<this.Fa.length;c++)this.Fa[c].Qg(l.multiply(this.zg[c])),this.Fa[c].format(this.view.sa,this.view.request);this.view.al(l);this.view.ia();if("gestureend"===a.type){for(c=0;c<this.Fa.length;c++)this.Fa[c].Qg(this.zg[c]);
this.view.aa.transaction(function(){b.view.aa.Nd(Re(b.Fa),l)});this.Rp()}return!0};c.prototype.Ab=function(a,b){if(this.Xj)return!0;this.Fa=this.view.Zc();this.ou(this.Fa);this.Eb=this.view.Ra(new G(a,b),this.Ra);this.log("onMouseDown(%s,%s)",this.Eb.x,this.Eb.y);new H(this.view.cd.x,this.view.cd.y,this.view.cd.width,this.view.cd.height);return!0};c.prototype.ou=function(a){this.zg=[];for(var b=0;b<a.length;b++)this.zg.push(a[b].Ja()),this.Ra=this.Ra||a[b].ka("snap")};c.prototype.pb=function(a,b){if(this.Xj)return!0;
var d=this;var c=this.view.Ra(new G(a,b),this.Ra);var f=c.x;var h=c.y;for(var k=this.handle.xg(new G(c.x-this.Eb.x,c.y-this.Eb.y)),l=0;l<this.Fa.length;l++)c=k.multiply(this.zg[l]),this.Fa[l].Qg(c),this.Fa[l].format(this.view.sa,this.view.request);this.view.al(k);this.view.ia(function(){if(d.handle instanceof Dd){var a=d.view.sa;a.save();a.beginPath();a.strokeStyle="#0050B7";a.lineWidth=1/d.view.scale;a.moveTo(d.handle.origin.x,d.handle.origin.y);a.lineTo(f,h);a.stroke();a.restore()}});return!0};
c.prototype.Db=function(a,b){var d=this;if(this.Xj)return!0;var c=a,f=b,h=this.view.Ra(new G(a,b),this.Ra);a=h.x;b=h.y;this.log("onMouseUp(%s,%s)",a,b);if(h.Lc(this.Eb))this.xy?(c=this.view.aa.xb(c,f,this.view.Ua))&&c.Ne()?(this.log("Didn't move, and has edit mode. Selecting node %s",c.id),this.view.eb(),this.view.Pg(c)):this.log("Didn't move, but node has no edit mode or failed hittest"):this.log("Didn't move, but toggleEditNode=false");else{this.log("Moved by %s,%s",a-this.Eb.x,b-this.Eb.y);var k=
this.handle.xg(new G(h.x-this.Eb.x,h.y-this.Eb.y));for(c=0;c<this.Fa.length;c++)this.Fa[c].Qg(this.zg[c]);this.view.aa.transaction(function(){d.view.aa.Nd(Re(d.Fa),k)})}this.Rp();return!0};c.prototype.Rp=function(){this.view.al(new J);this.view.mh();this.view.update(!0);this.view.ib()};return c}();var Te=function(){function c(a,b){this.view=a;this.ba=b;this.rj=!1;this.Aa=this.Ie=this.ja=null;this.fillStyle="#000000";this.Xk=!1;this.xa=new nb;this.$n="normal";this.log=x.create("Text");this.multiline=a.ga.get("multilineText");this.rb=document.createElement("div");a.ga.get("iPadNoScrollText")&&null!==navigator.userAgent.match(/iPad|iPhone|Android/i)&&(this.$n="top")}c.prototype.Kc=function(){this.log("Entering text mode");this.view.fc("text")};c.prototype.mc=function(){this.rj&&this.gj();this.view.fc("default");
this.log("Leaving text mode");this.ja&&this.ja.parentNode&&this.ja.parentNode.removeChild(this.ja);this.ja=null;this.rb.parentNode&&this.rb.parentNode.removeChild(this.rb);this.xa.Xa()};c.prototype.Ab=function(a,b,d){this.log("onMouseDown(%s)",d.type);if(this.rj){if(d.target===this.ja)return this.log("Ignore click -- its in our own edit box."),!1;this.log("Editing somewhere else on mousedown; submit that first.");this.gj();this.view.ga.get("autoPickToolText")&&this.view.ib()}else d=this.view.aa.xb(a,
b,this.view.Ua),this.Un(d,a,b);this.log("Eating click");return this.view.jm=!0};c.prototype.nu=function(){if(this.rb&&this.ja){this.rb.style.fontSize=this.ja.style.fontSize;this.rb.style.fontFamily=this.ja.style.fontFamily;this.rb.style.fontWeight=this.ja.style.fontWeight;this.rb.style.fontStyle=this.ja.style.fontStyle;this.rb.style.whiteSpace="pre-line";this.rb.style.position="absolute";this.rb.style.visibility="hidden";this.rb.style.backgroundColor="rgba(0,0,0,0.2)";document.body.appendChild(this.rb);
this.rb.style.left="0";for(this.rb.style.top="0";this.rb.firstChild;)this.rb.removeChild(this.rb.firstChild);this.rb.appendChild(document.createTextNode(this.ja.value));var a=this.rb.clientWidth,b=this.ja.clientWidth;b<a&&(b=a,this.view.ga.get("multilineText")&&b>500*this.view.scale&&(b=500*this.view.scale),this.ja.style.width=b+2+"px")}};c.prototype.Un=function(a,b,d){function c(){v.ja&&(v.log("Set editBox height to %s",""+v.ja.scrollHeight+"px"),v.ja.style.height=""+v.ja.scrollHeight+"px",v.ja.style.width=
""+v.ja.scrollWidth+"px");w=null}function f(){null===v.Aa&&v.nu()}var h=0;this.Xk=!1;if(a&&"TextNode"===a.type()||a&&"PathNode"===a.type()&&this.view.ga.get("allowTextInShape")||a&&a.Oh()){this.Aa=a;"top"!==this.$n&&"TextNode"===a.type()&&this.Aa.Zf(!0);this.view.ia();this.Ie=new G(a.rect.x,a.rect.y);if(h=a.ka("font")){h=fe(h);var k=h.fontFamily||"arial";var l=parseFloat(h.fontSize)||10;var n="bold"===h.fontWeight;var q="italic"===h.fontStyle}else k=a.ka("fontName"),l=a.ka("fontSize"),n=a.ka("bold"),
q=a.ka("italic");"TextNode"===a.type()&&(l*=a.Ja().$b().y);var u=a.ka("textDecoration");h=a.rect.width*this.view.scale;h=Math.max(h,200);this.fillStyle=a.ka("textFillStyle")||this.Oa("textFillStyle")}else this.Aa=null,this.Ie=new G(b,d),k=this.Oa("fontName"),l=this.Oa("fontSize"),n=this.Oa("bold"),q=this.Oa("italic"),u=this.Oa("textDecoration"),this.fillStyle=this.ba.fillStyle||this.Oa("textFillStyle")||this.Oa("fillStyle"),this.Oa("wrap")&&(d-=l);var v=this;this.ja=document.createElement("textarea");
a=this.ja.clientHeight;this.ja.style.width=h?""+h+"px":"auto";h=this.view.dm(this.Ie.x,this.Ie.y);this.ja.style.position="absolute";this.ja.style.fontFamily=k;this.ja.style.fontSize=""+l*this.view.scale+"px";this.ja.style.overflow="auto";this.ja.style.fontWeight=n?"bold":"normal";this.ja.style.fontStyle=q?"italic":"normal";this.ja.style.padding="0";this.ja.style.border="1px solid #888";this.ja.style.color=this.fillStyle;this.ja.style.backgroundColor=this.Oa("background");this.Aa&&"PathNode"===this.Aa.type()&&
(this.ja.style.backgroundColor="white");this.ja.style.textDecoration=u||"none";this.ja.style.textAlign=this.Oa("textAlign");this.ja.style.zIndex=""+(this.view.Cd()+1);this.log("Using z-index %s",this.ja.style.zIndex);"#ffffff"===r.Zd(this.fillStyle).toString()&&(this.ja.style.backgroundColor="#808080");k=this.view.canvas.parentElement;l=B(k).Yb();q=n=0;"top"===this.$n?(q=B(this.view.canvas.first).Yb(),n=this.view.canvas.width,h=this.ja.clientWidth,n=q.left+n/2-h/2,q=q.top):(n=Math.round(h.x)-1,q=
Math.round(h.y)-1);this.ja.style.WebkitTransitionDuration="0";this.ja.style.MozTransitionDuration="0";this.ja.style.msTransitionDuration="0";this.ja.style.OTransitionDuration="0";this.ja.style.transitionDuration="0";this.ja.style.left=n-l.left+"px";this.ja.style.top=q-l.top+"px";k.appendChild(this.ja);wc(this.ja);this.rj=!0;this.Ie=new G(b,d+a);this.Aa&&(this.ja.value=this.Aa.ka("text"));var w=null;w=setTimeout(c,0);this.xa.addEventListener(this.ja,"keydown",function(a){"keydown"===a.type&&(27===
a.keyCode&&v.multiline||13===a.keyCode&&(a.shiftKey||!v.multiline)?(v.log("Enter pressed. create text."),v.gj(),v.view.Ea.qb&&v.view.jy(),v.view.ga.get("autoPickToolText")&&v.view.ib()):27===a.keyCode?(v.log("ESC pressed; cancel."),v.cancel(),v.view.ib(),v.view.kc.na("goto-toolbar")):13===a.keyCode&&(w||(w=setTimeout(c,0))))});this.xa.addEventListener(this.ja,"input",f);this.xa.addEventListener(this.ja,"propertychange",f);this.view.ga.get("leaveTextToolOnBlur")&&(this.xa.addEventListener(this.ja,
"focus",function(){v.log("Text focus received.")}),this.xa.addEventListener(this.ja,"blur",function(){v.ja&&!v.ja.wn&&(v.log("Text blur received -- removing=%s",!0===v.ja.wn),v.ja.wn=!0,v.gj())}));setTimeout(function(){v.ja&&v.ja.focus()},200);this.ja.focus();this.view.ya.na("edit-text-shown",v.ja)};c.prototype.cancel=function(){this.ja&&(this.ja.wn=!0,this.ja.parentNode&&this.ja.parentNode.removeChild(this.ja),this.view.ya.na("edit-text-hidden"),this.view.Ea.qb&&this.view.kc.na("goto-canvas"));this.ja=
null;this.rj=!1;this.Aa&&(this.Aa.Zf(!1),this.view.ia())};c.prototype.Oa=function(a){if(this.Aa){var b=this.Aa.ka(a);if(b)return b}return a in this.ba?this.ba[a]:"background"===a?this.view.ga.get("defaultTextBackground"):"wrap"===a?this.view.ga.get("multilineText"):this.view.ta[a]};c.prototype.Pj=function(){return{textFillStyle:this.Oa("textFillStyle"),fillStyle:this.Oa("textFillStyle"),bold:this.Oa("bold"),italic:this.Oa("italic"),textDecoration:this.Oa("textDecoration"),strokeStyle:this.Oa("strokeStyle"),
lineWidth:this.Oa("lineWidth"),fontName:this.Oa("fontName"),fontSize:this.Oa("fontSize"),textAlign:this.Oa("textAlign")}};c.prototype.gj=function(){var a=this;if(this.ja){var b=this.ja.value;this.cancel();if(this.Aa&&this.Aa.ka("text")===b&&!this.Xk)this.log("Text was not changed.");else if(null===this.Aa&&""===b)this.log("No text entered.");else if(this.Aa){this.log("Update text in node %s",this.Aa.id);var d={text:b,textFillStyle:this.fillStyle,textAlign:this.Oa("textAlign"),textDecoration:this.Oa("textDecoration")};
"bold"in this.ba&&(d.bold=this.ba.bold);"italic"in this.ba&&(d.italic=this.ba.italic);this.view.aa.transaction(function(){a.view.aa.Uc([a.Aa.id],d)})}else if(this.Ie){this.log("Create new text node.");var c=0,f=this.Oa("fontSize");this.view.ga.get("multilineText")||(c=f);var h=new Fc(this.Ie.x,this.Ie.y+c);this.view.aa.transaction(function(){var d=a.view.aa.createNode("TextNode",zc({text:b,background:a.Oa("background"),fontSize:f,fontName:a.Oa("fontName"),bold:a.Oa("bold"),italic:a.Oa("italic"),textAlign:a.Oa("textAlign"),
textFillStyle:a.Oa("textFillStyle"),textDecoration:a.Oa("textDecoration"),strokeStyle:a.Oa("textStrokeStyle"),lineWidth:a.Oa("textLineWidth"),layer:a.ba.layer||a.view.Ua,wrap:a.view.ga.get("multilineText")},a.ba));a.view.aa.Nd([d],h)})}}};c.prototype.pb=function(){return!1};c.prototype.od=function(a){this.log("keyboard: %s",a);"cancel"===a&&null===this.ja&&(this.view.ib(),this.view.kc.na("goto-toolbar"))};c.prototype.Re=function(a){this.log("Set text colour to %s",a);this.Xk=!0;this.fillStyle=a;this.ba.textFillStyle=
a;this.ja&&(this.ja.style.color=a,"#ffffff"===r.Zd(a).toString()?this.ja.style.backgroundColor="#808080":this.ja.style.backgroundColor="#ffffff")};c.prototype.Se=function(a,b){this.view.Kn(a,b)};c.prototype.je=function(a,b){"defaultBold"===a?(a="bold",this.ja&&(this.ja.style.fontWeight=b?"bold":"normal")):"defaultItalic"===a?(a="italic",this.ja&&(this.ja.style.fontStyle=b?"italic":"normal")):"defaultTextBackground"===a?(a="background",this.ja&&(this.ja.style.backgroundColor=b)):"defaultFont"===a?
(a="fontName",this.ja&&(this.ja.style.fontFamily=b)):"defaultFontSize"===a?(a="fontSize",this.ja&&(this.ja.style.fontSize=b+"px")):"defaultTextFillStyle"===a?(a="textFillStyle",this.ja&&(this.ja.style.color=b)):"defaultTextDecoration"===a?(a="textDecoration",this.ja&&(this.ja.style.textDecoration=b)):"defaultTextAlign"===a&&(a="textAlign",this.ja&&(this.ja.style.textAlign=b));this.log("Update %s=%s",a,b);this.Xk=!0;this.ba[a]=b};c.prototype.ld=function(){return"text"};c.prototype.Kd=function(a,b){this.ba[a]=
b;"fillStyle"===a&&(this.ba.textFillStyle=b);if(this.ja)switch(a){case "textFillStyle":case "fillStyle":this.ja.style.color=b}};return c}();var Ue=x.create("MOVE"),Xe=function(){function c(a,b,d,c){var e=this;this.Ha=a;this.node=d;this.mk=c;this.so=!0;this.placeholder=this.lr=null;this.Xm=function(){};this.Ye=new Md;this.Il=new Wa;this.wd=null;Ue("Moving node: %s istool=%s",d.id,c);this.Aw=d.fa.style.position||"";this.yw=d.fa.style.left||"";this.Bw=d.fa.style.top||"";this.tk=d.fa.parentElement;this.Cw=B(d.fa).ce("zIndex");this.zw=d.fa.nextElementSibling;this.Kt=null!==d.fa.getAttribute("confine")||1===c;this.uk=d.Bm();var h=this.Ha.Jd(b.Fb,
b.Gb,!0);this.start=h;if(2===c){a=Ve(this.node.fa);var k=this.Ha.Jd(a.x,a.y,!0);Ue("Moving fixture from %s; tl=%s",a,k);a.x=k.x;a.y=k.y;this.node.rect=a;this.uk=this.node.rect}"IFRAME"===d.fa.tagName&&(this.so=!1);d.fa.style.position="absolute";this.so&&this.Ha.Uk.appendChild(d.fa);d.fa.style.zIndex="1";1===c&&(this.node.rect=new H(h.x-this.node.fa.offsetWidth/2,h.y-this.node.fa.offsetHeight/2,this.node.fa.offsetWidth,this.node.fa.offsetHeight),this.uk=this.node.rect,this.Xm=function(){Ue("Got image load event from dragged tool");
e.nx(h)},this.node.fa.addEventListener("load",this.Xm,!0));this.rect=this.node.Bm();d.fa.classList.add("dragging");this.Ha.aa.Mb(function(a){var b=a.rect;Zc(a)&&(b=a.Bm());e.Ye.jp(b,a.id)});this.pb(h.x,h.y,b)}c.prototype.Kc=function(){Ue("Entering DragHTMLBehaviour")};c.prototype.mc=function(){this.node.fa.style.left=this.yw;this.node.fa.style.top=this.Bw;this.node.fa.style.position=this.Aw;this.node.fa.style.zIndex=this.Cw;this.node.fa.style.transform="";this.node.fa.classList.remove("dragging");
this.tk?this.so&&this.tk.insertBefore(this.node.fa,this.zw):B(this.node.fa).remove();this.wd&&this.wd.classList.remove("drop");Ue("DragHTMLBehaviour.leave()");this.wr();this.node.fa.removeEventListener("load",this.Xm,!0);this.Il.cancel()};c.prototype.Lt=function(a,b){var d=Ve(b);d.transform(this.Ha.Rj());a.x<d.x&&(a.x=d.x);a.y<d.y&&(a.y=d.y)};c.prototype.pb=function(a,b,d){var c=this;this.Il.request(d,function(a){var b=c.Ha.Jd(a.pageX,a.pageY).ty(c.start),d=c.uk;c.rect.x=d.x+b.x;c.rect.y=d.y+b.y;
c.Kt&&c.tk&&c.Lt(c.rect,c.tk);c.Ha.ga.get("magnet")&&(b=c.Ye.oy(c.rect,c.node.id),c.rect.x+=b.x,c.rect.y+=b.y);c.node.fa.style.left=c.rect.x+"px";c.node.fa.style.top=c.rect.y+"px";b=Ve(c.node.fa);b=c.ru(b);null!==b?c.Xs(b,a.pageX,a.pageY):c.wr();a=c.node.ka("$component");var e=null,f=Ve(c.node.fa);B(c.Ha.de()).query('[z-drop-accept="'+a+'"]',function(a){var b=Ve(a),d=Math.min(f.lh(),b.lh());a!==c.node.fa&&b.hr(f)>.7*d&&(e=a)});a=e;a!==c.wd&&(c.wd&&c.wd.classList.remove("drop"),c.wd=a,c.wd&&c.wd.classList.add("drop"))});
return!0};c.prototype.ru=function(a){var b=this.node.ka("$component"),d=null;B(this.Ha.de()).query("[container-for]",function(c){We(c,b)&&Ve(c).hr(a)>.5*a.lh()&&(d=c)});return d};c.prototype.Xs=function(a,b,d){var c=0,f=null,h=new G(b,d),k=null;for(b=a.firstElementChild;b;){if(!b.classList.contains("placeholder")){k=Ve(b);k=(new G(k.x,k.y)).Lb(h);if(!f||k<c)f=b,c=k;k=b}b=b.nextElementSibling}f&&f===k&&(k=Ve(f),d>k.y&&(f=null));d=f;if(this.placeholder&&this.placeholder.parentNode){if(a!==this.placeholder.parentElement||
d!==this.lr)this.lr=d,a.insertBefore(this.placeholder,d)}else console.log("Create placeholder"),this.placeholder=B("div",{"class":"placeholder"}).Wa({flex:"0 0 "+this.node.fa.offsetHeight+"px"}).fa,a.insertBefore(this.placeholder,d)};c.prototype.wr=function(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder)};c.prototype.Db=function(a,b,d){this.Il.cancel();Ue("onMouseUp()");if(1===this.mk&&!Ve(this.Ha.canvas.first).gd(d.pageX,d.pageY))return Ue("Dropped nowhere!"),
this.Ha.Qa(new Pe(this.Ha)),!0;a="static";var c=0,f=0,h=0;b=this.Ha.aa.zf();if(this.placeholder&&this.placeholder.parentElement)if("flex"!==B(this.placeholder.parentElement).ce("display")&&(a="absolute"),d=this.Ha.aa.zm(this.placeholder)){b=d;c=this.placeholder;f=this.placeholder.parentElement.firstElementChild;for(h=0;f&&f!==c;)f.getAttribute("nid")&&h++,f=f.nextElementSibling;h=Math.min(h,d.Ma()-1);Ue("Use placeholder, place at %s:%s",b.id,h);c=this.rect.x-d.rect.x;f=this.rect.y-d.rect.y}else Ue("Placeholder is not in a NID node");
else Ue("No placeholder; add to root"),a="absolute",h=-1,c=this.rect.x,f=this.rect.y;this.Ha.Qa(new Pe(this.Ha));this.Ha.aa.Va();0===this.mk||2===this.mk?this.Ha.aa.Pc(this.node.id,b.id,h):b&&1===this.mk&&(d=this.node.Mc(),"absolute"===a&&(d["style.position"]="absolute",d["style.left"]=c+"px",d["style.top"]=f+"px"),this.Ha.aa.createNode("HTMLNode",d,b.id,h),this.Ha.eb(),this.Ha.Rd(this.node));"absolute"===a?this.Ha.aa.Uc([this.node.id],{"style.left":c+"px","style.top":f+"px","style.position":a}):
this.Ha.aa.Uc([this.node.id],{"style.left":"","style.top":"","style.position":""});this.wd&&(a=this.Ha.ya.nq(this.wd))&&(a=this.Ha.ya.Em(a),this.Ha.ya.Em(this.node.id),a&&a.element&&P.jd(a.element,"drop",this.node.Lj(null)));this.Ha.aa.va(!1);this.Ha.Qa(new Pe(this.Ha));return!0};c.prototype.nx=function(a){this.node.rect=new H(a.x-this.node.fa.offsetWidth/2,a.y-this.node.fa.offsetHeight/2,this.node.fa.offsetWidth,this.node.fa.offsetHeight);this.uk=this.node.rect};return c}();
function Ve(c){c=B(c).Yb();return new H(c.left,c.top,c.width,c.height)};var Ye=x.create("RESIZE"),Ze=function(){function c(a,b,d){this.Ha=a;this.node=b;this.jc=d;Ye("Enter resize behaviour")}c.prototype.Kc=function(){};c.prototype.mc=function(){Ye("Exit RESIZE")};c.prototype.pb=function(a,b,d){this.Ha.Jd(d.pageX,d.pageY);b=(d.pageX-d.Fb)/this.Ha.scale;var c=(d.pageY-d.Gb)/this.Ha.scale;d=this.node.rect.clone();a=this.jc;if(a&16){var f=Math.min(Math.abs(b),Math.abs(c));b=Math.sign(b)*f;c=Math.sign(c)*f}switch(a){case 25:case 22:c=b;break;case 19:case 28:c=-b}Id("D: %s,%s",
b,c);a&1&&(d.y+=c,d.height-=c);a&4&&(d.height+=c);a&8&&(d.x+=b,d.width-=b);a&2&&(d.width+=b);if(this.node.fa){a=this.node.fa;f=a.offsetParent;b=d.x;for(c=d.y;f instanceof HTMLElement&&f!==this.Ha.aa.Oc;)b-=f.offsetLeft,c-=f.offsetTop,f=f.offsetParent;f=B(a).Cm();a.style.left=b-f.left+"px";a.style.top=c-f.top+"px";a.style.width=d.width-f.Vm-f.Cn+"px";a.style.height=d.height-f.jo-f.Ml+"px"}return!0};c.prototype.Db=function(){if(!this.node.fa)throw Error("Expected element to be created");this.Ha.Qa(new Pe(this.Ha));
B(this.node.fa).Cm();this.Ha.aa.Va();this.Ha.aa.Uc([this.node.id],{"style.left":this.node.fa.style.left,"style.top":this.node.fa.style.top,"style.width":this.node.fa.style.width,"style.height":this.node.fa.style.height});this.Ha.aa.va(!1);return!0};return c}();var $e=x.create("DefaultBehaviour"),Pe=function(){function c(a){this.view=a;this.Dr=1;this.view.Pk("");if(this.Yg=this.view.ga.Yg())this.Dr=2;this.pc=new be(a)}c.prototype.Kc=function(){$e("Entering pick tool.");this.view.fc("default")};c.prototype.mc=function(){$e("Leaving pick tool.")};c.prototype.kb=function(a){return this.pc.kb(a)};c.prototype.Ab=function(a,b,d){var c,f;$e("onMouseDown");if(d.button)return $e("   -- not main button. ignore."),!1;if(this.view.ga.get("readOnly"))return(c=this.view.aa.xb(a,
b,this.view.Ua))?($e("layer=%s active=%s",c.Xb(),this.view.Ua),this.view.ya.na("node-clicked",parseInt(c.id,36),a,b)):$e("readOnly mode: Ignoring click."),!1;if(f=this.view.dv(a,b)){if(f.click())return this.view.ya.digest(),!0;this.view.Qa(new Se(this.view,f,!1,a,b));return!0}this.view.selection.length&&this.view.Uv(d)&&this.view.wh();if(this.view.Aa&&(c=this.view.Aa,f=c.Yj(a,b,1/this.view.scale*this.Dr),null!==f))return this.view.Qa(new Qe(this.view,c,f,a,b,this,d)),!0;(c=this.view.aa.xb(a,b,this.view.Ua))?
($e("layer=%s active=%s",c.Xb(),this.view.Ua),this.view.ya.na("node-clicked",parseInt(c.id,36),a,b)):c=this.view.aa.zm(d.target);f=c&&Yc(c);var h=this.view.Ye.Dm(a,b);if(c&&c.Xb()===this.view.Ua){h=c===this.view.Aa;var k=this.view.Rh(c);$e("wasEditNode: %s, wasSelected: %s",h,k);k||(d.shiftKey||this.view.eb(),this.view.Rd(c),this.view.Vb());if(f)return!1;this.view.Qa(new Se(this.view,this.view.ni?new Ed(yd,c.Ja()):new Fd,!h&&k,a,b))}else if(this.view.mr(a,b)){if(f)return!1;this.view.Qa(new Se(this.view,
this.view.ni?new Ed(yd,this.view.selection[0].Ja()):new Fd,!0,a,b))}else{if(!this.view.ga.Gu())return $e("Disabled select box -- mobile touch active."),this.view.Pg(null),this.view.eb(),this.view.Vb(),this.view.ia(),!1;0==h.length&&(this.view.Pg(null),this.view.Qa(new $d(this.view,this,a,b)))}return!0};c.prototype.pb=function(a,b){var d=this.view.Ye.Dm(a,b);d.length?this.view.fc(Jd(d[0].jc)):this.view.fc("default");return!1};c.prototype.Db=function(){$e("onMouseUp");return!1};c.prototype.br=function(a,
b,d){$e("Mouse drag!");if(Ac(d.oc.target)||this.view.ga.get("readOnly"))return!1;a=this.view.Jd(d.Fb,d.Gb,!0);b=this.view.Ye.Dm(a.x,a.y);if((a=b.length?this.view.aa.hb(b[0].id):this.view.aa.xb(a.x,a.y,this.view.rg()))&&Zc(a)){var c;if(c=b.length)a:{switch(b[0].jc){case 25:case 33:case 19:case 34:case 22:case 36:case 28:case 40:c=!0;break a}c=!1}b=c&&a.fa.hasAttribute("z-sizeable")?new Ze(this.view,a,b[0].jc,d.Fb,d.Gb):new Xe(this.view,d,a,0);this.view.Qa(b)}if(!a){a:{for(a=d.oc.target;a;){if(a.hasAttribute("z-drag-to-create")){b=
{fa:a,type:a.getAttribute("z-drag-to-create")};break a}a=a.parentElement}b=null}if(b){a=Q.Ru(b.type);a.$component=b.type;b=b.fa;c={};for(var f=0;f<b.attributes.length;f++){var h=b.attributes[f].name,k=b.attributes[f].value;if(h.startsWith("z-prop:")){h=h.substr(7);for(var l=!1,n="",q=0;q<h.length;q++){var u=h[q];"-"===u?l=!0:l?(n+=u.toUpperCase(),l=!1):n+=u.toLowerCase()}h=n;k=jc.mm(c,k,b);a[h]=k}}b=new af(this.view.aa.Fj(),this.view.aa);b.We(a);b.format(this.view.sa,this.view.request);this.view.Qa(new Xe(this.view,
d,b,1))}else(a=this.view.aa.zm(d.target))&&Zc(a)&&this.view.Qa(new Xe(this.view,d,a,2))}return!1};c.prototype.od=function(a,b){$e("keyboard: %s on target %s",a,b.target.tagName);if("INPUT"!==b.target.tagName){var d=!0,c=this.view.ga.get("nudge");b&&b.ctrlKey&&(c=this.view.ga.get("preciseNudge"));var f=this.view.Ea.qb;switch(a){case "bring-to-front":this.view.Yc(0);break;case "send-to-back":this.view.Yc(1);break;case "left":f||this.view.qk(-1,0,c)||(this.view.mb=Math.min(this.view.mb+16,0),this.view.Gc(),
this.view.ia());break;case "right":f||this.view.qk(1,0,c)||(c=this.view.um().width,this.view.mb=Math.max(-(c*this.view.scale-c),this.view.mb-16),this.view.Gc(),this.view.ia());break;case "up":f||this.view.qk(0,-1,c)||(this.view.cb=Math.min(this.view.cb+16,0),this.view.Gc(),this.view.ia());break;case "down":f||this.view.qk(0,1,c)||(c=this.view.um().height,this.view.cb=Math.max(-(c*this.view.scale-c),this.view.cb-16),this.view.Gc(),this.view.ia());break;case "select-none":this.view.eb();this.view.Vb();
this.view.ia();f&&this.view.kc.na("goto-toolbar");break;case "select-all":var h=[];this.view.aa.Mb(function(a){h.push(a)});this.view.selectNodes(h);this.view.ia();f&&this.view.kc.na("goto-toolbar");break;case "duplicate":this.view.duplicate();break;case "move-up":this.view.Yc(2);break;case "move-down":this.view.Yc(3);break;case "delete":this.view.wh();break;case "curve-tool":this.view.Fp({});break;case "line-tool":this.view.Kq({},!1,!1);break;case "group":this.view.group();break;case "ungroup":this.view.Xg();
break;case "undo":this.view.Ac();break;case "redo":this.view.Id();break;case "cut":this.view.$l();break;case "copy":this.view.nf(!1,this.view.Nc(!1));break;case "paste":this.view.gi();break;case "zoom-normal":this.view.ga.get("allowZoom")?this.view.rd(1):$e("Zooming is disabled.");break;case "zoom-in":this.view.ga.get("allowZoom")?this.view.il():$e("Zooming is disabled.");break;case "zoom-out":this.view.ga.get("allowZoom")?this.view.jl():$e("Zooming is disabled.");break;default:d=!1}d&&(b.preventDefault(),
b.stopPropagation())}};c.prototype.Re=function(a,b){if(b){this.view.Bb=a;this.view.Kb=a;var d="fillStyle"}else this.view.Tb=a,d="strokeStyle";this.view.setProperty(d,a)};c.prototype.Se=function(a,b){b?(this.view.Bb=vc(this.view.Bb,a),this.view.Kb=vc(this.view.Kb,a)):this.view.Tb=vc(this.view.Tb,a);this.view.Kn(a,b)};c.prototype.en=function(a,b){$e("onDoubleClick");var d=this.view.aa.xb(a,b,this.view.Ua);$e("hittest: %s, hasText: %s",null!==d,null!==d&&d.Oh());this.view.ya.na("double-click",a,b,d?
parseInt(d.id,36):null);if(d&&"PathNode"===d.type()&&!this.view.ga.get("allowTextInShape"))$e("Editing text in shape is disabled.");else if(d&&d.Oh()&&!this.view.ga.get("readOnly"))$e("Text double-clicked."),this.view.ao({}),this.view.qa instanceof Te&&this.view.qa.Un(d,a,b);else return!1;return!0};c.prototype.ld=function(){return"pick"};return c}();var bf=function(){function c(a,b,d){var c=this;this.view=a;this.options=b;this.mode=d;this.Te={};this.log=x.create("Brush");this.view.eb(!0);this.yr=function(){return c.ke()};this.pc=new be(this.view)}c.prototype.ke=function(){this.Zm(this.Bd()/2)};c.prototype.kb=function(a){a=this.pc.kb(a);this.pc.active&&this.reset();return a};c.prototype.Kc=function(){this.view.fc("crosshair");this.Zm(this.Bd()/2);window.addEventListener("resize",this.yr)};c.prototype.mc=function(){this.view.fc("default");this.view.Rl("brush");
window.removeEventListener("resize",this.yr)};c.prototype.reset=function(){this.Te={}};c.prototype.Zm=function(a){var b=document.createElement("canvas");a*=this.view.scale*this.view.Gh();a=Math.ceil(a+1);b.width=2*a+2;b.height=2*a+2;var d=b.getContext("2d");d.beginPath();"round"===(this.options.lineCap||"round")?d.arc(a+1,a+1,a,0,2*Math.PI):d.rect(1,1,2*a-2,2*a-2);d.lineWidth=2;d.strokeStyle="#ffffff";d.stroke();d.lineWidth=1;d.strokeStyle="#000000";d.stroke();b=b.toDataURL();this.view.fc("url("+
b+") "+(a+1)+" "+(a+1)+", auto")};c.prototype.Ng=function(a){this.options.strokeStyle=a};c.prototype.Bd=function(){var a=this.options.lineWidth;this.view.ga.get("adaptiveBrushWidth")&&(a/=this.view.scale);return a};c.prototype.Qk=function(a){this.options.lineWidth=a;this.Zm(this.Bd()/2)};c.prototype.Ab=function(a,b,d){if(this.pc.active)return!0;var c="freehand"===this.mode||"brush"===this.mode?new Vc:new Tc;c.hf(a,b);this.Te[d.pointerId]=c;return!0};c.prototype.er=function(a){var b,d,c=this.view.zp(a);
a.lineCap=this.options.lineCap||"round";a.lineJoin="round"===a.lineCap?"round":"bevel";a.lineWidth=this.Bd();var f=a.globalAlpha;"opacity"in this.options&&(a.globalAlpha=this.options.opacity);a.beginPath();for(var h in this.Te){var k=this.Te[h].Hm();a.moveTo(k[0].x,k[0].y);var l=b=1;for(d=k.length-1;b<=d;l=b+=1)l=k[l],a.lineTo(l.x,l.y)}yc(a,this.options.strokeStyle);c&&a.restore();a.globalAlpha=f};c.prototype.pb=function(a,b,d){var c=this;d.pointerId in this.Te&&(this.Te[d.pointerId].hf(a,b),"erase"===
this.options.strokeStyle?this.view.ia(function(a){return c.er(a)}):this.view.vr("brush",function(a){return c.er(a)}));return!0};c.prototype.Db=function(a,b,d){this.pb(a,b,d);this.view.Rl("brush");this.va();return!0};c.prototype.va=function(){var a,b;this.view.aa.Va();var d="";for(var c in this.Te){var f=this.Te[c].Hm();if("brush"===this.mode||"freehand"===this.mode){var h=[];1===f.length&&f.push(new G(f[0].x+.1,f[0].y+.1));if(1<f.length){d=a=0;for(b=f.length-1;a<=b;d=a+=1)h.push(f[d].x),h.push(f[d].y);
d=this.view.aa.createNode("BrushNode",zc({points:h,layer:this.view.Ua},this.options,{lineWidth:this.Bd()}))}}else{if("shapebrush"===this.mode){f=Oc(f,20);var k;var l=f;if(!(2>l.length)){a=l[0];f=l[l.length-1];h=40>a.Lb(f);for(b=0;b<l.length;b++){var n=l[b];for(k=b+1;k<l.length;k++){var q=l[k];20>Math.abs(n.x-q.x)&&(q.x=n.x);20>Math.abs(n.y-q.y)&&(q.y=n.y)}}n=H.dh(l).vd();for(b=0;b<l.length;b++)k=l[b],20>Math.abs(k.x-n.x)&&(k.x=n.x),20>Math.abs(k.y-n.y)&&(k.y=n.y);h&&(a.x=f.x,a.y=f.y)}f=l}else if("quadratic"===
this.mode){f=Oc(f,10);a=vd(f);d=a.da[1];h=a.da[2];l=a.da[4];b=a.da[5];f=a.da[8];a=a.da[9];l=((3*l-d)/2+(3*l-f)/2)/2;b=((3*b-h)/2+(3*b-a)/2)/2;k=new K;k.moveTo(d,h);k.quadraticCurveTo(l,b,f,a);d=k;h=M.qs(d);d=this.view.aa.createNode("PathNode",zc({commands:h,fillStyle:this.view.Bb,sloppiness:0,layer:this.view.Ua},this.options,{lineWidth:this.Bd()}));continue}1===f.length&&"freehand"===this.mode&&f.push(new G(f[0].x+.1,f[0].y+.1));if(1<f.length){h=new N;h.moveTo(f[0].x,f[0].y);a=f[0].Lc(f[f.length-
1]);d=b=1;for(l=f.length-1;b<=l;d=b+=1)h.lineTo(f[d].x,f[d].y);a&&h.close();d=this.view.aa.createNode("PathNode",zc({commands:h.Jb(),fillStyle:this.view.Bb,sloppiness:0,layer:this.view.Ua},this.options,{lineWidth:this.Bd()}))}}}this.view.aa.va();this.view.eb();c=this.view.aa.hb(d);this.view.ga.get("singleStrokeBrush")?(c&&this.view.Rd(c),this.view.ib()):this.reset();this.view.Vb()};c.prototype.Re=function(a,b){this.options.strokeStyle=a;if(b){this.view.Bb=a;this.view.Kb=a;var d="fillStyle"}else this.view.Tb=
a,d="strokeStyle";this.view.setProperty(d,a)};c.prototype.Se=function(a){this.view.Kb=vc(this.view.Kb,a);this.options.strokeStyle=vc(this.options.strokeStyle,a);this.view.Bb=this.view.Kb};c.prototype.od=function(a){this.log("keyboard: %s",a);"cancel"===a&&(this.log("ESC pressed. Abort brush and go back to toolbar."),this.view.ib(),this.view.kc.na("goto-toolbar"))};c.prototype.je=function(a,b){"defaultBrushWidth"===a?this.Qk(b):"defaultBrushColour"===a&&this.Ng(b)};c.prototype.Kd=function(a,b){switch(a){case "lineWidth":this.Qk(b);
break;case "strokeStyle":case "fillStyle":this.Ng(b)}};c.prototype.ld=function(){return"circle"===this.mode?"ellipse":this.mode};c.prototype.Pj=function(){return this.options};return c}();var cf=function(){function c(a,b,d,c,f){void 0===d&&(d={});void 0===c&&(c=!1);void 0===f&&(f=!1);this.view=a;this.type=b;this.ba=d;this.Mn=c;this.cj=f;this.node=null;this.rm=new G(0,0);this.ik=new G(0,0);this.index=0;this.state="start";this.log=x.create("DRAWLINES");"wrap"in this.ba||(this.ba.wrap=this.view.ga.get("multilineText"));"fontSize"in this.ba||(this.ba.fontSize=this.view.ga.get("defaultFontSize"));this.pc=new be(this.view);this.view.eb(!0)}c.prototype.Kc=function(){this.log("Entering DrawLinesBehaviour");
this.view.fc("crosshair");this.view.ga.Yg()||this.view.Pk("click-to-place-first-point-of-line");this.view.ia()};c.prototype.reset=function(){this.Kc()};c.prototype.kb=function(a){a=this.pc.kb(a);this.pc.active&&this.node&&this.reset();return a};c.prototype.od=function(a){"cancel"===a&&(null!==this.node&&this.view.Ea.qb&&"curve"===this.type&&this.va(),null!==this.node&&(this.view.aa.Va(),this.view.aa.Ub([this.node.id]),this.view.aa.va(!0)),this.view.Ea.qb?this.view.kc.na("goto-toolbar"):this.view.ib())};
c.prototype.done=function(){this.view.ga.get("autoPickTool")?this.view.ib():this.state="start"};c.prototype.hf=function(a,b){this.node instanceof M&&("curve"===this.type||"arrow"===this.type||"linear-bezier"===this.type?this.node.vh(a,b):this.node.lineTo(a,b))};c.prototype.Ab=function(a,b){var d=this.view.Ra(new G(a,b));this.log("onMouseDown(%s, %s) state=%s, index=%s",a,b,this.state,this.index);if("start"===this.state){this.rm=d;var c={seed:Math.round(65535*Math.random()),strokeStyle:this.view.Tb,
lineWidth:this.Bd(),sloppiness:this.view.ta.sloppiness,smoothness:this.view.ta.smoothness};"arrow"===this.type&&(c.arrowSize=this.view.ga.Sa("defaultArrowSize"),c.arrowStyle=this.view.ga.Sa("defaultArrowStyle"),c.arrowXOffset=this.view.ga.Sa("defaultArrowXOffset"));for(var f in this.ba)this.ba.hasOwnProperty(f)&&(c[f]=this.ba[f]);this.view.aa.Va();c=this.view.aa.createNode("PathNode",c);this.view.aa.va(!0);this.node=this.view.aa.hb(c);this.node.moveTo(d.x,d.y);this.hf(d.x,d.y);this.index=3;this.view.update();
this.state="predrag"}else if("placing"===this.state)if(c=this.ik.Lb(d),this.log("Mouse moved by %s",c),"arrow"!==this.type&&8>this.rm.Lb(d)&&3<this.index)this.log("Clicked close to start; automatically closing path"),this.node instanceof M&&this.node.close(),this.va(),this.done();else if(8>this.ik.Lb(d))this.log("Didn't move. Stop drawing."),this.Bp(),this.done();else{if(this.Mn)return this.va(),this.done(),!0;this.node&&(this.hf(d.x,d.y),this.index+=3,this.view.aa.Xh(this.node.id),this.view.update())}else return this.log("Invalid state %s",
this.state),!0;this.ik=new G(d.x,d.y);return!0};c.prototype.Bp=function(){3<this.index?(this.node instanceof M&&this.node.qx(this.index),this.va()):this.cancel()};c.prototype.Db=function(a,b){var d=new G(a,b);d=this.rm.Lb(d);this.log("onMouseUp (%s,%s) %s",a,b,this.state);"predrag"===this.state&&(this.log("MovedBy: %s",d),10<d?(this.va(),this.done()):(this.state="placing",this.view.Pk("click-to-place-another-point-or-double-click-to-end-the-line")));return!0};c.prototype.pb=function(a,b,d){b=this.view.Ra(new G(a,
b));a=b.x;b=b.y;if(d.ctrlKey||this.cj){d=this.ik;var c=Math.atan2(b-d.y,a-d.x),f=Math.PI/8;c>=-f&&c<f?b=d.y:c>=f&&c<3*f?(a=Math.max(b-d.y,a-d.x),b=d.y+a,a=d.x+a):c>=3*f&&c<5*f?a=d.x:c>=5*f&&c<7*f?(a=Math.max(b-d.y,d.x-a),b=d.y+a,a=d.x-a):c>=7*f||c<=7*-f?b=d.y:c<5*-f?(a=Math.max(d.y-b,d.x-a),b=d.y-a,a=d.x-a):c<3*-f?a=d.x:(a=Math.max(d.y-b,a-d.x),b=d.y-a,a=d.x+a)}this.node&&(this.node.ge(this.index,a,b),this.node.format(this.view.sa,this.view.request),this.view.ia());return!1};c.prototype.xk=function(){this.log("onMouseClick()");
return!0};c.prototype.Nt=function(a){for(var b=0,d=[],c,f,h,k,l,n;b<a.length;){var q=a[b];switch(q){case M.cg:h=a[b+1];k=a[b+2];d.push(q,h,k);break;case M.xe:c=a[b+1],f=a[b+2],void 0!==h&&void 0!==k&&void 0!==l&&void 0!==n&&d.push(M.bh,c,f,(l+h)/2,(n+k)/2,(h+c)/2,(k+f)/2),l=h,n=k,h=c,k=f}b+=M.$a[q]+1}return d};c.prototype.va=function(){var a=this;if(this.node){this.node instanceof M&&this.node.jt();this.view.aa.Va();this.view.aa.Ub([this.node.id]);this.view.aa.va(!0);var b=this.view.ga.Sa("defaultArrowSize"),
d=this.node.ka("commands");"linear-bezier"===this.type&&(d=this.Nt(d));var c={arrowSize:"arrow"===this.type?b:0,arrowStyle:this.view.ga.Sa("defaultArrowStyle"),arrowXOffset:this.view.ga.Sa("defaultArrowXOffset"),commands:d,seed:this.node.ka("seed"),fillStyle:this.view.Bb,strokeStyle:this.view.Tb,lineWidth:this.Bd(),sloppiness:this.view.ta.sloppiness,smoothness:this.view.ta.smoothness,layer:this.view.Ua},f;for(f in this.ba)this.ba.hasOwnProperty(f)&&(c[f]=this.ba[f]);this.view.aa.transaction(function(){a.view.aa.createNode("PathNode",
c)});this.node=null}};c.prototype.cancel=function(){this.node&&(this.view.aa.Va(),this.view.aa.Ub([this.node.id]),this.view.aa.va(!0),this.node=null)};c.prototype.mc=function(){this.Bp();this.view.fc("default");this.view.Pk("");this.view.ia()};c.prototype.Re=function(a,b){if(b){this.view.Bb=a;this.view.Kb=a;var d="fillStyle";this.log("We are drawing lines. Set strokeStyle instead of fillStyle")}else d="strokeStyle";this.view.Tb=a;this.view.setProperty(d,a)};c.prototype.Se=function(a,b){b?(this.view.Bb=
vc(this.view.Bb,a),this.view.Kb=vc(this.view.Kb,a)):this.view.Tb=vc(this.view.Tb,a);this.view.Kn(a,b)};c.prototype.ld=function(){return this.type};c.prototype.Kd=function(a,b){this.ba[a]=b};c.prototype.Bd=function(){return this.view.jh(this.view.ta.lineWidth)};return c}();var df=function(){function c(a,b,d,c,f,h,k,l){var e=this;this.view=a;this.nodeType=b;this.ba=d;this.width=c;this.height=f;this.Er=h;this.zy=k;this.state="initial";this.start=new G(0,0);this.end=new G(0,0);this.node=null;this.log=x.create("DrawShape");"rectangle-tl"===h&&(this.Lp=function(a){a.lineWidth=1/e.view.scale;a.strokeStyle="#ccc";a.beginPath();a.rect(e.start.x,e.start.y,e.end.x-e.start.x,e.end.y-e.start.y);a.stroke()});this.sp=null===l?this.view.ga.get("autoPickTool"):l;this.pc=new be(this.view);
this.view.eb(!0)}c.prototype.Lp=function(){};c.prototype.Kc=function(){this.log("Entering DrawShapeBehaviour");this.view.fc("crosshair")};c.prototype.mc=function(){this.log("Leaving DrawShapeBehaviour");this.cancel()};c.prototype.cancel=function(){this.node&&(this.view.aa.Va(),this.view.aa.Ub([this.node.id]),this.view.aa.va(!0),this.view.update(),this.node=null);this.state="initial"};c.prototype.kb=function(a){a=this.pc.kb(a);this.node&&this.pc.active&&(this.view.aa.Va(),this.view.aa.Ub([this.node.id]),
this.view.aa.va(!0),this.node=null,this.state="initial");return a};c.prototype.od=function(a){"cancel"===a&&this.view.ib()};c.prototype.Ab=function(a,b){"initial"===this.state&&(this.start=this.view.Ra(new G(a,b)),this.state="predraw",this.log("initial -> predraw"));return!0};c.prototype.pb=function(a,b,d){a=this.view.Ra(new G(a,b));d=d.ctrlKey;"predraw"===this.state&&10<this.start.Lb(a)&&(this.create(),this.state="drawing",this.log("predraw -> drawing"));"drawing"===this.state&&(this.transform(this.start,
a,d),this.end=a,this.view.update(!1,this.Lp));return!0};c.prototype.Db=function(a,b,d){"predraw"===this.state?this.view.ga.get("clickToDrawShapes")?(this.create(),this.transform(this.start,null,d.ctrlKey),this.va(),this.sp&&this.view.ib(),this.state="initial"):this.cancel():"drawing"===this.state&&(this.transform(this.start,this.view.Ra(new G(a,b)),d.ctrlKey),this.va(),this.sp&&this.view.ib(),this.state="initial");return!0};c.prototype.create=function(){this.view.aa.Va();var a=this.view.aa.createNode(this.nodeType,
this.ba);this.node=this.view.aa.hb(a);this.view.aa.va(!0)};c.prototype.transform=function(a,b,d){if(b)if("circle"===this.Er){var c=a;a=a.Lb(b);var f=2*a/this.width;a=2*a/this.height}else{if("rectangle-tl"===this.Er)a=a.clone(),b=b.clone(),a.x>b.x&&(f=a.x,a.x=b.x,b.x=f),a.y>b.y&&(f=a.y,a.y=b.y,b.y=f),c=a;else if(f=[a,b],0===f.length)c=new G(0,0);else{c=f[0].x;for(var h=f[0].y,k=1;k<f.length;k++)c+=f[k].x,h+=f[k].y;c=new G(c/f.length,h/f.length)}f=(b.x-a.x)/this.width;a=(b.y-a.y)/this.height}else c=
a,a=f=1;d&&(a=f=Math.min(f,a));d=new Fc(c.x,c.y);d=d.multiply(new Hc(f,a));this.node&&(this.node.Qg(d),this.view.aa.Xh(this.node.id))};c.prototype.va=function(){var a=this;this.node&&(this.ba.matrix=this.node.Ja(),this.view.aa.Va(),this.view.aa.Ub([this.node.id]),this.view.aa.va(!0),this.node=null,this.view.aa.transaction(function(){a.view.aa.createNode(a.nodeType,a.ba)}))};c.prototype.Qk=function(a){this.ba.lineWidth=this.view.jh(a)};c.prototype.Re=function(a,b){Pe.prototype.Re.call(this,a,b);this.ba[b?
"fillStyle":"strokeStyle"]=a};c.prototype.Se=function(a,b){Pe.prototype.Se.call(this,a,b);var d=b?"fillStyle":"strokeStyle",c=vc(this.ba[d],a);this.log("oldColour=%s+opacity %s = %s",this.ba[d],a,c);this.ba[d]=c};c.prototype.ld=function(){return this.zy};c.prototype.Kd=function(a,b){this.ba[a]=b};c.prototype.Pj=function(){return this.ba};c.prototype.je=function(a,b){"defaultLineWidth"===a&&this.Qk(b)};return c}();for(var ef,ff=[],gf=0;4>gf;gf++)ff.push(String.fromCharCode(">2$-".charCodeAt(gf)^"zwibbler3".charCodeAt(gf%9)));ef=ff.join("");for(var hf,jf=[115,116,114,111,107,101,84,101,120,116],kf=[],lf=0;lf<jf.length;lf++)kf.push(String.fromCharCode(jf[lf]));hf=kf.join("");
var mf=function(){function c(a,b,d,e,f,h,k,l,n,q){var u=this;this.vc=a;this.canvas=b;this.aa=d;this.kc=e;this.ga=f;this.language=h;this.ya=k;this.xa=l;this.Uk=n;this.jf=q;this.Pd="none";this.xi=this.wi=0;this.scale=1;this.cb=this.mb=0;this.cd=new H(0,0,0,0);this.Dn=new Pc;this.ni=this.oi=this.Nk=!0;this.Mk=new J;this.selection=[];this.Wf=[];this.Ua="default";this.re=this.jm=!1;this.hd=1;this.background=this.ze=null;this.Ui={};this.tp=null;this.backgroundRepeat="no-repeat";this.xd=this.Aa=null;this.Io=
4;this.Jo=3*this.Io;this.af=this.Ah=null;this.gg=!1;this.Kb=this.Bb=this.Tb="#000000";this.mg=5;this.yg="";this.ec=0;this.bn=new H(0,0,0,0);this.cn=new H(0,0,0,0);this.Ea={qb:!1,Cb:!1,Ol:!1,x:100,y:100};this.ak=new Za;this.Uj=[];this.Ye=new Md;this.log=x.create("VIEW");this.sa=this.canvas.get(0);this.canvas.Rs();this.re=!0===f.get("pageView");this.ox();this.qa=new Pe(this);this.xa.add(function(){u.qa&&u.qa.mc&&u.qa.mc();u.request.qh();u.md.qh();u.rc.qh();u.qa={};u.aa.Xa()});this.md=new xd("horizontal",
!0,this.xa);this.md.Xc(this.canvas.get(0).canvas.parentNode);this.rc=new xd("vertical",!1,this.xa);this.rc.Xc(this.canvas.get(0).canvas.parentNode);var v=this;this.request=new Be;this.request.canvas=this.canvas.get(0).canvas;this.request.ga=this.ga;this.request.pa("reformat",function(a){u.log("Node %s requests reformat",a);u.aa.Je(a)&&(u.log("   Reformatting... zoom=%s",u.Pd),u.aa.Xh(a));u.update();(a=u.aa.hb(a))&&"background"===a.Xb()&&u.uh();u.Mg();u.ya.na("resource-loaded")});this.request.pa("convert-dom-request",
function(a,b){v.ya.na("convert-dom-request",b,a)});this.request.pa("mouseevent",function(a){u.By.handleEvent(a)});f.pa("useTouch",function(){v.af=null;v.Jo=3*v.Io});this.rc.pa("scroll",function(a){v.cb=-a*v.scale;v.ya.na("scroll");u.ko();v.ia()});this.md.pa("scroll",function(a){v.mb=-a*v.scale;v.ia();u.ko();v.ya.na("scroll")});this.uh();this.aa=this.Yf(d);this.ga.pa("update",function(a,b){v.je(a,b)});this.xa.addEventListener(document,"webkitfullscreenchange",function(){0<=navigator.userAgent.search("Safari")&&
0>navigator.userAgent.search("Chrome")&&(u.log("SAFARI WORKAROUND: Disabling requestAnimationFrame."),u.requestAnimationFrame=c.prototype.requestAnimationFrame)});a=document;a.fonts&&this.xa.addEventListener(a.fonts,"loadingdone",function(){u.log("Font loading done, redraw now.");u.ia()});this.Wc(.5,0,0,-30,"","rotate");this.Wc(0,0,0,0,"","scale");this.Wc(1,0,0,0,"","scale");this.Wc(1,1,0,0,"","scale");this.Wc(0,1,0,0,"","scale");this.Wc(.5,0,0,0,"","scale");this.Wc(1,.5,0,0,"","scale");this.Wc(.5,
1,0,0,"","scale");this.Wc(0,.5,0,0,"","scale");this.qa=this.ib()}c.prototype.jh=function(a){this.ga.get("adaptiveBrushWidth")&&(a/=this.scale);return a};c.prototype.Iv=function(a){var b,d=!1;for(b=0;b<a.Ik.length;b++){var c=a.Ik[b];c in this.Ui&&(this.log("Background node has been removed"),d=!0)}for(b=0;b<a.Pi.length;b++){c=a.Pi[b];var f=this.aa.Ka(c,!1);"background"===f.ka("layer")&&(this.log("Background node has been added"),d=!0)}for(b=0;b<a.dl.length;b++)c=a.dl[b],f=this.aa.Ka(c,!1),"background"===
f.ka("layer")?(this.log("Background node has been changed"),d=!0):c in this.Ui&&(this.log("Node removed from background layer"),d=!0);d&&this.uh();a.Pi.length&&this.ya.na("nodes-added",a.Pi);a.dl.length&&this.ya.na("nodes-changed",a.dl);a.Ik.length&&this.ya.na("nodes-removed",a.Ik)};c.prototype.requestAnimationFrame=function(a){a()};c.prototype.rg=function(){this.log("getActiveLayer() -> %s",this.Ua);return this.Ua};c.prototype.Ok=function(a){this.log("setActiveLayer(%s)",a);this.Ua=a;this.eb();this.Vb();
this.ia()};c.prototype.si=function(a,b){this.aa.si(a,b);this.Dg(!1);b||a!==this.Ua||(this.eb(),this.Vb());this.ia()};c.prototype.Yf=function(a){var b=this;this.log("setDocument()");this.ib();this.aa.Xa();this.aa=a;this.aa.gr=function(a,d,c,k){b.wk(a,d,c,k)};this.scale=1;this.cb=this.mb=0;this.selection=[];this.xd=this.Aa=null;this.ec+=1;this.cd=new H(0,0,0,0);this.Dn=new Pc(this.cd);this.Mk=new J;this.yg="";this.Ua="default";this.Bb="#ffffff";this.Kb=this.ga.Sa("defaultBrushColour");this.Tb=this.ga.Sa("defaultStrokeStyle");
this.ta={};this.ta.lineWidth=this.ga.Sa("defaultLineWidth");this.ta.sloppiness=.5;this.ta.fontName=this.ga.Sa("defaultFont");this.ta.fontSize=this.ga.Sa("defaultFontSize");this.ta.bold=this.ga.Sa("defaultBold");this.ta.italic=this.ga.Sa("defaultItalic");this.ta.smoothness=.3;this.ta.textFillStyle=this.ga.Sa("defaultTextFillStyle");this.ta.textStrokeStyle=this.ga.Sa("defaultTextStrokeStyle");this.ta.textLineWidth=this.ga.Sa("defaultTextLineWidth");this.ta.textDecoration=this.ga.Sa("defaultTextDecoration");
this.ta.textAlign=this.ga.Sa("defaultTextAlign");this.mg=this.ga.get("defaultBrushWidth");var d=this.xf();this.mb=-d.x;this.cb=-d.y;this.Gc();this.aa.Rn=this.ga.get("spotHighlightColour");this.aa.Sk=this.ga.get("spotHighlightZIndex");this.aa.format(this.sa,this.request);this.cn=new H(0,0,0,0);this.bn=new H(0,0,0,0);"none"!==this.Pd?this.rd(this.Pd):(this.rd(this.ga.get("defaultZoom")),this.ia());return a};c.prototype.je=function(a,b){var d=!1;switch(a){case "allowResize":this.mh();this.ia();break;
case "defaultBrushColour":this.Kb=b;break;case "defaultFillStyle":this.Bb=this.ta.fillStyle=b;break;case "defaultStrokeStyle":this.Tb=b;this.ta.strokeStyle=b;break;case "defaultLineWidth":this.ta.lineWidth=b;break;case "defaultFont":this.ta.fontName=b;break;case "defaultBold":this.ta.bold=b;break;case "defaultTextAlign":this.ta.textAlign=b;break;case "defaultTextDecoration":this.ta.textDecoration=b;break;case "defaultItalic":this.ta.italic=b;break;case "defaultFontSize":this.ta.fontSize=b;break;case "defaultTextFillStyle":this.ta.textFillStyle=
b;break;case "defaultTextStokeStyle":this.ta.textStrokeStyle=b;break;case "defaultTextLineWidth":this.ta.textLineWidth=b;break;case "defaultBrushWidth":this.mg=b;break;case "defaultZoom":this.rd(b);break;case "pageView":this.re=b;d=!0;break;case "pagePlacement":case "pageInflation":this.rd(this.Pd);break;case "snap":case "background":case "gridSpacing":case "gridBlocks":case "gridColour":this.uh();d=!0;break;case "pageShadow":case "outsidePageColour":d=!0;break;case "readOnly":!0===b&&(this.ib(),
this.eb(),this.Vb(),d=!0);this.aa.Rg(b);break;case "spotHighlightColour":this.aa.Rn=b;d=!0;break;case "spotHighlightZIndex":this.aa.Sk=b;d=!0;break;case "showRuler":case "pixelsPerUnit":case "units":d=!0}this.qa.je&&this.qa.je(a,b);d&&this.ia()};c.prototype.qe=function(a,b){this.ta[a]=b;switch(a){case "fillStyle":this.Kb=this.Bb=b;break;case "strokeStyle":this.Kb=this.Tb=b}};c.prototype.rd=function(a){a!==this.Pd&&this.log("Zooming to: %s (scale %s)",a,this.scale);var b=this.Ke().width-20;var d=this.aa.Lv()||
this.re;var c=!0;this.Pd=a;d||"number"===typeof a||(this.log("WARNING: Cannot zoom to page/width because the document size has not been set."),c="page"===a||"width"===a);if("number"===typeof a)this.scale=a;else if("none"===a||this.aa.empty()||!d)this.scale=1;else{if("page"===a)return d=this.xf(),this.Tg(d,"centre"===this.ga.get("pagePlacement"),!0),this.Pd=a,this.qa.ke&&this.qa.ke(),c;"width"===a&&(d=this.xf(),this.scale=b/d.width,this.mb=-d.x*this.scale,this.cb=-d.y*this.scale,this.log("RECT=%s scale=%s tx=%s ty=%s",
d,this.scale,this.mb,this.cb),this.Pd=a)}this.Gc();this.ia();this.qa.ke&&this.qa.ke();return c};c.prototype.Jd=function(a,b,d){void 0===d&&(d=!1);a=this.Rj().apply(a,b);d||(a=this.Ra(a));return a};c.prototype.dm=function(a,b){return this.Rj().inverse().apply(a,b)};c.prototype.vw=function(a,b,d){return a.ae().multiply(this.Rj()).apply(b,d)};c.prototype.te=function(a){return this.Jd(a.pageX,a.pageY,!0)};c.prototype.od=function(a,b){if("TEXTAREA"!==b.target.tagName&&"INPUT"!==b.target.tagName&&"BUTTON"!==
b.target.tagName&&!b.target.isContentEditable&&(this.qa.od&&this.qa.od(a,b),!this.Jv(a,b))){switch(a){case "next-page":this.zc(this.aa.ab+1);break;case "previous-page":this.zc(this.aa.ab-1);break;case "zoom-to-page":this.ga.get("allowZoom")&&this.rd("page");break;case "zoom-to-width":this.ga.get("allowZoom")&&this.rd("width")}b.preventDefault();b.stopPropagation()}};c.prototype.Ck=function(a){var b=a instanceof Rd?a.oc.target:a.target;var d=this.ga.get("readOnly");b=b&&b.matches&&(!b.matches(".zwibbler-canvas-holder,.zwibbler-canvas-holder *, [z-drag-tool], [z-drag-tool] *, [z-fixture] *")||
b.matches(".zwibbler-passthrough, .zwibbler-passthrough *")||d&&b.matches(".zwibbler-dom-node,.zwibbler-dom-node *"));a instanceof Rd&&((b=b&&!a.getData("not-passthrough"))||"down"!==a.type||a.setData("not-passthrough",!0));return b};c.prototype.ox=function(){function a(a){d.log(a.type)}function b(a){a.stopPropagation();a.preventDefault()}var d=this,c=this,f=new Yd(this.vc,{mp:this.ga.get("allowPointerEvents"),oo:!0});this.By=f;this.xa.add(function(){f.Xa()});f.pa("gesturestart",function(a){c.log("GestureStart");
c.qa.kb&&!1!==c.qa.kb(a)?(a.stopPropagation(),a.preventDefault()):c.log("Pass to browser")});f.pa("gesturechange",function(a){c.qa.kb&&!1!==c.qa.kb(a)?(a.stopPropagation(),a.preventDefault()):c.log("Pass to browser")});f.pa("gestureend",function(a){c.log("GestureEnd");c.qa.kb&&!1!==c.qa.kb(a)?(a.stopPropagation(),a.preventDefault()):c.log("Pass to browser")});var h="onpointerdown"in window,k="ongesturestart"in window,l="onmousedown"in window;this.log("Have TouchEvents: %s","ontouchstart"in window);
this.log("Have PointerEvents: %s",h);this.log("Have GestureEvents: %s",k);this.log("Have MouseEvents: %s",l);h&&!this.ga.get("allowPointerEvents")&&this.log("Configuration does not allow PointerEvents");var n=!1,q;f.pa("down",function(a){c.log(a.toString());d.Ck(a)||(n=!0,c.qa.Ab&&(q=c.te(a),!1!==c.qa.Ab(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault())),d.jm||d.kc.na("goto-canvas"),d.jm=!1)});f.pa("move",function(a){d.Ck(a)||(n&&0===a.buttons&&(c.log("MISSED POINTERUP! Fixing."),u(a)),c.qa.pb&&
(q=c.te(a),!1!==c.qa.pb(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault())))});var u=function(a){d.Ck(a)||(n=!1,c.log(a.toString()),q=c.te(a),c.qa.Db&&!1!==c.qa.Db(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault()))};f.pa("up",u);f.pa("tap",function(a){c.log(a.toString());c.qa.xk&&(q=c.te(a),!1!==c.qa.xk(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault()))});f.pa("drag",function(a){c.log(a.toString());c.qa.br&&(q=c.te(a),!1!==c.qa.br(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault()))});f.pa("doubletap",
function(a){c.log("doubletap: "+a.toString());c.qa.en&&(q=c.te(a),!1!==c.qa.en(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault()))});this.xa.addEventListener(this.vc,"pointerleave",function(a){c.qa.cr&&(q=c.te(a),!1!==c.qa.cr(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault()))});this.xa.addEventListener(this.vc,"contextmenu",function(a){var b=c.te(a);c.qa.Yq&&!1!==c.qa.Yq(b.x,b.y,a)?(a.stopPropagation(),a.preventDefault()):c.log("Pass contextmenu to browser")});this.xa.addEventListener(this.vc,
"mouseenter",b);this.xa.addEventListener(this.vc,"mouseleave",b);this.xa.addEventListener(this.vc,"mouseover",b);this.xa.addEventListener(this.vc,"mouseout",b);!window.parent&&this.ga.get("setFocus")&&this.vc.focus();f.pa("wheel",function(a){if(!d.Ck(a)){var b=-40*a.Tu().y,e=b/120*32;q=c.te(a);if((!c.qa.gn||!1===c.qa.gn(q.x,q.y,e,a.oc))&&c.rc.Vv()){var f=c.xf();c.cb=-120>=b?Math.max(c.cb+e,-(f.bottom()*c.scale-c.canvas.height)):Math.min(c.cb+e,-f.y*c.scale);c.Gc();c.ia();a.stopPropagation();a.preventDefault()}}});
this.xa.addEventListener(this.vc,"dragover",function(a){c.log("Dragover");a.preventDefault()});this.xa.addEventListener(this.vc,"drop",a);this.xa.addEventListener(this.vc,"dragenter",a);this.xa.addEventListener(this.vc,"dragleave",a)};c.prototype.Hf=function(a){this.log("Received clipboard event: %s",a.type);if(this.ga.get("allowSystemClipboard"))if(null===a.clipboardData)this.log("Ignored; clipboardData is null.");else{var b=this;switch(a.type){case "copy":case "cut":if(!this.vq())break;this.log("Cut to system clipboard.");
var d=this.nf(!0,this.Nc(!1));a.clipboardData.setData("application/zwibbler",d);a.preventDefault();"cut"===a.type&&this.wh();break;case "paste":for(this.log("There are %s items on the clipboard",a.clipboardData.items.length),d=0;d<a.clipboardData.items.length;d++){var c=a.clipboardData.items[d];this.log("Item [%s] type is %s",d,c.type);if(b.rn(c)){a.preventDefault();break}else if("application/zwibbler"===c.type){this.log("Pasting from system clipboard");c.getAsString(function(a){b.gi(a)});a.preventDefault();
break}}}}else this.log("   ignored due to allowSystemClipboard setting.")};c.prototype.de=function(){return this.vc};c.prototype.rn=function(a){var b=this;if(0!==a.type.indexOf("image/"))return!1;a instanceof File||(a=a.getAsFile());var d=new FileReader;d.readAsDataURL(a);d.onloadend=function(){b.tw(d.result)};return!0};c.prototype.Jv=function(a,b){if(!this.Ea.qb)return!1;var d=0,c=0,f=this.ga.get("nudge");switch(a){case "right":d=f;break;case "left":d=-f;break;case "down":c=f;break;case "up":c=-f;
break;case "enter":if(this.qa.xk){this.Ea.Cb=!1;var h="tap"}else this.Ea.Cb=!this.Ea.Cb,h=this.Ea.Cb?"down":"up"}if(d||c)h=this.Ke(),this.Ea.x+=d,this.Ea.x=Math.max(this.Ea.x,0),this.Ea.x=Math.min(h.width,this.Ea.x),this.Ea.y+=c,this.Ea.y=Math.max(this.Ea.y,0),this.Ea.y=Math.min(h.height,this.Ea.y),this.ia(),h="move";return h?(b.preventDefault(),b.stopPropagation(),this.ia(),c=B(this.canvas.first).Yb(),d=this.Ea.x+c.left-window.pageXOffset,f=this.Ea.y+c.top-window.pageYOffset,c=this.Jd(d,f),this.log("Simulate a %s at (%s,%s)",
h,d,f),d=new Rd(h,d,f,d,f,(new Date).getTime(),(new Date).getTime(),b.target,b,0,{},0,0,0,!1,!1),"down"!==h&&"tap"!==h||!this.qa.Ab||this.qa.Ab(c.x,c.y,d),"move"===h&&this.qa.pb&&this.qa.pb(c.x,c.y,d),"up"!==h&&"tap"!==h||!this.qa.Db||this.qa.Db(c.x,c.y,d),!0):!1};c.prototype.Ln=function(a){void 0===a&&(a=!1);this.Ea.qb=!0;this.Ea.Cb=!1;this.Ea.Ol=a;this.log("Showing keyboard cursor, caret=%s",a);this.ia()};c.prototype.jy=function(){this.Ea.qb=!0;this.Ea.Ol=!1;if(0<this.selection.length){this.log("showKeyboardCursorAndStartMoving()");
this.Ea.Cb=!0;var a=this.cd.vd();this.Ea.x=a.x;this.Ea.y=a.y;this.ib();this.Qa(new Se(this,new Ed(yd,this.selection[0].Ja()),!1,a.x-4,a.y-4))}this.ia()};c.prototype.Mv=function(){this.Ea.qb&&(this.log("Hiding keyboard cursor"),this.Ea.qb=!1,this.ia())};c.prototype.Uv=function(a){var b=B(this.canvas.first).Yb(),d=this.rc.vg();var c=a.pageX-b.left;a=a.pageY-b.top;b=this.Ke();return this.af&&c>b.width-this.af.width-d&&a<this.af.height};c.prototype.Ra=function(a,b){void 0===b&&(b=0);b=b||this.ga.get("snap")||
0;this.ga.get("autoSnap");if(0<b){var d=Math.round(a.x/b)*b;var c=Math.round(a.y/b)*b}else d=a.x,c=a.y;return new G(d,c)};c.prototype.Yc=function(a,b){void 0===b&&(b=this.Nc(!1));this.aa.Va();this.aa.Yc(b,a);this.aa.va()};c.prototype.setProperty=function(a,b){var d=this.Nc(!0);this.ta[a]=b;if(d.length){this.aa.Va();this.aa.Qb(d,a,b);if("fillStyle"===a)for(var c=0;c<d.length;c++){var f=this.aa.Ka(d[c],!1);f&&(this.log("nodeType=%s closed=%s",f.type(),f.ka("closed")),"PathNode"===f.type()&&!1===f.ka("closed")&&
this.aa.Qb([d[c]],"strokeStyle",b))}this.aa.va()}0<this.selection.length&&"lineWidth"===a&&"BrushNode"===this.selection[0].type()?this.mg=b:"textFillStyle"===a&&(this.ta.textFillStyle=b)};c.prototype.Kd=function(a,b){this.qa.Kd&&this.qa.Kd(a,b)};c.prototype.Dj=function(){return this.ta.fillStyle};c.prototype.Nj=function(){return this.ta.strokeStyle};c.prototype.Kn=function(a,b){this.log("setSelectionOpacity(%s, fill=%s)",a,b);var d=this.Nc(!0);this.aa.Va();for(var c=b?"fillStyle":"strokeStyle",f=
0;f<d.length;f++){var h=d[f],k=this.aa.Ka(h);k&&(k=k.ka(c))&&(k=vc(k,a),this.aa.Qb([h],c,k),this.log("   set %s of %s to %s",c,h,k))}this.aa.va()};c.prototype.group=function(){var a=this;this.aa.transaction(function(){a.aa.group(a.Nc(!1))})};c.prototype.Xg=function(){var a=this;this.aa.transaction(function(){a.aa.Xg(a.Nc(!1))})};c.prototype.wh=function(){var a=this;this.aa.transaction(function(){a.aa.Ub(a.Nc(!1))})};c.prototype.eb=function(a){void 0===a&&(a=!1);var b=!1;if(0<this.selection.length){b=
0;for(var d=this.selection;b<d.length;b++){var c=d[b];Zc(c)&&c.fa.classList.remove("zwibbler-selected")}this.ec+=1;this.selection.length=0;this.log("Clear selection. selectGeneration=%s",this.ec);b=!0}null!==this.xd&&(this.ya.na("selected-edit-handle",null,null),b=!0);this.Aa&&(this.log("Clear selection."),this.xd=this.Aa=null,b=!0);b&&a&&(this.Vb(),this.ia())};c.prototype.Rd=function(a,b){void 0===b&&(b=!0);this.Pg(null);if(a.ec!==this.ec&&a.Xb()===this.Ua){this.selection.push(a);a.ec=this.ec;if(5===
(a.Rb&5))Zc(a)&&a.fa.classList.add("zwibbler-selected");else{if(a.Rm()){for(var d=a.parent,c=0;c<d.Ma();c++){var f=d.sb(c);Xc(f)&&this.Rd(f)}Xc(d)&&this.Rd(d)}for(d=0;d<a.Ma();d++)f=a.sb(d),Xc(f)&&this.Rd(f)}if(this.ga.get("autoGroup")&&b)for(f=0,d=this.aa.Iu(a);f<d.length;f++)this.Rd(d[f],!1)}};c.prototype.selectNodes=function(a){this.eb();for(var b=0;b<a.length;b++)a[b].ka("locked")||"PageNode"===a[b].type()||this.Rd(a[b]);this.Vb()};c.prototype.Ex=function(a,b){var d=this.aa.hb(a,!1);d?d.Ne()&&
(d.Dq()?(d!==this.Aa&&this.Pg(d),this.log("Select edit handle %s",b),this.xd=b,this.ya.na("selected-edit-handle",a,b)):this.log("selectEditHandle: That handle is not selectable.")):this.log("selectEditHandle: nodeid %s does not exist.",a)};c.prototype.Dx=function(a){a=this.aa.tv(a);for(var b=0;b<a.length;b++)this.Rd(a[b])};c.prototype.Vb=function(){this.mh();this.ya.og("selected-nodes");this.ia()};c.prototype.un=function(){for(var a=0,b=this.Uj;a<b.length;a++){var d=b[a];""!==d.Cf&&this.ak.release(d.Cf)}this.Uj.length=
0};c.prototype.Wc=function(a,b,d,c,f,h,k){this.Uj.push({type:h,position:new G(a,b),offset:new G(d,c),Cf:f,yp:k});""!==f&&this.ak.add(f,f)};c.prototype.mh=function(){var a;this.ni=this.oi=this.Nk=!0;var b=!1;this.Wf.length=0;if(0!==this.selection.length){for(a=0;a<this.selection.length;a++){var d=this.selection[a];"GroupNode"!==d.type()&&(0===a?this.cd=d.rect.clone():this.cd.zi(d.rect),this.cd.zi(d.rect),d.ka("lockSize")&&(this.Nk=!1),d.ka("lockRotation")&&(this.oi=!1),d.ka("lockAspectRatio")&&(b=
!0),d.ka("lockPosition")&&(this.ni=!1))}this.Dn=1===this.selection.length?this.selection[0].zj():new Pc(this.cd);var c=0<this.ga.get("snap");if(1<this.selection.length){d=new J;a=null;var f=this.cd}else a=this.selection[0],f=a.Ga,d=a.Ja();for(var h=0,k=this.Uj;h<k.length;h++){var l=k[h];if("scale"===l.type){if(!this.ga.get("allowResize")||!this.Nk)continue;if("scale"===l.type&&(0!==l.position.x&&1!==l.position.x||0!==l.position.y&&1!==l.position.y)&&b)continue}else if("rotate"===l.type&&!this.oi)continue;
this.Wf.push(Hd(l,f,d,c))}if(this.oi&&a&&a.ka("rotationHandles"))for(b=a.ka("rotationHandles"),a=0;a<b.length;a+=4)new G(b[a],b[a+1]),h=new G(b[a+2],b[a+3]),this.Wf.push(new Dd(zd,d,f,h,c))}};c.prototype.At=function(){for(var a=0,b=0;b<this.selection.length;b++)b!==a&&(this.selection[a]=this.selection[b]),this.aa.Je(this.selection[a].id)&&(a+=1);this.selection.length!==a&&(this.selection.length=a);this.Aa&&!this.aa.Je(this.Aa.id)&&(this.Aa=null,null!==this.xd&&this.ya.na("selected-edit-handle",null,
null),this.xd=null)};c.prototype.mr=function(a,b){return this.selection.length&&this.Dn.gd(a,b)};c.prototype.vq=function(){return 0!==this.selection.length||null!==this.Aa};c.prototype.Zc=function(){var a=this.selection.concat();this.Aa&&a.push(this.Aa);return a};c.prototype.sv=function(a){if(0===a.length)return new G(0,0);for(var b=a[0].rect.clone(),d=1;d<a.length;d++)b.zi(a[d].rect);return b.vd()};c.prototype.oq=function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].id);return b};c.prototype.Rj=
function(){var a=B(this.canvas.first).Yb();this.ga.get("showRuler")&&(a.left+=20,a.top+=20);return(new J).multiply(new Hc(1/this.scale,1/this.scale)).multiply(new Fc(-this.mb,-this.cb)).multiply(new Fc(-a.left,-a.top))};c.prototype.Nc=function(a){var b=this.Zc();a||(b=this.aa.$i(b));return this.oq(b)};c.prototype.tm=function(a){for(var b=null,d=0;d<a.length;d++){var c=this.aa.hb(a[d]);c&&0==(c.Rb&2)&&(null===b?b=c.rect.clone():b.zi(c.rect))}null===b&&(b=new H(0,0,0,0));return b};c.prototype.update=
function(a,b){void 0===a&&(a=!1);if(this.aa.format(this.sa,this.request)||a)this.mh(),this.ia(b)};c.prototype.uh=function(){var a=this,b=this.ga.get("snap"),d=null,c;var f=this.ga.get("background");var h=r.Dh(f);this.background=this.ze=null;this.backgroundRepeat="no-repeat";this.tp=this.aa.zf();this.log("createBackground() background=%s",f);if("grid"===f){this.backgroundRepeat="repeat";b=this.ga.get("gridBlocks");var k=this.ga.get("gridSpacing"),l=(b||1)*k;d=uc(document.body);d.width=l;d.height=l;
f=d.getContext("2d");f.fillStyle="#ffffff";f.fillRect(0,0,l,l);f.beginPath();for(c=0;c<l;c+=k)if(c%l||1>b)f.moveTo(c+.5,0),f.lineTo(c+.5,l);for(c=0;c<l;c+=k)if(c%l||1>b)f.moveTo(0,c+.5),f.lineTo(l,c+.5);f.strokeStyle=this.ga.get("gridColour");f.lineWidth=.5;f.stroke();if(0<b){f.beginPath();for(c=0;c<=l;c+=l)f.moveTo(c,0),f.lineTo(c,l);for(c=0;c<=l;c+=l)f.moveTo(0,c+.5),f.lineTo(l,c+.5);f.lineWidth=2;f.stroke()}}else h?(this.log("Using background colour %s",h.toString()),this.ze=function(a,b,d,c,e){1>
h.values[3]&&(a.globalCompositeOperation="destination-out",a.fillRect(b,d,c,e),a.globalCompositeOperation="source-over");a.fillStyle=h.toString();a.fillRect(b,d,c,e)}):0<b&&"clear"!==f&&(this.backgroundRepeat="repeat",d=uc(document.body),d.width=b,d.height=b,f=d.getContext("2d"),f.beginPath(),f.moveTo(0,0),f.arc(0,0,3,0,2*Math.PI,!1),f.moveTo(b,0),f.arc(b,0,3,0,2*Math.PI,!1),f.moveTo(b,b),f.arc(b,b,3,0,2*Math.PI,!1),f.moveTo(0,b),f.arc(0,b,3,0,2*Math.PI,!1),f.fillStyle="#c0c0c0",f.fill());this.Ui=
{};var n=[];this.aa.Mb(function(b){"background"===b.Xb()&&(n.push(b),a.Ui[b.id]=!0)});d&&document.body.removeChild(d);this.background=d;if(n.length){f=document.createElement("canvas");k=this.aa.Ij();console.log("Paper size: %s",k);f.width=k.width;f.height=k.height;b=f.getContext("2d");b.fillStyle=d?b.createPattern(d,this.backgroundRepeat):h?h.toString():"white";b.fillRect(0,0,k.width,k.height);for(d=0;d<n.length;d++)k=n[d],k.ia(b),k.Zf(!0);this.background=f;this.backgroundRepeat="no-repeat";this.ze=
null}};c.prototype.Yd=function(a,b,d,c,f){this.tp!==this.aa.zf()&&this.uh();a.ed=null;this.background?(a.ed=a.createPattern(this.background,this.backgroundRepeat),a.fillStyle=a.ed||"magenta",a.fillRect(b,d,c,f)):this.ze?this.ze(a,b,d,c,f):"G_vmlCanvasManager"in window&&(a.fillStyle="rgba(0, 0, 0, 0.0)",a.fillRect(b,d,c,f));null===a.ed&&(b=this.ga.get("background"),b=r.Dh(b))&&(a.ed=b.toString())};c.prototype.au=function(a){var b=this.aa.Ij();a.beginPath();a.fillStyle="#FFFFFF";this.ga.get("pageShadow")&&
(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,1.0)");a.rect(0,0,b.width,b.height);a.fill();a.shadowColor="rgba(0,0,0,0.0)";a.shadowBlur=0;a.shadowOffsetX=0;a.shadowOffsetY=0;a.strokeStyle=this.ga.get("pageBorderColour");a.stroke();this.Yd(a,0,0,b.width,b.height);this.ze&&this.ze(a,0,0,b.width,b.height)};c.prototype.Gn=function(a){a?(this.log("Setting a custom background function."),this.ze=a):this.log("Clearing custom background function.")};c.prototype.$t=function(a){if(this.Ea.qb){var b=
this.Ea.x,d=this.Ea.y,c=this.Gh();a.save();a.setTransform(c,0,0,c,0,0);a.beginPath();this.Ea.Ol?(a.moveTo(b-3,d-10),a.lineTo(b+3,d-10),a.moveTo(b-3,d+10),a.lineTo(b+3,d+10),a.moveTo(b,d-10),a.lineTo(b,d+10)):(a.moveTo(b,d-3),a.lineTo(b,d-15),a.moveTo(b,d+3),a.lineTo(b,d+15),a.moveTo(b-3,d),a.lineTo(b-15,d),a.moveTo(b+3,d),a.lineTo(b+15,d));this.Ea.Cb&&this.sa.arc(b,d,8,0,2*Math.PI,!1);a.lineWidth=2;a.strokeStyle="#000000";a.stroke();a.restore()}};c.prototype.ke=function(){var a=this.ga.get("showRuler")?
20:0,b=B(this.canvas.first).Yb(),d=B(this.canvas.first.parentElement).Yb(),c=this.canvas.width,f=this.canvas.height,h=b.left-d.left;b=b.top-d.top;this.rc.moveTo(h+c-20,b+a);this.rc.Xe(20,f-20);this.md.moveTo(h+a,b+f-20);this.md.Xe(c-20,20);a=this.canvas.hq();a!==this.hd&&(this.hd=a,this.log("Detected DPR change to %s",this.hd),this.qa.ke&&this.qa.ke());this.Mg();this.ia()};c.prototype.Mg=function(){if(!this.Tm()){var a=this.xf(),b=this.Ke();b=new H(0,0,b.width,b.height);a.Lc(this.cn)&&b.Lc(this.bn)||
!this.rd(this.Pd)||(this.cn=a,this.bn=b)}};c.prototype.zp=function(a){if(this.re){var b=this.aa.Ij();a.save();a.beginPath();a.rect(0,0,b.width,b.height);a.clip()}return this.re};c.prototype.ia=function(a){var b=this;this.Tm()||this.canvas.Sc(0,"main",function(d,c){if(!b.ya.kj){var e=b.Af(),h=e.x,k=e.y,l=e.width,n=e.height;b.re&&(d.fillStyle=b.ga.get("outsidePageColour"),d.fillRect(0,0,b.canvas.width,b.canvas.height));d.translate(b.mb,b.cb);d.scale(b.scale,b.scale);b.ga.get("showRuler")&&d.translate(20/
b.scale,20/b.scale);var q=new Fc(b.mb,b.cb);q=q.multiply(new Hc(b.scale,b.scale));d.Bi=q;b.re?b.au(d):b.Yd(d,h,k,Math.max(l,l-h),Math.max(n,n-h));b.aa.iy();h=b.zp(d);b.aa.ia(d,e);b.ya.ng&&(d.save(),b.ya.ng(d),d.restore());0<b.selection.length&&(d.save(),b.bu(d),d.restore());h&&d.restore();b.Aa&&b.Aa.qj(d,1/b.scale,b.xd);""!==b.yg&&b.ga.get("showHints")&&(d.save(),d.font=15/b.scale+"px Arial",d.fillStyle="#000000",d.textBaseline="top",d.fillText(b.yg,0,0),d.restore());b.$t(d);b.qa.dr&&b.qa.dr(d);a&&
a(d);b.ya.jd("draw",d);b.ga.get("showRuler")&&(d.setTransform(c,0,0,c,0,0),e=b.ga.get("pixelsPerUnit")*b.scale,h=b.ga.get("units"),d.fillStyle="#ccc",d.fillRect(0,0,20,20),wd(d,new H(20,0,b.canvas.width-20,20),0,h,e,-b.mb),wd(d,new H(0,20,20,b.canvas.height-20),2,h,e,-b.cb));d.setTransform(1,0,0,1,0,0);0<b.selection.length&&b.af&&b.af.naturalWidth&&(e=b.af.width,d.drawImage(b.af,b.canvas.width-e-b.rc.vg(),0));b.Ah&&b.Ah.complete&&b.Ah.naturalWidth&&(e=b.Ah.naturalWidth,d.drawImage(b.Ah,b.canvas.width-
e-b.rc.vg(),0));d.setTransform(c,0,0,c,0,0);d.beginPath();d.font="20px Arial";l=d.measureText(ef).width;e=b.canvas.width/c/l;d.scale(e,e);d.textBaseline="top";d.lineWidth=4/e;d.strokeStyle="rgba(128, 128, 128, 0.1)";d[hf](ef,0,0)}})};c.prototype.vr=function(a,b){var d=this;this.canvas.Sc(1,a,function(a){a.translate(d.mb,d.cb);a.scale(d.scale,d.scale);d.ga.get("showRuler")&&a.translate(20/d.scale,20/d.scale);b(a)})};c.prototype.Rl=function(a){this.canvas.Sc(1,a,function(){})};c.prototype.bu=function(a){a.lineWidth=
1/this.scale;a.strokeStyle="#888888";a.beginPath();for(var b=0,d=0;d<this.selection.length;d++){var c=this.selection[d];var f=c.Ja();Yc(c)||c.hidden()||(c=new K(c.Ga),c.transform(f),c.pj(a,[3/this.scale,3/this.scale]),b++)}if(0!==b)for(a.stroke(),d=0;d<this.Wf.length;d++)this.Wf[d].ia(a,this.ak,this.scale,this.Mk)};c.prototype.Pg=function(a){this.Aa=a};c.prototype.ym=function(){return this.Aa};c.prototype.al=function(a){this.Mk=a};c.prototype.Rh=function(a){return a.ec===this.ec};c.prototype.dv=function(a,
b){if(this.Aa)return null;for(var d=this.Jo,c=null,f=0;f<this.Wf.length;f++){var h=this.Wf[f];if(h.xb(this.ak,a,b,d,this.scale)){c=h;break}}return c};c.prototype.Ac=function(){this.es(!1)};c.prototype.Id=function(){this.es(!0)};c.prototype.es=function(a){if(a?this.aa.Sd():this.aa.Td())a?this.aa.Id():this.aa.Ac(),a=this.aa.Ag,this.log("Most recent change page=%s",a),a!==this.aa.ab?(this.log("Undo/redo switched page %s->%s",this.aa.ab,a),this.zc(a)):this.ia(),this.Dg(!1)};c.prototype.wk=function(a,
b,d,c){var e=this;if(b.length&&!a){for(var h=[],k=0;k<b.length;k++){var l=this.aa.hb(b[k],!1);l&&h.push(l)}this.ga.get("autoPickTool")&&this.selectNodes(h)}else if(this.selection.length||this.Aa){h=0;this.ec+=1;l=this.aa.ab;for(k=0;k<this.selection.length;k++)k!==h&&(this.selection[h]=this.selection[k]),this.aa.Je(this.selection[h].id)&&this.aa.be(this.selection[h].id)===l&&(this.selection[h].ec=this.ec,h++);this.selection.length!==h&&(this.selection.length=h);this.Aa&&!this.aa.Je(this.Aa.id)&&(this.log("EditNode %s no longer exists",
this.Aa.id),this.Aa=null,null!==this.xd&&this.ya.na("selected-edit-handle",null,null),this.xd=null);0!==this.selection.length||this.Aa||this.eb();this.Vb()}this.aa.format(this.sa,this.request);this.At();this.mh();this.Mg();this.Gc();this.ia();this.Ye.clear();this.aa.Mb(function(a){5===(a.Rb&5)&&e.Ye.jp(a.rect,a.id)});this.Iv({Pi:b,Ik:d,dl:c});this.Dg(a)};c.prototype.$l=function(){this.nf(!1,this.Nc(!0));this.wh()};c.prototype.nf=function(a,b){var d=this.aa.rv(b),c=this.aa.Bx(d);0<d.length&&(!0!==
a&&Ne.setItem("clipboard",c),this.log("Reset paste offset to 0"),this.xi=this.wi=0);return c};c.prototype.duplicate=function(){var a=this,b=this.Nc(!1),d=this.ga.get("pasteOffset"),c=d||this.ga.get("pasteOffsetX"),f=d||this.ga.get("pasteOffsetY");this.aa.transaction(function(){a.aa.duplicate(b,c,f)})};c.prototype.gi=function(a){var b=this;if(!a){var d=Ne.getItem("clipboard");if(d)a=d;else return}var c=this.ga.get("pasteOffset");d=c||this.ga.get("pasteOffsetX");c=c||this.ga.get("pasteOffsetY");this.wi+=
d;this.xi+=c;this.log("Using paste offset %s,%s",this.wi,this.xi);var f=new Fc(this.wi,this.xi);this.aa.transaction(function(){b.aa.Lq(a,f)})};c.prototype.Pk=function(a){""!==a?(this.yg=this.language.get(a),this.ya.na("hint",this.yg)):(this.yg="",this.ya.na("hint",""))};c.prototype.ib=function(){return this.Qa(new Pe(this))};c.prototype.Qa=function(a){this.qa&&this.qa.mc&&this.qa.mc();this.qa=a;a.Kc&&a.Kc();a.ld&&this.ya.na("tool-changed",a.ld());return a};c.prototype.Fh=function(){var a=null;this.qa.ld&&
(a=this.qa.ld());return a};c.prototype.ao=function(a){a=new Te(this,a);this.Qa(a);return a};c.prototype.Kq=function(a,b,d){this.Qa(new cf(this,"line",a,b,d))};c.prototype.gm=function(a){a.lineWidth=a.lineWidth||this.mg;a.strokeStyle=a.strokeStyle||this.Kb;this.Qa(new bf(this,a,"brush"))};c.prototype.cu=function(a){a.lineWidth=a.lineWidth||this.mg;a.strokeStyle=a.strokeStyle||this.Kb;this.Qa(new bf(this,a,"shapebrush"))};c.prototype.Kp=function(a,b){a.lineWidth=a.lineWidth||this.mg;a.strokeStyle=a.strokeStyle||
this.Kb;this.Qa(new bf(this,a,b))};c.prototype.Fp=function(a){this.Qa(new cf(this,"curve",a))};c.prototype.ft=function(a,b){this.Qa(new cf(this,"arrow",a,b))};c.prototype.xf=function(){if(this.re){var a=this.aa.Ij();var b=this.ga.get("pageInflation");a.Dd(b,b)}else a=this.aa.lc();return a};c.prototype.ko=function(){var a=B(this.canvas.first).Yb(),b=B(this.vc).Yb(),d=a.left-b.left;a=a.top-b.top;this.aa.Oc.style.transform="translate("+this.mb+"px, "+this.cb+"px) scale("+this.scale+")";this.Uk.style.transform=
"translate("+(this.mb+d)+"px, "+(this.cb+a)+"px) scale("+this.scale+")"};c.prototype.Gc=function(){if(!this.Tm())if(this.ko(),this.ya.na("scroll"),this.ga.get("scrollbars")){var a=this.Ke(),b=this.xf(),d=this.Af(),c=!1,f=!1;d.y<=b.y&&d.bottom()>=b.bottom()?this.rc.Oe():(this.rc.show(),this.rc.Rr(Math.min(d.y,b.y),Math.max(d.bottom(),b.bottom()),d.height,-this.cb/this.scale),c=!0);d.x<=b.x&&d.right()>=b.right()?this.md.Oe():(this.md.show(),this.md.Rr(Math.min(d.x,b.x),Math.max(d.right(),b.right()),
d.width,-this.mb/this.scale),f=!0);f&&c?(this.rc.Xe(20,a.height-20),this.md.Xe(a.width-20,20)):c?this.rc.Xe(20,a.height):f&&this.md.Xe(a.width,20)}else this.rc.Oe(),this.md.Oe()};c.prototype.Og=function(a,b,d){this.log("Set document size %s,%s",a,b);this.aa.Va();this.aa.setProperty("width",a);this.aa.setProperty("height",b);this.aa.va(d);this.Gc();this.Mg();this.Dg(!1)};c.prototype.qk=function(a,b,d){var c=this;if(this.ni)if(this.Ea.qb)this.log("Not nudging; keyboard cursor shown.");else{a*=d/this.scale;
b*=d/this.scale;this.log("Nudge selection by %s, %s",a,b);var f=this.Nc(!0),h=new Fc(a,b);this.aa.transaction(function(){c.aa.Nd(f,h)});this.al(h.multiply(this.Mk));return 0<f.length}else this.log("Can't nudge; selection motion is locked.")};c.prototype.Ai=function(a){var b=new N;var d=new G(-50,-50);var c=new G(50,-50);var f=new G(50,50);var h=new G(-50,50);b.moveTo(d.x,d.y);b.lineTo(c.x,c.y);b.lineTo(f.x,f.y);b.lineTo(h.x,h.y);b.lineTo(d.x,d.y);b.close();a=zc({},{commands:b.Jb(),fillStyle:this.Bb,
strokeStyle:this.Tb,seed:Math.round(65535*Math.random()),lineWidth:this.jh(this.ta.lineWidth),sloppiness:this.ta.sloppiness,layer:this.Ua,wrap:this.ga.get("multilineText"),fontSize:this.ga.get("defaultFontSize")},a);this.log("Create an item on layer %s",this.Ua);this.Qa(new df(this,"PathNode",a,100,100,"rectangle","rectangle",null))};c.prototype.qo=function(a,b,d,c){var e=new N;for(var h=0;h<=a;h++){var k=50*Math.sin(b),l=50*-Math.cos(b);h&1&&(k*=d,l*=d);"matrix"in c&&(l=c.matrix.apply(k,l),k=l.x,
l=l.y);0===h?e.moveTo(k,l):e.lineTo(k,l);b+=2*Math.PI/a}e.close();"matrix"in c&&delete c.matrix;c=zc({},{commands:e.Jb(),fillStyle:this.Bb,strokeStyle:this.Tb,seed:Math.round(65535*Math.random()),lineWidth:this.jh(this.ta.lineWidth),sloppiness:this.ta.sloppiness,layer:this.Ua,wrap:this.ga.get("multilineText"),fontSize:this.ga.get("defaultFontSize")},c);this.log("Create an item on layer %s",this.Ua);this.Qa(new df(this,"PathNode",c,100,100,this.ga.iq(),"polygon",null))};c.prototype.Pw=function(){this.Qa(new ce(this))};
c.prototype.el=function(a){var b=new G(0,0);var d=new N;d.moveTo(b.x,b.y-50);d.pf(b.x+50,b.y-50,b.x+50,b.y);d.pf(b.x+50,b.y+50,b.x,b.y+50);d.pf(b.x-50,b.y+50,b.x-50,b.y);d.pf(b.x-50,b.y-50,b.x,b.y-50);d.closePath();b=d.Jb();a=zc({},{commands:b,fillStyle:this.Bb,strokeStyle:this.Tb,seed:Math.round(65535*Math.random()),lineWidth:this.jh(this.ta.lineWidth),sloppiness:this.ta.sloppiness,layer:this.Ua,wrap:this.ga.get("multilineText"),fontSize:this.ga.get("defaultFontSize")},a||{});this.Qa(new df(this,
"PathNode",a,100,100,this.ga.iq(),"circle",null))};c.prototype.ro=function(a,b,d,c,f,h){this.Qa(new df(this,a,b,d,c,f,"shape",h))};c.prototype.Ly=function(a,b){this.Qa(new ae(this,a,b))};c.prototype.po=function(a){var b=this.aa.hb(a,!1);if(!b)return this.log("useEditHandleTool: node %s doesn't exist.",a),!1;if(!b.Ne())return this.log("useEditHandleTool: nodetype %s has no edit mode",b.type()),!1;this.ib();this.eb();this.Vb();this.Pg(b);this.ia()};c.prototype.tw=function(a){var b=this,d=this.Ra(new G(100,
100)),c=new Fc(d.x,d.y);this.aa.transaction(function(){var d=b.aa.createNode("ImageNode",{url:a,layer:b.Ua});b.aa.Nd([d],c)});this.ib()};c.prototype.Cd=function(){return B.kq()};c.prototype.Dw=function(a,b){this.qa.Re?(this.log("Simulating click of colour %s",a),this.qa.Re(a,b)):this.log("A colour is not needed for this tool.")};c.prototype.Jw=function(a,b){this.qa.Se?(this.log("Simulating opacity change %s",a),this.qa.Se(a,b)):this.log("An opacity is not needed for this tool.")};c.prototype.zc=function(a){this.aa.zc(a)&&
(this.eb(),this.Vb(),this.Mg(),this.ia(),this.ya.na("set-page",a))};c.prototype.In=function(a){this.re=a;a=this.xf();this.mb=-a.x;this.cb=-a.y;this.Gc();this.ia()};c.prototype.Fr=function(a){var b=this.Af(),d=b.width/a;a=b.height/a;b.x-=(d-b.width)/2;b.y-=(a-b.height)/2;b.width=d;b.height=a;this.Tg(b)};c.prototype.il=function(){this.Fr(this.ga.li(1.1*this.scale)/this.scale)};c.prototype.jl=function(){this.Fr(this.ga.li(this.scale/1.1)/this.scale)};c.prototype.Ch=function(a,b,d){var c=this;d=d||this.sv(a);
var f=new Ic(b,d.x,d.y);this.aa.transaction(function(){c.aa.Nd(c.oq(a),f)})};c.prototype.Xp=function(a,b){this.vq()||this.log("flipSelection: selection is empty");this.Ch(this.Zc(),a,b)};c.prototype.Gh=function(){var a=this.sa;return(window.devicePixelRatio||1)/(a.Vy||a.nw||a.qw||a.ww||a.mt||1)};c.prototype.um=function(){return new Cc(this.canvas.width,this.canvas.height)};c.prototype.Ke=function(){var a=this.um(),b=this.ga.get("showRuler")?20:0;return new H(b,b,a.width-b,a.height-b)};c.prototype.Hx=
function(a,b){this.canvas.Xe(a,b)};c.prototype.Af=function(){var a=this.Ke();return new H((0-this.mb)/this.scale,(0-this.cb)/this.scale,a.width/this.scale,a.height/this.scale)};c.prototype.Tg=function(a,b,d){void 0===b&&(b=!1);void 0===d&&(d=!1);this.log("setViewRect(%s)",a);var c=this.Ke(),f=Math.min(c.width/a.width,c.height/a.height),h=a.x*f,k=a.y*f;this.mb=b?(c.width-a.width*f)/2-h:-h;this.cb=d?(c.height-a.height*f)/2-k:-k;this.Pd=this.scale=f;this.Gc();this.ia()};c.prototype.Bu=function(a){this.request.kg?
(this.log("Formatting in progress; will call function soon"),this.request.once("done",a)):(this.log("Format already done; call function in 1 tick"),setTimeout(a,0))};c.prototype.kk=function(a){!this.gg&&a?(this.log("Locking updates."),this.gg=!0):this.gg&&!a&&(this.log("Resuming updates"),this.gg=!1,this.Mg(),this.Gc(),this.ia())};c.prototype.Tm=function(){this.gg&&this.log("Updates are locked. Ignoring draw/format request");return this.gg};c.prototype.Dg=function(a){this.ya.og("document-changed",
{remote:a})};c.prototype.li=function(a){return this.ga.li(a)};c.prototype.fc=function(a){this.jf.style.cursor=a};return c}();var rf=function(){function c(a,b,d){var c=this;this.ya=a;this.ma=b;this.log=x.create("APP");this.xa=new nb;this.Vq=this.Xq=-1;this.oj=[];this.Jm=!1;this.Bn=this.mo=null;for(this.If=[];null!==b.firstChild;)b.removeChild(b.firstChild);b=B(this.ma).ce("position");"absolute"!==b&&"fixed"!==b&&(this.ma.style.position="relative");this.ma.style.overflow="none";this.ma.style.textAlign="left";this.ma.classList.add("zwibbler-main");Q.Pe(".zwibbler-main { font-size: 16px; }\n        .zwibbler-passthrough { cursor: pointer; }\n        .zwibbler-selected {outline: 4px solid rgba(0, 80, 183, 0.2);}\n        ");
this.ij=new nc(B("div").Wa({width:"300px"}).fa,this.xa);this.log("Zwibbler built on "+new Date(1588217211853)+" for 'web'");this.ga=new Me(this.xa,d);this.language=new $a("\nen:arrowhead-size:Arrowhead size\nes:arrowhead-size:Flecha tama\u00f1o\n\nen:arrowhead-size-large:Large\nes:arrowhead-size-large:Grande\n\nen:arrowhead-size-medium:Medium\nes:arrowhead-size-medium:Medio\n\nen:arrowhead-size-none:None\nes:arrowhead-size-none:Nada\n\nen:arrowhead-size-small:Small\nes:arrowhead-size-small:Peque\u00f1o\n\nen:arrowhead-size-tiny:Tiny\nes:arrowhead-size-tiny:Diminuto\n\nen:arrowhead-style:Arrowhead style\nes:arrowhead-style:Flecha estilo\n\nen:arrowhead-style-simple:Simple\nes:arrowhead-style-simple:Llanura\n\nen:arrowhead-style-solid:Solid\nes:arrowhead-style-solid:Denso\n\nen:arrow-keys:Arrow Keys\nes:arrow-keys:Teclas de flecha\n\nen:arrow-tool:Arrow tool\nes:arrow-tool:Flecha\nfr:arrow-tool:Fl\u00e8che\nnl:arrow-tool:Pijl\n\nen:break-apart-group:Break apart group\nes:break-apart-group:Dividir el grupo\n\nen:bring-to-front:Bring to front\nes:bring-to-front:Traer al frente\n\nen:brush-tool:Brush tool\nes:brush-tool:Brocha\nfr:brush-tool:Brosse\nnl:brush-tool:Penseel\n\nen:circle-tool:Circle tool\nes:circle-tool:C\u00edrculo\nfr:circle-tool:Cercle\nnl:circle-tool:Cirkel\n\nen:click-to-place-another-point-or-double-click-to-end-the-line:Click to place another point, or double-click to end the line.\nes:click-to-place-another-point-or-double-click-to-end-the-line:Haga clic para colocar otro punto, o doble clic para finalizar la l\u00ednea\nfr:click-to-place-another-point-or-double-click-to-end-the-line:Cliquez pour placer un autre point, ou double-cliquez pour terminer la ligne.\nnl:click-to-place-another-point-or-double-click-to-end-the-line:Klik op een ander punt te plaatsen, of dubbelklik om de lijn te be\u00ebindigen.\n\nen:click-to-place-first-point-of-line:Click to place first point of line\nes:click-to-place-first-point-of-line:Haga clic para colocar el primer punto de la l\u00ednea\nfr:click-to-place-the-first-point-of-line:Cliquez pour placer le premier point de la ligne\nnl:click-to-place-the-first-point-of-line:Klik om het eerste punt van de lijn te plaatsen.\n\nen:click-to-set-the-end-of-the-line:Click to set the end of the line\nes:click-to-set-the-end-of-the-line:Haga clic para colocar el extremo de la l\u00ednea\nfr:click-to-set-the-end-of-the-line:Cliquez pour d\u00e9finir la fin de la ligne\nnl:click-to-set-the-end-of-the-line:Klik hier voor het einde van de lijn in te stellen.\n\nen:copy:Copy\nes:copy:Copiar\nfr:copy:Copie\nnl:copy:Kopi\u00ebren\n\nen:curve-tool:Curve tool\nes:curve-tool:Curva\nfr:curve-tool:Courbes\nnl:curve-tool:Kromme\n\nen:delete-selection:Delete selection\nes:delete-selection:Eliminar la selecci\u00f3n\n\nen:del-key:Del\nes:del-key:Del\n\nen:double-arrows:Double arrows\nes:double-arrows:flechas dobles\n\nen:draw-curves:Draw curves\nes:draw-curves:Dibuje las curvas\n\nen:draw-lines:Draw lines\nes:draw-lines:Dibujar l\u00edneas\n\nen:duplicate-selection:Duplicate selection\nes:duplicate-selection:Duplica la selecci\u00f3n\n\nen:fill-colour:Fill colour\nes:fill-colour:Color de relleno\n\nen:font:Font\nes:font:Font\n\nen:font-size:Font size\nes:font-size:Tama\u00f1o de letra\n\nen:group-selection:Group selection\nes:group-selection:Grupo la selecci\u00f3n\n\nen:image-tool:Image tool\nes:image-tool:Imagen\nfr:image-tool:Image\nnl:image-tool:Afbeelding\n\nen:image-url:Image URL\nes:image-url:URL de la imagen\n\nen:keyboard:Keyboard\nes:keyboard:Teclado\n\nen:line-style:Line style\nes:line-style:Estilo de l\u00ednea\n\nen:line-style-long-dashes:Long dashes\nes:line-style-long-dashes:Gui\u00f3n largo\n\nen:line-style-short-dashes:Short dashes\nes:line-style-short-dashes:Gui\u00f3n corto\n\nen:line-style-solid:Solid\nes:line-style-solid:Denso\n\nen:line-tool:Line tool\nes:line-tool:Raya\nfr:line-tool:Lignes\nnl:line-tool:Lijn\n\nen:move-selection-away:Move selection away\nes:move-selection-away:Mover la selecci\u00f3n de distancia\n\nen:move-selection-closer:Move selection closer\nes:move-selection-closer:Mover la selecci\u00f3n de distancia\n\nen:move-while-zoomed:Move while zoomed\nes:move-while-zoomed:Desplazarse por la pantalla\n\nen:none:None\nes:none:Nada\n\nen:no:No\nes:no:No\n\nen:outline-colour:Outline colour\nes:outline-colour:Color del contorno\n\nen:outline-thickness:Outline thickness\nes:outline-thickness:Grosor del contorno\n\nen:page-down-key:Page Down\nes:page-down-key:Page Down\n\nen:page-up-key:Page Up\nes:page-up-key:Page Up\n\nen:paste:Paste\nes:paste:Pegar\nfr:paste:Coller\nnl:paste:Plak\n\nen:pick-tool:Pick tool\nes:pick-tool:Seleccionar\nfr:pick-tool:S\u00e9lectionner\nnl:pick-tool:Uitkiezen\n\nen:rectangle-tool:Rectangle tool\nes:rectangle-tool:rect\u00e1ngulo\nfr:rectangle-tool:Rectangle\nnl:rectangle-tool:Rechthoek\n\nen:redo:Redo\nes:redo:Rehacer\nfr:redo:Refaire\nnl:redo:Opnieuw maken\n\nen:rounded-rectangle-tool:Rounded rectangle tool\nes:rounded-rectangle-tool:Rect\u00e1ngulo redondeado\n\nen:save:Save\nes:save:Guardar\n\nen:send-to-back:Send to back\nes:send-to-back:Enviar a la parte posterior\n\nen:shadow:Shadow\nes:shadow:Sombra\n\nen:shape-brush-tool:Shape brush tool\nes:shape-brush-tool:Brush que dibuja formas\n\nen:sloppiness-artist:Artist\nes:sloppiness-artist:Artista\n\nen:sloppiness-cartoonist:Cartoonist\nes:sloppiness-cartoonist:Caricaturista\n\nen:sloppiness-child:Child\nes:sloppiness-child:Ni\u00f1o\n\nen:sloppiness-draftsman:Draftsman\nes:sloppiness-draftsman:Dibujante\n\nen:sloppiness-drunk:Drunk\nes:sloppiness-drunk:Borracho\n\nen:sloppiness:Sloppiness\nes:sloppiness:La dejadez\n\nen:smoothness-sharper:Sharper\nes:smoothness-sharper:Muy afilado\n\nen:smoothness-sharpest:Sharpest\nes:smoothness-sharpest:M\u00e1s afilado\n\nen:smoothness-sharp:Sharp\nes:smoothness-sharp:Afilado\n\nen:smoothness-smoothest:Smoothest\nes:smoothness-smoothest:Muy liso\n\nen:smoothness:Smoothness\nes:smoothness:Lisura\n\nen:smoothness-smooth:Smooth\nes:smoothness-smooth:Liso\n\nen:text-colour:Text colour\nes:text-colour:Color del texto\n\nen:text:Text\nes:text:Texto\n\nen:text-tool:Text tool\nes:text-tool:Texto\nfr:text-tool:Texte\nnl:text-tool:Tekst\n\nen:thickness-brush:Brush\nes:thickness-brush:Brocha\n\nen:thickness-marker:Marker\nes:thickness-marker:Rotulador\n\nen:thickness-pencil:Pencil\nes:thickness-pencil:L\u00e1piz\n\nen:thickness-pen:Pen\nes:thickness-pen:Pluma\n\nen:undo:Undo\nes:undo:Deshacer\nfr:undo:D\u00e9faire\nnl:undo:Ongedaan maken\n\nen:yes:Yes\nes:yes:S\u00ed\n\nen:zoom-in:Zoom in\nes:zoom-in:Zoom\n\nen:zoom-out:Zoom out\nes:zoom-out:Disminuir el zoom\n");
this.language.Or(this.ga.get("language"));this.jf=B("div").sd("zwibbler-canvas-holder").Wa({position:"absolute",overflow:"hidden",touchAction:"none"}).fa;this.ma.appendChild(this.jf);this.canvas=new oc(this.jf,100,100);B(this.canvas.first).sd("zwibbler-main-canvas").Wa({outline:"0",position:"absolute",left:"0",top:"0",pointerEvents:"none"});this.canvas.first.setAttribute("tabindex","0");d=this.de();this.kc=new bb;this.Uk=B("DIV").Wa({position:"absolute",Az:"none",nz:"none",transformOrigin:"left top",
left:0,top:0}).sd("zwibbler-staging").Xc(d).fa;this.mi={ctx:a};this.view=new mf(d,this.canvas,new of(!1,d,this.mi),this.kc,this.ga,this.language,this.ya,this.xa,this.Uk,this.jf);this.Oc=B(this.view.aa.Oc).sd("zwibbler-html-root").Wa({position:"absolute",left:"0",top:"0",userSelect:"none",msUserSelect:"none"}).insertBefore(this.canvas.first).fa;this.Jr();this.wc=this.gy();this.xa.addEventListener(window,"resize",function(){c.ya.resize()});window.$&&(this.log("jQuery detected; register for bootstrap events"),
window.$(document).bind("shown.bs.modal",function(){c.log("Bootstrap modal shown; resize now");c.ya.resize()}));null!==this.ga.Sa("backgroundImage")&&(this.Fn(this.ga.Sa("backgroundImage")),this.view.aa.Kk());this.ga.pa("update",function(a,b){c.je(a,b)});Q.Pe(".zwibbler-progress-notification {\n            position: absolute;\n            top: 0;\n            right: 0;\n            box-shadow: 3px 3px 3px #444;\n            background: #ccc;\n            color: black;\n            border-bottom-left-radius: 4px;\n            font-family: arial,sans;\n        }");
this.sr=B("div").sd("zwibbler-progress-notification").Xc(this.ma).fa;a.resize();this.ga.get("setFocus")&&this.focus();this.je("showDebug",this.ga.get("showDebug"));this.view.Dg(!1);this.ya.na("set-page",this.view.aa.ab);if(Ne.Ti()){if(this.ga.get("persistent")&&(a=Ne.getItem("zwibbler-document")))try{var f=pf.fh(a,d,this.mi);if(f)this.Yf(f);else throw Error("Failed to open document.");}catch(h){this.log("Failed to load persistent document: %s",h.message)}this.mo=Oe(function(){c.ga.get("persistent")&&
(c.log("Saving document"),Ne.setItem("zwibbler-document",c.ya.save()))});this.ya.pa("document-changed",function(){c.mo()});this.xa.add(function(){c.mo.cancel()})}this.xa.add(function(){for(;c.ma.firstChild;)c.ma.removeChild(c.ma.firstChild);c.wc.qh();c.kc.qh()});this.xa.addEventListener(this.de(),"dragstart",function(a){if(a.target instanceof HTMLImageElement){var b=a.target.getAttribute("draggable");if(!b||"false"===b.toLowerCase())return a.preventDefault(),!1}})}c.prototype.Xa=function(){this.xa.Xa()};
c.prototype.je=function(a,b){var d=!1;this.log("onConfigChange %s=%s",a,b);switch(a){case "showDebug":b?(this.ij.show(),this.hh(0,"right",this.ij.ma)):(this.ij.Oe(),this.ki(this.ij.ma));d=!0;break;case "backgroundImage":this.Fn(b);break;case "language":this.language.Or(b)}d&&this.Ji()};c.prototype.Jr=function(){this.ga.Sa("sloppy")||this.view.qe("sloppiness",0);this.view.qe("smoothness",this.ga.Su());this.view.qe("fillStyle",this.ga.Sa("defaultFillStyle"));this.view.qe("strokeStyle",this.ga.Sa("defaultStrokeStyle"));
this.view.qe("fontName",this.ga.Sa("defaultFont"));this.view.qe("fontSize",this.ga.Sa("defaultFontSize"));this.view.qe("lineWidth",this.ga.Sa("defaultLineWidth"));this.view.qe("textFillStyle",this.ga.Sa("defaultTextFillStyle"))};c.prototype.Yf=function(a){this.jf.insertBefore(a.Oc,this.Oc);B(this.Oc).remove();this.Oc=a.Oc;B(this.Oc).Wa({position:"absolute",left:0,top:0,userSelect:"none"});this.view.Yf(a);this.Jr();this.ya&&(this.view.Dg(!1),this.ya.na("set-page",a.ab));for(a=0;a<this.oj.length;a++){var b=
this.oj[a];this.log("Removing old DomElement of type %s",b.tagName);B(b).remove()}this.oj=[]};c.prototype.Sl=function(){this.view.aa.Kk()};c.prototype.gy=function(){var a=this,b=this;this.Jm=!1;var d=new cb;this.ga.gt(d);d.pa("*",function(b,d){a.Jm?a.view.od(b,d):a.log("Ignore key action -- don't have focus.")});this.ma.setAttribute("tabindex","0");d.rp(this.ma);this.xa.add(function(){a.wc.detach(a.ma)});this.kc.pa("goto-toolbar",function(){a.Bn&&a.Bn.focus()});this.kc.pa("goto-canvas",function(){b.focus()});
this.xa.addEventListener(this.ma,"blur",function(){"text"!==b.view.Fh()&&(b.log("Blur event received -- hide keyboard cursor"),b.view.Mv())});this.ga.pa("allowSystemClipboard",function(b){a.log("allowSystemClipboard=>%s",b);a.ga.Qm()&&(a.xa.addEventListener(document,"cut",function(b){return a.view.Hf(b)}),a.xa.addEventListener(document,"copy",function(b){return a.view.Hf(b)}),a.xa.addEventListener(document,"paste",function(b){return a.view.Hf(b)}))});return d};c.prototype.Yx=function(a){this.Bn=a};
c.prototype.focus=function(){document.activeElement&&(document.activeElement===this.ma||document.activeElement.matches("zwibbler *, [zwibbler] *, .zwibbler-main *")&&Ac(document.activeElement))?this.log("focus(): Already have focus."):(this.Jm=!0,this.ga.get("setFocus")&&(this.log("focus(): set focus to div"),this.ma.focus()))};c.prototype.Ln=function(a){void 0===a&&(a=!1);this.focus();this.view.Ln(a)};c.prototype.createNode=function(a,b,d){"layer"in b||(b.layer=this.view.Ua);d||(d=this.view.aa.wm());
this.view.aa.Va();a=this.view.aa.createNode(a,b,d);this.view.aa.va();return a};c.prototype.transformNode=function(a,b){var d=this;this.view.aa.transaction(function(){d.view.aa.Nd(a,b)});return!0};c.prototype.Hn=function(a,b,d,c,f,h,k){var e=this,n=new J(b,c,d,f,h,k);this.view.aa.transaction(function(){e.view.aa.Qb(a,"matrix",n)});return!0};c.prototype.yi=function(a,b,d){var c=this,f=new Fc(b,d);this.view.aa.transaction(function(){c.view.aa.Nd(a,f)})};c.prototype.Lk=function(a,b,d,c,f){var e=this,
k=new Hc(b,d,c,f);this.view.aa.transaction(function(){e.view.aa.Nd(a,k)});return!0};c.prototype.Xd=function(a){this.view.aa.Va();this.view.aa.Ub(a);this.view.aa.va();return!0};c.prototype.Fn=function(a){var b=this;this.view.aa.Va();this.view.aa.Mb(function(a){"background"===a.Xb()&&b.view.aa.Ub([a.id])});a&&(a=this.view.aa.createNode("ImageNode",{url:a,locked:!0,tag:"background",layer:"background"}),this.view.aa.Yc([a],1));this.view.aa.va(!0);this.view.eb();this.view.Vb()};c.prototype.Ku=function(){var a=
null;this.view.aa.Mb(function(b){if("background"===b.Xb()&&"ImageNode"===b.type())return a=b.ka("url"),!1});return a};c.prototype.Qq=function(){this.Yf(new of(!1,this.de(),this.mi));null!==this.ga.Sa("backgroundImage")&&(this.Fn(this.ga.Sa("backgroundImage")),this.view.aa.Kk())};c.prototype.Ji=function(){var a=!0;void 0===a&&(a=!1);var b=this.ma.clientWidth,d=this.ma.clientHeight;if(a||b!==this.Xq||d!==this.Vq){this.log("onResize()");this.Xq=b;this.Vq=d;for(var c=a=0,f=0,h=0,k=0,l=this.If;k<l.length;k++){var n=
l[k];switch(n.position){case "left":case "right":n.ma.style.top=f+"px";n.ma.style.bottom=h+"px";break;case "top":case "bottom":n.ma.style.left=a+"px",n.ma.style.right=c+"px"}switch(n.position){case "left":n.ma.style.left=a+"px";a+=n.ma.offsetWidth;break;case "right":n.ma.style.right=c+"px";c+=n.ma.offsetWidth;break;case "top":n.ma.style.top=f+"px";f+=n.ma.offsetHeight;break;case "bottom":n.ma.style.bottom=h+"px",h+=n.ma.offsetHeight}}B(this.jf).Wa({left:a+"px",right:c+"px",top:f+"px",bottom:h+"px"});
this.view.Hx(b-c-a,d-h-f);B(this.sr).Wa({top:"0",right:c+"px"});this.view.ke();this.ya.na("resize")}else this.log("Ignoring resize; div size did not change.")};c.prototype.tl=function(a,b,d){void 0===d&&(d=this.view.aa.ab);var c=this.view.aa.ab;this.view.aa.zc(d);a.translate(-b.x,-b.y);this.view.Yd(a,b.x,b.y,b.width,b.height);this.view.aa.ia(a);this.ya.ng&&this.ya.ng(a);this.view.aa.zc(c)};c.prototype.Br=function(a,b,d){0==d&&(d=b.width);var c=d/b.width;if("image/svg+xml"===a||"application/pdf"===
a){var f=!1;"image/svg+xml"===a?d=new je(new H(0,0,b.width,b.height)):(b=this.ya.tg(0),b=new H(b.x,b.y,b.width,b.height),d=new Ae(new H(0,0,b.width,b.height),Q.fonts),f=!0);if(f)for(f=0;f<this.view.aa.Zb();f++)0<f&&(b=this.view.aa.lc(f,qf),d.Ug(b)),this.tl(d,b,f);else this.tl(d,b);return"data:"+a+";base64,"+Ba(d.toString())}f=document.createElement("canvas");f.setAttribute("width",Math.ceil(b.width*c).toString());f.setAttribute("height",Math.ceil(b.height*c).toString());d=f.getContext("2d");d.scale(c,
c);if("image/jpeg"===a||"image/bmp"===a)d.fillStyle="#ffffff",d.fillRect(0,0,b.width,b.height);this.tl(d,b);return"image/bmp"===a?xc(f):f.toDataURL(a)};c.prototype.Qb=function(a,b,d){var c=this;this.log("External app setItemProperty %s: %s=%s",a,b,d);this.view.aa.transaction(function(){c.view.aa.Qb(a,b,d)});return!0};c.prototype.Uc=function(a,b){var d=this;this.log("External app setNodeProperty %s: %s",a,b);this.view.aa.transaction(function(){d.view.aa.Uc(a,b)});return!0};c.prototype.Gj=function(a,
b){var d,c;(d=this.view.aa.Ka(a))&&(c=d.ka(b));this.log("GetItemProperty %s: %s=%s",a,b,c);return c};c.prototype.Xl=function(a){var b,d;if(6>a.length)this.log("newShape: Cannot create shape with fewer than three points.");else{var c=new N;var f=b=0;for(d=a.length-1;b<=d;f=b+=2){var h=this.view.Ra(new G(a[f],a[f+1]));if(0===f){c.moveTo(h.x,h.y);var k=h}else c.lineTo(h.x,h.y)}k&&(c.lineTo(k.x,k.y),c.close());return this.fj(c.Jb())}};c.prototype.fj=function(a){return this.createNode("PathNode",{commands:a,
fillStyle:this.view.Bb,strokeStyle:this.view.Tb,seed:Math.round(65535*Math.random()),lineWidth:this.view.ta.lineWidth,sloppiness:this.view.ta.sloppiness,angleArcs:this.ga.get("angleArcs")})};c.prototype.Wt=function(a){return new mc(this.sr,a)};c.prototype.hh=function(a,b,d){for(var c=0,f=this.If;c<f.length;c++)if(f[c].ma===d)return;this.ma.appendChild(d);this.If.push({order:a,ma:d,position:b});d.style.position="absolute";this.If.sort(function(a,b){return a.order<b.order?-1:1});this.Ji()};c.prototype.ki=
function(a){for(var b=0;b<this.If.length;b++)if(this.If[b].ma===a){this.If.splice(b,1);this.ma.removeChild(a);break}this.Ji()};c.prototype.de=function(){for(var a=this.ma,b=a;b;){if(b instanceof HTMLElement&&(null!==b.getAttribute("zwibbler")||"ZWIBBLER"===b.tagName)){a=b;break}b=b.parentElement}return a};c.prototype.El=function(a,b){this.wc.map(a,b)};return c}();var sf=function(){function c(a,b){this.view=a;this.methods=b;this.log=x.create("CustomToolBehaviour");this.pc=new be(a)}c.prototype.Kc=function(){this.log("Entering CustomToolBehaviour");this.methods.enter&&this.methods.enter()};c.prototype.mc=function(){this.log("Leaving CustomToolBehaviour");this.methods.leave&&this.methods.leave()};c.prototype.xk=function(a,b,d){return this.methods.onMouseClick?this.methods.onMouseClick(a,b,d.oc):!1};c.prototype.Ab=function(a,b,d){return this.methods.onMouseDown?
this.methods.onMouseDown(a,b,d.oc):!1};c.prototype.pb=function(a,b,d){return this.methods.onMouseMove?this.methods.onMouseMove(a,b,d.oc):!1};c.prototype.Db=function(a,b,d){return this.methods.onMouseUp?this.methods.onMouseUp(a,b,d.oc):!1};c.prototype.cr=function(a,b,d){return this.methods.onMouseLeave?this.methods.onMouseLeave(a,b,d):!1};c.prototype.en=function(a,b,d){return this.methods.onDoubleClick?this.methods.onDoubleClick(a,b,d.oc):!1};c.prototype.Yq=function(a,b,d){return this.methods.onContextMenu?
this.methods.onContextMenu(a,b,d):!1};c.prototype.Re=function(a,b){return this.methods.onColour?this.methods.onColour(a,b):!1};c.prototype.Se=function(a,b){return this.methods.onOpacity?this.methods.onOpacity(a,b):!1};c.prototype.od=function(a,b){this.log("keyboard: %s",a);this.methods.onKeyCommand&&!1===this.methods.onKeyCommand(a,b)||"cancel"!==a||(this.log("ESC pressed. Abort and go back to toolbar."),this.view.ib(),this.view.kc.na("goto-toolbar"))};c.prototype.dr=function(a){if(this.methods.onRedraw)this.methods.onRedraw(a)};
c.prototype.kb=function(a){return this.methods.onGesture?this.methods.onGesture(a):this.pc.kb(a)};c.prototype.gn=function(a,b,d,c){return this.methods.onMouseWheel?this.methods.onMouseWheel(a,b,d,c):!1};c.prototype.ld=function(){return this.methods.getToolName?this.methods.getToolName():"custom"};return c}();var tf=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.element=null;b.hj=void 0;b.yc=new Pc;b.Nm=new Pc;b.He=new J;b.readOnly=!1;b.qb=!1;b.Ad=null;b.width=0;b.height=0;b.Rc=null;b.rr="";b.log=x.create("DomNode",!0);b.$g=-1;b.canvas=null;b.ba.data="";b.ba.locked=!1;return b}__extends(a,c);a.prototype.type=function(){return"DomNode"};a.prototype.setProperty=function(a,d){if("data"===a)this.element&&(B(this.element).remove(),this.hj=this.element=null);else if("border"===a||"lockSize"===a||
"lockRotate"===a||"preview"===a){this.ba[a]=d;return}c.prototype.setProperty.call(this,a,d)};a.prototype.Px=function(a){null!==this.Ad&&(this.log("Node %s receives DOM element and requests reformat",this.id),this.element&&(this.log("   Remove existing DOM element"),B(this.element).remove()),this.element=a,this.element.style.position="absolute",B(this.element).Om(this.Ad.canvas),this.width=this.element.offsetWidth||parseFloat(this.element.getAttribute("width")||"0"),this.height=this.element.offsetHeight||
parseFloat(this.element.getAttribute("height")||"0"),B(this.element).remove(),this.Rg(this.readOnly,!0),this.element.style.top="0px",this.element.style.left="0px",this.element.style.boxSizing="border-box",this.element.classList.add("zwibbler-dom-node"),this.element.setAttribute("zwibbler-node-id",""+this.id),this.Dl("transformOrigin","top left"),this.log("element height: %s, %s",this.element.offsetWidth,this.element.offsetHeight),this.Ad.Lg(this.id))};a.prototype.Wb=function(){return this.element};
a.prototype.Dl=function(a,d){if(null!==this.element){for(var b=a.charAt(0).toUpperCase()+a.substr(1),c=["ms","Webkit","O","Moz"],h=0;h<c.length;h++)this.element.style[c[h]+b]=d;this.element.style[a]=d}};a.prototype.Zf=function(a){ed.prototype.Zf.call(this,a);this.element&&(this.element.style.visibility=this.Hi?"hidden":"visible")};a.prototype.Rg=function(a,d){void 0===d&&(d=!1);if(d||this.readOnly!==a)this.readOnly=a,this.element&&this.Ad&&this.qb&&(this.nn(this.$g),B(this.element).Om(this.Ad.canvas))};
a.prototype.format=function(a,d){var b=this;this.canvas=d.canvas;null===this.element&&this.hj!==this.ka("data")&&d&&(this.hj=this.ka("data"),this.Ad=d,this.log("DomNode %s requests conversion to DOM element",this.id),this.Ad.Mt(this.hj,this.id));if(this.element){this.element.jz=this.id;var c=this.Ja(),h=c.$b();this.element.style.width=this.width*h.x+"px";this.element.style.height=this.height*h.y+"px";c=c.multiply(new Hc(1/h.x,1/h.y));h=this.He;h=h.multiply(c);h.Wv()?(this.Dl("transform",""),this.element.style.left=
""+h.Ba+"px",this.element.style.top=""+h.Ca+"px"):(this.element.style.left="0px",this.element.style.top="0px",this.Dl("transform","matrix("+h.m11+","+h.m21+","+h.m12+","+h.m22+","+h.Ba+","+h.Ca+")"));this.rect.x=0;this.rect.y=0;this.rect.width=this.width;this.rect.height=this.height;this.element.style.visibility=this.Hi?"hidden":"visible"}else this.rect.x=0,this.rect.y=0,this.rect.width=100,this.rect.height=22;this.yc=new Pc(this.rect);this.Ga=this.rect.clone();this.rect.transform(this.Ja());this.yc.transform(this.Ja());
if(c=this.ba.border)this.rect.Dd(c),this.Nm=this.yc.clone(),this.Nm.Dd(c/2),this.yc.Dd(c);!this.ba.preview||null!==this.Rc&&this.rr===this.ba.preview?this.ba.preview||(this.Rc=null):(this.log("Requesting new preview image for %s",this.ba.preview),this.Rc=document.createElement("img"),this.rr=this.Rc.src=this.ba.preview,this.Rc.onload=function(){b.log("Preview image loaded.");d.Lg(b.id)},this.Rc.onerror=function(){b.log("Failed to load preview image")})};a.prototype.ef=function(a){var b=a.Bi;b&&this.Ad&&
(b.m11!==this.He.m11||b.m21!==this.He.m21||b.m12!==this.He.m12||b.m22!==this.He.m22||b.Ba!==this.He.Ba||b.Ca!==this.He.Ca)&&(this.log("Moving DOM element as result of draw zooming"),this.He=b,this.format(a,this.Ad));if(this.element){var c=this.ba.border;if(c){var f=this.Nm;a.setTransform(1,0,0,1,0,0);a.beginPath();a.lineWidth=c;a.strokeStyle="#cccccc";a.moveTo(f.la[0].x,f.la[0].y);a.lineTo(f.la[1].x,f.la[1].y);a.lineTo(f.la[2].x,f.la[2].y);a.lineTo(f.la[3].x,f.la[3].y);a.lineTo(f.la[0].x,f.la[0].y);
a.closePath();a.stroke()}}else a.beginPath(),a.lineWidth=1,a.fillStyle="#888888",a.strokeStyle="#CCCCCC",a.rect(0,0,100,22),a.stroke(),a.font="20px Arial",a.textBaseline="top",a.fillText("DomNode",0,0);if(this.Rc&&this.Rc.naturalHeight&&!b&&this.qb){this.log("Drawing preview image %s,%s ->%s,s",this.Rc.naturalWidth,this.Rc.naturalHeight,this.width,this.height);try{a.drawImage(this.Rc,0,0,this.Rc.naturalWidth,this.Rc.naturalHeight,0,0,this.width,this.height)}catch(h){this.log("Tried to draw image, got error: %s",
h.toString())}}else b&&(b=a.globalCompositeOperation,a.globalCompositeOperation="destination-out",a.fillRect(this.Ga.x,this.Ga.y,this.Ga.width,this.Ga.height),a.globalCompositeOperation=b)};a.prototype.clip=function(a){this.yc.ia(a)};a.prototype.xb=function(a,d){return!this.ba.locked&&this.rect.gd(a,d)&&this.yc.gd(a,d,3)?this:null};a.prototype.vk=function(){this.element&&this.Ad&&(this.log("Added DOM NODE %s",this.id),this.nn(this.$g));this.qb=!0};a.prototype.yk=function(){this.log("Removed DOM NODE %s",
this.id);this.element&&B(this.element).remove();this.qb=!1};a.prototype.nn=function(a){if(this.element&&this.canvas&&!(0>a)){a!==this.$g?(this.element.classList.remove("zwibbler-zorder-"+this.$g),this.element.classList.add("zwibbler-zorder-"+a),this.$g=a,this.log("Add class zwibbler-zorder-%s",a)):this.log("order=zorder=%s",this.$g);var b=null;for(--a;0<=a;a--){var c=this.canvas.parentElement.querySelector(".zwibbler-zorder-"+a);if(c){b=c;this.log("Found element zorder-%s",a);break}this.log("Did not find element zorder-%s",
a)}if(this.element.previousSibling!==b||null===b)b?(this.log("Insert after previous."),B(this.element).Om(b)):(this.log("Insert before canvas %s",this.canvas),B(this.element).insertBefore(this.canvas))}};a.prototype.Xa=function(){this.element&&(this.log("DomNode %s destroyed",this.id),P.detach(this.element))};a.prototype.Mr=function(a){this.nn(a)};return a}(ed);ed.fd("DomNode",tf);var uf={style:".zwibbler-page-selector {\n    overflow-y: scroll;\n    background: #888;\n    width: 160px;\n    text-align: center;\n}\n\n.zwibbler-page-selector [z-page] {\n    border: 3px solid transparent;\n    margin: 5px;\n    display: inline-block;\n    box-shadow: 2px 2px 2px rgba(0,0,0,0.2);\n}\n\n.zwibbler-page-selector [z-page].selected {\n    border: 3px solid #9fb3e7;\n}\n",Zj:'<div class="zwibbler-page-selector">\n    <button z-if="getConfig(\'showPageSelectorControls\')"\n        z-click="ctx.setCurrentPage(ctx.insertPage(ctx.getCurrentPage()+1))">\n        Add Page\n    </button>\n    <button z-if="ctx.getConfig(\'showPageSelectorControls\')"\n        z-click="ctx.deletePage(ctx.getCurrentPage())">\n        Delete Page\n    </button>\n    <br>\n    <div z-sort="ctx.movePage($from,$to)">\n        <div z-for="page in ctx.getPageCount()"\n            draggable="TRUE"\n            z-sortable\n            z-page="page"\n            z-width="130"\n            z-height="130"\n            z-click="ctx.setCurrentPage(page)"\n            z-selected="page==ctx.getCurrentPage()">\n        </div>\n    </div>\n</div>\n'};var vf={style:".zwibbler-property-panel {\n    width: 200px;\n    background: #f5f5f5;\n    display:flex;\n    flex-flow: column nowrap;\n    overflow-y: scroll;\n    padding: 10px;\n    font-family: sans-serif;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none; \n     -khtml-user-select: none; \n       -moz-user-select: none; \n        -ms-user-select: none; \n            user-select: none;     \n}\n\n.zwibbler-property-panel h3 {\n    margin-bottom: 0.5em;\n}\n\n.zwibbler-property-panel button {\n    font-family: inherit;\n    font-size: 100%;\n    padding: 5px;\n    display: block;\n    background-color: white;\n    color: black;\n    border: none;\n    border-radius: 2px;\n    border-bottom: 2px solid #ddd;\n    width: 100%;\n}\n\n.zwibbler-property-panel button[tool] {\n    display: inline-block;\n    width: 60px;\n    height: 60px;\n    font-size: 30px;\n}\n\n.zwibbler-property-panel button.zwibbler-option {\n    border: 0;\n    padding: 10px;\n    border-radius: 3px;\n    background: transparent;\n    text-align: left;\n}\n\n.zwibbler-property-panel button.selected {\n    background: #9fb3e7;\n}\n\n.zwibbler-property-panel button.hover {\n    background: #ddd;\n}\n\n.zwibbler-property-panel hr {\n    border: none;\n    border-top: 1px solid #ccc;\n}\n\n.zwibbler-property-panel select {\n    width: 100%;\n}\n\n.zwibbler-property-panel .colour-picker {\n    padding: 10px 0;\n}\n\n.zwibbler-property-panel [swatch] {\n    border: 1px solid black;\n    display: inline-block;\n    height: 2em;\n    width: 4em;\n    vertical-align:middle;\n    margin-right: 10px;\n}\n",
Zj:'<div class="zwibbler-property-panel">\n<h3>Shape options</h3>\n<div z-if="summary.empty">\n    There are no selected shapes.\n</div>\n<div z-has="AnyNode">\n    <button z-click="deleteNodes()">Delete</button>                    \n    <button z-click="bringToFront()">\n        Move to front\n    </button>\n    <button z-click="sendToBack()">\n        Send to back\n    </button>\n</div>\n<div z-has="fontName">\n    <h3>Font</h3>\n    <select z-property="fontName">\n        <option z-for="font in getConfig(\'fonts\')" z-text="font" z-bind:value="font"></option>\n    </select>\n</div>\n<div z-has="fontSize">\n    <h3>Font size</h3>\n    <select z-property="fontSize">\n        <option value="8">8</option>\n        <option value="10">10</option>\n        <option value="12">12</option>\n        <option value="16">16</option>\n        <option value="20">20</option>\n        <option value="24">24</option>\n        <option value="50">50</option>\n    </select>\n</div>\n<div z-has="fillStyle|strokeStyle|background">\n    <h3>Colours</h3>\n    <div class="colour-picker" z-has="fillStyle">\n        <div swatch z-property="fillStyle" z-colour></div>\n        Fill style\n    </div>\n    <div class="colour-picker" z-has="strokeStyle">\n        <div swatch z-property="strokeStyle" z-colour></div>\n        Outline\n    </div>\n    <div class="colour-picker" z-has="background">\n        <div swatch z-property="background" z-colour></div>\n        Background\n    </div>\n</div>\n<div z-has="arrowSize">\n    <h3>Arrows</h3>\n    <button class="zwibbler-option" z-property="arrowSize" z-value="0">None</button>\n    <button class="zwibbler-option" z-property="arrowSize" z-value="10">Small</button>\n    <button class="zwibbler-option" z-property="arrowSize" z-value="15">Large</button>\n    <hr>\n    <button class="zwibbler-option" z-property="arrowStyle" z-value="solid">Solid</button>\n    <button class="zwibbler-option" z-property="arrowStyle" z-value="open">Open</button>\n</div>\n<div z-has="lineWidth">\n        <h3>Line width</h3> \n        <select z-property="lineWidth">\n            <option value="0">None</option>\n            <option value="1">1</option>\n            <option value="2">2</option>\n            <option value="4">4</option>\n            <option value="8">8</option>\n        </select>\n    </div>\n<div z-has="dashes">\n    <h3>Line style</h3>\n    <button class="zwibbler-option" z-property="dashes" z-value="">Solid</button>\n    <button class="zwibbler-option" z-property="dashes" z-value="3,3">Dots</button>\n    <button class="zwibbler-option" z-property="dashes" z-value="8,2">Dashes</button>\n</div>\n<div z-has="opacity">\n    <h3>Opacity</h3>\n    <input z-property="opacity" type="range" min="0.1" max="1.0" step="0.05">\n</div>              \n'};var wf=function(c){function a(a){var b=c.call(this)||this;b.sa=a;b.path=new N;b.node=null;return b}__extends(a,c);a.prototype.beginPath=function(){this.path=new N;this.node=0};a.prototype.closePath=function(){this.path.close()};a.prototype.moveTo=function(a,d){this.path.moveTo(a,d)};a.prototype.lineTo=function(a,d){this.path.lineTo(a,d)};a.prototype.quadraticCurveTo=function(a,d,c,f){this.path.quadraticCurveTo(a,d,c,f)};a.prototype.bezierCurveTo=function(a,d,c,f,h,k){this.path.bezierCurveTo(a,d,c,
f,h,k)};a.prototype.fill=function(){this.Uo(!0)};a.prototype.stroke=function(){this.Uo(!1)};a.prototype.Uo=function(a){this.node||(this.node=this.sa.createNode("PathNode",{da:this.path.Jb(),ra:this.ra.clone(),lineWidth:this.lineWidth}));a?this.sa.Qb(this.node,"fillStyle",this.fillStyle):this.sa.Qb(this.node,"strokeStyle",this.strokeStyle)};a.prototype.fillText=function(a,d,c){this.Vo(a,d,c,!0)};a.prototype.strokeText=function(a,d,c){this.Vo(a,d,c,!1)};a.prototype.Vo=function(a,d,c,f){d=this.ra.multiply(new Fc(d,
c));c=this.gf(this.font);a={text:a,matrix:d,fontName:c.fontFamily,fontSize:c.fontSize,italic:"italic"===c.fontStyle,bold:"bold"===c.fontWeight};f?a.fillStyle=this.fillStyle:a.strokeStyle=this.strokeStyle;this.sa.createNode("TextNode",a)};a.prototype.ul=function(){throw Error("drawImage: not implented");};a.prototype.measureText=function(a){var b=document.createElement("canvas").getContext("2d");b.font=this.font;return b.measureText(a)};a.prototype.clip=function(){throw Error("clip: not implemented.");
};a.prototype.xl=function(){return{}};a.prototype.Al=function(){};return a}(ge);var xf=function(){function c(){var a=this;this.Ww=new Promise(function(b,d){a.resolve=b;a.reject=d})}c.prototype.then=function(a,b){return this.Ww.then(a,b)};return c}();function yf(c,a,b,d){c.fillStyle="#ffffff";c.fillRect(a,b,d,d);c.beginPath();c.strokeStyle="#000000";c.moveTo(a,b);c.lineTo(a+d,b+d);c.moveTo(a+d,b);c.lineTo(a,b+d);c.stroke()}function zf(c,a,b,d){for(var e,f=0;f<d;f+=5){e=0===f/5%2;for(var h=0;h<d;h+=5)c.fillStyle=e?"#000000":"#ffffff",e=!e,c.fillRect(a+h,b+f,5,5)}e=c.createLinearGradient(a+d,b+d,a,b);e.addColorStop(0,"rgba(255, 255, 255, 1.0)");e.addColorStop(1,"rgba(255, 255, 255, 0.0)");c.fillStyle=e;c.fillRect(a,b,d,d)}
function Af(c,a,b){function d(a){a.addEventListener("click contextmenu",function(b){l.call(self,a.ce("backgroundColor"),0===b.button||"contextmenu"!==b.type);b.preventDefault()})}function e(a,b){return B("div").Wa({width:b+"px",height:b+"px",display:"inline-block"}).Xc(a)}function f(a,b){var d=document.createElement("canvas");d.width=a;d.height=a;b(d.getContext("2d"),0,0,a);var c=e(h,a);c.fa.appendChild(d);return c}void 0===b&&(b={});var h=B.Wb(c),k;if(h){var l=b.onColour||b.onColor;c=f(a,yf);c.addEventListener("click contextmenu",
function(a){if("click"===a.type||"contextmenu"===a.type)l.call(self,"transparent",0===a.button),a.preventDefault()});c=f(a,zf);c.addEventListener("click contextmenu",function(a){if("click"===a.type||"contextmenu"===a.type){if(b.onOpacity)b.onOpacity(.5,0===a.button);a.preventDefault()}});for(k=0;1>=k;k+=1/13){var n=(new r(r.df,[0,0,k,1])).toString();d(e(h,a).Wa({backgroundColor:n}))}for(k=.3;1>=k;k+=.7/14)for(c=0;360>c;c+=22.5)n=(new r(r.df,[c,.7,k,1])).toString(),d(e(h,a).Wa({backgroundColor:n}));
for(c=0;360>c;c+=22.5)n=(new r(r.df,[c,1,1,1])).toString(),d(e(h,a).Wa({backgroundColor:n}))}}(function(){function c(a,b){var d=this;this.Ek=null;var c=document.createElement("div");c.style.width="320px";c.style.lineHeight="0";c.style.position="absolute";b.appendChild(c);Af(c,20,{onColour:function(a,b){d.Ek&&d.Ek.resolve({type:"colour",value:a,fill:b})}});this.cm=ec(c);a.add(function(){d.cm&&d.cm.destroy()})}c.prototype.show=function(a,b){this.Ek=new xf;this.cm.show(a,b,!0);return this.Ek};return c})();var T=x.create("CONTEXT");function U(c){return"number"===typeof c?c.toString(36):c}function Bf(c){if(c instanceof Array){for(var a=[],b=0;b<c.length;b++)a.push(U(c[b]));return a}return[U(c)]}
var W=function(){function c(a,b){var d=this;this.Ya={};this.nm={};this.Pv=0;this.Ym=null;this.hg={};this.Ld=this.ng=null;this.kj=!1;this.uj=new bc;this.Up=new cc;this.cc=null;this.globals={};this.kp=!1;this.zn=0;this.Hg=null;this.Ap="";this.ea=new rf(this,a,b);this.Iw();var c=this;Q.Pm.push(this);this.ea.xa.add(function(){T("Running ZwibblerContext destructor");d.Wk();delete a.zwibbler;delete c.Ya;delete c.ea;delete c.ng;for(var b=Q.Pm,e=0;e<b.length;e++)if(b[e]===c){b.splice(e,1);break}d.Ld&&d.Ld.stop()});
this.pa("document-changed",function(a){d.summary=d.Jh();a.remote||d.cc&&!d.cc.empty()||(d.cc=d.ea.view.aa.lb.vm(),d.cc.empty()?T("No outstanding changes to send..."):(T("Submitting local changes: %s",d.cc.getData()),d.na("local-changes",d.cc.getData())))});this.ea.ga.pa("latency",function(a){d.Ld&&d.Ld.Tx(a)});this.Ls();this.pa("selected-nodes",function(){d.summary=d.Jh()});this.pa("tool-changed",function(){d.summary=d.Jh()});this.summary=this.Jh();this.Fi(Cf,"left","showToolbar");this.Fi(uf,"right",
"showPageSelector");this.Fi(vf,"right","showPropertyPanel");this.Fi(mb,"bottom","showColourPanel")}c.prototype.El=function(a,b){this.ea.El(a,b)};c.prototype.ih=function(a,b){void 0===b&&(b=!1);T("Add remote changes: %s reset=%s",a,b);b&&(this.ea.Yf(new of(!0,this.ea.de(),this.ea.mi)),this.cc=null);this.ea.view.aa.lb.ih(a)};c.prototype.sc=function(a,b){P.sc(a,b);P.digest();this.ea.xa.add(function(){T("DESTROYING A PANEL");P.detach(b)});if(!this.kp&&a instanceof c||a.ctx instanceof c)this.kp=!0,this.pa("tool-changed",
function(){return P.digest()}),this.ea.ga.pa("update",function(){return P.digest()}),this.pa("document-changed",function(){return P.digest()}),this.pa("selected-nodes",function(){return P.digest()});this.resize()};c.prototype.digest=function(a){P.digest(a)};c.prototype.Os=function(){this.za("abortTransaction is not implemented. Please contact support.")};c.prototype.Wc=function(a,b,d,c,f,h){switch(h){case "scale":case "rotate":case "translate":var e=h;break;default:if("function"===typeof h){e="click";
var l=h}else{this.za('addSelectionHandle: action must be "scale", "rotate", "translate", or a function');return}}this.ea.view.Wc(a,b,d,c,f,e,l)};c.prototype.Oi=function(a,b){var d=this.ea.view.aa.Ka(U(a));if(d)if(d instanceof Ce){var c=Bf(b);this.Qd(function(a){a.Oi(d.id,c)})}else T("parent is not a group");else T("addToGroup: Bad node id")};c.prototype.Gl=function(a){this.ea.language.Gl(a)};c.prototype.Ws=function(a,b,d){if(!this.wa())return this.fk(this.Zb(),b,d)};c.prototype.hh=function(a,b,d){this.ea.hh(a,
b,d)};c.prototype.Va=function(){this.ea.view.aa.Va()};c.prototype.Vi=function(){this.Va()};c.prototype.tt=function(a){void 0===a&&(a=this.Zc());this.wa()||this.ea.view.Yc(0,Bf(a))};c.prototype.Sd=function(){return this.wa()?!1:this.ea.view.aa.Sd()};c.prototype.Td=function(){return this.wa()?!1:this.ea.view.aa.Td()};c.prototype.eb=function(){this.ea.view.eb();this.ea.view.Vb();this.ea.view.ia()};c.prototype.Ct=function(){this.ea.Sl()};c.prototype.Dt=function(a,b){if(this.wa())return!1;this.Ng(a,!b)};
c.prototype.va=function(a){void 0===a&&(a=!1);this.ea.view.aa.va(a)};c.prototype.Ht=function(){this.va(!0)};c.prototype.aj=function(){this.va(!1)};c.prototype.nf=function(a,b){void 0===a&&(a=!1);void 0===b&&(b=this.Zc());"boolean"!==typeof a&&this.za("First parameter of copy() must be true/false");return this.ea.view.nf(a,Bf(b))};c.prototype.Ep=function(){function a(a){for(var d=30;100>d;d+=20)a.values[2]=d/100,b.push(a.toString())}var b="rgba(0,0,0,0.0) rgba(0,0,0,0.5) #000000 #ffffff #000088 #008800 #008888 #880000 #880088 #884400 #888888 #444444 #0000ff #00ff00 #00ffff #ff0000 #ff00ff #ffff00".split(" ");
a(new r(r.df,[0,0,0,1]));for(var d=0;720>d;d+=35){var c=new r(r.df,[d,.5,0,1]);a(c)}return b};c.prototype.Rt=function(a,b){return this.createNode("DataNode",a,b)};c.prototype.St=function(a){if(this.wa())return!1;var b=0;this.Qd(function(d){b=parseInt(d.group(Bf(a)),36)});return b};c.prototype.Sb=function(a){void 0===a&&(a={});var b={};if(a instanceof Array)return a.concat();if(!(a instanceof Object))return a;for(var d in a)if(a.hasOwnProperty(d)){var c=a[d];"matrix"===d&&("[object Array]"===Object.prototype.toString.apply(c)&&
"Matrix"===c[0]?(c.splice(0,1),c=new J(c)):c instanceof J||(c=new J(c)));b[d]=c}return b};c.prototype.Ut=function(a){return x.create(a)};c.prototype.createNode=function(a,b,d){T("createNode(%s)",a);pc(a)||this.za("createNode: node type must be string");b=this.Sb(b);return d?parseInt(this.ea.createNode(a,b,U(d)),36):parseInt(this.ea.createNode(a,b),36)};c.prototype.Tt=function(a,b,d){if(!Q.De[a])throw Error("Component "+a+" not registered");var c=Q.De[a].ta;if(c)for(var f in c)f in b||(b[f]=c[f]);
b.$component=a;return this.createNode("HTMLNode",b,d)};c.prototype.fj=function(a){return this.ea.fj(a)};c.prototype.Fi=function(a,b,d){var c=this,f;this.ea.ga.pa(d,function(d){d?(f||(a.style&&Q.Pe(a.style),d=document.createElement("div"),d.innerHTML=a.Zj,f=d.firstChild,c.sc(c,f),a.controller&&a.controller(c)),c.ea.hh(1,b,f)):f&&c.ea.ki(f)})};c.prototype.Yt=function(a,b){var d=B.Wb(a);if(d){"object"===typeof b&&"[object Array]"===Object.prototype.toString.apply(b)||this.za("createToolbar: second parameter must be array");
Q.Pe("a.zwibbler-button {\n            background-repeat: no-repeat;\n            background-position: center;\n            display: inline-block;\n            overflow: hidden;\n        }");for(var c=this,f=function(a,b){b.addEventListener("click",function(b){a.onclick.call(this,c,b)})},h=0;h<b.length;h++){var k=b[h],l=B("a").sd("zwibbler-button").fa;l.setAttribute("href","javascript:void(0)");k.toolName&&B(l).sd(k.toolName);k.onclick&&f(k,l);k.title&&l.setAttribute("title",k.title);k.background?
l.style.background=k.background:k.image&&(l.style.backgroundImage="url("+k.image+")");k.html&&(l.innerHTML=k.html);d.appendChild(l)}var n;this.pa("tool-changed",function(a){n&&n.classList.remove("zwibbler-selected");(n=d.querySelector("."+a))&&n.classList.add("zwibbler-selected")})}else this.za("createToolbar: Could not convert first parameter to an HTML element")};c.prototype.Xl=function(a){if(!this.ea.Xl(a))return this.za("createShape needs an array of at least 6 numbers"),null};c.prototype.$l=
function(){if(this.wa())return!1;var a=this.ea.view.nf(!1,this.ea.view.Nc(!0));this.Ip();return a};c.prototype.Xa=function(){this.ea.Xa();this.uj.Xa();this.Up.Xa();for(var a in this)this.hasOwnProperty(a)&&delete this[a];this.kj=!0};c.prototype.Qd=function(a){this.ea.view.aa.transaction(a)};c.prototype.Xd=function(a){this.Ub(a)};c.prototype.Gs=function(a){for(var b=0;b<a.length;b++)this.ea.view.aa.Ka(a[b],!1)||(a.splice(b,1),--b);return 0<a.length};c.prototype.Ub=function(a){void 0===a&&(a=this.Zc());
if(this.wa())return!1;T("deleteNodes()");var b=Bf(a);this.Gs(b)&&this.Qd(function(a){return a.Ub(b)})};c.prototype.Zt=function(){var a=this;if(this.wa())return!1;1<this.Pv&&this.za("deletePage is not implemented inside transactions. Please contact support.");if(1===this.Zb())this.Qd(function(b){return b.Ub(Bf(a.sm()))});else{var b=this.ea.view.aa.zf().id;this.Qd(function(a){return a.Ub([b])})}};c.prototype.Ip=function(){if(this.wa())return!1;this.ea.view.wh()};c.prototype.Ee=function(){1===arguments.length&&
!1===arguments[0]&&this.ea.view.aa.Nq();return this.ea.view.aa.Ee()};c.prototype.download=function(a,b,c,e){void 0===e&&(e=0);"jpeg"===a&&(a="jpg");"pdf"===a||"svg"===a||"png"===a||"jpg"===a||"bmp"===a||"zwibbler3"===a?(a="zwibbler3"===a?pf.Di(this.ea.view.aa,a,"data-uri"):this.save(a,c,e),this.Up.Ax(a,b)):T("unsupported format for download: %s",a)};c.prototype.ia=function(a,b){void 0===b&&(b={});var c=b.page||0,e=this.ea.view.aa.ab,f=this.tg();this.ea.view.aa.zc(c);this.ea.view.Yd(a,0,0,f.width,
f.height);this.ea.view.aa.ia(a);this.ea.view.aa.zc(e)};c.prototype.gu=function(a){if(this.wa())return!1;var b=this.ea.view.aa.hb(U(a),!1);b?b.Oh()?(a=this.ea.view.ao({}))&&a.Un(b,b.rect.x,b.rect.y):T("editNodeText: node %s (%s) cannot contain text.",a,b.type()):T("editNodeText: ExtNodeID %s does not exist.",a)};c.prototype.duplicate=function(){if(this.wa())return!1;this.ea.view.duplicate()};c.prototype.vl=function(a,b,c){var d=this;if(!(this.kj||this.nm[a]||this.Js(a))){var f=function(){if(!d.kj&&
(d.nm[a]=!1,a in d.Ya))for(var c=0,e=d.Ya[a];c<e.length;c++)e[c].apply(null,b)};"once"===c&&(this.nm[a]=!0);"now"===c?f():setTimeout(f,0);return this}};c.prototype.na=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return this.vl(a,b,"normal")};c.prototype.jd=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return this.vl(a,b,"now")};c.prototype.og=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return this.vl(a,b,"once")};c.prototype.my=
function(a){this.hg[a]=a in this.hg?this.hg[a]+1:1};c.prototype.Js=function(a){return a in this.hg&&0<this.hg[a]?(T("Skipped %s event",a),--this.hg[a],!0):!1};c.prototype.focus=function(a,b){void 0===a&&(a=!1);void 0===b&&(b=null);this.ea.Yx(b);a?this.ea.Ln("text"===this.Fh()):this.ea.focus()};c.prototype.zu=function(a){this.ea.view.aa.Mb(function(b){return a(parseInt(b.id,36))},this.Me())};c.prototype.tu=function(a){a=this.Vp(a);return a.length?a[0]:null};c.prototype.Vp=function(a){a=this.ea.view.aa.uu(a);
for(var b=[],c=0;c<a.length;c++)b.push(a[c].id);return b};c.prototype.xu=function(a,b,c){if(this.wa())return!1;if(3===arguments.length)if("number"!==typeof b||"number"!==typeof c)this.za("flip: 2nd and 3rd args must be numbers.");else{var d=new G(b,c);this.ea.view.Xp(a/180*Math.PI,d)}else this.ea.view.Xp(a/180*Math.PI)};c.prototype.Ch=function(a,b,c,e){if(this.wa())return!1;a=this.fp(Bf(a));"number"===typeof c&&"number"===typeof e?(c=new G(c,e),this.ea.view.Ch(a,b/180*Math.PI,c)):this.ea.view.Ch(a,
b/180*Math.PI)};c.prototype.aq=function(a,b,c){var d=this;void 0===c&&(c={});c.onColour=c.onColour||c.onColor||function(a,b){d.Ng(a,b)};c.onOpacity=c.onOpacity||function(a,b){d.Pr(a,b)};return Af(a,b,c)};c.prototype.rg=function(){return this.ea.view.rg()};c.prototype.sm=function(){var a=[];this.ea.view.aa.Mb(function(b){a.push(parseInt(b.id,36))},this.Me());return a};c.prototype.Ju=function(){return this.ea.Ku()};c.prototype.tm=function(a){return this.ff(this.ea.view.tm(Bf(a)))};c.prototype.$d=function(a){pc(a)||
this.za("getConfig: Expected string");return this.ea.ga.get(a)};c.prototype.getContext=function(){return new wf(this)};c.prototype.Me=function(){return this.ea.view.aa.ab};c.prototype.Ou=function(){return this.ea.view.Dj()};c.prototype.Pu=function(){return this.ea.view.Nj()};c.prototype.Fh=function(){return this.ea.view.Fh()};c.prototype.Qu=function(a){a=this.ea.view.aa.Ka(U(a));var b=null;a&&"CustomNode"===a.type()&&(b=a.Ta);return b};c.prototype.gq=function(a,b){var c=this.ea.view.Jd(a,b);return{x:c.x,
y:c.y}};c.prototype.Uu=function(a){return this.ea.view.aa.ka(a)};c.prototype.tg=function(){var a;this.$d("pageView")&&(a=qf);return this.ff(this.ea.view.aa.lc(this.Me(),a))};c.prototype.Wb=function(){return this.ea.de()};c.prototype.Dj=function(){return this.ea.view.Dj()};c.prototype.ev=function(){for(var a=[],b=0,c=this.ea.view.aa.Im();b<c.length;b++){var e=c[b];a.push({cid:e.Pa,ts:e.gc})}return a};c.prototype.Am=function(a){return this.ea.ga.Am(a)};c.prototype.iv=function(a){return this.ea.language.get(a)};
c.prototype.ff=function(a){return{x:a.x,y:a.y,width:a.width,height:a.height}};c.prototype.Ii=function(a){"object"!==typeof a&&this.za("Error: Rectangle object expected.");a=new H(a.x||0,a.y||0,a.width||0,a.height||0);a.xr();return a};c.prototype.Wu=function(){return this.ff(this.ea.view.aa.cq())};c.prototype.cv=function(a){var b=this.ea.view.aa.hb(U(a));return null===b?(T("getGroupParent: No such node %s",a),null):b.Rm()&&b.parent?parseInt(b.parent.id,36):null};c.prototype.bv=function(a){var b=[],
c=this.ea.view.aa.Ka(U(a));if(!(c&&c instanceof Ce))return T("getGroupMembers: Error node %s is not a group.",a),b;if(c.children)for(a=0,c=c.children;a<c.length;a++)b.push(parseInt(c[a].id,36));return b};c.prototype.gv=function(a,b){return this.Gj(a,b)};c.prototype.kv=function(){var a=[],b={};this.ea.view.aa.Ic(!1,function(d){!(c=d.Xb())||c in b||(b[c]=1,a.push(c))});var c=this.rg();c in b||a.push(c);return a};c.prototype.jv=function(a){var b=[];this.ea.view.aa.Ic(!1,function(c){c.Xb()===a&&b.push(parseInt(c.id,
36))});return b};c.prototype.lv=function(a,b,c){var d=this.ea.view.aa.hb(U(a));if(null===d)return this.za("Error: node %s does not exist",a),null;a=this.ea.view.vw(d,b,c);return{x:a.x,y:a.y}};c.prototype.be=function(a){return this.ea.view.aa.be(U(a))};c.prototype.Gj=function(a,b){return this.ea.Gj(U(a),b)};c.prototype.mv=function(a){a=Bf(a);for(var b=null,c=0;c<a.length;c++){var e=a[c],f=this.ea.view.aa.hb(e);null===f?this.za("Error: node %s does not exist",e):b?b.zi(f.rect):b=f.rect.clone()}b||(b=
new H(0,0,0,0));return this.ff(b)};c.prototype.nv=function(a){var b=this.ea.view.aa.hb(U(a));if(null===b)return this.za("Error: node %s does not exist",a),null;a=b.Ja().$b();return{x:a.x,y:a.y}};c.prototype.ov=function(a){var b=this.ea.view.aa.hb(U(a));if(null===b)this.za("Error: node %s does not exist",a);else return a=b.Ja(),[a.m11,a.m21,a.m12,a.m22,a.Ba,a.Ca]};c.prototype.pv=function(a){a=this.ea.view.aa.Ka(U(a));var b="";a&&(b=a.type(),"CustomNode"===b&&(b=a.ka("nodeType")));return b};c.prototype.qv=
function(a,b){var c=this.ea.view.aa.xb(a,b,this.ea.view.Ua);return c?c.id:this.ea.view.mr(a,b)&&(c=this.Zc(),c.length)?c[0]:null};c.prototype.uv=function(a,b){for(var c=[],e=0,f=this.ea.view.aa.Nv(a,b);e<f.length;e++)c.push(parseInt(f[e].id,36));return c};c.prototype.Zb=function(){return this.ea.view.aa.Zb()};c.prototype.Hj=function(a){return(a=this.ea.view.aa.zf(a))?parseInt(a.id,36):null};c.prototype.pq=function(a){return this.ff(this.ea.view.aa.lc(a,qf))};c.prototype.Jj=function(a){var b=this.ea.view.aa.hb(U(a),
!1);if(!b||"PathNode"!==b.type())return null;a=b.Jj().clone().$e();var c=[];b.Ja();for(b=0;b<a.length;b++){var e=a[b];c.push(e.x);c.push(e.y)}return c};c.prototype.xv=function(a){a=this.ea.view.aa.Ka(U(a),!1);if(!a||"PathNode"!==a.type())return null;a=a.Jj();for(var b=[],c=[],e=0;e<a.da.length;){switch(a.da[e]){case K.Ec:c=[{x:a.da[e+1],y:a.da[e+2]}];b.push(c);break;case K.Dc:c.push({x:a.da[e+1],y:a.da[e+2]})}e+=K.Fc[a.da[e]]}return b};c.prototype.eq=function(){return this.ea.view.scale};c.prototype.ym=
function(){var a=this.ea.view.ym();return a?parseInt(a.id,36):0};c.prototype.yv=function(a,b,c,e){var d=this.ea.view.dm(a,b);if(void 0===c||void 0===e)return{x:d.x,y:d.y};a=this.ea.view.dm(a+c,b+e);return this.ff(new H(d.x,d.y,a.x-d.x,a.y-d.y))};c.prototype.Av=function(){return this.ea.view.xd};c.prototype.Nj=function(){return this.ea.view.Nj()};c.prototype.Cj=function(a,b){var c=this.ea.view.aa.hb(U(a),!1);return c&&c.Ne()?c.Cj(b):null};c.prototype.Ox=function(a,b,c){var d=this.ea.view.aa.Ka(U(a),
!1);if(!d)return T("setEditHandle: node %s doesn't exist.",a),!1;if("PathNode"!==d.type())return T("setEditHandle: node %s is not a PathNode.",a),!1;d=d.ka("commands");d=M.Cs(d,b,c);if(!d)return T("setEditHandle: failed"),!1;this.Qb(a,"commands",d);return!0};c.prototype.Zc=function(a){void 0===a&&(a=!1);a=this.ea.view.Nc(a);for(var b=[],c=0;c<a.length;c++)b.push(parseInt(a[c],36));return b};c.prototype.Jh=function(a){function b(a,b){var d=c.properties[a];void 0!==b&&(c.properties[a]=d!==b&&void 0!==
d?null:b);c.empty=!1}void 0===a&&(a=this.Zc());for(var c={properties:{},types:{},nodes:[],empty:!0},e=this.ea.ga.get("allowTextInShape"),f=0;f<a.length;f++){var h=this.ea.view.aa.Ka(U(a[f]),!1);if(h){var k=h.type();c.types[k]=!0;c.types.AnyNode=!0;c.empty=!1;c.nodes.push(parseInt(h.id,36));"PathNode"===k&&(k=h.ka("closed")?"PathNode-closed":"PathNode-open",c.types[k]=!0);h=h.Mc();for(var l in h)h.hasOwnProperty(l)&&"matrix"!==l&&("BrushNode"!==k||"fillStyle"!==l)&&("PathNode-open"!==k||"fontSize"!==
l&&"fontName"!==l&&"fillStyle"!==l)&&("PathNode-closed"!==k||(e||"fontSize"!==l&&"fontName"!==l)&&"arrowSize"!==l&&"arrowStyle"!==l)&&b(l,h[l])}}!c.nodes.length||"opacity"in c.properties||(c.properties.opacity=1);if(this.ea.view.qa.Pj){a=this.ea.view.qa.Pj();for(var n in a)b(n,a[n])}return c};c.prototype.Fv=function(){return this.ff(this.ea.view.Af())};c.prototype.Hv=function(a){this.ea.view.aa.Km(a);this.Ir("readOnly",this.ea.view.aa.locked())};c.prototype.za=function(a){for(var b=1;b<arguments.length;b++);
b=arguments[0].split("%s");for(var c=[],e=0;e<b.length;e++)c.push(b[e]),e<b.length-1&&c.push(JSON.stringify(arguments[e+1]));b=c.join("");T(b);console.log(b);throw Error(b);};c.prototype.Lw=function(a){a||(a={});return this.uj.open({accept:a.accept,format:a.format}).then(function(a){return a.data})};c.prototype.Rv=function(){var a=this;if(this.wa())return!1;this.uj.open({accept:"image/*",format:"data-uri"}).then(function(b){a.createNode("ImageNode",{url:b.data,kz:!0})})};c.prototype.fk=function(a,
b,c){if(this.wa())return!1;var d={};F(b)&&F(c)&&(d.width=b,d.height=c);this.Qd(function(b){return b.createNode("PageNode",d,b.root.id,a)});return a};c.prototype.Sm=function(a){return this.ea.view.aa.Sm(a)};c.prototype.Rh=function(a){a=this.ea.view.aa.hb(U(a));return null!==a&&this.ea.view.Rh(a)};c.prototype.load=function(a,b){void 0===b&&(b=a);var c=pf.fh(b,this.ea.de(),this.ea.mi);if(c)return this.Wk(),this.ea.Yf(c),!0;T("load(): Could not open file.");return!1};c.prototype.kk=function(a){var b=
this;F(a)?(this.Ym&&clearTimeout(this.Ym),this.Ym=setTimeout(function(){b.ea.view.kk(!1)},a),b.ea.view.kk(!0)):this.za("lockUpdates: Expected a number")};c.prototype.Vh=function(a){if(!this.cc||a!==this.cc.getData())throw Error("markChangesSent(): marked changes were not the ones sent");T("Mark changes sent!");this.ea.view.aa.lb.Vh(this.cc.ug());this.cc=this.ea.view.aa.lb.vm();this.cc.empty()?T("No more changes to send."):(T("Sending more changes"),this.na("local-changes",this.cc.getData()))};c.prototype.kw=
function(){if(this.wa())return!1;this.ea.view.Yc(3)};c.prototype.lw=function(a,b){if(this.wa())return!1;if(F(a)&&F(b)){var c=this.Zb();if(0>a||a>=c)this.za("From page must be > 0 and less than getPageCount()");else if(0>b||b>=c)this.za("From page must be > 0 and less than getPageCount()");else{var e=this.Hj(a);null!==e&&this.Qd(function(a){return a.Yc([U(e)],4,b)})}}else this.za("movePage: needs two valid page numbers.")};c.prototype.mw=function(){if(this.wa())return!1;this.ea.view.Yc(2)};c.prototype.Qq=
function(){this.Wk()};c.prototype.nextPage=function(){this.Xf(Math.min(this.Me()+1,this.Zb()-1))};c.prototype.pa=function(a,b){"draw"===a?this.ng=b:a in this.Ya?this.Ya[a].push(b):this.Ya[a]=[b];return this};c.prototype.Ew=function(a){"function"===typeof a||this.za("Error: onComplete needs a function argument.");this.ea.view.Bu(a)};c.prototype.Iw=function(){var a=this.ea.ga.get("defaultPaperSize");T("onNewDocument()");"none"!==a&&this.Jn(a)};c.prototype.Mw=function(a){var b=this;return this.uj.open({accept:"."+
a,format:"text"}).then(function(a){if("string"===typeof a.data&&b.load(a.data))return b;throw Error("Could not open the file.");})};c.prototype.gi=function(a){if(this.wa())return!1;this.ea.view.gi(a)};c.prototype.Vw=function(){this.Xf(Math.max(this.Me()-1,0))};c.prototype.print=function(a,b){var c=[],e;if("number"===typeof a)c.push(a);else if(a instanceof Array)for(e=0;e<a.length;e++)if(F(a[e]))c.push(a[e]);else{this.za("print(): pageSpec must be array of numbers");return}else if(!a)for(e=0;e<this.Zb();e++)c.push(e);
var f=b?this.Ii(b):this.Ii(this.tg());var h=this.Me(),k=document.createElement("canvas");k.width=f.width;k.height=f.height;var l=k.getContext("2d");l.translate(-f.x,-f.y);e=window.location.hostname;var n=window.open("about:blank","_blank");n.document.write("<!DOCTYPE html><html><head><title>"+e+"</title></head><body>");for(e=0;e<c.length;e++)this.Xf(c[e]),this.ea.view.Yd(l,f.x,f.y,f.width,f.height),this.ea.view.aa.ia(l),0<e?n.document.write("<div style='page-break-before:always'>"):n.document.write("<div>"),
n.document.write("<img style='width:100%' src='"),n.document.write(k.toDataURL()),n.document.write("'></div>"),l.clearRect(f.x,f.y,f.width,f.height);n.document.write("</body></html>");n.document.close();setTimeout(function(){n.focus();n.print();setTimeout(function(){n.close()},1E3)},1E3);this.Xf(h)};c.prototype.wa=function(){return this.ea.ga.get("readOnly")?(T("readOnly; ignore tool click."),!0):!1};c.prototype.Id=function(){this.ea.view.Id()};c.prototype.Sc=function(a){this.ea.view.ia(a)};c.prototype.removeEventListener=
function(a,b){if(a in this.Ya){for(var c=this.Ya[a],e=0;e<c.length;e++)if(c[e]===b){c.splice(e,1);break}0===c.length&&delete this.Ya[a]}};c.prototype.removeListener=function(a,b){this.removeEventListener(a,b)};c.prototype.resize=function(){if(!this.zn){var a=this;a.zn=setTimeout(function(){a.zn=0;a.ea.Ji()},0)}};c.prototype.save=function(a,b,c){void 0===a&&(a="zwibbler3");void 0===c&&(c=0);var d={jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",bmp:"image/bmp",svg:"image/svg+xml",pdf:"application/pdf"};
b=this.Ii(b||this.tg());switch(a){case "list":return pf.Di(this.ea.view.aa,"list","object");case "png":case "jpeg":case "jpg":case "bmp":case "svg":case "pdf":return this.ea.Br(d[a],b,c);case "zwibbler3":return pf.Di(this.ea.view.aa,"zwibbler3","string");case "image/png":case "image/jpeg":case "image/bmp":b=this.ea.Br(a,b,c);b=b.substr(b.indexOf(",")+1);a="";c=0;d={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,
d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63,"=":64};for(b=b.replace(/[^A-Za-z0-9\-_=\+\/]/g,"");c<b.length;){var f=d[b.charAt(c++)];var h=d[b.charAt(c++)];var k=d[b.charAt(c++)];var l=d[b.charAt(c++)];f=f<<2|h>>4;h=(h&15)<<4|k>>2;var n=(k&3)<<6|l;a+=String.fromCharCode(f);64!==k&&(a+=String.fromCharCode(h));64!==l&&(a+=String.fromCharCode(n))}return a;default:return"Unsupported format: "+
a}};c.prototype.fc=function(a){this.ea.view.fc(a)};c.prototype.Kd=function(a,b){if(this.wa())return!1;this.ea.view.Kd(a,b)};c.prototype.fp=function(a){for(var b=[],c=0;c<a.length;c++){var e=this.ea.view.aa.hb(a[c],!1);e&&b.push(e)}return b};c.prototype.selectNodes=function(a){a=this.fp(Bf(a));this.ea.view.selectNodes(a);this.ea.view.Vb();this.ea.view.ia()};c.prototype.Fx=function(a){if(this.wa())return!1;var b=Bf(a||this.Zc());this.Qd(function(a){return a.Yc(b,1)})};c.prototype.Ok=function(a){this.ea.view.Ok(a)};
c.prototype.Ir=function(a,b){"defaultPaperSize"===a&&this.Jn(b);return this.ea.ga.set(a,b)};c.prototype.Ng=function(a,b){if(this.wa())return!1;this.ea.view.Dw(a,b)};c.prototype.Xf=function(a){this.ea.view.zc(a)};c.prototype.Gn=function(a){this.ea.view.Gn(a)};c.prototype.Mx=function(a,b){this.ea.view.aa.setProperty(a,b)};c.prototype.Og=function(a,b){!F(a)&&null!==a||!F(b)&&null!==b?alert("setDocumentSize: width/height must be numbers"):this.ea.view.Og(a,b,!0)};c.prototype.Kr=function(a,b){!F(a)&&null!==
a||!F(b)&&null!==b?alert("setDocumentSize: width/height must be numbers"):this.ea.view.Og(a,b,!1)};c.prototype.Lr=function(a,b){var c=this.ea.view.aa.Ka(U(a));c?("DomNode"!==c.type()&&this.za("setDomElement: Node %s is not a DomNode. It is %s",a,c.type()),c.Px(b),this.ea.oj.push(b)):this.za("setDomElement: Node %s does not exist",a)};c.prototype.Nx=function(a,b){return this.Lr(a,b)};c.prototype.Ls=function(){var a=this;T("Setting up dragdrop");this.ea.xa.addEventListener(this.ea.ma,"drop",function(b){b.preventDefault();
if(b.dataTransfer){if(b.dataTransfer.items)for(var c=0;c<b.dataTransfer.items.length;c++){if("file"===b.dataTransfer.items[c].kind){a.ea.view.rn(b.dataTransfer.items[c]);break}}else for(c=0;c<b.dataTransfer.files.length;){a.ea.view.rn(b.dataTransfer.files[c]);break}try{var e=JSON.parse(b.dataTransfer.getData("text"))}catch(k){return}if("object"===typeof e&&e["zwibbler-src"]){var f=parseFloat(e["zwibbler-width"]),h=e["zwibbler-src"];T("DragDrop received with src=%s size=%s",h,f);h&&Q.lq(h,function(c,
d){var e=1;f&&(e=f/c);var k=a.gq(b.pageX,b.pageY);k.x-=c*e/2;k.y-=d*e/2;a.Vi();var l=a.createNode("ImageNode",{url:h});a.Lk(l,e,e);a.yi(l,k.x,k.y);a.aj();a.gs()})}}})};c.prototype.Vu=function(a){var b=this.ea.view.aa.Ka(U(a));if(!b)return this.za("getDomElement: Node %s does not exist",a),null;b instanceof tf||this.za("getDomElement: Node %s is not a DomNode. It is %s",a,b.type());return b.Wb()};c.prototype.nq=function(a){for(;a;){var b=a.getAttribute("nid");if(b)return parseInt(b,36)||0;a=a.parentElement}return 0};
c.prototype.Em=function(a){return(a=this.ea.view.aa.Ka(U(a)))?a.Lj({ctx:this}):null};c.prototype.Ux=function(a,b){pc(a)&&pc(b)?(this.rg()===a&&this.Ok(b),this.ea.view.aa.Ic(!1,function(c){c.Xb()===a&&c.setProperty("layer",b)})):this.za("setLayerName() needs string arguments.")};c.prototype.Jn=function(a,b){var c=null,e=null,f=!0,h=!1;if(2===arguments.length)if(F(arguments[0])&&F(arguments[1])){var k=arguments[0];c=arguments[1]}else pc(arguments[0])&&"boolean"===typeof arguments[1]?(e=arguments[0],
h=arguments[1]):f=!1;else if(1===arguments.length&&pc(arguments[0]))for(var l=arguments[0].split(" "),n=0;n<l.length;n++)"landscape"===l[n]?h=!0:"portrait"===l[n]?h=!1:e=l[n];if(!1===f)return T("Bad arguments to setPaperSize()."),!1;if(null===e)return this.Og(k,c),!0;switch(e.toLowerCase()){case "letter":k=816;c=1056;break;case "legal":k=816;c=1344;break;case "11x17":k=1056;c=1632;break;case "tabloid":k=1056;c=1632;break;case "a0":k=841/25.4*96;c=1189/25.4*96;break;case "a1":k=594/25.4*96;c=841/25.4*
96;break;case "a2":k=420/25.4*96;c=594/25.4*96;break;case "a3":k=297/25.4*96;c=420/25.4*96;break;case "a4":k=210/25.4*96;c=297/25.4*96;break;case "none":c=k=null;break;default:return T("Invalid paper size: %s",e),!1}h&&(e=k,k=c,c=e);this.Og(k,c);return!0};c.prototype.Sx=function(a,b,c){this.Qb(a,b,c)};c.prototype.Uc=function(a,b){if(this.wa())return!1;if(2!==arguments.length)throw"Error: setNodeProperties takes 2 arguments.";this.ea.Uc(Bf(a),this.Sb(b))};c.prototype.Qb=function(a,b,c){if(this.wa())return!1;
3!==arguments.length&&this.za("Error: setNodeProperty takes 3 arguments.");var d={};d[b]=c;this.Uc(a,d)};c.prototype.Vx=function(a,b){for(var c=Bf(a),e=0;e<c.length;e++){var f=this.ea.view.aa.hb(c[e],!0);f&&f.Zf(!b)}this.ea.view.ia()};c.prototype.Pr=function(a,b){if(this.wa())return!1;this.ea.view.Jw(a,b)};c.prototype.Wx=function(a,b,c){F(a)&&F(b)&&F(c)||this.za("setPageSize(): requires pageNo, width, height");var d=this.Hj(a);d?this.Uc(d,{width:b,height:c}):this.za("setPageSize: no such page %s",
a)};c.prototype.In=function(a){this.ea.view.In(a)};c.prototype.setProperty=function(a,b){this.wa()||(this.Qb(this.Zc(),a,b),this.Kd(a,b),this.ea.view.qe(a,b))};c.prototype.ay=function(a){qc(a)&&F(a.x)&&F(a.y)&&F(a.width)&&F(a.height)||this.za("setViewRect: arg must be an object with numeric x, y, width, height properties");0!==a.width&&0!==a.height||this.za("setViewRect: width and height must be non-zero.");this.ea.view.Tg(this.Ii(a))};c.prototype.rd=function(a,b,c){if(F(a)||"page"===a||"width"===
a)if(1===arguments.length)this.ea.view.rd(a);else if(3===arguments.length&&"number"===typeof a&&F(b)&&F(c)){var d=this.eq()/a,f=this.ea.view.Af();f.transform(new Hc(d,d,b,c));this.ea.view.Tg(f)}else this.za("setZoom: invalid arguments.");else T("setZoom: invalid parameter.")};c.prototype.si=function(a,b){void 0===b&&(b=!0);this.ea.view.si(a,b)};c.prototype.Ra=function(a,b,c){a=this.ea.view.Ra(new G(a,b),c);return{x:a.x,y:a.y}};c.prototype.hk=function(){return Q.hk()};c.prototype.vi=function(a){a?
(a=B.Wb(a))||this.za("toggleFullScreen: can't find element from "+a):a=this.Wb();a.style.backgroundColor="#ffffff";Q.vi(a)};c.prototype.yi=function(a,b,c){if(this.wa())return!1;T("Translate node %s by %s,%s",a,b,c);return this.ea.yi(Bf(a),b,c)};c.prototype.ki=function(a){this.ea.ki(a)};c.prototype.un=function(){this.ea.view.un()};c.prototype.xx=function(a){if(this.wa())return!1;var b=0===Math.round(a/(Math.PI/2))%2;this.Vi();for(var c=0;c<this.Zb();c++)this.Ar(c,a);b||(a=this.ea.view.aa.ka("width"),
b=this.ea.view.aa.ka("height"),a&&b||!this.$d("pageView")||(a=qf.width,b=qf.height),a&&b&&this.Kr(b,a));this.aj()};c.prototype.zr=function(a,b,c,e){if(this.wa())return!1;T("Rotate nodes by %s around (%s,%s)",b/Math.PI*180,c,e);for(var d=4===arguments.length,h=Bf(a),k=new G(0,0),l=0;l<h.length;l++){var n=h[l],q=this.ea.view.aa.hb(n);q&&(q||d)?!d&&q&&(n=q.rect.vd(),k.x+=n.x,k.y+=n.y):T("rotateNode: Node %s does not exist",n)}d?(k.x=c,k.y=e):(k.x/=h.length,k.y/=h.length);d=new Gc(b,k.x,k.y);return this.ea.transformNode(h,
d)};c.prototype.Ar=function(a,b){a>=this.Zb()&&this.za("rotatePage: page "+a+" does not exist.");if(!this.wa()){var c=Math.round(b/(Math.PI/2));b=c*Math.PI/2;var e=0===c%2;this.Vi();c=this.Me();this.Xf(a);var f=this.sm(),h=this.tg(),k=h.width/2,l=h.height/2;this.zr(f,b,k,l);e||this.yi(f,l-k,k-l);e=this.Hj(a);this.Uc(e,{width:h.height,height:h.width});this.Xf(c);this.aj()}};c.prototype.Lk=function(a,b,c,e,f){void 0===e&&(e=0);void 0===f&&(f=0);if(this.wa())return!1;T("Scale node %s by %s,%s",a,b,c);
return this.ea.Lk(Bf(a),b,c,e,f)};c.prototype.Hn=function(a,b,c,e,f,h,k){if(this.wa())return!1;7!==arguments.length&&this.za("setNodeTransform: requires 7 arguments");T("setNodeTransform(id=%s %s %s %s %s %s %s %s)",a,b,c,e,f,h,k);return this.ea.Hn(Bf(a),b,c,e,f,h,k)};c.prototype.Tr=function(a,b,c){var d=this;if(!this.Hg){var f=document.createElement("div");f.style.width="320px";f.style.lineHeight="0";f.style.position="absolute";this.Wb().appendChild(f);var h=this;this.aq(f,20,{onColour:function(a,
b){var c=h.Ap;if(""===c||"fillStyle"===c&&!b)c="strokeStyle";h.setProperty(c,a)}});this.Hg=Q.ql(f);this.ea.xa.add(function(){d.Hg&&(d.Hg.destroy(),d.Hg=null)})}this.Ap=a;this.Hg.show(b,c,!0)};c.prototype.Xt=function(a){void 0===a&&(a=sc(32));T("Creating shared session "+a);this.Zo(a,2);return a};c.prototype.Zo=function(a,b){var c=this;T("Attach to shared session %s, creating=%s",a,b);this.cc=null;this.Ld&&this.Ld.stop();return new Tb(function(d,f){var e=c.ea.ga.get("collaborationServer");"custom"!==
e?(e=new lb(c,e.replace("{name}",a),c.$d("latency")),c.Ld=e,e.pa("connected",function(){c.na("connected");c.digest()}),e.pa("connect-error",function(){c.na("connect-error");c.digest()}),e.start(a,b).then(function(){T("Session resolved");d(a)},function(a){T("Error joining session: %s",a.message);f(a)})):d(a);1!==b&&(c.cc=c.ea.view.aa.lb.vm(),c.na("local-changes",c.cc.getData()));return a})};c.prototype.Xv=function(a,b){void 0===a&&(a="");void 0===b&&(b=!1);return this.Zo(a,b?0:1).then(function(){T("Successfully connected to session.")},
function(a){console.log("Error connecting to session:",a);throw a;})};c.prototype.Wk=function(){this.Ld&&(this.Ld.stop(),this.Ld=null,this.na("disconnected"))};c.prototype.Ac=function(){if(this.wa())return!1;this.ea.view.Ac()};c.prototype.Xg=function(a){if(this.wa())return!1;this.Qd(function(b){b.Xg(Bf(a))})};c.prototype.upload=function(a,b){function c(){}function e(){}var f=this.ea.Wt(b||"Working"),h=new XMLHttpRequest,k=new FormData(a);h.upload.addEventListener("progress",function(a){f.update(a.loaded/
a.total)},!1);h.addEventListener("load",function(){200===h.status?(f.done(),e(h.response,h)):(f.error("Error"),c(h))},!1);h.addEventListener("error",function(){f.error("Error");c(h)},!1);h.addEventListener("abort",function(){f.error("Aborted");c(h)},!1);h.open(a.method,a.action);h.send(k);var l={success:function(a){e=a;return l},error:function(a){c=a;return l}};return l};c.prototype.Ey=function(a,b){void 0===b&&(b=!1);if(this.wa())return!1;this.ea.view.ft(this.Sb(a),b)};c.prototype.Fy=function(a,
b){if(this.wa())return!1;2===arguments.length?this.ea.view.gm({lineWidth:b,strokeStyle:a}):1===arguments.length?this.ea.view.gm(this.Sb(arguments[0])):this.ea.view.gm({})};c.prototype.Gy=function(a){if(this.wa())return!1;this.ea.view.el(this.Sb(a))};c.prototype.Hy=function(a){if(this.wa())return!1;this.ea.view.Fp(this.Sb(a))};c.prototype.Iy=function(a){if(this.wa())return!1;qc(a)?(a=new sf(this.ea.view,a),this.ea.view.Qa(a)):this.za("useCustomTool(): requires an object as argument.")};c.prototype.po=
function(a){if(this.wa())return!1;this.ea.view.po(U(a))};c.prototype.el=function(a){void 0===a&&(a={});if(this.wa())return!1;this.ea.view.el(this.Sb(a))};c.prototype.Ky=function(a,b,c){void 0===c&&(c="freehand");if(this.wa())return!1;qc(a)?(a=this.Sb(a),c=b):a={strokeStyle:a,lineWidth:b};this.ea.view.Kp(a,c)};c.prototype.Sy=function(a,b){void 0===b&&(b=!0);if(this.wa())return!1;var c=a;pc(a)?c={url:a}:"url"in c||this.za("useStampTool: missing url in properties");this.ea.view.Ly(c,1===arguments.length||
!0===b)};c.prototype.My=function(a,b){if(this.wa())return!1;if(qc(b)){var c=b.singleLine;var e=b.orthogonal}else c=b;this.ea.view.Kq(this.Sb(a),c,e)};c.prototype.Ny=function(){this.ea.view.Pw()};c.prototype.gs=function(){this.ea.view.ib()};c.prototype.qo=function(a,b,c,e){if(this.wa())return!1;F(a)||this.za("usePolygonTool: parameter 1 must be a number.");F(b)||this.za("usePolygonTool: parameter 2 must be a number.");c&&!F(c)&&this.za("usePolygonTool: parameter 3 must be a number.");e&&!qc(e)&&this.za("usePolygonTool: parameter 4 must be a object properties.");
this.ea.view.qo(a,b,c||1,this.Sb(e||{}))};c.prototype.Oy=function(a){void 0===a&&(a={});if(this.wa())return!1;this.ea.view.Kp(this.Sb(a),"quadratic")};c.prototype.Ai=function(a){void 0===a&&(a={});if(this.wa())return!1;this.ea.view.Ai(this.Sb(a))};c.prototype.Py=function(a){void 0===a&&(a={});if(this.wa())return!1;this.ea.view.Ai(zc({roundRadius:this.ea.ga.get("defaultRoundRectRadius")},a))};c.prototype.Qy=function(a,b){if(this.wa())return!1;var c={};qc(a)?c=this.Sb(a):pc(a)&&(c.stokeStyle=a);F(b)&&
(c.lineWidth=b);this.ea.view.cu(c)};c.prototype.ro=function(a,b,c,e,f,h){void 0===f&&(f="rectangle-tl");void 0===h&&(h=null);if(this.wa())return!1;this.ea.view.ro(a,this.Sb(b),c,e,f,h)};c.prototype.Ry=function(a){if(this.wa())return!1;this.ea.view.Ai(this.Sb(a))};c.prototype.Ty=function(a){if(this.wa())return!1;this.ea.view.ao(this.Sb(a))};c.prototype.il=function(){this.ea.view.il()};c.prototype.jl=function(){this.ea.view.jl()};return c}();W.prototype.addKeyboardShortcut=W.prototype.El;
W.prototype.addRemoteChanges=W.prototype.ih;W.prototype.attach=W.prototype.sc;W.prototype.abortTransaction=W.prototype.Os;W.prototype.addSelectionHandle=W.prototype.Wc;W.prototype.addToGroup=W.prototype.Oi;W.prototype.addToLanguage=W.prototype.Gl;W.prototype.addPage=W.prototype.Ws;W.prototype.addPanel=W.prototype.hh;W.prototype.begin=W.prototype.Va;W.prototype.beginTransaction=W.prototype.Vi;W.prototype.bringToFront=W.prototype.tt;W.prototype.canRedo=W.prototype.Sd;W.prototype.canUndo=W.prototype.Td;
W.prototype.clearSelection=W.prototype.eb;W.prototype.clearUndo=W.prototype.Ct;W.prototype.clickColour=W.prototype.Dt;W.prototype.commit=W.prototype.va;W.prototype.commitIrreversibleTransaction=W.prototype.Ht;W.prototype.commitTransaction=W.prototype.aj;W.prototype.copy=W.prototype.nf;W.prototype.createColours=W.prototype.Ep;W.prototype.createDataNode=W.prototype.Rt;W.prototype.createGroup=W.prototype.St;W.prototype.createLogger=W.prototype.Ut;W.prototype.createNode=W.prototype.createNode;
W.prototype.createHTMLNode=W.prototype.Tt;W.prototype.createPath=W.prototype.fj;W.prototype.createToolbar=W.prototype.Yt;W.prototype.createShape=W.prototype.Xl;W.prototype.cut=W.prototype.$l;W.prototype.destroy=W.prototype.Xa;W.prototype.deleteNode=W.prototype.Xd;W.prototype.deleteNodes=W.prototype.Ub;W.prototype.deletePage=W.prototype.Zt;W.prototype.deleteSelection=W.prototype.Ip;W.prototype.dirty=W.prototype.Ee;W.prototype.download=W.prototype.download;W.prototype.draw=W.prototype.ia;
W.prototype.editNodeText=W.prototype.gu;W.prototype.duplicate=W.prototype.duplicate;W.prototype.emit=W.prototype.na;W.prototype.emitNow=W.prototype.jd;W.prototype.emitOnce=W.prototype.og;W.prototype.skipEvent=W.prototype.my;W.prototype.focus=W.prototype.focus;W.prototype.forEachNode=W.prototype.zu;W.prototype.findNode=W.prototype.tu;W.prototype.findNodes=W.prototype.Vp;W.prototype.flip=W.prototype.xu;W.prototype.flipNodes=W.prototype.Ch;W.prototype.generatePalette=W.prototype.aq;
W.prototype.getActiveLayer=W.prototype.rg;W.prototype.getAllNodes=W.prototype.sm;W.prototype.getBackgroundImage=W.prototype.Ju;W.prototype.getBoundingRectangle=W.prototype.tm;W.prototype.getConfig=W.prototype.$d;W.prototype.getContext=W.prototype.getContext;W.prototype.getCurrentPage=W.prototype.Me;W.prototype.getCurrentFillColour=W.prototype.Ou;W.prototype.getCurrentOutlineColour=W.prototype.Pu;W.prototype.getCurrentTool=W.prototype.Fh;W.prototype.getCustomNode=W.prototype.Qu;
W.prototype.getDocumentCoordinates=W.prototype.gq;W.prototype.getDocumentProperty=W.prototype.Uu;W.prototype.getDocumentSize=W.prototype.tg;W.prototype.getElement=W.prototype.Wb;W.prototype.getFillColour=W.prototype.Dj;W.prototype.getHistory=W.prototype.ev;W.prototype.getImageUrl=W.prototype.Am;W.prototype.getLanguageString=W.prototype.iv;W.prototype.getDrawingRectangle=W.prototype.Wu;W.prototype.getGroupParent=W.prototype.cv;W.prototype.getGroupMembers=W.prototype.bv;
W.prototype.getItemProperty=W.prototype.gv;W.prototype.getLayers=W.prototype.kv;W.prototype.getLayerNodes=W.prototype.jv;W.prototype.getNodeCoordinates=W.prototype.lv;W.prototype.getNodePageNumber=W.prototype.be;W.prototype.getNodeProperty=W.prototype.Gj;W.prototype.getNodeRectangle=W.prototype.mv;W.prototype.getNodeScale=W.prototype.nv;W.prototype.getNodeTransform=W.prototype.ov;W.prototype.getNodeType=W.prototype.pv;W.prototype.getNodeUnderPoint=W.prototype.qv;W.prototype.getNodesUnderPoint=W.prototype.uv;
W.prototype.getPageCount=W.prototype.Zb;W.prototype.getPageNode=W.prototype.Hj;W.prototype.getPageRect=W.prototype.pq;W.prototype.getPathData=W.prototype.Jj;W.prototype.getPathAsPoints=W.prototype.xv;W.prototype.getCanvasScale=W.prototype.eq;W.prototype.getEditNode=W.prototype.ym;W.prototype.getScreenCoordinates=W.prototype.yv;W.prototype.getSelectedEditHandle=W.prototype.Av;W.prototype.getStrokeColour=W.prototype.Nj;W.prototype.getEditHandleType=W.prototype.Cj;W.prototype.setEditHandle=W.prototype.Ox;
W.prototype.getSelectedNodes=W.prototype.Zc;W.prototype.getPropertySummary=W.prototype.Jh;W.prototype.getViewRectangle=W.prototype.Fv;W.prototype.goToRevision=W.prototype.Hv;W.prototype.openFile=W.prototype.Lw;W.prototype.insertImage=W.prototype.Rv;W.prototype.insertPage=W.prototype.fk;W.prototype.isLayerVisible=W.prototype.Sm;W.prototype.isNodeSelected=W.prototype.Rh;W.prototype.load=W.prototype.load;W.prototype.lockUpdates=W.prototype.kk;W.prototype.markChangesSent=W.prototype.Vh;
W.prototype.moveDown=W.prototype.kw;W.prototype.movePage=W.prototype.lw;W.prototype.moveUp=W.prototype.mw;W.prototype.newDocument=W.prototype.Qq;W.prototype.nextPage=W.prototype.nextPage;W.prototype.on=W.prototype.pa;W.prototype.onComplete=W.prototype.Ew;W.prototype.openFromComputer=W.prototype.Mw;W.prototype.paste=W.prototype.gi;W.prototype.previousPage=W.prototype.Vw;W.prototype.print=W.prototype.print;W.prototype.redo=W.prototype.Id;W.prototype.redraw=W.prototype.Sc;
W.prototype.removeEventListener=W.prototype.removeEventListener;W.prototype.resize=W.prototype.resize;W.prototype.save=W.prototype.save;W.prototype.setCursor=W.prototype.fc;W.prototype.setToolProperty=W.prototype.Kd;W.prototype.selectNodes=W.prototype.selectNodes;W.prototype.sendToBack=W.prototype.Fx;W.prototype.setActiveLayer=W.prototype.Ok;W.prototype.setConfig=W.prototype.Ir;W.prototype.setColour=W.prototype.Ng;W.prototype.setCurrentPage=W.prototype.Xf;W.prototype.setCustomBackgroundFn=W.prototype.Gn;
W.prototype.setDocumentProperty=W.prototype.Mx;W.prototype.setDocumentSize=W.prototype.Og;W.prototype.setDocumentSizeInTransaction=W.prototype.Kr;W.prototype.setDomElement=W.prototype.Lr;W.prototype.setDomNode=W.prototype.Nx;W.prototype.getDomElement=W.prototype.Vu;W.prototype.getNodeFromElement=W.prototype.nq;W.prototype.getNodeObject=W.prototype.Em;W.prototype.setLayerName=W.prototype.Ux;W.prototype.setPaperSize=W.prototype.Jn;W.prototype.setItemProperty=W.prototype.Sx;
W.prototype.setNodeProperties=W.prototype.Uc;W.prototype.setNodeProperty=W.prototype.Qb;W.prototype.setNodeVisibility=W.prototype.Vx;W.prototype.setOpacity=W.prototype.Pr;W.prototype.setPageSize=W.prototype.Wx;W.prototype.setPageView=W.prototype.In;W.prototype.setProperty=W.prototype.setProperty;W.prototype.setViewRectangle=W.prototype.ay;W.prototype.setZoom=W.prototype.rd;W.prototype.showLayer=W.prototype.si;W.prototype.snap=W.prototype.Ra;W.prototype.isFullscreenSupported=W.prototype.hk;
W.prototype.toggleFullscreen=W.prototype.vi;W.prototype.translateNode=W.prototype.yi;W.prototype.removePanel=W.prototype.ki;W.prototype.removeSelectionHandles=W.prototype.un;W.prototype.rotateDocument=W.prototype.xx;W.prototype.rotateNode=W.prototype.zr;W.prototype.rotatePage=W.prototype.Ar;W.prototype.scaleNode=W.prototype.Lk;W.prototype.setNodeTransform=W.prototype.Hn;W.prototype.showColourPicker=W.prototype.Tr;W.prototype.createSharedSession=W.prototype.Xt;W.prototype.joinSharedSession=W.prototype.Xv;
W.prototype.stopSharing=W.prototype.Wk;W.prototype.undo=W.prototype.Ac;W.prototype.ungroup=W.prototype.Xg;W.prototype.upload=W.prototype.upload;W.prototype.useArrowTool=W.prototype.Ey;W.prototype.useBrushTool=W.prototype.Fy;W.prototype.useCircleTool=W.prototype.Gy;W.prototype.useCurveTool=W.prototype.Hy;W.prototype.useCustomTool=W.prototype.Iy;W.prototype.useEditHandleTool=W.prototype.po;W.prototype.useEllipseTool=W.prototype.el;W.prototype.useFreehandTool=W.prototype.Ky;
W.prototype.useStampTool=W.prototype.Sy;W.prototype.useLineTool=W.prototype.My;W.prototype.usePanTool=W.prototype.Ny;W.prototype.usePickTool=W.prototype.gs;W.prototype.usePolygonTool=W.prototype.qo;W.prototype.useQuadraticBezierTool=W.prototype.Oy;W.prototype.useRectangleTool=W.prototype.Ai;W.prototype.useRoundRectTool=W.prototype.Py;W.prototype.useShapeBrushTool=W.prototype.Qy;W.prototype.useShapeTool=W.prototype.ro;W.prototype.useSquareTool=W.prototype.Ry;W.prototype.useTextTool=W.prototype.Ty;
W.prototype.zoomIn=W.prototype.il;W.prototype.zoomOut=W.prototype.jl;var Df={fontStyle:null,fontWeight:"normal",fontSize:12,fontFamily:"Times New Roman",colour:"black",align:"left",background:"none",underline:!1},Ef={fontStyle:"fs",fontWeight:"fw",fontSize:"fh",fontFamily:"ff",colour:"fc",align:"ta",background:"fb",underline:"fu"},Ff=function(){function c(a){this.ta=a;this.options={}}c.prototype.Dy=function(){var a=new c(this.ta),b;for(b in Df)Df.hasOwnProperty(b)&&(a.options[b]=this.get(b));return a};c.prototype.wy=function(){var a={},b;for(b in this.options)this.options.hasOwnProperty(b)&&
(a[b]=this.options[b]);return a};c.prototype.apply=function(a){a.fillStyle=this.get("colour");a.font=this.Nu()};c.prototype.empty=function(){var a=0,b;for(b in this.options)this.options.hasOwnProperty(b)&&(a+=1);return 0===a};c.prototype.xj=function(a,b){var d=c.xj(a,b);return d.empty()?this:d};c.prototype.Wg=function(a){c.Wg(this.options,a)};c.prototype.set=function(a,b){this.options[a]=b};c.prototype.get=function(a){return a in this.options?this.options[a]:this.ta[a]};c.prototype.has=function(a){return a in
this.options};c.prototype.Ff=function(a){for(var b in a.options){var c=this.get(b),e=a.get(b);c!==e&&this.set(b,e)}};c.prototype.clone=function(){var a=new c(this.ta);a.Ff(this);return a};c.prototype.Nu=function(){var a=this.get("fontStyle"),b=this.get("fontWeight"),c=this.get("fontSize"),e=this.get("fontFamily");this.get("colour");var f=[];a&&f.push(a);b&&f.push(b);f.push(c+"px");f.push(e);return f.join(" ")};c.prototype.Lc=function(a){if(this===a)return!0;for(var b in this.options)if(!(b in a.options)||
a.options[b]!==this.options[b])return!1;for(b in a.options)if(!(b in this.options))return!1;return!0};c.prototype.mj=function(a){var b=new c(this.ta),d;for(d in Df)Df.hasOwnProperty(d)&&a.get(d)!==this.get(d)&&(b.options[d]=this.get(d));return b};c.prototype.toString=function(){var a=[],b;for(b in this.options)a.push(b+"="+this.options[b]);return a.join(",")};return c}();
(function(c){c.xj=function(a,b){void 0===b&&(b="");var d=new c(Df);switch(b){case "B":d.set("fontWeight","bold");break;case "I":d.set("fontStyle","italic");break;case "U":d.set("underline",!0)}for(var e in a){var f=a[e];if("textDecoration"===e)d.set("underline",0<=f.indexOf("underline"));else if(""!==f)switch(e){case "fontStyle":case "fontFamily":case "fontWeight":case "background":d.set(e,f);break;case "fontSize":d.set(e,parseFloat(f)||2);break;case "textAlign":d.set("align",f);break;case "color":d.set("colour",
f)}}return d};c.Wg=function(a,b){for(var c in a){var e=a[c];switch(c){case "fontStyle":case "fontFamily":case "fontWeight":case "background":b[c]=e;break;case "fontSize":b[c]=e+"px";break;case "align":b.textAlign=e;break;case "colour":b.color=e;break;case "underline":b.textDecoration=e?"underline":""}}return b}})(Ff||(Ff={}));var Gf=Ff;x.create("TEXTWRITER");var Hf=function(){function c(){this.qn=null;this.Ak=[]}c.prototype.Vn=function(){};c.prototype.km=function(){this.Ak.push("\n")};c.prototype.ms=function(a){this.qn=a=this.qn?a.mj(this.qn):a.Dy();a=a.wy();for(var b in a)a.hasOwnProperty(b)&&this.Ak.push("/"+Ef[b]+a[b]+";")};c.prototype.ns=function(a){a=a.replace(/\//g,"//");this.Ak.push(a)};c.prototype.toString=function(){return this.Ak.join("")};return c}();
function If(c,a){for(var b=0,d="",e="",f="",h=0;h<c.length;h++){var k=c.charAt(h);switch(b){case 0:"/"===k?b=1:d+=k;break;case 1:"/"===k?(d+=k,b=0):(--h,d.length&&(a("text",d.replace(/\/\//g,"/")),d=""),e="",b=2);break;case 2:e+=k;2===e.length&&(b=3,f="");break;case 3:";"===k?(a(e,f),b=0):f+=k}}d.length&&a("text",d.replace(/\/\//g,"/"))};var Jf=x.create("InlineItem"),Kf=function(){function c(a){this.style=a;this.index=0}c.prototype.count=function(){return 1};c.prototype.Wa=function(a){Jf("Asked to set %s",a);this.style=this.style.clone();this.style.Ff(a);Jf("After merge: %s",this.style)};c.prototype.dk=function(){};c.prototype.split=function(){return null};c.prototype.Eh=function(){return{width:0,height:0,Ef:0,st:!0,Rq:!1}};c.prototype.wg=function(){return""};return c}();x.create("TextItem");
var Lf=function(c){function a(a,d){var b=c.call(this,a)||this;b.text=d;return b}__extends(a,c);a.prototype.count=function(){return this.text.length};a.prototype.split=function(b){if(0<b&&b<this.text.length){var c=this.text.substr(b);this.text=this.text.substr(0,b);return new a(this.style.clone(),c)}return null};a.prototype.Eh=function(a,c){var b=this.text.charAt(c);return{width:a?a.measureText(b).width:0,height:this.style.get("fontSize"),Ef:0,st:" "===b||"-"===b,Rq:"\n"===b}};a.prototype.wg=function(a,
c){return this.text.substr(a,c)};return a}(Kf);var Mf=x.create("TEXTSEQ"),Nf=function(){function c(a){this.style=a;this.children=[];this.length=this.fg=0;this.me=null}c.fh=function(a){var b=new Gf(Df),d=new c(b),e={},f;for(f in Ef)Ef.hasOwnProperty(f)&&(e[Ef[f]]=f);If(a,function(a,c){var f=c;a in e?("fh"===a&&(f=parseFloat(f)),"null"===f&&(f=null),b.set(e[a],f)):"text"===a?d.append([new Lf(b.clone(),f)]):Mf("Bad key: %s",a)});return d};c.prototype.save=function(a,b,c){var d=!1;this.Hq(a,b,function(a,b,e){c.ms(a.style);a=a.wg(b,e);b=0;for(e=a.split("\n");b<
e.length;b++){var f=e[b];if(""===f){if(d||c.Vn(),c.km(),d=!1,"\n"===a)break}else d||(c.Vn(),d=!0),c.ns(f)}});d&&c.km();return c};c.prototype.append=function(a){this.dk(this.fg,a)};c.prototype.dk=function(a,b){Mf("Insert %s item at index %s",b.length,a);var c,e=0;for(c=0;c<this.children.length;c++){var f=this.children[c];var h=f.count();if(e===a){Mf("Found proper position");break}else if(e+h>a){Mf("Splitting item from %s..(%s)..%s",f.index,a,f.index+h);this.Mi(c,a-e);e=a;c+=1;break}e+=h}for(this.children.splice.apply(this.children,
[c,0].concat(b));c<this.children.length;c++)f=this.children[c],h=f.count(),Mf("Bump item %s index %s->%s length=%s",c,f.index,e,h),f.index=e,e+=h,Mf("   item %s: %s/%s",c,f.index,f.count());this.fg=e;this.length=this.children.length;this.me=null};c.prototype.remove=function(a,b){var c=[];if(0===this.children.length)return c;this.cp(a);this.cp(a+b);for(var e=this.Ih(a),f,h=e.item.index,k=e.index;k<this.children.length;k++){var l=this.children[k];f=l.count();h+f<=a+b?c.push(l):l.index=h-b;h+=f}this.children.splice(e.index,
c.length);this.length-=c.length;this.fg-=b;this.me=null;return c};c.prototype.count=function(){return this.fg};c.prototype.Ih=function(a){for(var b=0,c=0;c<this.children.length;c++)if(b+=this.children[c].count(),b>a)return{index:c,item:this.children[c]};if(this.children.length)return{index:this.children.length-1,item:this.children[this.children.length-1]};throw Error("getItemAt() on empty sequence.");};c.prototype.Mi=function(a,b){var c=this.children[a],e=c.split(b);e&&(e.index=c.index+c.count(),
this.children.splice(a+1,0,e),this.length+=1,Mf("Split %s..%s..%s",c.index,e.index,e.index+e.count()));return e};c.prototype.cp=function(a){var b=this.Ih(a);b&&b.item.index<a&&this.Mi(b.index,a-b.item.index)};c.prototype.Oj=function(a){return 0===this.length?this.style:this.Ih(a).item.style};c.prototype.rq=function(a,b){var c=[],e=0,f=0,h=null,k=0;if(0===b)return c.push({start:a,length:0,style:this.Oj(a)}),c;for(var l=0;l<this.children.length;l++){var n=this.children[l];var q=n.count();k+=q;if(k>
a){null===h&&(h=n.style,e=n.index);var u=n.style.Lc(h);u&&(f+=q);if(!u||k>=b)c.push({start:e,length:f,style:h}),e=n.index,f=0;if(k>=a+b)break}}return c};c.prototype.Zx=function(a){for(var b=0;b<a.length;b++){var c=a[b];this.Wa(c.style,c.start,c.length)}};c.prototype.Wa=function(a,b,c){var d=0,f=b+c;Mf("setStyle: %s:%s %s",b,c,a);for(c=0;c<this.children.length;c++){var h=this.children[c],k=h.count();d<b&&b<d+k?this.Mi(c,b-d)?k=b-d:(h.Wa(a),Mf("Case 1")):b<=d&&f<d+k&&f>d?(this.Mi(c,f-d),k=f-d,h.Wa(a),
Mf("Case 2")):b<=d&&d+k<=f&&(h.Wa(a),Mf("Case 3: fromChar=%s..%s count=%s..%s",b,f,d,d+k));d+=k}};c.prototype.Cx=function(a,b,c){for(var d=b;;){b=this.Eh(null,a);if(c(b)){a+=1;break}else if(0===a)break;--a}for(;;){b=this.Eh(null,d);if(c(b))break;else if(d>=this.fg-1)break;d+=1}return{start:a,length:d-a}};c.prototype.wv=function(a,b){return this.Cx(a,b,function(a){return a.Rq})};c.prototype.Eh=function(a,b){if(0===this.length)throw Error("error: expected to have child items");if(null===this.me||b<
this.me.index||b>=this.me.index+this.me.count())this.me=this.Ih(b).item;return this.me.Eh(a,b-this.me.index)};c.prototype.wg=function(a,b){var c="";this.Hq(a,b,function(a,b,d){console.log("Iterate: ",a,b,d);c+=a.wg(b,d)});return c};c.prototype.Hq=function(a,b,c){var d=a+b;if(0!==b){var f=this.Ih(a);if(f)for(b=f.item,f=f.index;a<d;){var h=Math.min(b.count(),d-a);c(b,a-b.index,h);a+=h;f+=1;if(f===this.children.length)break;b=this.children[f]}}};return c}();var Of=x.create("SpliceText"),Pf=function(c){function a(a,d,e,f,h){var b=c.call(this)||this;b.Nb=a;b.text=d;b.start=e;b.length=f;b.style=h;b.ie=[];return b}__extends(a,c);a.prototype.Ff=function(b){if(!(b instanceof a))return!1;Of("?merge(%s,%s,%s) and (%s,%s,%s)",this.start,this.length,this.text.substr(0,5),b.start,b.length,b.text.substr(0,5));return 0===this.length&&0===b.length&&this.start+this.text.length===b.start&&(null===this.style&&null===b.style||null!=this.style&&null!==b.style&&this.style.Lc(b.style))?
(this.text+=b.text,Of("Merging SpliceTextAction"),!0):0!==this.text.length||0!==b.text.length||this.start!==b.start&&b.start+b.length!==this.start?!1:(this.length+=b.length,this.start<b.start?this.ie=this.ie.concat(b.ie):(this.ie=b.ie.concat(this.ie),this.start=b.start),Of("Merging Deletes"),!0)};a.prototype.kd=function(){Of("Execute SpliceTextAction(del=%s/%s insert %s...)",this.start,this.length,this.text.substr(0,5));this.Nb.Wh(this.start);0<this.length&&(Of("Removing text"),this.ie=this.Nb.text.remove(this.start,
this.length));if(0<this.text.length){if(null===this.style)throw Error("style is null");var a=new Lf(this.style,this.text);this.Nb.text.dk(this.start,[a])}};a.prototype.Ac=function(){Of("Undo SpliceTextAction(del=%s/%s insert %s)",this.start,this.length,this.text);0<this.text.length&&this.Nb.text.remove(this.start,this.text.length);this.ie.length&&this.Nb.text.dk(this.start,this.ie);this.Nb.Wh(this.start)};return a}(Oa);var Qf=x.create("UNDO"),Rf=function(c){function a(a,d,e,f){var b=c.call(this)||this;b.Nb=a;b.from=d;b.length=e;b.style=f;b.dn=[];return b}__extends(a,c);a.prototype.kd=function(){Qf("Do apply style");this.Nb.Wh(this.from);this.dn=this.Nb.text.rq(this.from,this.length);this.Nb.text.Wa(this.style,this.from,this.length)};a.prototype.Ac=function(){Qf("Undo apply style");console.log(this.dn);this.Nb.Wh(this.from);this.Nb.text.Zx(this.dn)};a.prototype.Ff=function(){return!1};return a}(Oa);var Sf=x.create("TextEditor"),Tf=function(c){function a(a,d){var b=c.call(this)||this;b.Bc=a;b.ta=d;b.kh=0;b.lg=0;b.Be=null;b.Yi=0;b.active=!1;b.text=new Nf(d);return b}__extends(a,c);a.prototype.setActive=function(a){this.active=a;Sf("setActive: %s",this.active)};a.prototype.Lh=function(){return Math.min(this.kh,this.lg)};a.prototype.Kh=function(){return Math.max(this.kh,this.lg)};a.prototype.save=function(a,c){void 0===a&&(a=0);void 0===c&&(c=this.text.length);return this.text.save(a,c,new Hf).toString()};
a.prototype.Tc=function(a,c){void 0===c&&(c=a);this.lg=a;this.kh=c;this.og("selchange")};a.prototype.eb=function(){this.Tc(0,0)};a.prototype.exec=function(a,c){var b=this.lg;switch(a){case "bold":this.Zk("fontWeight","bold","normal");return;case "italic":this.Zk("fontStyle","italic","normal");return;case "underline":this.Zk("underline",!0,!1);return;case "orange":this.Zk("background","orange","transparent");return;case "undo":Sf("Processing undo");this.Bc.Ac(this);this.Tc(b);return;case "redo":Sf("Processing redo");
this.Bc.Id(this);this.Tc(b);return;case "font":this.Ri("fontFamily",c);return;case "fontSize":"string"===typeof c&&(c=parseFloat(c)||2);this.Ri("fontSize",c);return;case "align":this.Ri("align",c);break;case "delete":Sf("Delete text");this.vn(!1);return;case "backspace":Sf("Delete text backspace");this.vn(!0);return;case "select-none":this.Tc(b,b);return}this.Ve()};a.prototype.Zk=function(a,c,e){var b=this.Lh();b=this.text.rq(b,this.Kh()-b);for(var d,k=0;k<b.length&&(d=b[k].style,d.get(a)===c);k++);
this.Ri(a,k<b.length?c:e)};a.prototype.Cq=function(a){var b=this.Lh(),c=this.Kh()-b;a=a.replace("\r","\n");Sf("Delete %s/%s Insert char %s...",b,c,a.substr(0,5));if(this.Be&&this.Yi===b&&0===c){var f=this.Be;Sf("Using recording caret style: %s",f)}else f=0===c&&0<b?this.text.Oj(b-1):this.text.Oj(b);this.Bc.va(new Pf(this,a,b,c,f),!1,this);this.Tc(b+a.length,b+a.length);this.Be=null};a.prototype.Ri=function(a,c){if("string"===typeof a){var b=new Gf(Df);b.set(a,c||"")}else b=a;if(b.empty())Sf("apply empty style; ignore");
else{var d=this.Lh(),h=this.Kh(),k=[];if(b.has("align")){var l=new Gf(Df);l.set("align",b.get("align"));var n=this.text.wv(d,h);0<n.length&&(Sf("Apply paragraph style to %s:%s %s",n.start,n.start+n.length,b),k.push(new Rf(this,n.start,n.length,l)))}Sf("applystyle called set %s:%s %s",d,h,b);d!==h?k.push(new Rf(this,d,h-d,b)):(this.Be=null===this.Be||this.Yi!==d?this.text.Oj(d).clone():this.Be.clone(),this.Be.Ff(b),this.Yi=d,Sf("Recording new caret style: %s",this.Be));this.Bc.va(k,!1,this)}};a.prototype.vn=
function(a){var b=this.Lh(),c=this.Kh()-b;Sf("Delete %s characters (totalCount=%s)",c,this.text.count());c?(this.Bc.va(new Pf(this,"",b,c,null),!1,this),this.Tc(b)):a&&0<b?(this.Bc.va(new Pf(this,"",b-1,1,null),!1,this),this.Tc(b-1)):b<this.text.count()&&this.Bc.va(new Pf(this,"",b,1,null),!1,this);this.Yi=-1};a.prototype.Bv=function(){var a=this.Lh(),c=this.Kh()-a;Sf("getSelectedText()=%s",this.text.wg(a,c));return this.text.wg(a,c)};a.prototype.Hf=function(a){var b=this;Sf("Received clipboard event: %s",
a.type);switch(a.type){case "copy":case "cut":Sf("Cut/Copy to system clipboard.");var c=this.Bv();Sf("text=%s",c);c.length&&(a.clipboardData.setData("text/plain",c),a.preventDefault(),"cut"===a.type&&this.vn(!1));break;case "paste":for(Sf("There are %s items on the clipboard",a.clipboardData.items.length),c=0;c<a.clipboardData.items.length;c++){var f=a.clipboardData.items[c];Sf("Item [%s] type is %s",c,f.type);"text/plain"===f.type&&f.getAsString(function(a){b.Cq(a)})}}};a.prototype.Wh=function(){};
a.prototype.Ve=function(){};return a}(bb);var Uf=x.create("HTMLTextEditor"),Zf=function(c){function a(a,d,e){void 0===e&&(e={});var b=c.call(this,new Qa,(new Gf(Df)).xj(window.getComputedStyle(d),d.tagName))||this;b.fa=d;b.options=e;b.wc=new cb;b.fy(a);a.addEventListener(document,"selectionchange",function(){b.Kw()});a.addEventListener(document,"cut",function(a){b.Hf(a)});a.addEventListener(document,"copy",function(a){b.Hf(a)});a.addEventListener(document,"paste",function(a){b.Hf(a)});Vf(b.text,d,b.ta);b.Ve();b.pa("reformat",function(){b.Ve()});
return b}__extends(a,c);a.prototype.Rx=function(a){this.fa.innerHTML=a;this.text=new Nf(this.ta);Vf(this.text,this.fa,this.ta);B(this.fa).clear();a=this.text;var b=this.fa,c=this.ta;a.save(0,a.count(),new Wf(b,c));this.Tc(0,0)};a.prototype.fy=function(a){var b=this;this.wc.map("ctrl+b,cmd+b","bold");this.wc.map("ctrl+i,cmd+i","italic");this.wc.map("ctrl+u,cmd+u","underline");this.wc.map("ctrl+z,cmd+z","undo");this.wc.map("ctrl+shift+z,cmd+shift+z","redo");this.wc.map("delete","delete");this.wc.map("backspace",
"backspace");this.wc.pa("*",function(a,c){Uf("Keyboard event: ",a);c.preventDefault();c.stopPropagation();b.exec(a)});this.wc.rp(this.fa);a.add(function(){b.wc.detach(b.fa)});a.addEventListener(this.fa,"keypress",function(a){var c=a.charCode;13===c&&b.options.Mn&&!a.shiftKey?b.na("enter"):(b.Cq(String.fromCharCode(c)),a.preventDefault(),b.Ve())})};a.prototype.setActive=function(a){c.prototype.setActive.call(this,a);a?(this.fa.setAttribute("contenteditable","TRUE"),this.fa.focus()):(this.fa.setAttribute("contenteditable",
"FALSE"),this.fa.blur())};a.prototype.Kw=function(){if(this.active){var a=document.getSelection();if(null===a)this.eb();else if(null===a.focusNode||null===a.anchorNode)this.eb();else if(a.anchorNode===this.fa)Uf("Select-all %s..%s",0,this.text.length),c.prototype.Tc.call(this,0,this.text.count());else{var d=Xf(this.fa,a.anchorNode,a.anchorOffset);a=Xf(this.fa,a.focusNode,a.focusOffset);-1!==d&&-1!==a&&(0===this.text.count()&&(a=d=0),a!==this.lg||d!==this.kh)&&(c.prototype.Tc.call(this,a,d),Uf("Selected %s..%s",
d,a))}}};a.prototype.Tc=function(a,d){void 0===d&&(d=a);Uf("self-set caret position: %s..%s",d,a);c.prototype.Tc.call(this,a,d);var b=Yf(this.fa,a),f=Yf(this.fa,d),h=document.createRange();d<=a?(h.setStart(f.node,f.offset),h.setEnd(b.node,b.offset)):(h.setStart(b.node,b.offset),h.setEnd(f.node,f.offset));if(b=window.getSelection())b.removeAllRanges(),b.addRange(h)};a.prototype.Wh=function(a){Uf("Mark for reformat: %s",a);this.og("reformat")};a.prototype.Ve=function(){B(this.fa).clear();var a=this.text,
c=this.fa,e=this.ta;a.save(0,a.count(),new Wf(c,e));this.options.placeholder&&0===this.text.count()&&(a=B("div").Wa({opacity:"0.5"}).Sg(this.options.placeholder).Xc(this.fa).fa,this.ta.Wg(a.style));this.Tc(this.lg,this.kh)};a.prototype.exec=function(a,d){c.prototype.exec.call(this,a,d);this.Ve()};return a}(Tf);
function Xf(c,a,b){function d(c){if(c.nodeType===Node.ELEMENT_NODE){var k=c.getAttribute("t-off");k&&(e=parseFloat(k));if(c===a)return c instanceof Element&&c.children[0]&&"BR"===c.children[0].tagName&&1===b&&--e,h=!0;"DIV"===c.tagName&&(f=!0);for(c=c.firstChild;c&&!d(c);)c=c.nextSibling;return!!c}if(c.nodeType===Node.TEXT_NODE){if(c===a)return h=!0;c=$f(c.nodeValue,f);e+=c.length;c.length&&(f=!1)}}var e=0,f=!0,h=!1;for(c=c.firstChild;c&&!d(c);)c=c.nextSibling;return h?e+b:-1}
function Yf(c,a){function b(c){d=c;f=0;if(c.nodeType===Node.ELEMENT_NODE){var k=c.getAttribute("t-off");k&&(e=parseFloat(k));"DIV"===c.tagName&&(h=!0);for(c=c.firstChild;c&&!b(c);)c=c.nextSibling;return!!c}if(c.nodeType===Node.TEXT_NODE){c=$f(c.nodeValue,h);if(e+c.length>=a)return f=a-e,!0;e+=c.length;c.length&&(h=!1)}}for(var d=c,e=0,f=0,h=!0,k=c.firstChild;k&&!b(k);)k=k.nextSibling;return{node:d,offset:f}}
function $f(c,a){for(var b="",d=a,e=0;e<c.length;e++){var f=c[e];switch(f){case " ":case "\n":case "\r":case "\t":d||(b+=" ",d=!0);break;default:b+=f,d=!1}}return b}
function Vf(c,a,b){function d(a,b){if(a.nodeType===Node.ELEMENT_NODE){switch(a.tagName){case "DIV":case "P":l||(f+="\n"),l=!1}"DIV"===a.tagName&&(n=!0);a instanceof HTMLElement&&(b=b.xj(a.style,a.tagName));for(var c=a.firstChild;c;)d(c,b),c=c.nextSibling}else a.nodeType===Node.TEXT_NODE&&(h.Lc(b)||(e(h),h=b),c=$f(a.nodeValue,n),f+=c,c.length&&(n=!1))}function e(a){f.length&&(k.push(new Lf(a,f)),f="")}var f="",h=b,k=[],l=!0,n=!0;for(a=a.firstChild;a;)d(a,b),a=a.nextSibling;e(h);k.length&&c.append(k)}
var Wf=function(){function c(a,b){this.root=a;this.$h=this.Gp=b;this.span=this.ma=null;this.offset=0;this.style=b}c.prototype.ms=function(a){Uf("writeStyle("+a.toString());this.$h=a};c.prototype.Vn=function(){Uf("startLine");this.ma=document.createElement("DIV");this.root.appendChild(this.ma);this.ma.setAttribute("t-off",this.offset.toString());this.ma.style.whiteSpace="pre-wrap";this.style=this.Gp;this.ma.style.fontSize=this.$h.get("fontSize")+"px"};c.prototype.km=function(){Uf("endLine");if(!this.ma)throw Error("Expected div to exist");
null===this.ma.firstChild&&this.ma.appendChild(document.createElement("BR"));this.span=this.ma=null;this.offset+=1};c.prototype.ns=function(a){Uf("writeText("+a+")");if(!this.ma)throw Error("Expected div to exist");null!==this.span&&this.style.Lc(this.$h)||(this.span=document.createElement("SPAN"),this.ma.appendChild(this.span),this.$h.Wg(this.span.style),this.style=this.$h);this.span.appendChild(document.createTextNode(a));this.offset+=a.length};return c}();var ag=x.create("zeact");function bg(c){"BUTTON"===c.tagName&&(c.getAttribute("type")||c.setAttribute("type","button"))}var P=jc.bf();
P.wb("click",function(c,a,b,d){function e(b){fc("z-click=["+d+"] received "+b.type);jc.mm(c,d,a,b,f);P.digest();b.preventDefault()}function f(a,b){a instanceof W&&0<=b.indexOf("Tool")&&(fc("Called %s",b),h=!0);return a[b]}bg(a);b="onpointerdown"in window;"ontouchstart"in window?P.Za(a,"touchend",e):b?P.Za(a,"pointerup",e):P.Za(a,"mouseup",e);var h;P.Za(a,"keydown",function(b){b.target===a&&13===b.keyCode&&(h=!1,e(b),h&&c.ctx.focus(!0,a))})});
P.wb("has",function(c,a,b,d){b=[];var e=0;for(d=d.split("|");e<d.length;e++){var f=d[e];f=f.trim();b.push('("'+f+'" in ctx.summary.types || "'+f+'" in ctx.summary.properties)')}(b=b.join("||"))&&P.watch(c,a,b,function(b){a.style.display=b?"block":"none"})});
P.wb("property",function(c,a,b,d){b='ctx.summary.properties["'+d+'"]';var e=a.getAttribute("z-value"),f=null!==a.getAttribute("z-colour");P.watch(c,a,b,function(b){"value"in a&&(a.value=b);null!==e&&B(a).ho("selected",""+b===e);f&&(a.style.backgroundColor=b)});"BUTTON"===a.tagName?(bg(a),P.Za(a,"click",function(){var b=a.getAttribute("z-value")||"";c.ctx.setProperty(d,b)})):P.Za(a,"change",function(){var b=jc.Xu(c,a);void 0!==b&&c.ctx.setProperty(d,b)})});
P.wb("popup",function(c,a,b,d){var e=a.parentNode;if(!e)throw Error("z-popup: no parent node?!");var f=document.createComment("z-popup="+d);e.replaceChild(f,a);P.xa(e,function(){e&&e.replaceChild(a,f)});c.ctx.$popups||(c.ctx.$popups={});c.ctx.$popups[d]=a});
P.wb("show-popup",function(c,a,b,d){bg(a);P.Za(a,"click",function(a){var b=c.ctx.$popups?c.ctx.$popups[d]:null;if(!b)throw Error("Popup "+d+" not found");b=b.cloneNode(!0);P.sc(c,b);var e=ec(b);e.onhide=function(){ag("Dialog is hidden.");e.destroy();P.detach(b)};e.show(a.pageX,a.pageY,!0)})});P.wb("colour",function(c,a){P.Za(a,"click",function(b){c.ctx.Tr(a.getAttribute("z-property")||"",b.pageX,b.pageY)})});
P.wb("page",function(c,a,b,d){function e(){var a=f.pq(k),b=Math.min(l/a.width,n/a.height);1<b&&(b=1);h.width=a.width*b|0;h.height=a.height*b|0;q.setTransform(b,0,0,b,0,0);q.fillStyle="white";q.fillRect(0,0,a.width,a.height);f.ia(q,{page:k})}if(!a.bz){var f=c.ctx,h=document.createElement("canvas"),k=Ka(c,d)||0,l=parseInt(a.getAttribute("z-width")||"1000000"),n=parseInt(a.getAttribute("z-height")||"1000000");h.style.backgroundColor="white";var q=h.getContext("2d");for(b=0;b<a.attributes.length;b++)d=
a.attributes[b],"z-page"!==d.name&&h.setAttribute(d.name,d.value);a.parentNode&&a.parentNode.replaceChild(h,a);e();f.pa("document-changed",e);f.pa("resource-loaded",e);P.xa(h,function(){f.removeEventListener("document-changed",e);f.removeEventListener("resource-loaded",e)});for(b=0;b<a.attributes.length;b++)h.setAttribute(a.attributes[b].name,a.attributes[b].value);h.bz=!0;return P.sc(c,h).node}},1);
P.wb("sort",function(c,a,b,d){Q.Pe(".zwibbler-sort-highlight { outline: 3px solid orange }");var e=lc({parent:a,Si:"z-sortable",kn:"zwibbler-sort-highlight",Hw:function(a,b){c.$from=a;c.$to=b;Ka(c,d);P.digest()}});P.xa(a,function(){e()})});function cg(){fc("Document loaded.");Array.prototype.forEach.call(document.querySelectorAll("zwibbler,[zwibbler]"),function(c){dg(c,null,!1)})}function eg(c,a,b){B(c).matches(a)&&b(c);Array.prototype.forEach.call(c.querySelectorAll(a),b)}
function dg(c,a,b){if(!c.gh&&("ZWIBBLER"===c.tagName&&Q.Pe("zwibbler {display: block}"),b||null===c.getAttribute("z-no-auto-init"))){eg(c,"[z-component]",function(a){var b=a.getAttribute("z-component"),c=a.getAttribute("z-controller"),d=(a.getAttribute("z-properties")||"").split(/[ ,]+/);if(b){var e=null;if(c)if(c in Q.controllers)e=Q.controllers[c];else if("function"===typeof window.zcontroller)e=window.zcontroller;else throw Error("While processing component: "+b+" could not find controller function "+
c);Q.bj(b,{template:a,properties:d,controller:e});a.parentNode.removeChild(a)}});var d,e={};for(b=0;b<c.attributes.length;b++){var f=c.attributes[b];Q.uq(f.name)&&(e[f.name]=f.value)}eg(c,"z-canvas,[z-canvas]",function(a){d=Q.create(a,e)});a||(a=d||{});d?(a.ctx=d,d.sc(a,c)):P.sc(a,c);a.$digest=function(){P.digest()};a.$watch=function(b,d){P.watch(a,c,b,d)};a.$apply=function(b){if(b)return Ka(a,b);P.digest()};a.hidePopup=function(b){a.qr&&b in a.qr&&a.qr[b].hide()};b=c.getAttribute("z-controller")||
"";b in Q.controllers?(fc("Running controller: %s",b),Q.controllers[b](a)):"function"===typeof window[b]?(fc("Running controller: %s",b),window[b](a)):b&&console.log("Controller not found: %s",b);P.digest();return a}}document.addEventListener("DOMContentLoaded",function(){cg()});
P.wb("editable",function(c,a,b,d){function e(){var b=a.innerHTML;f=b;Ka(c,d+"="+JSON.stringify(b));ag("Text editor no longer selected. Blurring");k.exec("select-none");k.setActive(!1)}if(c.ctx){var f="";P.watch(c,a,d,function(a){f!==a&&(f=a,k.Rx(a))});var h=new nb,k=new Zf(h,a,{Mn:!0,placeholder:a.getAttribute("placeholder")||""});P.xa(a,function(){h.Xa()});P.Za(a,"focus",function(){ag("Got text focus event");k.setActive(!0)});P.Za(a,"click",function(){ag("Clicked on text");k.setActive(!0)});P.Za(a,
"blur",function(){ag("Got text blur event")});k.pa("selchange",function(){});k.pa("enter",e);c.ctx.pa("selected-nodes",function(){!c.ctx.Rh(c.id)&&k.active&&e()})}});P.Od("clear-glyph",function(c,a,b){ag("Drawing colour panel, width=%s tag=%s",JSON.stringify(a),c.tagName);"CANVAS"===c.tagName&&(c.width=a.width,c.height=a.width,"clear"===a.style?yf(c.getContext("2d"),0,0,a.width):zf(c.getContext("2d"),0,0,a.width),b.resize())});var fg=x.create("HTMLNode");
function gg(c){return function(a){function b(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b.fa=null;b.children=[];b.Rb|=6;return b}__extends(b,a);b.prototype.Ma=function(){return this.children.length};b.prototype.removeChild=function(a){var b=this.children[a];this.children.splice(a,1);Yc(b)&&b.fa&&b.fa.parentNode&&b.fa.parentNode.removeChild(b.fa);return b};b.prototype.pk=function(a){for(a+=1;a<this.children.length;a++){var b=this.children[a];if(Yc(b))return b.fa}return null};
b.prototype.ek=function(a,b){this.children.splice(b,0,a);this.fa&&Yc(a)&&a.fa&&this.yl(a.fa,this.pk(b))};b.prototype.yl=function(a,b){if(b)b.parentNode.insertBefore(a,b);else if(this.fa){var c=a.getAttribute("z-type")||"";hg(this.fa,c).appendChild(a)}};b.prototype.sb=function(a){return this.children[a]};b.prototype.Yn=function(a,b){var c=this.pk(a),d=this.pk(a),e=this.children[a],l=this.children[b],n=this.children[a];this.children[a]=this.children[b];this.children[b]=n;this.fa&&(Yc(e)&&e.fa&&this.yl(e.fa,
d),Yc(l)&&l.fa&&this.yl(l.fa,c))};return b}(c)}
var af=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.Wp=!1;b.mn={};b.scope=null;return b}__extends(a,c);a.prototype.type=function(){return"HTMLNode"};a.prototype.Xa=function(){this.fa&&!this.Wp&&(P.detach(this.fa),B(this.fa).remove())};a.prototype.Qr=function(a){this.mn=a};a.prototype.setProperty=function(a,d){"matrix"===a||"object"!==typeof d||d instanceof Array?(d=c.prototype.setProperty.call(this,a,d),this.Wa(a,d)):this.We(ig(d,{},a+"."))};a.prototype.ka=function(a){switch(a){case "lockRotation":case "lockSize":return!0}return c.prototype.ka.call(this,
a)};a.prototype.Wa=function(a,c){this.fa&&"style."===a.substr(0,6)&&(this.fa.style[a.substr(6)]=c||"")};a.prototype.format=function(a,c){var b=this;if(null===this.fa){var d=this.ba.$component;fg("Create component element of type %s",d);var h=ad(this.mn,this);h=Q.ej(this.mn,d,{nid:this.id,"z-type":d},h);if(!h)throw Error("Error: No component registered for "+d);this.scope=h.scope;this.fa=h.node;this.fa.style.boxSizing="border-box";this.fa.pz=function(){return!1};this.parent&&Yc(this.parent)&&this.Fw();
for(var k in this.ba)this.Wa(k,this.ba[k]);this.fa.addEventListener("load",function(){fg("Something loaded; request reformat.");c.na("reformat",b.id)})}d=this.Ja();"style.left"in this.ba&&(this.fa.style.left=parseFloat(this.ba["style.left"])+d.Ba+"px");"style.top"in this.ba&&(this.fa.style.top=parseFloat(this.ba["style.top"])+d.Ca+"px");d=0;for(k=this.children;d<k.length;d++)h=k[d],Xc(h)&&h.format(a,c)};a.prototype.Xx=function(a){this.rect=a;this.Ga=a.clone()};a.prototype.ia=function(a){var b=a.globalCompositeOperation;
a.globalCompositeOperation="destination-out";a.fillRect(this.Ga.x,this.Ga.y,this.Ga.width,this.Ga.height);a.globalCompositeOperation=b;a.strokeStyle="rgba(255,0,0,0.2)";a.lineWidth=3};a.prototype.Qi=function(){return!0};a.prototype.Fw=function(){if(this.parent&&Yc(this.parent)&&this.parent.fa){var a=this.parent.Le(this);if(-1===a)throw Error("Child node not found");var c=hg(this.parent.fa,this.ba.$component);a=this.parent.pk(a);c&&this.fa&&c.insertBefore(this.fa,a)}};a.prototype.Bm=function(){if(!this.fa)return this.rect;
var a=B(this.fa).Cm();return new H(this.rect.x-a.left,this.rect.y-a.top,this.rect.width+a.left+a.right,this.rect.height+a.top+a.bottom)};return a}(gg(ed));bd.fd("HTMLNode",af);function hg(c,a){for(var b=c.querySelectorAll("[container-for]"),d=null,e=0;e<b.length;e++)if(We(b[e],a)){d=b[e];break}if(d){b=d.parentElement;for(e=!0;b;){if(b.getAttribute("nid")){e=b==c;break}b=b.parentElement}if(e)return d}return c}function We(c,a){var b=c.getAttribute("container-for");return b&&0<=b.indexOf(a)}
function ig(c,a,b){void 0===a&&(a={});void 0===b&&(b="");for(var d in c){var e=c[d];e instanceof Object&&!(e instanceof Array)?ig(e,a,d+"."):a[b+d]=e}return a};var jg=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.log=x.create("PAGE",!0);b.fa=document.createElement("div");b.fa.classList.add("zwibbler-page");b.fa.setAttribute("nid",a);return b}__extends(a,c);a.prototype.type=function(){return"PageNode"};a.prototype.setProperty=function(a,d){if(void 0===d)delete this.ba[a];else switch(a){case "width":case "height":this.ba[a]=d;break;default:c.prototype.setProperty.call(this,a,d)}};a.prototype.lc=function(){return"width"in this.ba&&"height"in this.ba?
new Cc(this.ba.width,this.ba.height):null};a.prototype.format=function(){};a.prototype.xb=function(){return null};a.prototype.ia=function(){};return a}(gg(bd));ed.fd("PageNode",jg);var kg=x.create("BRUSH"),lg=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.la=[];b.uc=[];kg("New BrushNode created.");b.ba.points=[];b.ba.strokeStyle="#ff00ff";b.ba.lineWidth=10;return b}__extends(a,c);a.prototype.type=function(){return"BrushNode"};a.prototype.setProperty=function(a,d){"fillStyle"===a&&(a="strokeStyle");"dashes"===a||"lineCap"===a?this.ba[a]=d:c.prototype.setProperty.call(this,a,d)};a.prototype.ka=function(a){"fillStyle"===a&&(a="strokeStyle");return c.prototype.ka.call(this,
a)};a.prototype.format=function(){var a,c;this.la.length=0;var e=this.ba.points;var f=a=0;for(c=e.length-1;a<=c;f=a+=2)this.la.push(new G(e[f],e[f+1]));f=H.dh(this.la);e=this.Ja().$b();a=this.ba.lineWidth;f.Dd(a/e.x,a/e.y);this.Ga=f.clone();f=new Pc(f);f.transform(this.ba.matrix);this.rect=H.dh(f.la);this.uc=[];if("dashes"in this.ba)for(e=this.ba.dashes.split(","),f=0;f<e.length;f++)a=parseFloat(e[f]),isNaN(a)||this.uc.push(a)};a.prototype.xb=function(a,c){if(this.rect.gd(a,c)){var b=this.ae().apply(a,
c);if(Mc(this.la,b.x,b.y,12+this.ba.lineWidth/2))return this}return null};a.prototype.ef=function(b){var c=this.ba.points;if(0!==c.length){b.save();b.beginPath();var e=this.ka("lineCap")||"round";b.lineCap=e;b.lineJoin="round"===e?"round":"bevel";if(1<this.uc.length){e=this.la;var f=this.uc;if(0!==e.length){b.moveTo(e[0].x,e[0].y);var h=0;for(var k=1,l=f[0],n=e[0].clone(),q;k<e.length;)q=n.Lb(e[k]),0===q?k+=1:q<=l?(n=e[k].clone(),h&1?b.moveTo(n.x,n.y):b.lineTo(n.x,n.y),l-=q,k+=1):(n.x+=(e[k].x-n.x)*
l/q,n.y+=(e[k].y-n.y)*l/q,h&1?b.moveTo(n.x,n.y):b.lineTo(n.x,n.y),h=(h+1)%f.length,l=f[h])}}else for(b.moveTo(c[0],c[1]),e=f=2,h=c.length-1;f<=h;e=f+=2)b.lineTo(c[e],c[e+1]);this.ae().ag(b);yc(b,this.ba.strokeStyle);if(a.Bs){this.Ja().ag(b);b.beginPath();e=f=0;for(h=c.length-1;f<=h;e=f+=2)b.rect(c[e]-2,c[e+1]-2,4,4);b.fillStyle="#ff0000";b.fill()}b.restore()}};a.Bs=!1;return a}(ed);ed.fd("BrushNode",lg);function mg(c){return{m11:c.m11,m12:c.m21,m21:c.m12,m22:c.m22,dx:c.Ba,dy:c.Ca}}
var ng=function(){function c(a,b){this.node=a;this.request=b}c.prototype.Cu=function(a,b,c){this.node.Du(b,a,this.request,c)};c.prototype.Yu=function(a){return this.node.Zu(a)};c.prototype.Ve=function(){this.request.Lg(this.node.id)};c.prototype.$v=function(a,b){this.request.add(this.node.id,"image",a,null,b)};c.prototype.pu=function(a){this.node.Qp(a,!0)};c.prototype.sy=function(a){this.node.Qp(a,!1)};c.prototype.Eu=function(a,b){var c=new fd;b.text&&c.Sg(b.text);if(b.font){var e=fe(b.font);c.Nr(e.fontFamily||
"arial",parseFloat(e.fontSize),"bold"===e.fontWeight,"italic"===e.fontStyle,b.textDecoration||"")}c.En(b.halign||null,b.valign||null);c.format(a,b.width||0,b.height||0);return{draw:function(a,b,d){c.ia(a,b,d)},width:c.rect.width,height:c.rect.height}};c.prototype.$b=function(){return 1};c.prototype.Sw=function(a){return new he(a)};c.prototype.$d=function(a){return this.request.$d(a)};return c}(),og=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.Ta=null;b.log=x.create("CUSTOM");b.setProperty("matrix",
new J);return b}__extends(a,c);a.prototype.type=function(){return"CustomNode"};a.prototype.setProperty=function(a,d){if(null===this.Ta&&"nodeType"===a){var b=Q.Zl[d];this.Ta=new b(this.id);for(var f in this.ba)this.setProperty(f,this.ba[f]);this.ba.nodeType=d}else d=c.prototype.setProperty.call(this,a,d),"matrix"===a&&(d=mg(d)),this.Ta&&this.Ta.setProperty&&this.Ta.setProperty(a,d)};a.prototype.Ne=function(){return this.Ta&&this.Ta.hasEditMode?this.Ta.hasEditMode():!1};a.prototype.xm=function(){var a=
[];this.Ta&&this.Ta.getEditHandles&&(a=this.Ta.getEditHandles());for(var c=this.Ja(),e=[],f=0;f<a.length;f++){var h=a[f];e.push(c.apply(h.x||0,h.y||0))}return e};a.prototype.xb=function(a,c){var b=this.ae().apply(a,c);return this.hidden()||this.ka("locked")||!this.Ga.gd(b.x,b.y)||this.Ta&&this.Ta.hittest&&!this.Ta.hittest(b.x,b.y)?null:this};a.prototype.qj=function(a,c){a.beginPath();for(var b=10/c,d=2/c,h=0,k=this.xm();h<k.length;h++){var l=k[h];a.moveTo(l.x+b/c,l.y);a.arc(l.x,l.y,b,0,2*Math.PI,
!1)}a.strokeStyle="#0050B7";a.lineWidth=d;a.stroke()};a.prototype.Bj=function(){this.xm()};a.prototype.Yj=function(a,c,e){for(var b=this.xm(),d=0;d<b.length;d++)if(20>b[d].Lb(new G(a,c))/e)return d;return null};a.prototype.ge=function(a,c,e){this.Ta&&this.Ta.moveEditHandle&&(c=this.ae().apply(c,e),this.Ta.moveEditHandle(a,c.x,c.y))};a.prototype.ka=function(a){var b;this.Ta&&this.Ta.getProperty&&(b=this.Ta.getProperty(a));void 0===b&&(b=c.prototype.ka.call(this,a));"matrix"===a&&(b=b?b instanceof J?
b:new J(b.m11||1,b.m21||0,b.m12||0,b.m22||1,b.dx||0,b.dy||0):new J);return b};a.prototype.Zf=function(a){this.Ta.setHidden&&this.Ta.setHidden(a)};a.prototype.format=function(a,c){if(this.Ta)if(this.Nb||(this.Nb=new ng(this,c)),"format"in this.Ta&&this.Ta.format(a,this.Nb),this.Ta.getUntransformedRect){var b=this.Ta.getUntransformedRect();this.Ga=new H(b.x||0,b.y||0,b.width||0,b.height||0);this.rect=this.Ga.clone();this.rect.transform(this.Ja())}else this.log("Error: NodeType %s missing getUntransformedRect()",
this.ba.nodeType)};a.prototype.ef=function(a){a.save();a.getTransform=function(){return a.Bi?mg(a.Bi):mg(new J)};this.Nb.$b=function(){return a.Bi?a.Bi.$b().x:1};this.Ta.draw(a,this.Nb);a.restore()};return a}(ed);ed.fd("CustomNode",og);ng.prototype.formatFill=ng.prototype.Cu;ng.prototype.getFill=ng.prototype.Yu;ng.prototype.reformat=ng.prototype.Ve;ng.prototype.loadImage=ng.prototype.$v;ng.prototype.fillEraser=ng.prototype.pu;ng.prototype.strokeEraser=ng.prototype.sy;ng.prototype.formatText=ng.prototype.Eu;
ng.prototype.getScale=ng.prototype.$b;ng.prototype.parseFont=ng.prototype.Sw;ng.prototype.getConfig=ng.prototype.$d;var pg=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.Vc=null;b.zd=null;b.width=100;b.height=20;b.yc=new Pc;b.sf=[];b.nd=new H(0,0,b.width,b.height);b.tc=new H(0,0,b.width,b.height);b.log=x.create("IMAGE",!0);delete b.ba.fillStyle;delete b.ba.strokeStyle;delete b.ba.lineWidth;b.ba.url="";return b}__extends(a,c);a.prototype.type=function(){return"ImageNode"};a.prototype.setProperty=function(a,d){c.prototype.setProperty.call(this,a,d);switch(a){case "url":this.zd=this.Vc=null;break;case "brightness":case "contrast":case "gamma":this.zd=
null;this.ba[a]=d;break;case "allowCrop":case "crop":case "blendMode":case "opacity":case "width":case "height":this.ba[a]=d}};a.prototype.Lx=function(a){a.x=Math.max(a.x,0);a.y=Math.max(a.y,0);a.width=Math.min(a.width,this.nd.width);a.height=Math.min(a.height,this.nd.height);a.width=Math.max(1,a.width);a.height=Math.max(1,a.height);this.ba.crop=[a.x,a.y,a.width,a.height].join()};a.prototype.fq=function(){var a=this.ba.crop,c=new H(0,0,this.nd.width,this.nd.height);a&&(a=a.split(","),c.x=parseFloat(a[0])|
0,c.y=parseFloat(a[1])|0,c.width=parseFloat(a[2])|0,c.height=parseFloat(a[3])|0);return c};a.prototype.yx=function(){var a={brightness:this.ka("brightness"),contrast:this.ka("contrast"),gamma:this.ka("gamma")};this.zd=void 0!==a.brightness&&void 0!==a.contrast&&void 0!==a.gamma&&this.Vc?this.qu(this.Vc,a)||this.Vc:this.Vc};a.prototype.format=function(a,c){function b(a,b,c){n.sf.push({x:n.tc.x+a*n.tc.width,y:n.tc.y+b*n.tc.height,ee:c})}var d=this;null===this.Vc&&"ImageSurface"in window?(this.Vc=new window.ImageSurface(this.ba.url),
this.nd=new H(0,0,this.Vc.width,this.Vc.height)):null===this.Vc?(this.nd=new H(0,0,this.width,this.height),c.add(this.id,"image",this.ba.url,null,function(a){d.log("Got image response.");d.Vc=a;return c.Lg(d.id)})):this.nd=new H(0,0,this.Vc.width,this.Vc.height);if(null===this.zd&&(this.yx(),this.zd)){var h=this.ka("width"),k=this.ka("height");this.log("Override width/height as %s/%s",h,k);h&&(this.zd.style.width=h+"px");k&&(this.zd.style.height=k+"px")}this.tc=this.fq();this.rect=this.tc.clone();
if(h=this.ka("boundingPolygon")){k=[];for(var l=0;l<h.length;l+=2)k.push(new G(h[l],h[l+1]));this.yc=new Pc(k)}else this.yc=new Pc(this.rect);this.Ga=this.rect.clone();this.yc.transform(this.ba.matrix);this.rect.transform(this.ba.matrix);this.sf.length=0;var n=this;b(.5,0,!0);b(1,.5,!1);b(.5,1,!0);b(0,.5,!1)};a.prototype.zj=function(){return this.yc};a.prototype.xb=function(a,c){return!this.ba.locked&&this.yc.gd(a,c,3)?this:null};a.prototype.ef=function(b){var c,e,f=!1;if(this.zd)try{var h=b.globalCompositeOperation,
k=b.globalAlpha,l=this.ka("blendMode"),n=this.ka("opacity");l&&(b.globalCompositeOperation=""+l,this.log("Using globalCompsiteOperation=%s (requested %s)",b.globalCompositeOperation,l));void 0!==n&&(b.globalAlpha=n);var q=this.ka("lineWidth")||0;if(q){b.save();this.ae().ag(b);var u=this.yc.clone();u.Dd(q/2);b.beginPath();u.ia(b);b.lineWidth=q;b.strokeStyle=this.ka("strokeStyle")||"#000000";b.stroke();b.restore()}b.drawImage(this.zd,this.tc.x,this.tc.y,this.tc.width,this.tc.height,this.tc.x,this.tc.y,
this.tc.width,this.tc.height);b.globalAlpha=k;b.globalCompositeOperation=h;if(a.Fo){var v=this.yc.la;b.save();b.setTransform(1,0,0,1,0,0);b.beginPath();b.lineWidth=2;b.strokeStyle="#000000";b.moveTo(v[0].x,v[0].y);var w=c=1;for(e=v.length-1;c<=e;w=c+=1)b.lineTo(v[w].x,v[w].y);b.closePath();b.stroke();b.restore()}}catch(y){this.log("Error drawing image: %s",y.message),f=y}if(null===this.zd||f)b.save(),b.lineWidth=1,b.strokeStyle="#cccccc",b.strokeRect(0,0,this.width,this.height),b.restore()};a.prototype.Ne=
function(){return!0===this.ka("allowCrop")&&!0!==this.ka("lockEditMode")};a.prototype.qj=function(a,c){a.save();a.beginPath();a.lineWidth=1*c;a.strokeStyle="#0050B7";for(var b=this.Ja(),d=0;d<this.sf.length;d++){var h=this.sf[d],k=b.apply(h.x,h.y),l;if(h.ee){var n=20;var q=l=0;var u=3;h=k.x-10;k=k.y-6}else n=0,l=20,q=3,u=0,h=k.x-6,k=k.y-10;for(var v=0;5>v;v++)a.moveTo(h,k),a.lineTo(h+n*c,k+l*c),h+=q*c,k+=u*c}a.stroke();a.restore()};a.prototype.Yj=function(a,c,e){var b=this.Ja();e*=10;for(var d=0;d<
this.sf.length;d++){var k=this.sf[d];k=b.apply(k.x,k.y);if(k.x-e<=a&&a<k.x+e&&k.y-e<=c&&c<k.y+e)return d}return null};a.prototype.Bj=function(a){a=this.sf[a];this.Ja().apply(a.x,a.y)};a.prototype.ge=function(a,c,e){var b=this.fq();c=this.ae().apply(c,e);c.x=Math.round(c.x);c.y=Math.round(c.y);0===a&&0<=c.y&&c.y<this.nd.height?(b.height-=c.y-b.y,b.y=c.y):1===a&&0<=c.x&&c.x<this.nd.width?b.width=c.x-b.x:2===a&&0<=c.y&&c.y<this.nd.height?b.height=c.y-b.y:3===a&&0<=c.x&&c.x<this.nd.width&&(b.width-=c.x-
b.x,b.x=c.x);this.Lx(b)};a.prototype.qu=function(a,c){var b=a.width,d=a.height;if(!(a instanceof HTMLCanvasElement)){var h=document.createElement("canvas");h.width=b;h.height=d;h.getContext("2d").drawImage(a,0,0);a=h}h="number"===typeof c.brightness?c.brightness:-1;var k="number"===typeof c.contrast?c.contrast:-1,l="number"===typeof c.gamma?c.gamma:-1,n=document.createElement("canvas");this.log("filterSpec: %s",JSON.stringify(c));this.log("brightness=%s contrast=%s gamma=%s w=%s h=%s",h,k,l,b,d);
n.width=b+1;n.height=d;try{var q=a.getContext("2d").getImageData(0,0,b,d).data}catch(L){return this.log("Cannot filter external image."),null}b=n.getContext("2d").getImageData(0,0,b,d);d=b.data;for(var u=0;u<q.length;u+=4){var v=q[u]/255,w=q[u+1]/255,y=q[u+2]/255,z=q[u+3];0<=l&&(v=Math.pow(v,l),w=Math.pow(w,l),y=Math.pow(y,l));0<=h&&(v*=h,y*=h,w*=h);0<=k&&(v=v*k-.5*k+.5,w=w*k-.5*k+.5,y=y*k-.5*k+.5);d[u]=Math.min(255*v|0,255);d[u+1]=Math.min(255*w|0,255);d[u+2]=Math.min(255*y|0,255);d[u+3]=z}n.getContext("2d").putImageData(b,
0,0);return n};a.Fo=!1;return a}(ed);ed.fd("ImageNode",pg);var qg=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.Ni="UnknownNode";b.width=100;b.height=20;b.gb=new fd;b.log=x.create("UNKNOWN",!0);b.gb.En("center","middle");return b}__extends(a,c);a.prototype.$x=function(a){this.Ni=a;this.gb.Sg(a);this.log("Creating placeholder for node type %s",a)};a.prototype.type=function(){return this.Ni};a.prototype.setProperty=function(a,c){this.ba[a]=c};a.prototype.format=function(a){this.log("Formatting placeholder for %s",this.Ni);this.rect=new H(0,0,this.width,
this.height);this.rect.transform(this.ba.matrix);this.gb.format(a,this.width,this.height)};a.prototype.ef=function(a){this.log("Drawing placeholder for for %s",this.Ni);a.save();a.lineWidth=1;a.fillStyle="#888888";a.fillRect(0,0,this.width,this.height);a.fillStyle="#000000";this.gb.ia(a,0,0);a.restore()};a.Fo=!1;return a}(ed);ed.fd("UnknownNode",qg);var rg=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a["class"]="DataNode";return a}__extends(a,c);a.prototype.type=function(){return"DataNode"};a.prototype.Qi=function(){return!0};return a}(bd);bd.fd("DataNode",rg);var sg=x.create("RootNode"),tg=function(c){function a(a,d,e){a=c.call(this,a,d)||this;sg("Root node is constructed: Traits=%s",a.Rb);a.fa=e;return a}__extends(a,c);return a}(gg(bd));var qf=new Cc(816,1056),ug=x.create("DOC"),of=function(){function c(a,b,c){this.Ov=c;this.Oc=document.createElement("DIV");this.Sc=new rc;this.Zp=!0;this.Pb="0";this.Yh=new rc;this.removedNodes=new rc;this.ph=new rc;this.Sk=0;this.Rn="magenta";this.readOnly=!1;this.em=new rc;this.Ph=new rc;this.Bo=new rc;this.Md=[];this.Cr=this.Ag=this.zh=this.ab=0;this.gr=function(){};this.Bg=0;this.Oc.setAttribute("nid","0");this.root=new tg(this.Fj(),this,this.Oc);this.ub=new Db(this,this.root);this.lb=new Bb(this.ub,
sc(3),!0);a||(this.Va(),this.zc(this.fk(0)),this.va(!0));b&&this.Ts(b,c);this.Nq()}c.prototype.Ts=function(a,b){var c=this;B(a).query("[z-fixture]",function(a){var d=a.getAttribute("z-fixture")||"",e=new af(d,c);e.fa=a;e.Wp=!0;e.Qr(b);ug("Register fixture %s",d);e.fa.setAttribute("nid",d);c.ub.Ys(d,e)})};c.prototype.empty=function(){return 0===this.root.Ma()};c.prototype.Nq=function(){this.Cr=this.lb.next};c.prototype.Ee=function(){return this.Cr!==this.lb.next};c.prototype.Xa=function(){this.ub.Ic(function(a){a.Xa()})};
c.prototype.Fj=function(){var a=this.Pb;this.Pb=((2147483647*Math.random()|0)+1).toString(36);return a};c.prototype.Je=function(a){return this.ub.Je(a)};c.prototype.Zq=function(a){ug("onCreateNode: %s",a);"PageNode"!==a.type()&&(this.Yh.add(a.id),this.removedNodes.remove(a.id));a.ka("spotHighlight")&&"PathNode"===a.type()&&this.Md.push(a);this.Ag=this.be(a.id)||0;"DomNode"===a.type()?this.em.add(a.id):"PageNode"===a.type()&&(this.zh=-1);Xc(a)&&(a.vk(),a.Rg(this.readOnly),this.Sc.add(a.id),this.Bo.add(a.Cd()))};
c.prototype.Xh=function(a){this.ph.add(a);this.Ag=this.be(a)||0;this.Sc.add(a)};c.prototype.Ka=function(a,b){void 0===b&&(b=!1);if(this.ub.Je(a)){var c=this.ub.Ka(a);b&&(this.Sc.add(a),this.ph.add(a),this.Ag=this.be(a)||0);return c}return null};c.prototype.hb=function(a,b){void 0===b&&(b=!1);var c=this.Ka(a,b);return c&&Xc(c)?c:null};c.prototype.be=function(a){for(a=this.Ka(a,!1);;)if(a)if("PageNode"===a.type())break;else{if(null===a.parent)return null;a=a.parent}else return null;a=this.root.Le(a);
return 0<=a?a:null};c.prototype.rv=function(a){for(var b=[],c=0;c<a.length;c++){var e=this.Ka(a[c],!1);e&&b.push(e)}return b=this.$i(b)};c.prototype.uu=function(a){var b=[];this.ub.Ic(function(c){c.ka("tag")===a&&b.push(c)});return b};c.prototype.Va=function(){this.Bg++;ug("begin(); nested transactions=%s",this.Bg)};c.prototype.va=function(a){void 0===a&&(a=!1);this.Bg=Math.max(this.Bg-1,0);ug("commit(skip=%s); nested transactions=%s",a,this.Bg);0===this.Bg?(this.lb.va(!1,a),this.ub.va(!1)):ug("In a nested transaction; not committing.")};
c.prototype.transaction=function(a){this.Va();a(this);this.va()};c.prototype.wk=function(a){ug("onCommit occured");this.gr(a,this.Yh.Jb(),this.removedNodes.Jb(),this.ph.mj(this.Yh).mj(this.removedNodes).Jb());this.Yh=new rc;this.removedNodes=new rc;this.ph=new rc};c.prototype.Ac=function(){this.lb.Ac()};c.prototype.Id=function(){this.lb.Id()};c.prototype.Td=function(){return this.lb.Td()};c.prototype.Sd=function(){return this.lb.Sd()};c.prototype.Kk=function(){this.lb.Sl()};c.prototype.format=function(a,
b){var c=this,e=[],f;this.Zp?this.ub.Ic(function(a){Xc(a)&&e.push(a)}):this.Sc.Ic(function(a){a=c.ub.Ka(a);Xc(a)&&e.push(a);return!1});var h=this.$i(e);var k=0;for(f=h.length;k<f;k++){var l=h[k];l.format(a,b)}this.Sc.clear();this.Zp=!1;this.Jt();return e.length};c.prototype.du=function(a,b,c){if(0!==this.Md.length&&b===this.Sk){a.save();a.beginPath();b=c||this.lc();a.moveTo(b.x,b.y);a.lineTo(b.x,b.bottom());a.lineTo(b.right(),b.bottom());a.lineTo(b.right(),b.y);a.closePath();c=!1;for(var d=0;d<this.Md.length;d++)this.be(this.Md[d].id)===
this.ab&&(this.Md[d].clip(a),c=!0);c&&(a.clip(),a.fillStyle=this.Rn,a.fillRect(b.x,b.y,b.width,b.height));a.restore()}};c.prototype.Yd=function(a,b){var c=b||this.lc(),e=this.ka("background");e&&(e=r.Dh(e))&&(a.fillStyle=e.toString(),a.fillRect(c.x,c.y,c.width,c.height))};c.prototype.ia=function(a,b){function c(c){f.Mb(function(b){f.Ph.contains(b.Xb())||b.Cd()!==c||b.hidden()||(b.Mr(k++),b.ia(a))});f.du(a,c,b)}var e,f=this;this.Bo.add(this.Sk);var h=this.Bo.vy();h.sort(function(a,b){return a-b});
var k=0;var l=0;for(e=h.length;l<e;l++)c(h[l])};c.prototype.xb=function(a,b,c,e){var d=null;this.Mb(function(f){f.Xb()===c&&f.xb(a,b)&&(!(null===d||d.Cd()<=f.Cd())||e&&e!==f.type()||(d=f))});return d};c.prototype.Nv=function(a,b){var c=[],e=0,f={};this.Mb(function(d){d.xb(a,b)&&(c.push(d),f[d.id]=e,e+=1)});c.sort(function(a,b){return a.Cd()!=b.Cd()?a.Cd()-b.Cd():f[a.id]-f[b.id]});c.reverse();return c};c.prototype.tv=function(a){var b=[];this.Mb(function(c){a.contains(c.rect)&&b.push(c)});return b};
c.prototype.$i=function(a){var b,c=[],e={};var f=0;for(b=a.length;f<b;f++){var h=a[f];if(Xc(h)){for(;h.Rm()&&h.parent;)ug("Node type %s:%s is a group member",h.id,h.type()),Xc(h.parent)&&(h=h.parent);h.id in e||(e[h.id]=h,c.push(h))}}this.py(c);return c};c.prototype.Ic=function(a,b){function c(d){if(d.Ma()){a&&Xc(d)&&b(d);for(var e=0;e<d.Ma();e++)c(d.sb(e))}else Xc(d)&&b(d)}c(this.root)};c.prototype.Mb=function(a,b){function c(b){if(Xc(b)&&!1===a(b))return!1;if(0!=(b.Rb&2)){for(var d=[],e=0;e<b.Ma();e++)d.push(b.sb(e));
for(b=0;b<d.length;b++)if(!1===c(d[b]))return!1}}void 0===b&&(b=this.ab);b<this.root.Ma()&&c(this.root.sb(b||0))};c.prototype.Iu=function(a){var b=!1,c=a.zj(),e=[];this.Mb(function(d){b?d.zj().Sv(c)&&e.push(d):d===a&&(b=!0)});return e};c.prototype.py=function(a){var b=0,c={};this.Ic(!0,function(a){c[a.id]=b++});a.sort(function(a,b){return c[a.id]-c[b.id]})};c.prototype.Bx=function(a){var b,c=[];var e=0;var f=this.$i(a);var h=0;for(b=f.length;h<b;h++)a=f[h],e=this.ap(a,c,e,null);return"zwibblerclip."+
JSON.stringify(c)};c.prototype.ap=function(a,b,c,e){var d=a.Mc(),h={},k;for(k in d){var l=d[k];l instanceof J&&(l=["Matrix",l.m11,l.m12,l.m21,l.m22,l.Ba,l.Ca]);h[k]=l}b.push({type:"CreateAction",node:a.type(),parent:e,properties:h});e=c+1;for(d=0;d<a.Ma();d++)e=this.ap(a.sb(d),b,e,c);return e};c.prototype.Lq=function(a,b){var c,e;0===a.indexOf("zwibblerclip.")&&(a=a.substr(13));var f=[];var h=JSON.parse(a);var k={},l=0,n=0;var q=0;for(e=h.length;q<e;q++){var u=h[q];if("GroupAction"===u.type){var v=
this.Fj();k[l++]=v;v=[];var w=0;for(u=u.members;w<u.length;w++)v.push(k[u[w]]);u=this.group(v);k[l++]=u;f.push(u)}else if("CreateAction"===u.type){var y=u.properties;v={};for(c in y)y.hasOwnProperty(c)&&(w=y[c],"[object Array]"===Object.prototype.toString.apply(w)&&"Matrix"===w[0]&&(w.splice(0,1),w=new J(w)),v[c]=w);y=this.wm();var z=-1;w=!0;"parent"in u&&u.parent in k?(y=k[u.parent],w=!1):"PageNode"===u.node&&(y=this.root.id,z=this.ab+1+n,n+=1);v=this.createNode(u.node,v,y,z);k[l++]=v;("HTMLNode"!==
u.node||w)&&f.push(v)}}0!==n||b.Fq()||this.Nd(f,b)};c.prototype.px=function(a,b){var c="function"!==typeof b?function(a){return a===b}:b;for(var e=0,f=0;f<a.length;f++)c(a[f])?e+=1:e&&(a[f-e]=a[f]);a.length-=e};c.prototype.$q=function(a){var b=this.be(a.id)||0;this.Yh.remove(a.id);this.ph.remove(a.id);this.removedNodes.add(a.id);Xc(a)&&a.yk();a.Xa();this.Sc.remove(a.id);a.ka("spotHighlight")&&this.px(this.Md,a);this.em.remove(a.id);"PageNode"===a.type()?(b===this.ab&&(ug("Removed current page."),
this.zc(Math.min(b,this.Zb()-1)),this.Ag=this.ab),this.zh=-1):this.Ag=b};c.prototype.cq=function(a){function b(a){if(!k||a.rect.x<c)c=a.rect.x;if(!k||a.rect.right()>e)e=a.rect.right();if(!k||a.rect.y<f)f=a.rect.y;if(!k||a.rect.bottom()>h)h=a.rect.bottom();k=!0}var c=0,e=0,f=0,h=0,k=!1;"number"===typeof a?this.Mb(b,a):this.Ic(!1,b);return k?new H(c,f,e-c,h-f):new H(0,0,10,10)};c.prototype.Lv=function(){var a=this.zf(void 0),b=null;a instanceof jg&&(b=a.lc());return b||this.root.Nh("width")};c.prototype.lc=
function(a,b){var c=this.zf(a),e=null;c instanceof jg&&(e=c.lc());return e?e.bs():this.ka("width")?new H(0,0,this.ka("width"),this.ka("height")):b?b.bs():this.cq(a)};c.prototype.ka=function(a){return this.root.ka(a)};c.prototype.Nh=function(){return this.root};c.prototype.setProperty=function(a,b){this.Qb([this.root.id],a,b)};c.prototype.Qb=function(a,b,c){var d={};d[b]=c;this.Uc(a,d)};c.prototype.Uc=function(a,b){var c=this;this.rf(a,function(a){var d={},e;for(e in b)d[e]=a.ka(e);c.lb.We(a.id,b,
d)})};c.prototype.fr=function(a,b){this.Sc.add(a.id);if("spotHighlight"in b&&"PathNode"===a.type()){for(var c=0;c<this.Md.length;c++)if(this.Md[c]===a){this.Md.splice(c,1);break}b.spotHighlight&&"PathNode"===a.type()?(ug("Added node %s to spotHighlightNodes",a.id),this.Md.push(a)):ug("Removed node %s from spotHighlightNodes",a.id)}};c.prototype.si=function(a,b){ug("showLayer(%s, %s)",a,b);b?(this.Ph.remove(a),this.Mb(function(b){b.Xb()===a&&b.vk()})):(this.Ph.add(a),this.Mb(function(b){b.Xb()===a&&
b.yk()}))};c.prototype.Sm=function(a){return!this.Ph.contains(a)};c.prototype.fk=function(a){ug("Adding page to document with index %s",a);if(a>this.root.Ma())return ug("Error: Can insert page with index %s",a),-1;this.createNode("PageNode",{},this.root.id,a);return a};c.prototype.Zb=function(){return this.root.Ma()};c.prototype.zc=function(a){if(a!==this.ab){if(0<=a&&a<this.Zb())return ug("Set current page to %s/%s",a,this.Zb()),this.ab=a,!0;ug("Tried to set page to non-existing %s",a);return!1}};
c.prototype.iy=function(){this.zh!==this.ab&&(this.io(this.zh,!1),this.io(this.ab,!0),this.zh=this.ab)};c.prototype.io=function(a,b){var c=this;b?this.Mb(function(a){"DomNode"!==a.type()||c.Ph.contains(a.Xb())||a.vk()},a):this.em.Ic(function(a){(a=c.hb(a,!1))&&a.yk()})};c.prototype.zf=function(a){return 0===this.root.Ma()?this.root:void 0===a?this.root.sb(this.ab):this.root.sb(a)};c.prototype.Ij=function(){return this.lc(this.ab,qf)};c.prototype.Rg=function(a){this.Ic(!1,function(b){b.Rg(a)})};c.prototype.getRootNode=
function(){return this.root};c.prototype.gw=function(a,b){var c=b.$type||"",e=bd.create(c,a,this);e||(c in Q.Zl?(e=new og(a,this),e.setProperty("nodeType",c)):(ug("Bad node type: %s",c),e=bd.create("UnknownNode",a,this),e.$x(c)));5===(e.Rb&5)&&e.Qr(this.Ov);e.We(b);return e};c.prototype.createNode=function(a,b,c,e,f){f||(f=this.Fj());c||(c=this.wm());var d=this.Ka(c);if(!d)throw Error("createNode type="+a+": parent "+c+" does not exist");if(void 0===e||-1==e)e=d.Ma();b.$type=a;this.lb.createNode(f,
c,e,b);return f};c.prototype.rf=function(a,b){for(var c=0;c<a.length;c++){var e=a[c],f=this.Ka(e);f?b(f):ug("Node %s does not exist",e)}};c.prototype.Ub=function(a){function b(a){for(var d=a.Ma()-1;0<=d;d--)b(a.sb(d));c.lb.Xd(a.id,a.parent.id,a.parent.Le(a))}var c=this;this.rf(a,function(a){a.parent?b(a):ug("deleteNode(%s): node has no parent",a.id)})};c.prototype.Nd=function(a,b){var c=this;this.rf(a,function(a){if(Xc(a)){var d=b.multiply(a.Ja());c.Qb([a.id],"matrix",d)}})};c.prototype.ge=function(a,
b,c,e){var d=this.hb(a,!0);if(d&&d.Ne()){var h=d.jq(),k=d.ka(h);d.ge(b,c,e);b=d.ka(h);d.setProperty(h,k);this.Qb([a],h,b)}};c.prototype.wm=function(){return this.root.sb(this.ab).id};c.prototype.group=function(a){var b=this.createNode("GroupNode",{});this.Oi(b,a);return b};c.prototype.Oi=function(a,b){var c=this,e=0;this.rf(b,function(b){if(!b.parent)throw Error("Expected node to have a parent");c.lb.Pc(b.id,a,e++,b.parent.id,b.parent.Le(b))})};c.prototype.Xg=function(a){var b=this,c={};this.rf(a,
function(a){if(a instanceof Ce&&!(a.id in c)&&a.parent){c[a.id]=!0;for(var d=a.parent.Ma(),e=a.Ma()-1;0<=e;e--)b.lb.Pc(a.children[e].id,a.parent.id,d,a.id,e);b.Ub([a.id])}})};c.prototype.duplicate=function(a,b,c){function d(a,b){var c=a.Mc();"matrix"in c&&(c.matrix=h.multiply(c.matrix));c=f.createNode(a.type(),c,b);if(0!=(a.Rb&2))for(var e=0;e<a.Ma();e++)d(a.sb(e),c)}var f=this,h=new Fc(b,c);this.rf(a,function(a){null!==a.parent&&d(a,a.parent.id)})};c.prototype.Pc=function(a,b,c){var d=this.Ka(a);
if(null===d)throw Error("moveNode: "+a+" does not exist");var f=this.Ka(b);if(null===f)throw Error("moveNode: New parent "+b+" does not exist");-1===c&&(c=d.parent!==f?f.Ma():f.Ma()-1);if(null===d.parent)throw Error("Expected a parent");f===d.parent&&c===d.parent.Le(d)?ug("moveNode: Skip moving to the same place"):this.lb.Pc(a,b,c,d.parent.id,d.parent.Le(d))};c.prototype.Yc=function(a,b,c){var d=this;void 0===c&&(c=-1);this.rf(a,function(a){if(a.parent){var e=a.parent.id,f=a.parent.Le(a);switch(b){case 0:d.Pc(a.id,
e,-1);break;case 1:d.Pc(a.id,e,0);break;case 3:0<f&&d.Pc(a.id,e,f-1);break;case 2:f<a.parent.Ma()-1&&d.Pc(a.id,e,f+1);break;case 4:d.Pc(a.id,e,c)}}})};c.prototype.toString=function(){return this.encode(this.root)};c.prototype.encode=function(a,b){void 0===b&&(b="");if(!(a instanceof bd))return b+"NOT A NODE: "+a+"\n";var c=a.type();c=b+a.id+": "+c+"\n";for(var e=0;e<a.Ma();e++)c+=this.encode(a.sb(e),b+"  ");return c};c.prototype.zm=function(a){if(a instanceof Element)for(;a;){var b=a.getAttribute("nid");
if(b&&(b=this.Ka(b))&&5===(b.Rb&5))return b;a=a.parentElement}return null};c.prototype.Jt=function(){this.To(this.Oc,new J,null,0,0)};c.prototype.To=function(a,b,c,e,f){if(a instanceof HTMLElement){var d=a.offsetLeft-a.scrollLeft,k=a.offsetTop-a.scrollTop;c===a.offsetParent&&(d-=e,k-=f);b=b.multiply(new Fc(d,k));c=a.getAttribute("nid")||"0";(c=this.Ka(c))&&Zc(c)&&(e=new H(0,0,c.fa.offsetWidth,c.fa.offsetHeight),e.transform(b),c.Xx(e));for(c=a.firstElementChild;c;)this.To(c,b,a.offsetParent,a.offsetLeft,
a.offsetTop),c=c.nextElementSibling}};c.prototype.Im=function(){return this.lb.Im()};c.prototype.locked=function(){return this.lb.locked()};c.prototype.Km=function(a){return this.lb.Km(a)};return c}();var pf=new (function(){function c(){this.log=x.create("serializer");this.Do={pdf:"application/pdf",svg:"image/svg+xml",png:"image/png",jpeg:"image/jpeg",jpg:"image/jpeg",bmp:"image/bmp"}}c.prototype.fh=function(a,b,c){if(a instanceof Array)b=this.Aq(a,b,c);else{if("string"!==typeof a)return this.log("Can only open an array or string as a document."),null;if("{"===a.charAt(0))b=this.aw(a,b,c);else if(0===a.indexOf("zwibbler3."))a=JSON.parse(a.substr(10)),b=this.Aq(a,b,c);else if(0===a.indexOf("zwibblerclip."))b=
new of(!1,b,c),b.Lq(a,new J),b.Kk();else throw Error("Format detection failed.");}for(a=1;a<b.Zb();a++)b.io(a,!1);return b};c.prototype.aw=function(a,b,c){function d(a){var b=new J;b.m11=a.m11;b.m12=a.m12;b.m21=a.m21;b.m22=a.m22;b.Ba=a.dx;b.Ca=a.dy;return b}function f(a,b){switch(a.type){case "Node":for(var c=[],e=a.children,h=e.length-1;0<=h;h--)try{c.push(f(e[h],b+1))}catch(D){}return 0<b?k.group(c):"";case "PathNode":case "ArrowNode":var l=a;e=0;"arrowSize"in l&&(e=l.arrowSize,l=l.path);c=d(l.matrix);
e={strokeStyle:l.strokeStyle,fillStyle:l.fillStyle,lineWidth:l.lineWidth,smoothness:l.smoothness,sloppiness:l.sloppiness,shadow:l.shadow,arrowSize:e,seed:Math.round(65535*Math.random())};"textNode"in l&&(h=l.textNode,e.fontSize=h.fontSize,e.fontName=h.fontName,e.text=h.text,e.textFillStyle="textFillStyle"in h?h.textFillStyle:h.fillStyle);"path"in l&&(l=l.path);var n=l.startX,q=l.startY;h=l.closed;var S=new N;l=l.segments;n=c.apply(n,q);S.moveTo(n.x,n.y);for(n=0;n<l.length;n++){var E=l[n];switch(E.type){case 1:q=
c.apply(E.x,E.y);S.lineTo(q.x,q.y);break;case 2:q=c.apply(E.x,E.y);S.vh(q.x,q.y);break;case 3:q=c.apply(E.x1,E.y1);E=c.apply(E.x,E.y);S.pf(q.x,q.y,E.x,E.y);break;default:throw"Unknown path segment type: "+E.type;}}h&&S.close();e.commands=S.Jb();return k.createNode("PathNode",e);case "TextNode":return c=d(a.matrix),c=c.multiply(new Fc(0,1.3*a.fontSize)),k.createNode("TextNode",{fillStyle:a.fillStyle,lineWidth:0,text:a.text,fontName:a.fontName,fontSize:a.fontSize,matrix:c});default:throw Error("Unknown node type: "+
a.type);}}var h=x.create("IMPORT"),k=new of(!1,b,c);try{var l=JSON.parse(a)}catch(n){a=a.replace(/\\\\/g,"\\").replace(/\\"/g,'"');try{l=JSON.parse(a)}catch(q){throw h("Couldn't parse file."),"Couldn't parse file.";}}h("Successfully parsed!");f(l,0);k.va(!0);return k};c.prototype.Aq=function(a,b,c){function d(a,b){if(void 0!==a){var c={};for(var e in a)a.hasOwnProperty(e)&&"children"!==e&&"parent"!==e&&"id"!==e&&"type"!==e&&(c[e]="matrix"===e?new J(a[e]):a[e]);e=a.id;0!==a.id&&n.createNode(a.type,
c,b,-1,e.toString(36));if(void 0!==a.children)for(c=0;c<a.children.length;c++)d(a.children[c],e.toString(36))}}a=JSON.parse(JSON.stringify(a));var f={};var h=!1;for(var k=0,l=a;k<l.length;k++)if("PageNode"===l[k].type){h=!0;break}var n=new of(h,b,c);n.Va();for(b=0;b<a.length;b++)if(c=a[b],"document"===c.type)for(delete c.type,h=0,k=c;h<k.length;h++)l=k[h],n.setProperty(l,c[l]);else{if("parent"in c){if(!(c.parent in f))throw Error("Error: child "+c.id+" references parent "+c.parent+" before it was defined.");
h=f[c.parent];void 0!==h.children?h.children.push(c):h.children=[c]}"GroupNode"!==c.type&&"PageNode"!==c.type||void 0!==c.children||(c.children=[]);f[c.id]=c}d(f[0],"0");n.va(!0);return n};c.prototype.Sp=function(a){function b(a,d){var e={id:parseInt(d.id,36),type:d.type()};c.push(e);a&&(e.parent=parseInt(a.id,36));var f=d.Mc(),l;for(l in f)f.hasOwnProperty(l)&&("matrix"===l?e[l]=f[l].Jb():"inverse"!==l&&(e[l]=f[l]));for(e=0;e<d.Ma();e++)b(d,d.sb(e))}var c=[];b(null,a.getRootNode());return c};c.prototype.Di=
function(a,b,c){b in this.Do&&(b=this.Do[b]);if("list"===b)a=this.Sp(a),b="application/json";else if("zwibbler3"===b)a=this.Sp(a),a="zwibbler3."+JSON.stringify(a),b="application/octet-stream";else if("image/svg+xml"===b){var d=a.lc();var f=new je(d);a.Yd(f);a.ia(f);a=f;b="image/svg+xml"}else if("application/pdf"===b){d=a.lc(0);f=new Ae(new H(0,0,d.width,d.height),Q.fonts);var h=a.ab;for(b=0;b<a.Zb();b++)0<b&&(d=a.lc(b),f.Ug(d)),f.translate(-d.x,-d.y),a.zc(b),a.Yd(f),a.ia(f);a.zc(h);a=f;b="application/pdf"}else if(!(d=
"image/png"===b||"image/bmp"===b)&&(d="image/jpeg"==b)&&(d=document.createElement("canvas"),f=!1,d.width=10,d.height=10,"toDataURL"in d&&(f=0<d.toDataURL("image/jpeg").indexOf("jpeg")),tc("JPEG supported: %s",f),d=f),d)f=document.createElement("canvas"),d=a.lc(),f.width=d.width,f.height=d.height,h=f.getContext("2d"),h.translate(-d.x,-d.y),a.Yd(h),a.ia(h),a="image/bmp"===b?xc(f):f.toDataURL(b),a=a.split(",")[1],a=atob(a);else throw"Unknown save format: "+b;if("string"===typeof a)if("string"===c)var k=
a;else if("data-uri"===c)k="data:"+b+";base64,"+Ba(a);else{if("blob"===c)for(c=new Uint8Array(a.length),b=0;b<a.length;b++)c[b]=a.charCodeAt(b)}else if(a.toBlob&&a.toString)"string"===c?k=a.toString():"data-uri"===c?k="data:"+b+";base64,"+Ba(a.toString()):"blob"===c&&(k=a.toBlob());else if("object"===c)k=a;else throw"Error in ZwibblerDocument.save()";return k};return c}());"undefined"!==typeof jQuery&&(jQuery.fn.zwibbler=function(c){void 0===c&&(c={});var a=null;this.each(function(b,d){d.zwibbler&&jQuery(d).empty();a=new W(d,c);d.zwibbler=a});return a},jQuery.fn.zwibblerContext=function(){return this[0].zwibbler});
var Y=function(){function c(){this.Pm=[];this.buttons=[];this.Zl={};this.fonts=new ye;this.De={};this.log=x.create("ZWIBBLER");this.WebSocket=WebSocket;this.controllers={};this.ss=W}c.prototype.create=function(a,b){"string"===typeof a&&0<a.length&&"."!==a.charAt(0)&&"#"!==a.charAt(0)&&(a="#"+a);var c=B.Wb(a);return c?new W(c,b):(alert("Zwibbler.create: Cannot find an element with id "+a),null)};c.prototype.Qs=function(a){for(var b=["name","image","onclick"],c=0;c<b.length;c++)if(!(b[c]in a))return alert("Zwibbler.addButton: missing "+
b[c]),!1;this.buttons.push(a);return!0};c.prototype.Ss=function(a,b){this.Zl[a]=b};c.prototype.As=function(a,b){void 0===b&&(b={});return this.ql(a,b)};c.prototype.ql=function(a,b){void 0===b&&(b={});return ec(a,b)};c.prototype.Vt=function(a,b){return this.Tf(a,b)};c.prototype.wb=function(a,b){P.wb(a,function(a,c,f,h){b(new hc(P,a,c,f,h))})};c.prototype.Tf=function(a,b,c){function d(){var a=y.lc(),b=1,d=0,e=0;l&&(a.y=l);u&&(a.height=u-a.y);n&&(a.x=n);q&&(a.width=q-a.x);h&&k?b=Math.min(h/a.width,k/
a.height):h?(b=h/a.width,k=a.height*b):k?(b=k/a.height,h=a.width*b):(h=a.width,k=a.height);a.width*b<h&&(d=h/2-a.width*b/2);a.height*b<k&&(e=k/2-a.height*b/2);d-=a.x*b;e-=a.y*b;v.width=Math.ceil(h);v.height=Math.ceil(k);w.translate(d,e);w.scale(b,b);y.ia(w);f.log("Drawn.");c(v)}var f=this;void 0===b&&(b={});void 0===c&&(c=function(){});var h=b.width||0,k=b.height||0,l=b.top||0,n=b.left||0,q=b.right||0,u=b.bottom||0,v=uc(null),w=v.getContext("2d"),y=pf.fh(a,null,{});if(!y)throw Error("Zwibbler.render: Could not open document");
var z=new Be;y.format(w,z);z.pa("reformat",function(a){y.Xh(a)});z.kg?z.pa("done",function(){y.format(w,z);d()}):d();return v};c.prototype.save=function(a,b){return new Tb(function(c,e){var d=pf.fh(a,null,{});if(d){d.Nh("background")||d.setProperty("background","white");var h=uc(null).getContext("2d"),k=new Be;k.pa("reformat",function(a){d.Xh(a)});k.pa("done",function(){try{d.format(h,k);var a=pf.Di(d,b,"string");c(a)}catch(n){e(n)}});d.format(h,k)}else e(Error("Failed to open document"))})};c.prototype.Rw=
function(a){a=r.Zd(a);return{r:a.values[0],g:a.values[1],b:a.values[2],a:a.values[3]}};c.prototype.ew=function(a){return(new r(r.RGBA,[a.r,a.g,a.b,a.a])).toString()};c.prototype.Fu=function(a){var b=document.createElement("a");b.href=a;return b.href};c.prototype.nt=function(a){return Ba(a)};c.prototype.Us=function(a,b){var c=this;return this.fonts.add(a,b).then(function(d){b||(b=d.yj);c.Pe('\n@font-face {\n    font-family: "'+b+'";\n    src: url("'+a+'");\n}');return b})};c.prototype.zs=function(a){return new N(a)};
c.prototype.rs=function(a){var b=new N,c;void 0===c&&(c=null);a=a.match(/[A-Z]|[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/gi);var e=0,f=0,h,k=0,l=0,n=[];if(a)for(h=0;h<a.length;h++){var q=a[h++];var u=a;for(n.length=0;h<u.length;h++){var v=parseFloat(u[h]);if(isNaN(v)){h--;break}else n.push(v)}if("M"===q){b.moveTo(n[0],n[1]);for(q=2;q<n.length;q+=2)b.lineTo(n[q],n[q+1]);e=n[n.length-2];f=n[n.length-1]}else if("m"===q)for(b.moveTo(n[0]+e,n[1]+f),e=n[0]+e,f=n[1]+f,q=2;q<n.length;q+=2)b.lineTo(n[q]+e,n[q+
1]+f),e=n[q]+e,f=n[q+1]+f;else if("L"===q){for(q=0;q<n.length;q+=2)b.lineTo(n[q],n[q+1]);e=n[n.length-2];f=n[n.length-1]}else if("l"===q)for(q=0;q<n.length;q+=2)b.lineTo(n[q]+e,n[q+1]+f),e=n[q]+e,f=n[q+1]+f;else if("H"===q)for(q=0;q<n.length;q+=1)b.lineTo(n[q],f),e=n[q];else if("h"===q)for(q=0;q<n.length;q+=1)b.lineTo(n[q]+e,f),e=n[q]+e;else if("V"===q)for(q=0;q<n.length;q+=1)b.lineTo(e,n[q]),f=n[q];else if("v"===q)for(q=0;q<n.length;q+=1)b.lineTo(e,n[q]+f),f=n[q]+f;else if("Q"===q)for(q=0;q<n.length;q+=
4)b.quadraticCurveTo(n[q],n[q+1],n[q+2],n[q+3]),k=n[q],l=n[q+1],e=n[q+2],f=n[q+3];else if("C"===q)for(q=0;q<n.length;q+=6)b.bezierCurveTo(n[q],n[q+1],n[q+2],n[q+3],n[q+4],n[q+5]),k=n[q+2],l=n[q+3],e=n[q+4],f=n[q+5];else if("c"===q)for(q=0;q<n.length;q+=6)b.bezierCurveTo(n[q]+e,n[q+1]+f,n[q+2]+e,n[q+3]+f,n[q+4]+e,n[q+5]+f),k=n[q+2]+e,l=n[q+3]+f,e=n[q+4]+e,f=n[q+5]+f;else if("S"===q)for(q=0;q<n.length;q+=4)k=e+e-k,l=f+f-l,b.bezierCurveTo(k,l,n[q],n[q+1],n[q+2],n[q+3]),k=n[q],l=n[q+1],e=n[q+2],f=n[q+
3];else if("s"===q)for(q=0;q<n.length;q+=4)k=e+e-k,l=f+f-l,b.bezierCurveTo(k,l,n[q]+e,n[q+1]+f,n[q+2]+e,n[q+3]+f),k=n[q]+e,l=n[q+1]+f,e=n[q+2]+e,f=n[q+3]+f;else"z"===q||"Z"===q?b.closePath():c?c(q,n):Bc("Unknown command: %s",q)}return b.Jb()};c.prototype.lq=function(a,b){var c=document.createElement("img");c.src=a;c.onload=function(){b(c.naturalWidth,c.naturalHeight,c)}};c.prototype.Kx=function(a,b){return vc(a,b)};c.prototype.yy=function(a){return this.vi(a)};c.prototype.hk=function(){var a=document.createElement("DIV");
return!!(a.requestFullscreen||a.msRequestFullscreen||a.pw||a.webkitRequestFullscreen)};c.prototype.vi=function(a){var b=B.Wb(a);if(!b)throw Error("Zwibbler.toggleFullScreen: "+a+" not found");a=document;this.Eq()?document.exitFullscreen?document.exitFullscreen():a.msExitFullscreen?a.msExitFullscreen():a.ow?a.ow():a.webkitExitFullscreen&&a.webkitExitFullscreen():b.requestFullscreen?b.requestFullscreen():b.msRequestFullscreen?b.msRequestFullscreen():b.pw?b.mozRequestFullScreen():b.webkitRequestFullscreen?
b.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):console.log("Element does not contain any requestFullscreen methods")};c.prototype.Eq=function(){var a=document;return a.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement||a.msFullscreenElement?!0:!1};c.prototype.iu=function(){x.hu()};c.prototype.uq=function(a){return Me.vs(a)};c.prototype.Pe=function(a){ac(a)};c.prototype.controller=function(a,b){this.controllers[a]=b};c.prototype.bj=function(a,b){P.bj(a,b);this.De[a]=b};
c.prototype.Ru=function(a){return a in this.De?JSON.parse(JSON.stringify(this.De[a].ta||{})):{}};c.prototype.ej=function(a,b,c,e){void 0===c&&(c={});void 0===e&&(e=null);if("object"!==typeof a||"string"!==typeof b)throw Error("Bad arguments passed to createComponent");return P.ej(a,b,c,e)};c.prototype.sc=function(a,b){var c=B.Wb(a);if(!c)throw Error("Zwibbler.attach: Cannot find element from "+a);return dg(c,b,!0)};c.prototype.at=function(a){return"string"!==typeof a.url?Tb.reject(Error("Zwibbler.ajax: settings.url missing")):
Yb({url:a.url,method:a.method,ir:a.params,mimeType:a.mimeType,contentType:a.contentType,withCredentials:a.withCredentials,data:a.data,Hp:a.delay}).then(function(a){P.digest();return a},function(a){P.digest();throw a;})};return c}();document.addEventListener("dragstart",function(c){var a=c.target;"IMG"===a.tagName&&(a={"zwibbler-src":a.getAttribute("zwibbler-src"),"zwibbler-width":a.getAttribute("zwibbler-width")},a["zwibbler-src"]&&c.dataTransfer.setData("text",JSON.stringify(a)))});var Q=new Y;
Q.instances=Q.Pm;Y.prototype.addButton=Y.prototype.Qs;Y.prototype.addCustomNode=Y.prototype.Ss;Y.prototype.Popup=Y.prototype.As;Y.prototype.Dialog=Y.prototype.ql;Y.prototype.createPreview=Y.prototype.Vt;Y.prototype.directive=Y.prototype.wb;Y.prototype.render=Y.prototype.Tf;Y.prototype.save=Y.prototype.save;Y.prototype.parseColour=Y.prototype.Rw;Y.prototype.makeColour=Y.prototype.ew;Y.prototype.getAbsoluteUrl=Y.prototype.Fu;Y.prototype.base64Encode=Y.prototype.nt;Y.prototype.addFont=Y.prototype.Us;
Y.prototype.PathCommands=Y.prototype.zs;Y.prototype.CommandsFromSvgPath=Y.prototype.rs;Y.prototype.getImageSize=Y.prototype.lq;Y.prototype.setColourOpacity=Y.prototype.Kx;Y.prototype.toggleFullScreen=Y.prototype.yy;Y.prototype.isFullscreenSupported=Y.prototype.hk;Y.prototype.toggleFullscreen=Y.prototype.vi;Y.prototype.isFullScreen=Y.prototype.Eq;Y.prototype.enableConsoleLogging=Y.prototype.iu;Y.prototype.hasConfig=Y.prototype.uq;Y.prototype.injectStyle=Y.prototype.Pe;Y.prototype.controller=Y.prototype.controller;
Y.prototype.component=Y.prototype.bj;Y.prototype.createComponent=Y.prototype.ej;Y.prototype.attach=Y.prototype.sc;Y.prototype.ajax=Y.prototype.at;Y.prototype.Context=Y.prototype.ss;window.Zwibbler=Q;var Cf={style:".zwibbler-builtin-toolbar {\n    background: white;\n    width: 130px;\n    overflow-y: auto;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none; \n     -khtml-user-select: none; \n       -moz-user-select: none; \n        -ms-user-select: none; \n            user-select: none; \n}\n\n.zwibbler-builtin-toolbar button {\n    font-family: inherit;\n    font-size: 100%;\n    padding: 5px;\n    background-color: white;\n    border: none;\n}\n\n.zwibbler-builtin-toolbar button img {\n    margin: 0;\n}\n\n.zwibbler-builtin-toolbar button:hover,\n.zwibbler-builtin-toolbar button.selected {\n    background-color: #9fb3e7;\n}\n",
Zj:'<div class="zwibbler-builtin-toolbar">\n<button \n    z-if="getConfig(\'showPickTool\')"\n    z-click="usePickTool()"\n    z-selected="getCurrentTool()===\'pick\'"\n    title="Pick">\n    <img z-bind:src="getImageUrl(\'wd-pick.png\')">\n</button>\n<button \n    z-if="getConfig(\'showSquareTool\')"\n    z-click="useRectangleTool()"\n    z-selected="getCurrentTool()===\'rectangle\'"\n    title="Rectangle">\n    <img z-bind:src="getImageUrl(\'wd-box.png\')">\n</button>\n<button \n    z-if="getConfig(\'showRoundRectTool\')"\n    z-click="useRoundRectTool()"\n    title="Rounded Rectangle">\n    <img z-bind:src="getImageUrl(\'wd-roundrect.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCircleTool\')"\n    z-click="useCircleTool()"\n    z-selected="getCurrentTool()===\'circle\'"\n    title="Circle">\n    <img z-bind:src="getImageUrl(\'wd-circle.png\')">\n</button>\n<button \n    z-if="getConfig(\'showShapeBrushTool\')"\n    z-click="useShapeBrushTool()"\n    title="Shape brush">\n    <img z-bind:src="getImageUrl(\'wd-shapebrush.png\')">\n</button>\n<button \n    z-if="getConfig(\'showBrushTool\')"\n    z-click="useBrushTool()"\n    z-selected="getCurrentTool()===\'brush\'"\n    title="Brush">\n    <img z-bind:src="getImageUrl(\'wd-brush.png\')">\n</button>\n<button \n    z-if="getConfig(\'showLineTool\')"\n    z-click="useLineTool()"\n    z-selected="getCurrentTool()===\'line\'"\n    title="Lines">\n    <img z-bind:src="getImageUrl(\'wd-line.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCurveTool\')"\n    z-click="useCurveTool()"\n    z-selected="getCurrentTool()===\'curve\'"\n    title="Curves">\n    <img z-bind:src="getImageUrl(\'wd-curve.png\')">\n</button>\n<button \n    z-if="getConfig(\'showArrowTool\')"\n    z-click="useArrowTool()"\n    z-selected="getCurrentTool()===\'arrow\'"\n    title="Arrows">\n    <img z-bind:src="getImageUrl(\'wd-arrow.png\')">\n</button>\n<button \n    z-if="getConfig(\'showTextTool\')"\n    z-selected="getCurrentTool()===\'text\'"\n    z-click="useTextTool()"\n    title="Text">\n    <img z-bind:src="getImageUrl(\'wd-text.png\')">\n</button>\n<button \n    z-if="getConfig(\'showImageTool\')"\n    z-click="insertImage()"\n    title="Insert image...">\n    <img z-bind:src="getImageUrl(\'wd-image.png\')">\n</button>\n<button \n    z-if="getConfig(\'showMoveToFrontBack\')"\n    z-click="bringToFront()"\n    title="Bring to front">\n    <img z-bind:src="getImageUrl(\'wd-moveup.png\')">\n</button>\n<button \n    z-if="getConfig(\'showMoveToFrontBack\')"\n    z-click="sendToBack()"\n    title="Send to back">\n    <img z-bind:src="getImageUrl(\'wd-movedown.png\')">\n</button>\n<button \n    z-if="getConfig(\'showUndoRedo\')"\n    z-disabled="!canUndo()"\n    z-click="undo()"\n    title="Undo">\n    <img z-bind:src="getImageUrl(\'wd-undo.png\')">\n</button>\n<button \n    z-if="getConfig(\'showUndoRedo\')"\n    z-disabled="!canRedo()"\n    z-click="redo()"\n    title="Redo">\n    <img z-bind:src="getImageUrl(\'wd-redo.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCopyPaste\')"\n    z-click="copy()"\n    title="Copy">\n    <img z-bind:src="getImageUrl(\'wd-copy.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCopyPaste\')"\n    z-click="paste()"\n    title="Paste">\n    <img z-bind:src="getImageUrl(\'wd-paste.png\')">\n</button>\n<button\n    z-for="button in _zwibblerButtons"\n    z-bind:title="button.name"\n    z-click="_zwibblerButtonClicked(this, button)">\n    <img z-bind:src="getImageUrl(button.image)">\n</button>\n</div>\n',
controller:function(c){c._zwibblerButtons=Q.buttons;c._zwibblerButtonClicked=function(a,b){b.onclick.call(a,c)}}};}).call(window);
//# sourceMappingURL=zwibbler-demo.js.map